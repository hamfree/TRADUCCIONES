<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="../css/JSP-Styles.css" type="text/css">
<title>Encabezados de solicitud - La Lección</title>
</head>
<body>
	<h1>Encabezados de solicitud</h1>
	<h2>La Lección</h2>
	<h3>Agenda</h3>
	<ul>
		<li class="n1">Reading HTTP request headers</li>
		<li class="n1">Building a table of all the request headers</li>
		<li class="n1">Understanding the various request headers</li>
		<li class="n1">Reducing download times by compressing pages</li>
		<li class="n1">Differentiating among types of browsers</li>
	</ul>
	<hr>

	<h3>A Typical HTTP Request</h3>
	GET /search-servlet?keywords=servlets+jsp HTTP/1.1
	<br>
	<span class="rojo">Accept</span>: image/gif, image/jpg, */*
	<br>
	<span class="rojo">Accept-Encoding</span>: gzip
	<br>
	<span class="rojo">Connection</span>: Keep-Alive
	<br>
	<span class="rojo">Cookie</span>: userID=id456578
	<br>
	<span class="rojo">Host</span>: www.somebookstore.com
	<br>
	<span class="rojo">Referer</span>:
	http://www.somebookstore.com/findbooks.html
	<br>
	<span class="rojo">User-Agent</span>: Mozilla/4.0 (compatible; MSIE
	6.0; Windows NT 5.0)
	<br>

	<ul>
		<li class="n2">It shouldn't take a rocket scientist to realize
			that you need to understand HTTP to be effective with servlets and
			JSP</li>
	</ul>

	<h3>Reading Request Headers(Methods in HttpServletRequest)</h3>
	<ul>
		<li class="n1">General</li>
		<li class="n2"><span class="rojo">getHeader (header name
				is not case sensitive)</span></li>
		<li class="n2">getHeaders</li>
		<li class="n2">getHeaderNames</li>
		<li class="n1">Specialized</li>
		<li class="n2">getCookies</li>
		<li class="n2">getAuthType and getRemoteUser</li>
		<li class="n2">getContentLength</li>
		<li class="n2">getContentType</li>
		<li class="n2">getDateHeader</li>
		<li class="n2">getIntHeader</li>
		<li class="n1">Related info</li>
		<li class="n2">getMethod, getRequestURI , getQueryString,
			getProtocol</li>
	</ul>
	<hr>
	<h3>Checking For Missing Headers</h3>
	<ul>
		<li class="n1">HTTP 1.0</li>
		<li class="n2">All request headers are optional</li>
		<li class="n1">HTTP 1.1</li>
		<li class="n2">Only Host is required</li>
		<li class="n1">Conclusion</li>
		<li class="n2">Always check that request.getHeader is non-null
			before trying to use it <pre> 
     String val = request.getHeader("Some-Name");
     if (val != null) { 
        ...
     } 
        </pre>
		</li>
	</ul>

	<hr>
	<h3>Making a Table o fAll Request Headers</h3>
	<pre>
@WebServlet("/show-request-headers")
public class ShowRequestHeaders extends HttpServlet {
  public void doGet(HttpServletRequest request,
                    HttpServletResponse response) throws ServletException, IOException { 
    ...
    // Content-Type, PrintWriter, docType defn, etc.
    out.println(docType +
      "&lt;HTML&gt;\n" + 
      "&lt;HEAD&gt;&lt;TITLE&gt;"+title+"&lt;/TITLE&gt;&lt;/HEAD&gt;\n"+
      "&lt;BODY BGCOLOR=\"#FDF5E6\"&gt;\n" + 
      "&lt;H1 ALIGN=\"CENTER\"&gt;" + title + "&lt;/H1&gt;\n" +
      "&lt;B&gt;Request Method: &lt;/B&gt;" +
      <span class="rojo">request.getMethod()</span> + "&lt;BR&gt;\n" + 
      "&lt;B&gt;Request URI: &lt;/B&gt;" +
      <span class="rojo">request.getRequestURI()</span> + "&lt;BR&gt;\n" + 
      "&lt;B&gt;Request Protocol: &lt;/B&gt;" +
      <span class="rojo">request.getProtocol()</span> + "&lt;BR&gt;&lt;BR&gt;\n" +8 
      "&lt;TABLE BORDER=1 ALIGN=\"CENTER\"&gt;\n" + 
        "&lt;TR BGCOLOR=\"#FFAD00\"&gt;\n" + 
        "&lt;TH&gt;Header Name&lt;TH&gt;Header Value");
    Enumeration&lt;String&gt; headerNames =
      <span class="rojo">request.getHeaderNames()</span>;
    while(headerNames.hasMoreElements()) {
      String headerName = headerNames.nextElement();
      out.println("&lt;TR&gt;&lt;TD&gt;" + <span class="rojo">headerName</span>);
      out.println("    &lt;TD&gt;"+<span class="rojo">request.getHeader(headerName)</span>);
    }
    out.println("&lt;/TABLE&gt;\n&lt;/BODY&gt;&lt;/HTML&gt;"); 
  }
   
  /** Since this servlet is for debugging, have it
   * handle GET and POST identically. */ 
  public void doPost(HttpServletRequest request,
                     HttpServletResponse response) throws ServletException, IOException {
    doGet(request, response);
  }
}
</pre>
	<hr>
	<h3>Making a Table of All Request Headers (Firefox)</h3>
	<img src="img01.png"
		alt="Hacer una Tabla de Todas las Peticions de Cabeceras" />
	<hr>
	<h3>Making a Table of All RequestHeaders (Internet Explorer)</h3>
	<img src="img02.png"
		alt="Hacer una Tabla de Todas las Peticions de Cabeceras" />
	<hr>
	<h3>Making a Table of All RequestHeaders (Chrome) 12</h3>
	<img src="img03.png"
		alt="Hacer una Tabla de Todas las Peticions de Cabeceras" />
	<hr>
	<h3>Common HTTP 1.1 RequestHeaders</h3>
	<ul>
		<li class="n1">Accept</li>
		<li class="n2">Indicates MIME types browser can handle</li>
		<li class="n2">Can send different content to different clients.
			For example, PNG files have good compressioncharacteristics but are
			not widely supported in browsers. A servlet could check to see if PNG
			is supported, sending&lt;IMG SRC="picture.png" ...&gt; if it is
			supported, and&lt;IMG SRC="picture.gif" ...&gt; if not.</li>
		<li class="n2">Warning: IE incorrectly sets this header when you
			hit the Refresh button. It sets it correctly on original request.</li>
		<li class="n1">Accept-Encoding</li>
		<li class="n2">Indicates encodings (e.g., gzip or compress)
			browser can handle.</li>
		<li class="n2"><span class="rojo">See following example</span></li>
		<li class="n1">Authorization</li>
		<li class="n2">User identification for password-protected pages.</li>
		<li class="n2">See upcoming example.</li>
		<li class="n2">Instead of HTTP authorization, use HTML forms to
			send username/password and store info in session object. This
			approach is usually preferable because standard HTTP authorization
			results in a small, terse dialog box that isunfamiliar to many users.</li>
		<li class="n2">Servers have high-level way to set up
			password-protectedpages without explicit programming in the servlets.</li>
		<li class="n3">For details, see Chapter 7 (Declarative Security)
			and Chapter 8 (Programmatic Security) of More Servlets and JavaServer
			Pages, www.moreservlets.com.</li>
		<li class="n1">Connection</li>
		<li class="n2">In HTTP 1.0, keep-alive means browser can handle
			persistent connection. In HTTP 1.1, persistent connection is default.
			Persistent connections mean that the server can reuse the same socket
			over again for requests very close together from the same client
			(e.g., the images associatedwith a page, or cells within a framed
			page).</li>
		<li class="n2">Servlets can't do this unilaterally; the best they
			can do is to give the server enough info to permit persistent
			connections. So, they should set Content-Length withsetContentLength
			(using ByteArrayOutputStream to determine length of output).</li>
		<li class="n1">Cookie</li>
		<li class="n2">Gives cookies previously sent to client. Use
			getCookies, not getHeader. See chapter &amp; later class session.</li>
		<li class="n1">Host</li>
		<li class="n2">Indicates host given in original URL
		<li class="n2">This is a <i>required</i> header in HTTP 1.1. This
			fact is important to know if you write a custom HTTP client (e.g.,
			WebClient used in book) or telnet to a server and use the HTTP/1.1
			version.
		</li>
		<li class="n1">If-Modified-Since</li>
		<li class="n2">Indicates client wants page only if it has been
			changed after specified date</li>
		<li class="n2">Don't handle this situation directly; implement
			getLastModified instead.</li>
		<li class="n2">See lottery-number example in book <i>(Core
				Servlets and JSP (2nd Ed)</i> Chapter 3).
		</li>
		<li class="n1">Referer</li>
		<li class="n2">URL of referring Web page</li>
		<li class="n2">Useful for tracking traffic; logged by many
			servers</li>
		<li class="n2">Can also be used to let users set preferences and
			then return to the page they came from</li>
		<li class="n2">Can be easily spoofed; don't let this header be
			sole means of deciding how much to pay sites that show your banner
			ads.</li>
		<li class="n2">Some browsers (Opera), ad filters (Web Washer),
			and personal firewalls (Norton) screen out this header</li>
		<li class="n2"><span class="rojo">See example in book</span></li>
		<li class="n1">User-Agent</li>
		<li class="n2">Best used for identifying <i>category</i> of
			client
		</li>
		<li class="n3">Regular Web browser vs. iPhone, etc.</li>
		<li class="n2">For Web applications, use other headers if
			possible</li>
		<li class="n2">Again, can be easily spoofed</li>
		<li class="n2"><span class="rojo">See following example</span></li>
	</ul>
	<hr>
	<h3>Sending CompressedWeb Pages</h3>
	<img src="img04.png" alt="Comic de Dilbert" />
	<hr>
	<h3>Sending Compressed Pages: GzipUtilities.java</h3>
	<pre> 
public class GzipUtilities {
  public static boolean isGzipSupported(HttpServletRequest request) {
    <span class="rojo">String encodings = request.getHeader("Accept-Encoding");
    return((encodings != null) &amp;&amp;
           (encodings.contains("gzip"));</span>
  }
   
  public static boolean isGzipDisabled(HttpServletRequest request) {
    String flag = request.getParameter("disableGzip");
    return((flag != null) &amp;&amp;
           (!flag.equalsIgnoreCase("false")));
  }
   
  public static PrintWriter getGzipWriter(HttpServletResponse response) throws IOException {
    return(new PrintWriter(
             new GZIPOutputStream
               (response.getOutputStream())));
  }
} 
</pre>
	<hr>
	<h3>Sending Compressed Pages: LongServlet.java</h3>
	<pre>
@WebServlet("/long-servlet")
public class LongServlet extends HttpServlet {
  public void doGet(HttpServletRequest request,
                    HttpServletResponse response) throws ServletException, IOException {
    response.setContentType("text/html");
     
    // Change the definition of "out" depending on
    // whether or not gzip is supported.
    PrintWriter out;
    <span class="rojo">if (GzipUtilities.isGzipSupported(request) &amp;&amp;
      !GzipUtilities.isGzipDisabled(request)) {
      out = GzipUtilities.getGzipWriter(response);</span>
      response.setHeader("Content-Encoding", "gzip");
    } else {
      out = response.getWriter();
    }
    ...
    out.println
      (docType +
      "&lt;HTML&gt;\n" + 
      "&lt;HEAD&gt;&lt;TITLE&gt;" + title + "&lt;/TITLE&gt;&lt;/HEAD&gt;\n" +
      "&lt;BODY BGCOLOR=\"#FDF5E6\"&gt;\n" + 
      "&lt;H1 ALIGN=\"CENTER\"&gt;" + title + "&lt;/H1&gt;\n");
    String line = "Blah, blah, blah, blah, blah. " +
                  "Yadda, yadda, yadda, yadda.";
    for(int i=0; i&lt;10000; i++) {
      out.println(line);
    }
    out.println("&lt;/BODY&gt;&lt;/HTML&gt;");
    out.close();
  }
} 
</pre>
	<hr>
	<h3>Sending Compressed Pages: Results</h3>
	<ul>
		<li class="n1">Uncompressed (28.8K modem), Firefox and Internet
			Explorer: <span class="rojo">&gt; 50 seconds</span>
		</li>
		<li class="n1">Compressed (28.8K modem), Firefox and Internet
			Explorer: <span class="rojo">&lt; 5 seconds</span>
		</li>
		<li class="n1">Caution</li>
		<li class="n2">Be careful about generalizing benchmarks</li>
	</ul>
	<img src="img05.png" alt="" />
	<hr>
	<h3>Differentiating AmongDifferent Browser Types</h3>
	<ul>
		<li class="n1">Use User-Agent only when necessary.</li>
		<li class="n2">Otherwise, you will have difficult-to-maintain
			code that consists of tables of browser versions and associated
			capabilities.</li>
		<li class="n1">Check for null.</li>
		<li class="n2">The header is not required by the HTTP 1.1
			specification, some browsers let you disable it (e.g., Opera), and
			custom clients (e.g., Web spiders or link verifiers) might not use
			the header at all.</li>
		<li class="n1">Differentiating among clients</li>
		<li class="n2">To differentiate among Firefox, Netscape, and
			Internet Explorer, check for "MSIE", not "Mozilla".</li>
		<li class="n3">Both Firefox and Internet Explorer say "Mozilla"
			at the beginning of the header. (For JavaScript compatibility.)</li>
		<li class="n2">Detecting Safari on the iPhone</li>
		<li class="n3">Mozilla/5.0 (<span class="rojo">iPhone</span>; U;
			CPU like Mac OS X; en) AppleWebKit/420+ (KHTML, like Gecko)
			Version/3.0 Mobile/1A543a Safari/419.3
		</li>
		<li class="n1">The header can be faked.</li>
		<li class="n2">If a client fakes this header, the servlet cannot
			tell the difference.</li>
	</ul>
	<hr>
	<h3>Differentiating AmongDifferent Browser Types (Code)</h3>
	<pre>
@WebServlet("/browser-insult") 
public class BrowserInsult extends HttpServlet { 
    public void doGet(HttpServletRequest request,
                      HttpServletResponse response) throws ServletException, IOException {
    response.setContentType("text/html"); 
    PrintWriter out = response.getWriter(); 
    String title, message; 
    // Assume for simplicity that Firefox and IE are
    // the only two browsers. 
    <span class="rojo">String userAgent = request.getHeader("User-Agent"); 
    if ((userAgent != null) &amp;&amp;
        (userAgent.contains("MSIE"))</span> { 
    title = "Microsoft Minion"; 
    message = "Welcome, O spineless slave to the " + 
              "mighty empire."; 
    } else { 
        title = "Hopeless Firefox Rebel"; 
        message = "Enjoy it while you can. " + 
                  "You &lt;I&gt;will&lt;/I&gt; be assimilated!"; 
    }
}
   </pre>
	<hr>
	<h3>Differentiating AmongBrowser Types (Result)</h3>
	<img src="img06.png" alt="" />
	<hr>
	<h3>Summary</h3>
	<ul>
		<li class="n1">HTTP is important</li>
		<li class="n2">Many servlet tasks can only be accomplished by
			making use of HTTP headers coming from the browser</li>
		<li class="n1">Use request.getHeader for arbitrary header</li>
		<li class="n2">Remember to check for null</li>
		<li class="n1">Shortcuts discussed later</li>
		<li class="n2">Cookies, authorization info, content length, and
			content typehave shortcut methods</li>
		<li class="n1">Most important headers you read directly</li>
		<li class="n2">Accept</li>
		<li class="n2">Accept-Encoding</li>
		<li class="n2">Connection</li>
		<li class="n2">Referer</li>
		<li class="n2">User-Agent</li>
	</ul>
	<p class="inicio">
		<a href="index.html">Volver al Índice de la Sección</a>
	</p>
	<p style="font-size: small;">
		Todo el código de los <a
			href="http://courses.coreservlets.com/Course-Materials/">
			tutoriales J2EE de coreservlets.com (servlets, JSP, Struts, JSF 1,
			JSF 2, PrimeFaces, Ajax [con jQuery], GWT 2, Spring, Hibernate, JPA,
			basado en SOAP y Servicios Web RESTful, Hadoop, &amp; programación
			Java 7) </a>. Hay también cursos de formación con un instructor en vivo <a
			href="http://courses.coreservlets.com/"> sobre los mismos tópicos
			J2EE (servlets, JSP, Struts, JSF 1, JSF 2, PrimeFaces, Ajax [con
			jQuery], GWT 0, Spring, Hibernate, JPA, basado en SOAP y Servicios
			Web RESTful, Hadoop, &amp; programación Java 7) </a>.
	</p>
</body>
</html>

