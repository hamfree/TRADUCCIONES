<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="../css/JSP-Styles.css" type="text/css">
<title>Directiva Page - La Lección</title>
</head>
<body>
	<h1>Directiva Page</h1>
	<h2>La Lección</h2>
	<pre>
-------------------------------------------------------------------------------
Agenda
 
* Understanding the purpose of the page 
directive 
* Designating which classes are imported 
* Specifying the MIME type of the page 
* Generating Excel spreadsheets 
* Participating in sessions 
* Setting the size and behavior of the output 
  buffer 
* Designating pages to handle JSP errors 
* Controlling threading behavior 

-------------------------------------------------------------------------------
Purpose of the page Directive
 
* Give high-level information about the servlet 
  that will result from the JSP page 
* Can control 
  * Which classes are imported 
  * What class the servlet extends 
  * What MIME type is generated 
  * How multithreading is handled 
  * If the servlet participates in sessions 
  * The size and behavior of the output buffer 
  * What page handles unexpected errors 

-------------------------------------------------------------------------------
The import Attribute
 
* Format 
  * &lt;%@ page import="package.class" %&gt; 
  * &lt;%@ page import="package.class1,...,package.classN" %&gt; 
* Purpose 
  * Generate import statements at top of servlet definition 
* Notes 
  * Although JSP pages can be almost anywhere on server, 
    classes used by JSP pages must be in normal servlet dirs 
  * E.g.: 
    .../WEB-INF/classes or 
    .../WEB-INF/classes/directoryMatchingPackage 
  * Always use packages for utilities that will be used by JSP! 

------------------------------------------------------------------------------- 
The Importance of Using Packages 

* What package will the system think that 
  SomeHelperClass and SomeUtilityClass are 
  in? 
... 
public class SomeClass { 
  public String someMethod(...) { 
    SomeHelperClass test = new SomeHelperClass(...); 
    String someString = 
      SomeUtilityClass.someStaticMethod(...); 
    ... 
  	} 
} 

* What package will the system think that 
  SomeHelperClass and SomeUtilityClass are 
  in? 
... 

&lt;% 
  SomeHelperClass test = new SomeHelperClass(...); 
  String someString = SomeUtilityClass.someStaticMethod(...); 
%&gt; 

-------------------------------------------------------------------------------
The import Attribute: Example(Code) 

... &lt;H2&gt;The import Attribute&lt;/H2&gt;

&lt;%@ page import="java.util.*,coreservlets.*" %&gt;

&lt;%! 

private String randomID() {
  int num = (int)(Math.random()*10000000.0);
  return("id" + num);

}
private final String NO_VALUE = "&lt;I&gt;No Value&lt;/I&gt;";
%&gt; 
&lt;% 
String oldID =
  CookieUtilities.getCookieValue(request, "userID", NO_VALUE);

if (oldID.equals(NO_VALUE)) {
  String newID = randomID();
  Cookie cookie = new LongLivedCookie("userID", newID);
  response.addCookie(cookie);
}
%&gt; 
This page was accessed on &lt;%= new Date() %&gt; with a userIDcookie of &lt;%= oldID %&gt;. 

&lt;/BODY&gt;&lt;/HTML&gt; 

-------------------------------------------------------------------------------
The import Attribute: Example(Results)

(IMAGEN)
(IMAGEN)
 
-------------------------------------------------------------------------------
The contentType and pageEncoding Attributes
 
* Format 
  * &lt;%@ page contentType="MIME-Type" %&gt; 
  * &lt;%@ page contentType="MIME-Type;charset=Character-Set" %&gt; 
  * &lt;%@ page pageEncoding="Character-Set" %&gt; 
* Purpose 
  * Specify the MIME type of the page generated by the 
    servlet that results from the JSP page 
* Notes 
  * Attribute value cannot be computed at request time 
  * See section on response headers for table of the most 
    common MIME types 

-------------------------------------------------------------------------------
Generating Excel Spreadsheets
 
Marty Hall hall@coreservlets.com
First Last    Email Address 
Larry Brown   brown@coreservlets.com
Steve Balmer  balmer@ibm.com
Scott McNealy mcnealy@microsoft.com
&lt;%@ page contentType="application/vnd.ms-excel" %&gt;
&lt;%--There are tabs, not spaces, between cols. --%&gt;
(IMAGEN)
 
-------------------------------------------------------------------------------
Conditionally Generating ExcelSpread sheets
 
* You cannot use the contentType attribute 
  for this task, since you cannot make 
  contentType be conditional. 
  * The following always results in the Excel MIME type 

  &lt;% boolean usingExcel = checkUserRequest(request); %&gt;
  &lt;% if (usingExcel) { %&gt;
  &lt;%@ page contentType="application/vnd.ms-excel" %&gt;
  &lt;% } %&gt; 

* Solution: use a regular JSP scriptlet with 
  response.setContentType 

-------------------------------------------------------------------------------
Conditionally Generating ExcelSpreadsheets (Code) 

... 
&lt;BODY&gt; 
&lt;CENTER&gt; 
&lt;H2&gt;Comparing Apples and Oranges&lt;/H2&gt;
&lt;% 
String format = request.getParameter("format");
if ((format != null) &amp;&amp; (format.equals("excel"))) {
  response.setContentType("application/vnd.ms-excel");
}
%&gt; 
&lt;TABLE BORDER=1&gt; 
  &lt;TR&gt;&lt;TH&gt;&lt;/TH&gt; &lt;TH&gt;Apples&lt;TH&gt;Oranges&lt;TR&gt;&lt;TH&gt;First Quarter &lt;TD&gt;2307 &lt;TD&gt;4706 
  &lt;TR&gt;&lt;TH&gt;Second Quarter&lt;TD&gt;2982 &lt;TD&gt;5104 
  &lt;TR&gt;&lt;TH&gt;Third Quarter &lt;TD&gt;3011 &lt;TD&gt;5220 
  &lt;TR&gt;&lt;TH&gt;Fourth Quarter&lt;TD&gt;3055 &lt;TD&gt;5287 
  &lt;/TABLE&gt;
 &lt;/CENTER&gt;&lt;/BODY&gt;&lt;/HTML&gt; 

-------------------------------------------------------------------------------
Conditionally Generating ExcelSpreadsheets (Results) 

(IMAGENES)

-------------------------------------------------------------------------------
The session Attribute 

* Format 
  * &lt;%@ page session="true" %&gt; &lt;%--Default --%&gt; 
  * &lt;%@ page session="false" %&gt; 
* Purpose 
  * To designate that page not be part of a session 
* Notes 
  * By default, it is part of a session 
  * Saves memory on server if you have a high-traffic site 
  * All related pages have to do this for it to be useful 
 
-------------------------------------------------------------------------------
The isELIgnored Attribute 

* Format 
  * &lt;%@ page isELIgnored="false" %&gt; 
  * &lt;%@ page isELIgnored="true" %&gt; 
* Purpose 
  * To control whether the JSP 2.0 Expression Language(EL) is ignored (true) or evaluated normally (false). 
* Notes 
  * If your web.xml specifies servlets 2.3 (corresponding toJSP 1.2) or earlier, the default is true 
    * But it is still legal to change the default*you are permitted 
      to use this attribute in a JSP-2.0-compliant server 
      regardless of the web.xml version. 
  * If your web.xml specifies servlets 2.4 (corresponding toJSP 2.0) or earlier, the default is false 


-------------------------------------------------------------------------------
The buffer Attribute 

* Format 
  * &lt;%@ page buffer="sizekb" %&gt; 
  * &lt;%@ page buffer="none" %&gt; 
* Purpose 
  * To give the size of the buffer used by the out variable 
* Notes 
  * Buffering lets you set HTTP headers even after some 
    page content has been generated (as long as buffer has not 
    filled up or been explicitly flushed) 
  * Servers are allowed to use a larger size than you ask for, 
    but not a smaller size 
  * Default is system-specific, but must be at least 8kb 

------------------------------------------------------------------------------- 
The errorPage Attribute 

* Format 
  * &lt;%@ page errorPage="Relative URL" %&gt; 
* Purpose 
  * Specifies a JSP page that should process any exceptions 
    thrown but not caught in the current page 
* Notes 
  * The exception thrown will be automatically available to 
    the designated error page by means of the "exception"
    variable 
  * The web.xml file lets you specify application-wide error 
    pages that apply whenever certain exceptions or certain 
    HTTP status codes result. 
    * The errorPage attribute is for page-specific error pages
     
-------------------------------------------------------------------------------
The isErrorPage Attribute
 
* Format 
  * &lt;%@ page isErrorPage="true" %&gt; 
  * &lt;%@ page isErrorPage="false" %&gt; &lt;%--Default --%&gt; 
* Purpose 
  * Indicates whether or not the current page can act as the 
    error page for another JSP page 
* Notes 
  * A new predefined variable called exception is created and 
    accessible from error pages 
  * Use this for emergency backup only; explicitly handle as 
    many exceptions as possible 
    * Don't forget to always check query data for missing or 
      malformed values 

------------------------------------------------------------------------------- 
Error Pages: Example

... 
&lt;BODY&gt; 
&lt;%@ page errorPage="/WEB-INF/SpeedErrors.jsp" %&gt;
&lt;TABLE BORDER=5 ALIGN="CENTER"&gt; 
  &lt;TR&gt;&lt;TH CLASS="TITLE"&gt;Computing Speed&lt;/TABLE&gt;
&lt;%! 
private double toDouble(String value) {
  return(Double.parseDouble(value));
}
%&gt; 
&lt;% 
double furlongs = toDouble(request.getParameter("furlongs")); 
double fortnights = 
  toDouble(request.getParameter("fortnights"));
double speed = furlongs/fortnights;
%&gt; 
&lt;UL&gt; 
  &lt;LI&gt;Distance: &lt;%= furlongs %&gt; furlongs.
  &lt;LI&gt;Time: &lt;%= fortnights %&gt; fortnights.
  &lt;LI&gt;Speed: &lt;%= speed %&gt; furlongs per fortnight.
&lt;/UL&gt;
&lt;/BODY&gt;&lt;/HTML&gt; 

...
&lt;BODY&gt; 
&lt;%@ page isErrorPage="true" %&gt;
&lt;TABLE BORDER=5 ALIGN="CENTER"&gt; 
  &lt;TR&gt;&lt;TH CLASS="TITLE"&gt; 
    Error Computing Speed&lt;/TABLE&gt;
&lt;P&gt; 
ComputeSpeed.jsp reported the following error:
&lt;I&gt;&lt;%= exception %&gt;&lt;/I&gt;. This problem occurred in thefollowing place:
&lt;PRE&gt; 
&lt;%@ page import="java.io.*" %&gt;
&lt;% exception.printStackTrace(new PrintWriter(out)); %&gt;
&lt;/PRE&gt;
&lt;/BODY&gt;&lt;/HTML&gt; 

------------------------------------------------------------------------------- 
Error Pages: Results 

(IMAGENES)

-------------------------------------------------------------------------------
The extends Attribute 

* Format 
  * &lt;%@ page extends="package.class" %&gt; 
* Purpose 
  * To specify parent class of servlet thatwill result from JSP page 
* Notes 
  * Use with extreme caution 
  * Can prevent system from using high-performance custom 
    superclasses 
  * Typical purpose is to let you extend classes that come 
    from the server vendor (e.g., to support personalization 
    features), not to extend your own classes. 

-------------------------------------------------------------------------------
The isThreadSafe Attribute 

* Format 
  * &lt;%@ page isThreadSafe="true" %&gt; &lt;%--Default --%&gt; 
  * &lt;%@ page isThreadSafe="false" %&gt; 
* Purpose 
  * To tell the system when your code is not threadsafe, so 
    that the system can prevent concurrent access 
    * Normally tells the servlet to implement SingleThreadModel 
* Notes 
  * Avoid this like the plague 
    * Causes degraded performance in some situations 
    * Causes incorrect results in others 

-------------------------------------------------------------------------------

Example of Non-ThreadsafeCode (IDs Must Be Unique) 
* What's wrong with this code?
 
&lt;%! private int idNum = 0; %&gt;
&lt;% 
String userID = "userID" + idNum;
out.println("Your ID is " + userID + ".");
idNum = idNum + 1;
%&gt; 

------------------------------------------------------------------------------- 
Is isThreadSafe Needed Here? 

* No! It is not needed. Synchronize normally:

  &lt;%! private int idNum = 0; %&gt;
  &lt;% 
  synchronized(this) {
    String userID = "userID" + idNum;
    out.println("Your ID is " + userID + ".");
    idNum = idNum + 1;
  }
%&gt;
 
* Better performance in high-traffic environments 
* isThreadSafe="false" will totally fail if serveruses 
  pool-of-instances approach 

-------------------------------------------------------------------------------
Summary 

* Used frequently 
  * import 
    * Changes the packages imported by the servlet that results from 
      the JSP page 
      * Always use packages for utility classes! 
  * contentType 
    * Specifies MIME type of result 
    * Cannot be used conditionally(use &lt;% response.setContentType(...) %&gt; for that) 
* Used moderately 
  * isELIgnored, session, buffer 
* Used occasionally 
  * errorPage/isErrorpage 
  * extends 
* Avoid like the plague 
  * isThreadSafe 
    * Always use explicit synchronization instead 


    </pre>
	<p class="inicio">
		<a href="index.html">Volver al Índice de la Sección</a>
	</p>
	<p style="font-size: small;">
		Todo el código de los <a
			href="http://courses.coreservlets.com/Course-Materials/">
			tutoriales J2EE de coreservlets.com (servlets, JSP, Struts, JSF 1,
			JSF 2, PrimeFaces, Ajax [con jQuery], GWT 2, Spring, Hibernate, JPA,
			basado en SOAP y Servicios Web RESTful, Hadoop, &amp; programación
			Java 7) </a>. Hay también cursos de formación con un instructor en vivo <a
			href="http://courses.coreservlets.com/"> sobre los mismos tópicos
			J2EE (servlets, JSP, Struts, JSF 1, JSF 2, PrimeFaces, Ajax [con
			jQuery], GWT 0, Spring, Hibernate, JPA, basado en SOAP y Servicios
			Web RESTful, Hadoop, &amp; programación Java 7) </a>.
	</p>
</body>
</html>
