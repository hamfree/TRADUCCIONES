<!DOCTYPE html>
<html lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="description" content="Prácticas y técnicas de programación en Java.">
    <meta name="keywords" content="java, programación java, Prácticas de Java, idioma java, estilo java, patrones de diseño java, 
          convenciones de codigo java">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prácticas de Java-&gt;Objetos Command</title>
    <link id="stylesheet" rel="stylesheet" type="text/css" href="../css/stylesheet9.css" media="all">
    <link rel="icon" type="image/png" href="../img/favicon.png">
  </head>
  <body>
    <nav class="menu-bar" id="menu-bar">
      <a href="../index.html" title="Tabla de Contenido" style="float: left;">Inicio</a> &nbsp;&nbsp;
      <form method="GET" action="https://www.google.com/search" class="search-form" style="float: right;">
        <input name="q" size="15" maxlength="255" placeholder="" type="text" />
        <input name="btnG" value="Búsqueda" type="submit" /> 
        <input name="sitesearch" value="www.javapractices.com" type="hidden" />
      </form>
    </nav>
    <div class="page-title">Objetos Command</div>
    <br />
    Es una práctica común definir una interfaz para procesar una petición del usuario a un nivel alto de abstracción. Esto 
    corresponde aproximadamente al patrón de Comando descrito en <i>Patrones de Diseño</i>.
    <h4>
      Ejemplo
    </h4>
    Esta ejemplo es en el contexto de una aplicación web.
    <a href="http://www.web4j.com/web4j/javadoc/hirondelle/web4j/action/Action.html"><code>Action</code></a> es una interfaz que :
    <ul>
      <li>
        ejecuta una operación de negocio (validar la entrada, interactuar con el almacén de datos, y colocar objetos de modelo 
        apropiados en el contexto de petición o de sesión)
      </li>
      <li>
        establece la identidad del recurso que presentará los objetos del modelo (habitualmente un JSP)
      </li>
      <li>controla cuando se envía una redirección al navegador</li>
    </ul>
    <br />
    <pre>
<span class="keyword">package</span> hirondelle.web4j.action;

<span class="keyword">import</span> hirondelle.web4j.model.AppException;

<span class="comment">/**
 &lt;span class="highlight"&gt;
 Procesa una petición HTTP, y devuelve una {@link ResponsePage}.
  &lt;/span&gt;

 &lt;P&gt;&lt;b&gt;Esta interfaz es probablemente la más importante
 abstracción en WEB4J.&lt;/b&gt; Casi cada característica implementada por el programador
 necesitará una implementación de esta interfaz.
 
 &lt;P&gt;Habitualmente, uno de las clases bases abstractas &lt;em&gt;ActionXXX&lt;/em&gt; se usan  
 para construir implementaciones de esta interfaz.
*/</span>
<span class="keyword">public</span> <span class="keyword">interface</span> Action {
  
  <span class="comment">/**
  Ejecuta la operación deseada.
   
  &lt;P&gt;Operaciones habituales incluyen : 
  &lt;ul&gt;
  &lt;li&gt;validar entrada de usuario
  &lt;li&gt;interactuar con la base de datos
  &lt;li&gt;colocar los objetos requeridos en el alcance apropiado
  &lt;li&gt;establecer el apropiado {@link ResponsePage}.
  &lt;/ul&gt;
  
  &lt;P&gt;Devuevle un identificador para el recurso (por ejemplo un JSP) que 
  visualizará el resultado final de esta &lt;tt&gt;Action&lt;/tt&gt; (usando un 
  forward o un redirect).
  */</span>
  ResponsePage execute() <span class="keyword">throws</span> AppException;
  
}
 
    </pre>
    <p>
      Las implementaciones de <code>Action</code> realizan tareas similares. Estas tareas deberían ser colocadas en una Clase 
      Base Abstracta (ABC, en inglés), que simplificarán las implementaciones concretas. La herramienta WEB4J define varias de 
      dichas ABC:
    </p>
    <ul>
      <li>
        <code>
          <a href="http://www.web4j.com/web4j/javadoc/hirondelle/web4j/action/ActionImpl.html">ActionImpl</a>
        </code> - colecciona varios métodos de utilidad <code>protected final</code> necesitados por muchas clases 
        <code>Action</code>. 
        <code>ActionImpl</code> a su vez forma una clase base para las clases <code>ActionTemplateXXX</code>.
      </li>
      <li>
        <code>
          <a href="http://www.web4j.com/web4j/javadoc/hirondelle/web4j/action/ActionTemplateListAndEdit.html">
            ActionTemplateListAndEdit</a>
        </code> - muestra un listado, y un formulario para editar elementos en el listado
      </li>
      <li>
        <code>
          <a href="http://www.web4j.com/web4j/javadoc/hirondelle/web4j/action/ActionTemplateShowAndApply.html">
            ActionTemplateShowAndApply</a>
        </code> - muestra una forma para editar un elemento singular
      </li>
      <li>
        <code>
          <a
            href="http://www.web4j.com/web4j/javadoc/hirondelle/web4j/action/ActionTemplateSearch.html">ActionTemplateSearch</a>
        </code> - muestra un formulario para introducir un criterio de búsqueda
      </li>
    </ul>
    Las diversas clases <code>ActionTemplateXXX</code> implementan el patrón de diseño en el 
    <a href="../patrones/patrones_164.html">método template</a>. El programador de la aplicación elije una plantilla particular 
    basada en el estilo deseado de la interfaz de usuario.
    <p>
      Aquí tiene un ejemplo de una <code>Action</code>, concreta, que se deriva de la clase 
      <code>
        <a href="http://www.web4j.com/web4j/javadoc/hirondelle/web4j/action/ActionTemplateShowAndApply.html">
          ActionTemplateShowAndApply</a>
      </code> mencionada arriba. Proporciona implementaciones para tres métodos: <code>show</code>, 
      <code>validateUserInput</code>, y <code>apply</code>.<br />
    </p>
    <pre>
<span class="keyword">package</span> hirondelle.fish.main.discussion;

<span class="keyword">import</span> hirondelle.web4j.BuildImpl;
<span class="keyword">import</span> hirondelle.web4j.action.ActionTemplateShowAndApply;
<span class="keyword">import</span> hirondelle.web4j.action.ResponsePage;
<span class="keyword">import</span> hirondelle.web4j.database.DAOException;
<span class="keyword">import</span> hirondelle.web4j.database.Db;
<span class="keyword">import</span> hirondelle.web4j.database.SqlId;
<span class="keyword">import</span> hirondelle.web4j.model.AppException;
<span class="keyword">import</span> hirondelle.web4j.model.ModelCtorException;
<span class="keyword">import</span> hirondelle.web4j.model.ModelFromRequest;
<span class="keyword">import</span> hirondelle.web4j.request.RequestParameter;
<span class="keyword">import</span> hirondelle.web4j.request.RequestParser;

<span class="keyword">import</span> java.util.Date;
<span class="keyword">import</span> java.util.List;
<span class="keyword">import</span> java.util.regex.Pattern;

<span class="comment">/**
 Lista comentarios, y agrega nuevos.
 
 &lt;P&gt;Se listan los comentarios, junto con un mecanismo de paginación.
 
 @sql statements.sql
 @view view.jsp
*/</span>
<span class="keyword">public</span> <span class="keyword">final</span> <span
            class="keyword">class</span> CommentAction <span
            class="keyword">extends</span> ActionTemplateShowAndApply {
  
  <span class="keyword">public</span> <span class="keyword">static</span> <span
            class="keyword">final</span> SqlId FETCH_RECENT_COMMENTS =  <span
            class="keyword">new</span> SqlId(<span class="literal">"FETCH_RECENT_COMMENTS"</span>);
  <span class="keyword">public</span> <span class="keyword">static</span> <span
            class="keyword">final</span> SqlId ADD_COMMENT =  <span
            class="keyword">new</span> SqlId(<span class="literal">"ADD_COMMENT"</span>);
  
  <span class="comment">/** Constructor. */</span>
  <span class="keyword">public</span> CommentAction(RequestParser aRequestParser){
    <span class="keyword">super</span>(FORWARD, REDIRECT, aRequestParser);
  }
  
  <span class="keyword">public</span> <span class="keyword">static</span> <span
            class="keyword">final</span> RequestParameter COMMENT_BODY = RequestParameter.withLengthCheck(
    <span class="literal">"Comment Body"</span>
   );

  <span class="comment">/** Usado por el mecanismo de paginación. */</span>
  <span class="keyword">public</span> <span class="keyword">static</span> <span
            class="keyword">final</span> RequestParameter PAGE_SIZE = RequestParameter.withRegexCheck(
    <span class="literal">"PageSize"</span>, Pattern.compile(<span
            class="literal">"(//d){1,4}"</span>)
   );
  <span class="comment">/** Usado por el mecanismo de paginación. */</span>
  <span class="keyword">public</span> <span class="keyword">static</span> <span
            class="keyword">final</span> RequestParameter PAGE_INDEX = RequestParameter.withRegexCheck(
    <span class="literal">"PageIndex"</span>, Pattern.compile(<span
            class="literal">"(//d){1,4}"</span>)
  );
  
  <span class="comment">/** Muestra el listado de comentarios, y un formulario para agregar nuevas mensajes. */</span>
  <span class="keyword">protected</span> <span class="keyword">void</span> show() <span
            class="keyword">throws</span> AppException {
    addToRequest(ITEMS_FOR_LISTING, fetchRecentComments());
  }
  
  <span class="comment">/** Se asegura que la entrada del usuario puede construir un nuevo {@link Comment}.  */</span>
  <span class="keyword">protected</span> <span class="keyword">void</span> validateUserInput() <span
            class="keyword">throws</span> AppException {
    <span class="keyword">try</span> {
      ModelFromRequest builder = <span class="keyword">new</span> ModelFromRequest(getRequestParser());
      <span class="comment">/*
        Este es un ejemplo de uso de tiempo el cual, para propósitos de pruebas, 
        puede ser hecho independiente del tiempo de sistema verdadero. El valor de 
        la variable 'now'  depende de la implementación de TimeSource.
       */</span>
      <span class="keyword">long</span> now = BuildImpl.forTimeSource().currentTimeMillis();
      fComment = builder.build(
        Comment.<span class="keyword">class</span>, getLoggedInUserName(), COMMENT_BODY, <span
            class="keyword">new</span> Date(now)
      );
    }
    <span class="keyword">catch</span> (ModelCtorException ex){
      addError(ex);
    }
  }
  
  <span class="comment">/** Agrega un nuevo {@link Comment} a la base de datos. */</span>
  <span class="keyword">protected</span> <span class="keyword">void</span> apply() <span
            class="keyword">throws</span> AppException {
    <span class="comment">//sin posibilidad de un error duplicado.
</span>    addNew(fComment);
  }
  
  <span class="comment">// PRIVADO //
</span>  <span class="keyword">private</span> Comment fComment;
  
  <span class="keyword">private</span> <span class="keyword">static</span> <span
            class="keyword">final</span> ResponsePage FORWARD = <span
            class="keyword">new</span> ResponsePage(
    <span class="literal">"Discussion"</span>, <span class="literal">"view.jsp"</span>, CommentAction.<span
            class="keyword">class</span>
  );
  <span class="keyword">private</span> <span class="keyword">static</span> <span
            class="keyword">final</span> ResponsePage REDIRECT =  <span
            class="keyword">new</span> ResponsePage(
    <span class="literal">"CommentAction.show?PageIndex=1&amp;PageSize=10"</span>
  );
  
  <span class="comment">/*
   Aquí, los métodos DAO no están en una clase separada, sino simplemente métodos regulares 
   de esta Action. Esto es razonable ya que los métodos son cortos y no hacen que 
   esta clase Action sea significativamente más compleja.
  */</span>
  
  <span class="comment">/**
   Devuelve una {@link List} inmutable de los objetos {@link Comment} recientes.
   
   &lt;P&gt;La definición de qué constituye "reciente" se deja deliberadamente vaga, para 
   permitir varias versiones de "reciente" - los últimos 5 mensajes, mensajes introducidos en los
   últimos N días, etc.
  */</span>
  <span class="keyword">private</span> List&lt;Comment&gt; fetchRecentComments() <span
            class="keyword">throws</span> DAOException {
    <span class="keyword">return</span> Db.list(Comment.<span
            class="keyword">class</span>, FETCH_RECENT_COMMENTS);
  }

  <span class="comment">/**
   Agrega &lt;tt&gt;aNewComment&lt;/tt&gt; a la base de datos. No son posibles duplicados.
  
   @param aNewComment a ser agregado al almacén de datos.
  */</span>
  <span class="keyword">private</span> <span class="keyword">void</span> addNew(Comment aNewComment) <span
            class="keyword">throws</span> DAOException {
    Object[] params = { 
      aNewComment.getUserName(), aNewComment.getBody(), aNewComment.getDate() 
    };
    Db.edit(ADD_COMMENT, params);
  }
}
 
    </pre>
    <br />
    <p></p>
    <p></p>
    <div class="topic-section" id="see-also-title">
      Vea También:
    </div>
    <div id="see-also" class="main-body">
      <a href="../servlets/servlets_107.html">Refactorize los Controladores grandes</a><br /> 
      <a href="../servlets/servlets_138.html">Analizar parámetros en objetos de dominio</a><br /> 
      <a href="../patrones/patrones_164.html">Método Template</a><br />
      <a href="../servlets/servlets_181.html">Forward versus redirect</a><br /> 
      <a href="../servlets/servlets_188.html">WEB4J; Un Marco de trabajo de Aplicaciones WEB</a><br />
    </div>
    <footer id="footer" class="legalese">
      <span id="app_name">Prácticas de Java</span> 
      <span id="app_version_number">3.001</span><br /> © 
      <span id="copyright">2018 Hirondelle Systems</span><br /> 
      <a href="http://www.javapractices.com/source/SourceAction.do">Código Fuente</a> | 
      <a href="mailto:webmaster@javapractices.com" rel="author">Contacto</a> | 
      <a href="http://creativecommons.org/licenses/by-nc-sa/1.0/" rel="license">Licencia</a> | 
      <a href="http://www.javapractices.com/apps/cjp.rss" rel="alternate" type="application/rss+xml">RSS</a>
      <!-- ukey="2AC36CD2" -->
      <!-- ckey="16DF3D87" -->
      <br /> Los trozos de código individual tienen una 
      <a href="http://www.javapractices.com/LICENSE.txt" rel="license">licencia BSD</a><br /> 
      Sobre 1,000,000 de IPs únicas el último año<br /> 
      Última actualización <time id="last_updated_on" datetime="2018-06-03">2018-06-03</time><br />
      - In Memoriam : Bill Dirani -
    </footer>
  </body>
</html>