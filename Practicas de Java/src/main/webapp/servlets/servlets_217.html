<!DOCTYPE html>
<html lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="description"
          content="Prácticas y técnicas de programación en Java.">
    <meta name="keywords"
          content="java,programación java,Prácticas de Java,idioma 
          java,estilo java,patrones de diseño java,convenciones de codigo java">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prácticas de Java-&gt;Tenga cuidado de los trucos
      habituales</title>
    <link id="stylesheet" rel="stylesheet" type="text/css"
          href="../css/stylesheet9.css" media="all">
    <link rel="icon" type="image/png" href="../img/favicon.png">
    <style>
      TD {
        border: 1px inset;
      }
    </style>
  </head>
  <body>
    <nav class="menu-bar" id="menu-bar">
      <a href="../index.html" title="Tabla de Contenido"
         style="float: left;">Inicio</a> &nbsp;&nbsp;
      <form method="GET" action="https://www.google.com/search"
            class="search-form" style="float: right;">
        <input name="q" size="15" maxlength="255" placeholder=""
               type="text"> <input name="btnG" value="Search"
               type="submit"> <input name="sitesearch"
               value="www.javapractices.com" type="hidden">
      </form>
    </nav>
    <div class="page-title">Tenga cuidado de los trucos habituales</div>
    <br />
    <h3>SQL Injection Attacks</h3>
    <a href="http://www.owasp.org/index.php/SQL_Injection">SQL
      Injection attacks</a> use crafted, unusual user input to cause
    undesired SQL statements to be executed. An application is
    vulnerable to such attacks whenever it builds SQL statements
    directly out of raw user input. If an application builds SQL
    statements out of user input by using
    <code>PreparedStatement</code>
    <a href="http://www.javapractices.com/topic/TopicAction.do?Id=212"><i>correctly</i></a>,
    then it will be protected from SQL injection attacks. If, on the
    other hand, it uses
    <code>Statement</code>
    to dynamically build SQL, or uses
    <code>PreparedStatement</code>
    <i>incorrectly</i> then it will
    <em>not</em> be protected from such attacks.
    <h3>Cross-Site Scripting (XSS) Attacks</h3>
    HTML allows for scripting. Scripting needs some extra care, since it
    allows all kinds of code to execute on the client, where it has
    access to the user's private environment.
    <span class="highlight">If you do not exercise care, it is <em>very
        easy</em> to create web applications that allow users to enter
      malicious scripts as regular data, into forms or URLs.
    </span> When such malicious input is later fetched from the database and
    rendered in a view, it becomes available for execution by the
    browser.
    <p>
      Note that such scripts will execute in <em>any</em> browser that
      renders the data, not just for the browser of the hacker who
      happened to enter the script. When the malicious script is
      executing in an innocent victim's browser, it gets access to
      sensitive information, and sends it back to the hacker. This is
      called a <a
        href="http://www.owasp.org/index.php/Cross_Site_Scripting">Cross-Site
        Scripting</a> (XSS) attack.
    </p>
    <p>To prevent XSS attacks, ask yourself two questions:</p>
    <ul>
      <li>can this form control accept a script as input?</li>
      <li>if so, how will the script be disabled when the user
        input is ultimately rendered in a page?</li>
    </ul>
    Let's take this mock form as an example (
    <code>POST</code>
    ing this form does nothing):
    <p></p>
    <form method="GET" action="Topic217.cjp">
      <table style="margin: 0 auto;">
        <tbody>
          <tr>
            <td>Movie Title :</td>
            <td><input name="Title" type="text"></td>
          </tr>
          <tr>
            <td>Movie Decade :</td>
            <td><select>
                <option selected="selected">2000</option>
                <option>1990</option>
                <option>1980</option>
                <option>1970</option>
                <option>1960</option>
                <option>1950</option>
                <option>1940</option>
                <option>1930</option>
                <option>1920</option>
              </select></td>
          </tr>
          <tr>
            <td colspan="2"><input value="Submit"
                                   type="submit"></td>
          </tr>
          <tr>
            <td colspan="2"></td>
          </tr>
        </tbody>
      </table>
    </form>
    <p></p>
    <p>
      When the user POSTs this form, the data should always be
      validated as strongly as possible by the server. For instance,
      the
      <code>Movie Decade</code>
      should be checked against a fixed set of values, to ensure that
      form has not been altered by a malicious user. If the
      <code>Movie Decade</code>
      is indeed checked in such a manner, then it's not possible for
      the user to enter an arbitrary script as a value for the decade.
      <em>If such strong checks are performed</em>, then no special
      precautions against XSS attacks are needed.
    </p>
    <p>
      The
      <code>Movie Title</code>
      is a different story, however. Since it's free-form user input,
      it's not possible to tightly constrain the
      <code>Movie Title</code>
      . The server cannot perform tight validation checks on its
      content, since there is no 'whitelist' of allowed values.
    </p>
    <p>
      In this case, the user may indeed enter a script. <span
        class="highlight">To prevent the script from being
        activated when rendered in a page as regular data, special
        care must be taken: any special characters in free-form user
        input must be escaped.</span> The Open Web App Security Project
      recommends that you escape these 12 characters :
    </p>
    <p></p>
    <table style="margin: 0 auto; border-spacing: 1px;">
      <tbody>
        <tr>
          <th>Character</th>
          <th>Encoding</th>
        </tr>
        <tr>
          <td>&lt;</td>
          <td>&amp;lt;</td>
        </tr>
        <tr>
          <td>&gt;</td>
          <td>&amp;gt;</td>
        </tr>
        <tr>
          <td>&amp;</td>
          <td>&amp;amp;</td>
        </tr>
        <tr>
          <td>"</td>
          <td>&amp;quot;</td>
        </tr>
        <tr>
          <td>'</td>
          <td>&amp;#039;</td>
        </tr>
        <tr>
          <td>(</td>
          <td>&amp;#040;</td>
        </tr>
        <tr>
          <td>)</td>
          <td>&amp;#041;</td>
        </tr>
        <tr>
          <td>#</td>
          <td>&amp;#035;</td>
        </tr>
        <tr>
          <td>%</td>
          <td>&amp;#037;</td>
        </tr>
        <tr>
          <td>;</td>
          <td>&amp;#059;</td>
        </tr>
        <tr>
          <td>+</td>
          <td>&amp;#043;</td>
        </tr>
        <tr>
          <td>-</td>
          <td>&amp;#045;</td>
        </tr>
      </tbody>
    </table>
    <p></p>
    <p>The escaping can be performed in various places :</p>
    <ul>
      <li>in the view, when the data is ultimately rendered</li>
      <li>in the Model Object</li>
      <li>in the database</li>
    </ul>
    <p>
      The <a href="http://www.web4j.com/UserGuide.jsp#XSS">WEB4J</a>
      tool, for example, recommends performing the escaping in the
      Model Object, by using its
      <code>SafeText</code>
      class to model free-form user input instead of
      <code>String</code>
      .
    </p>
    <p>
      In any case, remember that data <a
        href="http://www.javapractices.com/topic/TopicAction.do?Id=201">should
        not be escaped more than once</a>.
    </p>
    <p>
      Note as well that JSTL's
      <code>&lt;c:out&gt;</code>
      tag performs escaping only for <em>XML</em> (5 characters), and
      not for <em>HTML</em> (12 characters). In addition, note that
      the JSP Expression Language performs no escaping at all.
    </p>
    <h3>Cross-Site Request Forgery (CSRF) Attacks</h3>
    The fundamental idea in a
    <a href="http://www.owasp.org/index.php/Cross-Site_Request_Forgery">Cross-Site
      Request Forgery</a> (CSRF) attack is that of hijacking a victim's
    session to perform a malicious task. Since the session becomes
    available to the hacker, the hacker can perform tasks that would
    otherwise not be possible.
    <p>
      For example, consider a simple logging-off operation. On many
      sites, logging off is implemented with a simple <em>link</em> (
      <code>GET</code>
      ), and not a
      <code>POSTed form</code>
      . A hacker can log you off such a site <em>simply by
        sending you an email</em>. Here's the scenario:
    </p>
    <ul>
      <li>you legitimately log in to the target site</li>
      <li>the hacker sends you an email containing a bogus <code>IMG</code>
        tag whose <code>'src'</code> attribute points to the log-off
        link
      </li>
      <li>you receive the email and open it in some client (while
        still logged in to the target site)</li>
      <li>your email client automatically parses the email
        content</li>
      <li>when the <code>IMG</code> tag is encountered by your
        email client, it extracts the <code>src</code> target and <em>sends
          an HTTP</em> <code>GET</code> <em>request over the
          network</em>, ostensibly to fetch the 'image'
      </li>
      <li>bingo! you are now logged out, just by opening an email
      </li>
    </ul>
    (This is why many email clients suppress the display of images.)
    <p>Defending against CSRF attacks isn't as simple as defending
      against XSS attacks. Usually, the defenses take this form:</p>
    <ul>
      <li><em>for operations that have side-effects</em> of any
        kind (database edits, logging off), use a form with <code>method='POST'</code>
      </li>
      <li><em>for operations without any side-effects</em>
        (listings, reports, search operations), use either a form
        with <code>method='GET'</code> or a link</li>
      <li>for each user log-in, create a random, hard-to-guess
        token, and store it in the session. This token (also called
        a <i>nonce</i>) is injected as a hidden parameter into each
        form served by your application. For each <code>POST</code>ed
        form, the server verifies that the hidden parameter is
        present, and has the expected value for the current session.
        All of this has the intent of answering a simple question: <em>'Did
          this POSTed form really come originally from the
          legitimate server, or from some unknown third party?'</em>
      </li>
      <li>specify the <code>content-type</code> of the response
        as an HTTP header. When using form tokens, the <code>content-type</code>
        lets tools know when you are serving HTML - if your are
        serving plain text or XML (which doesn't contain a form),
        then there's no need to inject form tokens.
      </li>
    </ul>
    Your web app framework should assist you in defending against CSRF
    attacks. With servlets, it's common to provide a Filter to generate
    and validate the special form token.
    <br />
    <p></p>
    <div class="topic-section" id="see-also-title">Vea También :</div>
    <div id="see-also" class="main-body">
      <a href="..\servlets\servlets_191.html">Administrar las
        sesiones de cerca</a> <br /> <a
        href="..\servlets\servlets_201.html">Tenga cuidado de
        los ampersands doblemente escapados</a> <br /> <a
        href="..\bbdd\bbdd_212.html">Prefiera PreparedStatement</a>
      <br />
    </div>
    <footer id="footer" class="legalese">
      <span id="app_name">Prácticas de Java</span> <span
        id="app_version_number">3.001</span><br /> © <span
        id="copyright">2018 Hirondelle Systems</span><br /> <a
        href="http://www.javapractices.com/source/SourceAction.do">Código
        Fuente</a> | <a href="mailto:webmaster@javapractices.com"
                      rel="author">Contacto</a> | <a
                      href="http://creativecommons.org/licenses/by-nc-sa/1.0/"
                      rel="license">Licencia</a> | <a
                      href="http://www.javapractices.com/apps/cjp.rss"
                      rel="alternate" type="application/rss+xml">RSS</a>
      <!-- ukey="2AC36CD2" -->
      <!-- ckey="16DF3D87" -->
      <br /> Los trozos de código individual tienen una <a
        href="http://www.javapractices.com/LICENSE.txt"
        rel="license">licencia BSD</a><br /> Sobre 1,000,000 de
      IPs únicas el último año<br> Última actualización
      <time id="last_updated_on" datetime="2018-06-03">2018-06-03</time>
      <br /> - In Memoriam : Bill Dirani -
    </footer>
  </body>
</html>