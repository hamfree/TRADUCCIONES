<!DOCTYPE html>
<html lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="description" content="Prácticas y técnicas de programación en Java.">
    <meta name="keywords" content="java, programación java, Prácticas de Java, idioma java, estilo java, patrones de diseño java, 
          convenciones de codigo java">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prácticas de Java-&gt;Escape los caracteres especiales</title>
    <link id="stylesheet" rel="stylesheet" type="text/css" href="../css/stylesheet9.css" media="all">
    <link rel="icon" type="image/png" href="../img/favicon.png">
  </head>
  <body>
    <nav class="menu-bar" id="menu-bar">
      <a href="../index.html" title="Tabla de Contenido" style="float: left;">Inicio</a> &nbsp;&nbsp;
      <form method="GET" action="https://www.google.com/search" class="search-form" style="float: right;">
        <input name="q" size="15" maxlength="255" placeholder="" type="text" />
        <input name="btnG" value="Búsqueda" type="submit" /> 
        <input name="sitesearch" value="www.javapractices.com" type="hidden" />
      </form>
    </nav>
    <div class="page-title">Escape los caracteres especiales</div>
    <br />
    <p>
      En un documento HTML, fuera de una etiqueta HTML, debería siempre "escapar" 
      <a href="https://www.w3.org/International/questions/qa-escapes#use">estos tres caracteres</a>:
    </p>
    <ul>
      <li>&lt;</li>
      <li>&gt;</li>
      <li>&amp;</li>
    </ul>
    <p>
      En este contexto, <em>escapar</em> significa reemplazarlos con 
      <a href="http://www.w3.org/TR/html401/sgml/entities.html">entidades de carácter</a> de HTML. Por ejemplo, <code>&lt;</code> 
      puede ser reemplazado con <code>&amp;lt;</code>. Otra entidad de carácter que es ocasionamente útil es <code>&amp;nbsp;</code> 
      (el espacio que no rompe).
    </p>
    <p>
      Cuando usted <a href="http://www.javapractices.com/topic/TopicAction.do?Id=206">usa UTF-8 como su codificación de caracteres</a>, 
      entonces, la mayor parte del tiempo, el único escape que necesita (para el texto visible visto por un humano) es para los 3 
      caracteres de arriba <em>y solo esos caracteres</em>. Por ejemplo, el símbilo del copyright © puede (y debería) ser usado 
      directamente en el texto; no hay necesidad de usar la entidad de carácter correspondiente <code>&amp;copy;</code>.
    </p>
    <p>
      El texto arbitrario <em>colocado en una etiqueta HTML</em> también a menudo necesita ser escapado, para asegurar que el HTML 
      resultante permanezca válido.
    </p>
    <p>Los problemas con los caracteres pueden incluir:</p>
    <ul>
      <li>&lt;</li>
      <li>&gt;</li>
      <li>"</li>
      <li>'</li>
      <li>\\</li>
      <li>&amp;</li>
    </ul>
    <p>
      Las cadenas de consulta (<code>Blah=1&amp;Name=Bob</code>) a menudo necesitan ser escapadas también. Si la cadena de consulta 
      contiene caracteres especiales, necesita ser "codificada como URL". (Vea el javadoc para la clase 
      <a href="https://docs.oracle.com/javase/10/docs/api/java/net/URLEncoder.html">URLEncoder</a> para información posterior).
      Esto asegurará que la cadena de búsqueda sea conforme con HTTP válido.
    </p>
    <p>
      Hay a menudo otro problema, sin embargo, respecto a las cadenas de búsqueda. Si una cadena de búsqueda se coloca en un 
      atributo <code>HREF</code>, entonces incluso una cadena de búsqueda codificada como URL no es a menudo una forma válida. Esto 
      es porque <code>URLEncoder</code> produce <i>HTTP</i> válido, pero no produce texto que en general sea un 
      <i>atributo de HTML</i> válido - el carácter ampersand necesita ser reemplazado por la entidad de carácter correspondiente 
      <code>&amp;amp;</code>.
    </p>
    <p>
      Aquí tiene un ejemplo de una clase de utilidad que escapa los caracteres especiales para HTML, XML, expresiones regulares, y 
      así.<br />
    </p>
    <pre>
<span class="keyword">package</span> hirondelle.web4j.util;

<span class="keyword">import</span> java.net.URLEncoder;
<span class="keyword">import</span> java.io.UnsupportedEncodingException;
<span class="keyword">import</span> java.text.CharacterIterator;
<span class="keyword">import</span> java.text.StringCharacterIterator;
<span class="keyword">import</span> java.util.regex.Pattern;
<span class="keyword">import</span> java.util.regex.Matcher;

<span class="keyword">import</span> hirondelle.web4j.security.SafeText;
<span class="keyword">import</span> hirondelle.web4j.ui.translate.Text;
<span class="keyword">import</span> hirondelle.web4j.ui.translate.Tooltips;
<span class="keyword">import</span> hirondelle.web4j.ui.translate.TextFlow;
<span class="keyword">import</span> hirondelle.web4j.ui.tag.Populate;
<span class="keyword">import</span> hirondelle.web4j.database.Report;

<span class="comment">/**
 Métodos de conveniencia para escapar caracteres especiales relacionados con HTML, XML, 
 y expresiones regulares.
  
 &lt;P&gt;Para mantenerle seguro por defecto, WEB4j va a realizar algún esfuerzo por escapar
 caracteres en sus datos cuando sea apropiado, de forma que usted &lt;em&gt;usualmente&lt;/em&gt;
 no necesite pensar demasiado sobre el escapado de caracteres especiales. Así, usted 
 no necesita usar &lt;em&gt;directamente&lt;/em&gt; los servicios de esta clase muy a menudo.
 
 &lt;P&gt;&lt;span class='highlight'&gt;Para Modelos de Objetso que contienen entrada libre de usuario , 
 es altamente recomendable que use {@link SafeText}, no &lt;tt&gt;String&lt;/tt&gt;&lt;/span&gt;.
 La entrada libre del usuario está abierta al uso malicioso, tales como ataques de 
 &lt;a href='http://www.owasp.org/index.php/Cross_Site_Scripting'&gt;Scripting Entre Sitios&lt;/a&gt;. 
 Usar &lt;tt&gt;SafeText&lt;/tt&gt; le protegerá de tales ataques, escapando siempre 
 los caracteres especiales automáticamente en su método &lt;tt&gt;toString()&lt;/tt&gt;.   
 
 &lt;P&gt;Las siguientes clases de WEB4J escaparán automáticamente los caracteres especiales por 
 usted, cuando se necesite: 
 &lt;ul&gt;
 &lt;li&gt;la clase {@link SafeText}, usada como clase de construcción de bloque para sus 
 Modelos de Objetos de la aplicación, para modelar toda la entrada libre del usuario
  &lt;li&gt;la etiqueta {@link Populate} usada con los formularios
 &lt;li&gt;la clase {@link Report} usada para la creación de informes rápidos
 &lt;li&gt;las etiquetas personalizadas {@link Text}, {@link TextFlow}, y {@link Tooltips} usadas 
 para la traducción
 &lt;/ul&gt; 
*/</span>
<span class="keyword">public</span> <span class="keyword">final</span> <span
            class="keyword">class</span> EscapeChars {

  <span class="comment">/**
    Los caracteres de escape para el texto que aparece en el marcado HTML.
    
    &lt;P&gt;Este método existe como una defensa contra los trucos de Scripting Entre Sitios (XSS).
    La idea es neutralizar los caracteres de control comunmente usados por scripts, tales como esos 
    que no serán ejecutados por el navegador. Esto se hace reemplazando los caracteres de control 
    con sus equivalentes escapados.
    Vea {@link hirondelle.web4j.security.SafeText} también.
    
    &lt;P&gt;Los caracteres siguientes son reemplazados con sus correspondientes 
    entidades de carácter HTML:
    &lt;table border='1' cellpadding='3' cellspacing='0'&gt;
    &lt;tr&gt;&lt;th&gt; Carácter &lt;/th&gt;&lt;th&gt;Reemplazo&lt;/th&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; &lt; &lt;/td&gt;&lt;td&gt; &amp;lt; &lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; &gt; &lt;/td&gt;&lt;td&gt; &amp;gt; &lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; &amp; &lt;/td&gt;&lt;td&gt; &amp;amp; &lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; " &lt;/td&gt;&lt;td&gt; &amp;quot;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; \t &lt;/td&gt;&lt;td&gt; &amp;#009;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; ! &lt;/td&gt;&lt;td&gt; &amp;#033;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; # &lt;/td&gt;&lt;td&gt; &amp;#035;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; $ &lt;/td&gt;&lt;td&gt; &amp;#036;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; % &lt;/td&gt;&lt;td&gt; &amp;#037;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; ' &lt;/td&gt;&lt;td&gt; &amp;#039;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; ( &lt;/td&gt;&lt;td&gt; &amp;#040;&lt;/td&gt;&lt;/tr&gt; 
    &lt;tr&gt;&lt;td&gt; ) &lt;/td&gt;&lt;td&gt; &amp;#041;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; * &lt;/td&gt;&lt;td&gt; &amp;#042;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; + &lt;/td&gt;&lt;td&gt; &amp;#043; &lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; , &lt;/td&gt;&lt;td&gt; &amp;#044; &lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; - &lt;/td&gt;&lt;td&gt; &amp;#045; &lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; . &lt;/td&gt;&lt;td&gt; &amp;#046; &lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; / &lt;/td&gt;&lt;td&gt; &amp;#047; &lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; : &lt;/td&gt;&lt;td&gt; &amp;#058;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; ; &lt;/td&gt;&lt;td&gt; &amp;#059;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; = &lt;/td&gt;&lt;td&gt; &amp;#061;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; ? &lt;/td&gt;&lt;td&gt; &amp;#063;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; @ &lt;/td&gt;&lt;td&gt; &amp;#064;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; [ &lt;/td&gt;&lt;td&gt; &amp;#091;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; \ &lt;/td&gt;&lt;td&gt; &amp;#092;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; ] &lt;/td&gt;&lt;td&gt; &amp;#093;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; ^ &lt;/td&gt;&lt;td&gt; &amp;#094;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; _ &lt;/td&gt;&lt;td&gt; &amp;#095;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; ` &lt;/td&gt;&lt;td&gt; &amp;#096;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; { &lt;/td&gt;&lt;td&gt; &amp;#123;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; | &lt;/td&gt;&lt;td&gt; &amp;#124;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; } &lt;/td&gt;&lt;td&gt; &amp;#125;&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt; ~ &lt;/td&gt;&lt;td&gt; &amp;#126;&lt;/td&gt;&lt;/tr&gt;
    &lt;/table&gt;
    
    &lt;P&gt;Tenga en cuenta que {@code &lt;c:out&gt;} de JSTL escapa &lt;em&gt;solo los primeros cinco&lt;/em&gt; 
    de los caracteres de arriba.    
   */</span>
   <span class="keyword">public</span> <span class="keyword">static</span> String forHTML(String aText){
     <span class="keyword">final</span> StringBuilder result = <span
            class="keyword">new</span> StringBuilder();
     <span class="keyword">final</span> StringCharacterIterator iterator = <span
            class="keyword">new</span> StringCharacterIterator(aText);
     <span class="keyword">char</span> character =  iterator.current();
     <span class="keyword">while</span> (character != CharacterIterator.DONE ){
       <span class="keyword">if</span> (character == <span
            class="literal">'&lt;'</span>) {
         result.append(<span class="literal">"&amp;lt;"</span>);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'&gt;'</span>) {
         result.append(<span class="literal">"&amp;gt;"</span>);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'&amp;'</span>) {
         result.append(<span class="literal">"&amp;amp;"</span>);
      }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'\"'</span>) {
         result.append(<span class="literal">"&amp;quot;"</span>);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'\t'</span>) {
         addCharEntity(<span class="literal">9</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'!'</span>) {
         addCharEntity(<span class="literal">33</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'#'</span>) {
         addCharEntity(<span class="literal">35</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'$'</span>) {
         addCharEntity(<span class="literal">36</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'%'</span>) {
         addCharEntity(<span class="literal">37</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'\''</span>) {
         addCharEntity(<span class="literal">39</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'('</span>) {
         addCharEntity(<span class="literal">40</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">')'</span>) {
         addCharEntity(<span class="literal">41</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'*'</span>) {
         addCharEntity(<span class="literal">42</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'+'</span>) {
         addCharEntity(<span class="literal">43</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">','</span>) {
         addCharEntity(<span class="literal">44</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'-'</span>) {
         addCharEntity(<span class="literal">45</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'.'</span>) {
         addCharEntity(<span class="literal">46</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'/'</span>) {
         addCharEntity(<span class="literal">47</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">':'</span>) {
         addCharEntity(<span class="literal">58</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">';'</span>) {
         addCharEntity(<span class="literal">59</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'='</span>) {
         addCharEntity(<span class="literal">61</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'?'</span>) {
         addCharEntity(<span class="literal">63</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'@'</span>) {
         addCharEntity(<span class="literal">64</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'['</span>) {
         addCharEntity(<span class="literal">91</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'\\'</span>) {
         addCharEntity(<span class="literal">92</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">']'</span>) {
         addCharEntity(<span class="literal">93</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'^'</span>) {
         addCharEntity(<span class="literal">94</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'_'</span>) {
         addCharEntity(<span class="literal">95</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'`'</span>) {
         addCharEntity(<span class="literal">96</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'{'</span>) {
         addCharEntity(<span class="literal">123</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'|'</span>) {
         addCharEntity(<span class="literal">124</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'}'</span>) {
         addCharEntity(<span class="literal">125</span>, result);
       }
       <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'~'</span>) {
         addCharEntity(<span class="literal">126</span>, result);
       }
       <span class="keyword">else</span> {
         <span class="comment">//el carácter no es uno especial
</span>         <span class="comment">//agrégalo al resultado tal como es
</span>         result.append(character);
       }
       character = iterator.next();
     }
     <span class="keyword">return</span> result.toString();
  }
  

  <span class="comment">/**
   Escapa todos los caracteres ampersand en una URL.

   &lt;P&gt;Reemplaza todos los caracteres &lt;tt&gt;'&amp;'&lt;/tt&gt; con &lt;tt&gt;'&amp;amp;'&lt;/tt&gt;.
   
   &lt;P&gt;Un carácter ampersand puede aparacer en la cadena de búsqueda de una URL.
   El carácter ampersand es de hecho válido en una URL. 
   &lt;em&gt;Sin embargo, las URLS usualmente aparecen como un atributo &lt;tt&gt;HREF&lt;/tt&gt; attribute, y 
   tales atributos tienen la restricción adicional de que esos ampersands deben ser escapados.&lt;/em&gt;
   
   &lt;P&gt;La etiqueta &lt;c:url&gt; de JSTL realiza la codificación URL apropiada de los 
   parámetros de búsqueda. Pero no produce, en general, texto que sea 
   válido como un atributo &lt;tt&gt;HREF&lt;/tt&gt;, simplemente porque no escapa al carácter ampersand. Esto es una molestia 
   cuando aparecen varios parámetros de consulta en la URL, ya que requiere un poco de trabajo adicional.
  */</span>
  <span class="keyword">public</span> <span class="keyword">static</span> String forHrefAmpersand(String aURL){
    <span class="keyword">return</span> aURL.replace(<span
            class="literal">"&amp;"</span>, <span class="literal">"&amp;amp;"</span>);
  }
   
  <span class="comment">/**
    Synonym for &lt;tt&gt;URLEncoder.encode(String, "UTF-8")&lt;/tt&gt;.
   
    &lt;P&gt;Used to ensure that HTTP query strings are in proper form, by escaping
    special characters such as spaces.
   
    &lt;P&gt;It is important to note that if a query string appears in an &lt;tt&gt;HREF&lt;/tt&gt;
    attribute, then there are two issues - ensuring the query string is valid HTTP
    (it is URL-encoded), and ensuring it is valid HTML (ensuring the 
    ampersand is escaped).
   */</span>
   <span class="keyword">public</span> <span class="keyword">static</span> String forURL(String aURLFragment){
     String result = <span class="keyword">null</span>;
     <span class="keyword">try</span> {
       result = URLEncoder.encode(aURLFragment, <span class="literal">"UTF-8"</span>);
     }
     <span class="keyword">catch</span> (UnsupportedEncodingException ex){
       <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span
            class="literal">"UTF-8 no soportado"</span>, ex);
     }
     <span class="keyword">return</span> result;
   }

  <span class="comment">/**
   Caracteres de escape para el texto que aparece como datos XML, entre etiquetas.
   
   &lt;P&gt;Los caracteres siguientes son reemplazados con las entidades de carácter correspondientes:
   &lt;table border='1' cellpadding='3' cellspacing='0'&gt;
   &lt;tr&gt;&lt;th&gt; Carácter &lt;/th&gt;&lt;th&gt; Codificación &lt;/th&gt;&lt;/tr&gt;
   &lt;tr&gt;&lt;td&gt; &lt; &lt;/td&gt;&lt;td&gt; &amp;lt; &lt;/td&gt;&lt;/tr&gt;
   &lt;tr&gt;&lt;td&gt; &gt; &lt;/td&gt;&lt;td&gt; &amp;gt; &lt;/td&gt;&lt;/tr&gt;
   &lt;tr&gt;&lt;td&gt; &amp; &lt;/td&gt;&lt;td&gt; &amp;amp; &lt;/td&gt;&lt;/tr&gt;
   &lt;tr&gt;&lt;td&gt; " &lt;/td&gt;&lt;td&gt; &amp;quot;&lt;/td&gt;&lt;/tr&gt;
   &lt;tr&gt;&lt;td&gt; ' &lt;/td&gt;&lt;td&gt; &amp;#039;&lt;/td&gt;&lt;/tr&gt;
   &lt;/table&gt;
   
   &lt;P&gt;Tenga en cuenta que {@code &lt;c:out&gt;} de JSTL escapa el mismo conjunto exacto de 
   caracteres como este método. &lt;span class='highlight'&gt;Es decir, {@code &lt;c:out&gt;}
   es bueno para escapar para producir XML válido, pero no para producir HTML 
   seguro.&lt;/span&gt;
  */</span>
  <span class="keyword">public</span> <span class="keyword">static</span> String forXML(String aText){
    <span class="keyword">final</span> StringBuilder result = <span
            class="keyword">new</span> StringBuilder();
    <span class="keyword">final</span> StringCharacterIterator iterator = <span
            class="keyword">new</span> StringCharacterIterator(aText);
    <span class="keyword">char</span> character =  iterator.current();
    <span class="keyword">while</span> (character != CharacterIterator.DONE ){
      <span class="keyword">if</span> (character == <span
            class="literal">'&lt;'</span>) {
        result.append(<span class="literal">"&amp;lt;"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'&gt;'</span>) {
        result.append(<span class="literal">"&amp;gt;"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'\"'</span>) {
        result.append(<span class="literal">"&amp;quot;"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'\''</span>) {
        result.append(<span class="literal">"&amp;#039;"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'&amp;'</span>) {
         result.append(<span class="literal">"&amp;amp;"</span>);
      }
      <span class="keyword">else</span> {
        <span class="comment">//el carácter no es uno especial
</span>        <span class="comment">//agréguelo al resultado tal como es 
</span>        result.append(character);
      }
      character = iterator.next();
    }
    <span class="keyword">return</span> result.toString();
  }
  
  <span class="comment">/**
    Escapa los caracteres para aparecer como datos en el formato de intercambio de datos (JSON)
   
   &lt;P&gt;Se escapan los siguientes caracteres de control de uso común:
   &lt;table border='1' cellpadding='3' cellspacing='0'&gt;
   &lt;tr&gt;&lt;th&gt; Carácter &lt;/th&gt;&lt;th&gt; Escapado Como &lt;/th&gt;&lt;/tr&gt;
   &lt;tr&gt;&lt;td&gt; " &lt;/td&gt;&lt;td&gt; \" &lt;/td&gt;&lt;/tr&gt;
   &lt;tr&gt;&lt;td&gt; \ &lt;/td&gt;&lt;td&gt; \\ &lt;/td&gt;&lt;/tr&gt;
   &lt;tr&gt;&lt;td&gt; / &lt;/td&gt;&lt;td&gt; \/ &lt;/td&gt;&lt;/tr&gt;
   &lt;tr&gt;&lt;td&gt; back space &lt;/td&gt;&lt;td&gt; \b &lt;/td&gt;&lt;/tr&gt; 
   &lt;tr&gt;&lt;td&gt; form feed &lt;/td&gt;&lt;td&gt; \f &lt;/td&gt;&lt;/tr&gt;
   &lt;tr&gt;&lt;td&gt; line feed &lt;/td&gt;&lt;td&gt; \n &lt;/td&gt;&lt;/tr&gt;
   &lt;tr&gt;&lt;td&gt; carriage return &lt;/td&gt;&lt;td&gt; \r &lt;/td&gt;&lt;/tr&gt;
   &lt;tr&gt;&lt;td&gt; tab &lt;/td&gt;&lt;td&gt; \t &lt;/td&gt;&lt;/tr&gt;
   &lt;/table&gt;
   
   &lt;P&gt;Vea &lt;a href='http://www.ietf.org/rfc/rfc4627.txt'&gt;RFC 4627&lt;/a&gt; para más información.
  */</span>
  <span class="keyword">public</span> <span class="keyword">static</span> String forJSON(String aText){
    <span class="keyword">final</span> StringBuilder result = <span
            class="keyword">new</span> StringBuilder();
    StringCharacterIterator iterator = <span class="keyword">new</span> StringCharacterIterator(aText);
    <span class="keyword">char</span> character = iterator.current();
    <span class="keyword">while</span> (character != StringCharacterIterator.DONE){
      <span class="keyword">if</span>( character == <span
            class="literal">'\"'</span> ){
        result.append(<span class="literal">"\\\""</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(character == <span
            class="literal">'\\'</span>){
        result.append(<span class="literal">"\\\\"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(character == <span
            class="literal">'/'</span>){
        result.append(<span class="literal">"\\/"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(character == <span
            class="literal">'\b'</span>){
        result.append(<span class="literal">"\\b"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(character == <span
            class="literal">'\f'</span>){
        result.append(<span class="literal">"\\f"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(character == <span
            class="literal">'\n'</span>){
        result.append(<span class="literal">"\\n"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(character == <span
            class="literal">'\r'</span>){
        result.append(<span class="literal">"\\r"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(character == <span
            class="literal">'\t'</span>){
        result.append(<span class="literal">"\\t"</span>);
      }
      <span class="keyword">else</span> {
        <span class="comment">//el carácter no es uno especial
</span>        <span class="comment">//agréguelo al resultado tal como es 
</span>        result.append(character);
      }
      character = iterator.next();
    }
    <span class="keyword">return</span> result.toString();    
  }

  <span class="comment">/**
   Devuelve &lt;tt&gt;aText&lt;/tt&gt; con todos los caracteres &lt;tt&gt;'&lt;'&lt;/tt&gt; and &lt;tt&gt;'&gt;'&lt;/tt&gt; 
   reemplazados con sus equivalentes escapados.
  */</span>
  <span class="keyword">public</span> <span class="keyword">static</span> String toDisableTags(String aText){
    <span class="keyword">final</span> StringBuilder result = <span
            class="keyword">new</span> StringBuilder();
    <span class="keyword">final</span> StringCharacterIterator iterator = <span
            class="keyword">new</span> StringCharacterIterator(aText);
    <span class="keyword">char</span> character =  iterator.current();
    <span class="keyword">while</span> (character != CharacterIterator.DONE ){
      <span class="keyword">if</span> (character == <span
            class="literal">'&lt;'</span>) {
        result.append(<span class="literal">"&amp;lt;"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'&gt;'</span>) {
        result.append(<span class="literal">"&amp;gt;"</span>);
      }
      <span class="keyword">else</span> {
        <span class="comment">//el carácter no es uno especial
</span>        <span class="comment">//agréguelo al resultado tal como es 
</span>        result.append(character);
      }
      character = iterator.next();
    }
    <span class="keyword">return</span> result.toString();
  }
  

  <span class="comment">/**
   Reemplace los caracteres que tienen especial significado en las expresiones regulares
   con sus escapados equivalentes, precedidos por un carácter '\'.
  
   &lt;P&gt;Los caracteres escapados incluyen:
  &lt;ul&gt;
  &lt;li&gt;.
  &lt;li&gt;\
  &lt;li&gt;?, * , y +
  &lt;li&gt;&amp;
  &lt;li&gt;:
  &lt;li&gt;{ y }
  &lt;li&gt;[ y ]
  &lt;li&gt;( y )
  &lt;li&gt;^ y $
  &lt;/ul&gt;
  */</span>
  <span class="keyword">public</span> <span class="keyword">static</span> String forRegex(String aRegexFragment){
    <span class="keyword">final</span> StringBuilder result = <span
            class="keyword">new</span> StringBuilder();

    <span class="keyword">final</span> StringCharacterIterator iterator = 
      <span class="keyword">new</span> StringCharacterIterator(aRegexFragment)
    ;
    <span class="keyword">char</span> character =  iterator.current();
    <span class="keyword">while</span> (character != CharacterIterator.DONE ){
      <span class="comment">/*
       Todos los literales necesitan tener dobladas las barras invertidas.
      */</span>
      <span class="keyword">if</span> (character == <span
            class="literal">'.'</span>) {
        result.append(<span class="literal">"\\."</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'\\'</span>) {
        result.append(<span class="literal">"\\\\"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'?'</span>) {
        result.append(<span class="literal">"\\?"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'*'</span>) {
        result.append(<span class="literal">"\\*"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'+'</span>) {
        result.append(<span class="literal">"\\+"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'&amp;'</span>) {
        result.append(<span class="literal">"\\&amp;"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">':'</span>) {
        result.append(<span class="literal">"\\:"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'{'</span>) {
        result.append(<span class="literal">"\\{"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'}'</span>) {
        result.append(<span class="literal">"\\}"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'['</span>) {
        result.append(<span class="literal">"\\["</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">']'</span>) {
        result.append(<span class="literal">"\\]"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'('</span>) {
        result.append(<span class="literal">"\\("</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">')'</span>) {
        result.append(<span class="literal">"\\)"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'^'</span>) {
        result.append(<span class="literal">"\\^"</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span> (character == <span
            class="literal">'$'</span>) {
        result.append(<span class="literal">"\\$"</span>);
      }
      <span class="keyword">else</span> {
        <span class="comment">//el carácter no es uno especial
</span>        <span class="comment">//agréguelo al resultado tal como es 
</span>        result.append(character);
      }
      character = iterator.next();
    }
    <span class="keyword">return</span> result.toString();
  }
  
  <span class="comment">/**
   Escapar caracteres &lt;tt&gt;'$'&lt;/tt&gt; and &lt;tt&gt;'\'&lt;/tt&gt; en cadenasd de reemplazo.
   
   &lt;P&gt;Sinónimo para &lt;tt&gt;Matcher.quoteReplacement(String)&lt;/tt&gt;.
   
   &lt;P&gt;Los métodos siguientes usan cadenas de reemplazo que tratan 
   &lt;tt&gt;'$'&lt;/tt&gt; and &lt;tt&gt;'\'&lt;/tt&gt; como caracteres especiales:
   &lt;ul&gt;
   &lt;li&gt;&lt;tt&gt;String.replaceAll(String, String)&lt;/tt&gt;
   &lt;li&gt;&lt;tt&gt;String.replaceFirst(String, String)&lt;/tt&gt;
   &lt;li&gt;&lt;tt&gt;Matcher.appendReplacement(StringBuffer, String)&lt;/tt&gt;
   &lt;/ul&gt;
   
   &lt;P&gt;Si el texto de reemplazo puede contener caracteres arbitrarios, entonces 
   habitualmente necesitará escapar ese texto, para asegurar que los caracteres especiales
   son interpretados literalmente.
  */</span>
  <span class="keyword">public</span> <span class="keyword">static</span> String forReplacementString(String aInput){
    <span class="keyword">return</span> Matcher.quoteReplacement(aInput);
  }
  
  <span class="comment">/**
   Deshabilita todas las etiquetas &lt;tt&gt;&lt;SCRIPT&gt;&lt;/tt&gt; en &lt;tt&gt;aText&lt;/tt&gt;.
   
   &lt;P&gt;Insensible a mayúsculas o minúsculas.
  */</span>  
  <span class="keyword">public</span> <span class="keyword">static</span> String forScriptTagsOnly(String aText){
    String result = <span class="keyword">null</span>;
    Matcher matcher = SCRIPT.matcher(aText);
    result = matcher.replaceAll(<span class="literal">"&amp;lt;SCRIPT&gt;"</span>);
    matcher = SCRIPT_END.matcher(result);
    result = matcher.replaceAll(<span class="literal">"&amp;lt;/SCRIPT&gt;"</span>);
    <span class="keyword">return</span> result;
  }
  
  <span class="comment">// PRIVADO //
</span>  
  <span class="keyword">private</span> EscapeChars(){
    <span class="comment">//vacío - evita la construcción
</span>  }
  
  <span class="keyword">private</span> <span class="keyword">static</span> <span
            class="keyword">final</span> Pattern SCRIPT = Pattern.compile(
    <span class="literal">"&lt;SCRIPT&gt;"</span>, Pattern.CASE_INSENSITIVE
   );
  <span class="keyword">private</span> <span class="keyword">static</span> <span
            class="keyword">final</span> Pattern SCRIPT_END = Pattern.compile(
    <span class="literal">"&lt;/SCRIPT&gt;"</span>, Pattern.CASE_INSENSITIVE
  );
  
  <span class="keyword">private</span> <span class="keyword">static</span> <span
            class="keyword">void</span> addCharEntity(Integer aIdx, StringBuilder aBuilder){
    String padding = <span class="literal">""</span>;
    <span class="keyword">if</span>( aIdx &lt;= <span class="literal">9</span> ){
       padding = <span class="literal">"00"</span>;
    }
    <span class="keyword">else</span> <span class="keyword">if</span>( aIdx &lt;= <span
            class="literal">99</span> ){
      padding = <span class="literal">"0"</span>;
    }
    <span class="keyword">else</span> {
      <span class="comment">//sin prefijo
</span>    }
    String number = padding + aIdx.toString();
    aBuilder.append(<span class="literal">"&amp;#"</span> + number + <span
            class="literal">";"</span>);
  }
}
 
    </pre>
    <br />
    <p></p>
    <p></p>
    <div class="topic-section" id="see-also-title">Vea También:</div>
    <div id="see-also" class="main-body">
      <a href="../tareascomunes/tareascomunes_80.html">Reemplazar una cadena</a><br /> 
      <a href="../servlets/servlets_201.html">Tenga cuidado de los ampersands doblemente escapados</a><br />
    </div>
    <footer id="footer" class="legalese">
      <span id="app_name">Prácticas de Java</span> 
      <span id="app_version_number">3.001</span><br /> © 
      <span id="copyright">2018 Hirondelle Systems</span><br /> 
      <a href="http://www.javapractices.com/source/SourceAction.do">Código Fuente</a> | 
      <a href="mailto:webmaster@javapractices.com" rel="author">Contacto</a> | 
      <a href="http://creativecommons.org/licenses/by-nc-sa/1.0/" rel="license">Licencia</a> | 
      <a href="http://www.javapractices.com/apps/cjp.rss" rel="alternate" type="application/rss+xml">RSS</a>
      <!-- ukey="2AC36CD2" -->
      <!-- ckey="16DF3D87" -->
      <br /> Los trozos de código individual tienen una 
      <a href="http://www.javapractices.com/LICENSE.txt" rel="license">licencia BSD</a><br /> 
      Sobre 1,000,000 de IPs únicas el último año<br /> 
      Última actualización <time id="last_updated_on" datetime="2018-06-03">2018-06-03</time><br />
      - In Memoriam : Bill Dirani -
    </footer>
  </body>
</html>