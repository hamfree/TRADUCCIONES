<!DOCTYPE html>
<html lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="description" content="Prácticas y técnicas de programación en Java.">
    <meta name="keywords" content="java, programación java, Prácticas de Java, idioma java, estilo java, patrones de diseño java, 
          convenciones de codigo java">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prácticas de Java-&gt;Estadísticas de la memoria</title>
    <link id="stylesheet" rel="stylesheet" type="text/css" href="../css/stylesheet9.css" media="all">
    <link rel="icon" type="image/png" href="../img/favicon.png">
  </head>
  <body>
    <nav class="menu-bar" id="menu-bar">
      <a href="../index.html" title="Tabla de Contenido" style="float: left;">Inicio</a> &nbsp;&nbsp;
      <form method="GET" action="https://www.google.com/search" class="search-form" style="float: right;">
        <input name="q" size="15" maxlength="255" placeholder="" type="text" />
        <input name="btnG" value="Búsqueda" type="submit" /> 
        <input name="sitesearch" value="www.javapractices.com" type="hidden" />
      </form>
    </nav>
    <div class="page-title">Estadísticas de la memoria</div>
    <br />
    La memoria disponible para su programa Java tiene un límite superior. Para especificar ese límite explícitamente, en lugar de 
    depender de un valor predeterminado, puede pasar un parámetro de línea de comando llamado
    <a href="http://docs.oracle.com/javase/7/docs/technotes/tools/solaris/java.html">-Xmx</a> al tiempo de ejecución de Java.
    <p>
      Es habitualmente importante saber cuanta memoria está usando su aplicación. Si está usando un alto porcentaje de la memoria 
      disponible total, entonces es habitualmente una buena idea usar <code>-Xmx</code> para incrementar el total disponible.
    </p>
    <p>
      Aquí tiene un ejemplo. (Una explicación de los métodos de la clase 
      <a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Runtime.html">Runtime</a> se puede encontrar 
      <a href="https://stackoverflow.com/questions/3571203/what-are-runtime-getruntime-totalmemory-and-freememory">aquí</a>).
      <br />
    </p>
    <pre>
<span class="keyword">import</span> java.math.BigDecimal;
<span class="keyword">import</span> java.math.RoundingMode;
<span class="keyword">import</span> java.text.DecimalFormat;
<span class="keyword">import</span> java.util.Objects;

<span class="comment">/** Todos los valores están en bytes. */</span>
<span class="keyword">public</span> <span class="keyword">class</span> PercentMemory {
  
  <span class="keyword">public</span> <span class="keyword">static</span> <span
			class="keyword">void</span> main(String... args) {
    log(<span class="literal">"Estadísticas de memoria:"</span>);
    PercentMemory pm = <span class="keyword">new</span> PercentMemory();
    log(<span class="literal">" Total:  "</span> + pm.format(pm.totalAvailableMemory()) + <span
			class="literal">" bytes (configuración -Xmx)"</span>);
    log(<span class="literal">" En uso: "</span> + pm.format(pm.currentlyUsedMemory()) + <span
			class="literal">" bytes"</span>);
    log(<span class="literal">" En uso: "</span> + pm.percentageMemoryUse(NUM_DECIMALS) + <span
			class="literal">" %"</span>);
  }
  
  <span class="comment">/** 
   Esta es la configuración -Xmx pasada a la línea de comandos de java.
   Ejemplo: -Xmx=10G. 
  */</span>
  Long totalAvailableMemory(){
    <span class="keyword">return</span> jre().maxMemory();
  }
  
  Long currentlyUsedMemory(){
    <span class="keyword">return</span> jre().totalMemory() - jre().freeMemory();
  }
  
  Long currentlyFreeMemory(){
    <span class="keyword">return</span> totalAvailableMemory() - currentlyUsedMemory();
  }
  
  BigDecimal percentageMemoryUse(<span class="keyword">int</span> numDecimals){
    BigDecimal currentlyUsed = <span class="keyword">new</span> BigDecimal(currentlyUsedMemory().toString()); 
    BigDecimal totalAvailable = <span class="keyword">new</span> BigDecimal(totalAvailableMemory().toString());
    BigDecimal HUNDRED = <span class="keyword">new</span> BigDecimal(<span
			class="literal">"100"</span>);
    BigDecimal result = currentlyUsed.divide(
      totalAvailable, numDecimals, RoundingMode.HALF_EVEN
    );
    result = result.multiply(HUNDRED);
    <span class="keyword">return</span> result.stripTrailingZeros();
  }
  
  <span class="keyword">private</span> Runtime jre(){
    <span class="keyword">return</span> Runtime.getRuntime();
  }
  
  <span class="keyword">private</span> String format(Number value){
    DecimalFormat formatter = <span class="keyword">new</span> DecimalFormat(<span
			class="literal">"#,###"</span>);
    <span class="keyword">return</span> formatter.format(value);
  }
  
  <span class="keyword">private</span> <span class="keyword">static</span> <span
			class="keyword">void</span> log(Object thing){
    System.out.println(Objects.toString(thing, <span class="literal">""</span>));
  }

  <span class="keyword">private</span> <span class="keyword">static</span> <span
			class="keyword">int</span> NUM_DECIMALS = <span class="literal">6</span>; <span
			class="comment">//antes de la operación *100
</span>}
 
    </pre>
    <p></p>
    <p>
      Ejecución de ejemplo:
    </p>
    <pre>
Estadísticas de memoria:
 Total:  2,734,686,208 bytes (configuración -Xmx)
 En uso: 1,929,416 bytes
 En uso: 0.0706 %
    </pre>
    <br />
    <p></p>
    <footer id="footer" class="legalese">
      <span id="app_name">Prácticas de Java</span> 
      <span id="app_version_number">3.001</span><br /> © 
      <span id="copyright">2018 Hirondelle Systems</span><br /> 
      <a href="http://www.javapractices.com/source/SourceAction.do">Código Fuente</a> | 
      <a href="mailto:webmaster@javapractices.com" rel="author">Contacto</a> | 
      <a href="http://creativecommons.org/licenses/by-nc-sa/1.0/" rel="license">Licencia</a> | 
      <a href="http://www.javapractices.com/apps/cjp.rss" rel="alternate" type="application/rss+xml">RSS</a>
      <!-- ukey="2AC36CD2" -->
      <!-- ckey="16DF3D87" -->
      <br /> Los trozos de código individual tienen una 
      <a href="http://www.javapractices.com/LICENSE.txt" rel="license">licencia BSD</a><br /> 
      Sobre 1,000,000 de IPs únicas el último año<br /> 
      Última actualización <time id="last_updated_on" datetime="2018-06-03">2018-06-03</time><br />
      - In Memoriam : Bill Dirani -
    </footer>
  </body>
</html>