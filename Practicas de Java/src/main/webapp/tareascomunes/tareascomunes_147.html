<!DOCTYPE html>
<html lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="description" content="Prácticas y técnicas de programación en Java.">
    <meta name="keywords" content="java, programación java, Prácticas de Java, idioma java, estilo java, patrones de diseño java, 
          convenciones de codigo java">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prácticas de Java-&gt;Recoger texto de la web</title>
    <link id="stylesheet" rel="stylesheet" type="text/css" href="../css/stylesheet9.css" media="all">
    <link rel="icon" type="image/png" href="../img/favicon.png">
  </head>
  <body>
    <nav class="menu-bar" id="menu-bar">
      <a href="../index.html" title="Tabla de Contenido" style="float: left;">Inicio</a> &nbsp;&nbsp;
      <form method="GET" action="https://www.google.com/search" class="search-form" style="float: right;">
        <input name="q" size="15" maxlength="255" placeholder="" type="text" />
        <input name="btnG" value="Search" type="submit" /> 
        <input name="sitesearch" value="www.javapractices.com" type="hidden" />
      </form>
    </nav>
    <div class="page-title">Recoger texto de la web</div>
    <br />
    La mayoría de las URLs devuelven texto de alguna clase - HTML, JSON, XML, texto plano, etcetera. Aquí tiene un ejemplo de la 
    recuperación programada del contenido de una URL como una String única.
    <p>
      Si necesita datos de un sitio, pero el sitio no tiene una IPA formal de web, entonces habitualmente no tiene tiene más 
      elección que obtener el HTML del sitio, analizarlo, y extraer los datos requeridos.<br />
    </p>
    <pre>
<span class="keyword">import</span> java.io.*;
<span class="keyword">import</span> java.net.*;
<span class="keyword">import</span> java.util.Objects;
<span class="keyword">import</span> java.util.Scanner;

<span class="comment">/** 
 Obtenga el texto de una página web (o encabezado HTTP) como una cadena. 
 El mismo tipo de código se puede utilizar para recuperar cualquier tipo de texto: 
 HTML, JSON, XML, texto sin formato, etc.
*/</span>
<span class="keyword">public</span> <span class="keyword">final</span> <span
			class="keyword">class</span> WebPageFetcher {

  <span class="comment">/**
   Maqueta de demostración.
   &lt;ul&gt;
    &lt;li&gt;aArgs[0] : una URL HTTP
    &lt;li&gt;aArgs[1] : (cabecera | contenido)
   &lt;/ul&gt;
  */</span>
  <span class="keyword">public</span> <span class="keyword">static</span> <span
			class="keyword">void</span> main(String... aArgs) <span
			class="keyword">throws</span> MalformedURLException {
    String url = aArgs[<span class="literal">0</span>];
    String option = aArgs[<span class="literal">1</span>];
    WebPageFetcher fetcher = <span class="keyword">new</span>  WebPageFetcher(url);
    <span class="keyword">if</span> (HEADER.equalsIgnoreCase(option)) {
      log(fetcher.getPageHeader());
    }
    <span class="keyword">else</span> <span class="keyword">if</span> (CONTENT.equalsIgnoreCase(option)) {
      log(fetcher.getPageContent());
    }
    <span class="keyword">else</span> {
      log(<span class="literal">"Opción desconocida."</span>);
    }
  }

  <span class="keyword">public</span> WebPageFetcher(URL aURL){
    <span class="keyword">if</span> (! HTTP.equals(aURL.getProtocol())) {
      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span
			class="literal">"La URL no tiene el protocolo HTTP: "</span> + aURL);
    }
    fURL = aURL;
  }

  <span class="keyword">public</span> WebPageFetcher(String aUrlName) <span
			class="keyword">throws</span> MalformedURLException {
    <span class="keyword">this</span>(<span class="keyword">new</span> URL(aUrlName));
  }

  <span class="comment">/** Obtiene el contenido de la URL como texto simple.*/</span>
  <span class="keyword">public</span> String getPageContent() {
    String result = <span class="keyword">null</span>;
    URLConnection connection = <span class="keyword">null</span>;
    <span class="keyword">try</span> {
      connection =  fURL.openConnection();
      <span class="keyword">try</span>(Scanner scanner = <span
			class="keyword">new</span> Scanner(connection.getInputStream())){
        scanner.useDelimiter(END_OF_INPUT);
        result = scanner.next();
      }
    }
    <span class="keyword">catch</span> (IOException ex) {
      log(<span class="literal">"No puede abrir conexión a  "</span> + fURL.toString());
    }
    <span class="keyword">return</span> result;
  }

  <span class="comment">/** 
   Obtenga todos los encabezados HTTP como texto simple.
   Un encabezado por línea, como un par 'clave: valor'.
  */</span>
  <span class="keyword">public</span> String getPageHeader(){
    StringBuilder result = <span class="keyword">new</span> StringBuilder();

    URLConnection connection = <span class="keyword">null</span>;
    <span class="keyword">try</span> {
      connection = fURL.openConnection();
    }
    <span class="keyword">catch</span> (IOException ex) {
      log(<span class="literal">"No puede abrir una conexión a la URL: "</span> + fURL);
    }

    <span class="comment">//no todas las cabeceras vienen en pares clave-valor- algunas veces la claves es 
</span>    <span class="comment">//nula o una String vacía
</span>    <span class="keyword">int</span> headerIdx = <span class="literal">0</span>;
    String headerKey = <span class="keyword">null</span>;
    String headerValue = <span class="keyword">null</span>;
    <span class="keyword">while</span> ( (headerValue = connection.getHeaderField(headerIdx)) != <span
			class="keyword">null</span> ) {
      headerKey = connection.getHeaderFieldKey(headerIdx);
      <span class="keyword">if</span> (headerKey != <span
			class="keyword">null</span> &amp;&amp; headerKey.length()&gt;<span
			class="literal">0</span>) {
        result.append(headerKey);
        result.append(<span class="literal">" : "</span>);
      }
      result.append(headerValue);
      result.append(NEWLINE);
      headerIdx++;
    }
    <span class="keyword">return</span> result.toString();
  }

  <span class="comment">// PRIVADO
</span>  <span class="keyword">private</span> URL fURL;
  
  <span class="keyword">private</span> <span class="keyword">static</span> <span
			class="keyword">final</span> String HTTP = <span class="literal">"http"</span>;
  <span class="keyword">private</span> <span class="keyword">static</span> <span
			class="keyword">final</span> String HEADER = <span class="literal">"header"</span>;
  <span class="keyword">private</span> <span class="keyword">static</span> <span
			class="keyword">final</span> String CONTENT = <span class="literal">"content"</span>;
  <span class="keyword">private</span> <span class="keyword">static</span> <span
			class="keyword">final</span> String END_OF_INPUT = <span
			class="literal">"\\Z"</span>;
  <span class="keyword">private</span> <span class="keyword">static</span> <span
			class="keyword">final</span> String NEWLINE = System.getProperty(<span
			class="literal">"line.separator"</span>);

  <span class="keyword">private</span> <span class="keyword">static</span> <span
			class="keyword">void</span> log(Object aObject){
    System.out.println(Objects.toString(aObject));
  }
} 
    </pre>
    <br />
    Un ejemplo de ejecución, obteniendo los encabezados HTTP de date4j.net:
    <p></p>
    <pre>
&gt;java -cp . WebPageFetcher http://www.date4j.net/ header
HTTP/1.1 200 OK
Date : Tue, 14 Nov 2017 00:24:05 GMT
Accept-Ranges : bytes
ETag : W/"21757-1441143396000"
Last-Modified : Tue, 01 Sep 2015 21:36:36 GMT
Content-Type : text/html; charset=UTF-8
Content-Length : 21757
Vary : Accept-Encoding
Keep-Alive : timeout=3, max=100
Connection : Keep-Alive
    </pre>
    <p></p>
    <p></p>
    <footer id="footer" class="legalese">
      <span id="app_name">Prácticas de Java</span> 
      <span id="app_version_number">3.001</span><br /> © 
      <span id="copyright">2018 Hirondelle Systems</span><br /> 
      <a href="http://www.javapractices.com/source/SourceAction.do">Código Fuente</a> | 
      <a href="mailto:webmaster@javapractices.com" rel="author">Contacto</a> | 
      <a href="http://creativecommons.org/licenses/by-nc-sa/1.0/" rel="license">Licencia</a> | 
      <a href="http://www.javapractices.com/apps/cjp.rss" rel="alternate" type="application/rss+xml">RSS</a>
      <!-- ukey="2AC36CD2" -->
      <!-- ckey="16DF3D87" -->
      <br /> Los trozos de código individual tienen una 
      <a href="http://www.javapractices.com/LICENSE.txt" rel="license">licencia BSD</a><br /> 
      Sobre 1,000,000 de IPs únicas el último año<br /> 
      Última actualización <time id="last_updated_on" datetime="2018-06-03">2018-06-03</time><br />
      - In Memoriam : Bill Dirani -
    </footer>
  </body>
</html>