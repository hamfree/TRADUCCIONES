<!DOCTYPE html>
<!-- saved from url=(0055)http://www.javapractices.com/topic/TopicAction.do?Id=49 -->
<html lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="description" content="Prácticas y técnicas de programación en Java.">
    <meta name="keywords" content="java, programación java, Prácticas de Java, idioma java, estilo java, patrones de diseño java, 
          convenciones de codigo java">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prácticas de Java-&gt;Sincronize el acceso a los campos mutables</title>
    <link id="stylesheet" rel="stylesheet" type="text/css" href="../css/stylesheet9.css" media="all">
    <link rel="icon" type="image/png" href="../img/favicon.png">
  </head>
  <body>
    <nav class="menu-bar" id="menu-bar">
      <a href="../index.html" title="Tabla de Contenido" style="float: left;">Inicio</a> &nbsp;&nbsp;
      <form method="GET" action="https://www.google.com/search" class="search-form" style="float: right;">
        <input type="text" name="q" size="15" maxlength="255" value="" placeholder=""/> 
        <input type="submit" name="btnG" value="Search" /> 
        <input type="hidden" name="sitesearch" value="www.javapractices.com" />
      </form>
    </nav>
    <div class="page-title">Sincronize el acceso a los campos mutables</div>
    <br />
    In a multi-threaded environment, accessing mutable data (data that can change) must always be coordinated between readers and 
    writers. The task of making sure that readers and writers don't interfere with each other in undesirable ways is called 
    <em>synchronization</em>. Synchronization can be done with an explicit lock object, but a more common style is to use the 
    <i>intrinsic locks</i> implied by the <code>synchronized</code> keyword.
    <p>
      For example, in a multi-threaded environment, all <code>get</code> and <code>set</code> methods for mutable fields should 
      usually be <code>synchronized</code> methods. This includes primitive fields.
    </p>
    <p>
      Most classes do not need to be designed for operation in a multi-threaded environment, and can ignore these considerations.
    </p>
    <p>
      If an object does need to live in a multi-threaded environment, however, then a significant amount of care must be taken to 
      ensure that it is correctly designed.
    </p>
    <p>
      If an object is <a href="http://www.javapractices.com/topic/TopicAction.do?Id=29">immutable</a>, then it's automatically 
      <a href="http://www.javapractices.com/topic/TopicAction.do?Id=48">thread-safe</a>. If it's mutable, then extra steps must be 
      taken to ensure thread-safety: every use of every mutable field must be synchronized in some way (usually with using the 
      <code>synchronized</code> keyword).
    </p>
    <p>
      Here, <i>mutable field</i> simply means a field which might change in any way, after the initial construction of the object. 
      (Objects are never shared between threads until after the object is fully created.) For example,
    </p>
    <ul>
      <li>an <code>int</code> field that changes its value some time after the constructor completes</li>
      <li>
        a <code>Date</code> field that changes state some time after the constructor completes, to represent a different date from 
        the original
      </li>
      <li>any object field that is "pointed" to a new object, some time after the constructor completes</li>
    </ul>
    Remember that all <i>local</i> variables declared in the body of a method are never shared between threads, and so have no 
    thread-safety considerations. 
    <p>
      It's a misconception that all mutable primitives except <code>long</code> and <code>double</code> do not need 
      <code>synchronized</code> access.
    </p>
    <p>
      <b>Example</b>
    </p>
    <p>
      Note that even the <code>get</code> of the <code>int</code> field is a <code>synchronized</code> method.<br />
    </p>
    <pre>
<span class="keyword">import</span> java.util.Date;

<span class="comment">/**
* This class is mutable, but thread-safe : the caller never
* needs to perform external synchronization, except when multiple calls
* need to be treated as a single unit.
*
* This class illustrates the three possible cases for fields :
*&lt;ul&gt;
* &lt;li&gt; a primitive (int)
* &lt;li&gt; an immutable object (String)
* &lt;li&gt; a mutable object (Date)
*&lt;/ul&gt;
*/</span>
<span class="keyword">public</span> <span class="keyword">final</span> <span
			class="keyword">class</span> MutablePlanet {

  <span class="keyword">public</span> MutablePlanet(<span
			class="keyword">int</span> aId, String aName, Date aDateOfDiscovery) {
     fId = aId;
     fName = aName;
     <span class="comment">//Make a private copy of aDateOfDiscovery.
</span>     <span class="comment">//This is the only way to keep the fDateOfDiscovery
</span>     <span class="comment">//field private, and shields this class from any changes
</span>     <span class="comment">//to the original aDateOfDiscovery object which might be
</span>     <span class="comment">//made by the caller.
</span>     fDateOfDiscovery = <span class="keyword">new</span> Date(aDateOfDiscovery.getTime());
  }

  <span class="keyword">public</span> <span class="keyword">synchronized</span> <span
			class="keyword">int</span> getId() {
     <span class="keyword">return</span> fId;
  }
  <span class="keyword">public</span> <span class="keyword">synchronized</span> <span
			class="keyword">void</span> setId(<span class="keyword">int</span> aNewId) {
    fId = aNewId;
  }

  <span class="keyword">public</span> <span class="keyword">synchronized</span> String getName() {
    <span class="keyword">return</span> fName;
  }
  <span class="keyword">public</span> <span class="keyword">synchronized</span> <span
			class="keyword">void</span> setName(String aNewName) {
    fName = aNewName;
  }

  <span class="comment">/**
  * Returns a defensive copy of the field.
  * The caller of this method can do anything they want with the
  * returned Date object, without affecting the internals of this
  * class in any way.
  */</span>
  <span class="keyword">public</span> <span class="keyword">synchronized</span> Date getDateOfDiscovery() {
    <span class="keyword">return</span> <span class="keyword">new</span> Date(fDateOfDiscovery.getTime());
  }
  <span class="keyword">public</span> <span class="keyword">synchronized</span> <span
			class="keyword">void</span> setDateOfDiscovery(Date aNewDiscoveryDate) {
    <span class="comment">//change the state of the mutable Date field
</span>    fDateOfDiscovery.setTime(aNewDiscoveryDate.getTime());
  }

  <span class="comment">// PRIVATE
</span>
  <span class="comment">/**
  * A primitive field.
  */</span>
  <span class="keyword">private</span> <span class="keyword">int</span> fId;

  <span class="comment">/**
  * An immutable object field.
  * Strings never alter state after construction.
  */</span>
  <span class="keyword">private</span> String fName;

  <span class="comment">/**
  * A mutable object field.
  * The state of a Date can change after construction.
  */</span>
  <span class="keyword">private</span> Date fDateOfDiscovery;
}
 
    </pre>
    <br />
    <p></p>
    <p></p>
    <div class="topic-section" id="see-also-title">Vea También :</div>
    <div id="see-also" class="main-body">
      <a href="..\patrones\patrones_29.html">Objetos inmutables</a><br />
      <a href="..\hilos\hilos_35.html">Recuerde los tipos de bloqueos intrínsecos</a><br />
      <a href="..\hilos\hilos_48.html">Documente la seguridad del hilo</a><br />
    </div>
    <footer id="footer" class="legalese">
      <span id="app_name">Prácticas de Java</span> 
      <span id="app_version_number">3.001</span><br /> © 
      <span id="copyright">2018 Hirondelle Systems</span><br /> 
      <a href="http://www.javapractices.com/source/SourceAction.do">Código Fuente</a> | 
      <a href="mailto:webmaster@javapractices.com" rel="author">Contacto</a> | 
      <a href="http://creativecommons.org/licenses/by-nc-sa/1.0/" rel="license">Licencia</a> | 
      <a href="http://www.javapractices.com/apps/cjp.rss" rel="alternate" type="application/rss+xml">RSS</a>
      <!-- ukey="2AC36CD2" -->
      <!-- ckey="16DF3D87" -->
      <br /> Los trozos de código individual tienen una 
      <a href="http://www.javapractices.com/LICENSE.txt" rel="license">licencia BSD</a><br /> 
      Sobre 1,000,000 de IPs únicas el último año<br /> 
      Última actualización <time id="last_updated_on" datetime="2018-06-03">2018-06-03</time><br />
      - In Memoriam : Bill Dirani -
    </footer>
  </body>
</html>