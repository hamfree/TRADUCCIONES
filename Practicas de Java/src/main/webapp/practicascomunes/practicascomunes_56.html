<!DOCTYPE html>
<!-- saved from url=(0055)http://www.javapractices.com/topic/TopicAction.do?Id=56 -->
<html lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="description" content="Prácticas y técnicas de programación en Java.">
    <meta name="keywords" content="java, programación java, Prácticas de Java, idioma java, estilo java, patrones de diseño java, 
          convenciones de codigo java">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prácticas de Java-&gt;Generar los IDs únicos</title>
    <link id="stylesheet" rel="stylesheet" type="text/css" href="../css/stylesheet9.css" media="all">
    <link rel="icon" type="image/png" href="../img/favicon.png">
  </head>
  <body>
    <nav class="menu-bar" id="menu-bar">
      <a href="../index.html" title="Tabla de Contenido" style="float: left;">Inicio</a> &nbsp;&nbsp;
      <form method="GET" action="https://www.google.com/search" class="search-form" style="float: right;">
        <input type="text" name="q" size="15" maxlength="255" value="" placeholder=""/> 
        <input type="submit" name="btnG" value="Búsqueda" /> 
        <input type="hidden" name="sitesearch" value="www.javapractices.com" />
      </form>
    </nav>
    <div class="page-title">Generar los IDs únicos</div>
    <br />
    Cuando los identificadores se usan solamente dentro de una base de datos, su generación debe dejarse a la propia base de datos.
    (Vea 
    <code><a 
        href="https://docs.oracle.com/javase/10/docs/api/java/sql/Statement.html#getGeneratedKeys()">
        Statement.getGeneratedKeys</a></code>).
    <p>
      Los identificadores únicos que son "publicados" de alguna forma pueden necesitar un tratamiento especial, ya que el 
      identificador puede ser difícil de adivinar o falsificar. Un ejemplo típico es el valor de una cookie usada como identificador       
      de sesión - simplemente usar una serie de enteros consecutivos es generalmente inaceptable, ya que un usuario podría 
      facilmente hacerse pasar por otro alterando el valor de la cookie a un número entero cercano.
    </p>
    <h3>
      Estilo 1 - UUID
    </h3>
    Empezando con Java 5, la clase 
    <code><a href="https://docs.oracle.com/javase/10/docs/api/java/util/UUID.html">UUID</a></code> proporciona una forma simple 
    para generar ids únicos. Los identificadores generados por UUID son en realidad identificadores únicos <em>universalmente</em>.
    <p>
      <b>Ejemplo</b><br />
    </p>
    <pre>
<span class="keyword">import</span> java.util.UUID;

<span class="keyword">public</span> <span class="keyword">class</span> GenerateUUID {
  
  <span class="keyword">public</span> <span class="keyword">static</span> <span
			class="keyword">final</span> <span class="keyword">void</span> main(String... aArgs){
    <span class="comment">//genera UUIDs aleatorios
</span>    UUID idOne = UUID.randomUUID();
    UUID idTwo = UUID.randomUUID();
    log(<span class="literal">"UUID Uno: "</span> + idOne);
    log(<span class="literal">"UUID Dos: "</span> + idTwo);
  }
  
  <span class="keyword">private</span> <span class="keyword">static</span> <span
			class="keyword">void</span> log(Object aObject){
    System.out.println( String.valueOf(aObject) );
  }
} 
    </pre>
    <br />
    Ejemplo de ejecución:
    <p></p>
    <pre>
&gt;java -cp . GenerateUUID
UUID Uno: 067e6162-3b6f-4ae2-a171-2470b63dff00 
UUID Dos: 54947df8-0e9e-4471-a2f9-9af509fb5889
    </pre>
    <p>
      <b>Si Java 5 no está disponible</b>, entonces hay otras formas más laboriosas de generar ids únicos (vea abajo).
    </p>
    <h3>
      Estilo 2 - SecureRandom y MessageDigest
    </h3>
    <p>
      El método siguiente usa <code>SecureRandom</code> y <code>MessageDigest</code>:
    </p>
    <ul>
      <li>al inicio, inicializar 
        <code><a href="https://docs.oracle.com/javase/10/docs/api/java/security/SecureRandom.html">SecureRandom</a></code> (esto 
        puede ser una operación larga)
      </li>
      <li>cuando un nuevo identificador se necesita, generar un número aleatorio usando <code>SecureRandom</code></li>
      <li>
        crear un
        <code><a href="https://docs.oracle.com/javase/10/docs/api/java/security/MessageDigest.html">MessageDigest</a></code> del 
        número aleatorio
      </li>
      <li>codifique la matriz de <code>byte[]</code> devuelta por <code>MessageDigest</code> en alguna forma textual aceptable</li>
      <li>comprueba si el resultado ya ha sido usado; si aún no está en uso, es adecuado como identificador único</li>
    </ul>
    La clase <code>MessageDigest</code> es adecuada para generar un "hash unidireccional" de datos arbitrarios. (Tenga en cuenta 
    que los valores de hash nunca identifican de forma única sus datos de origen, ya que diferentes datos de origen pueden producir
    el mismo valor hash. El valor de <code>hashCode</code>, por ejemplo, no identifica de forma única a su objeto asociado). Un 
    <code>MessageDigest</code> toma cualquier entrada, y produce una <code>String</code> que:
    <ul>
      <li>es de longitud fija</li>
      <li>no permite que la entrada original sea facilmente recuperable (en realidad, es muy difícil)</li>
      <li>
        no identifica de forma única la entrada; sin embargo, una entrada similar producirá un resúmen de mensaje muy diferente
      </li>
    </ul>
    <code>MessageDigest</code> es usado a menudo como suma de comprobación, para verificar que los datos no han sido alterados 
    desde su creación.
    <p>
      <b>Ejemplo</b><br />
    </p>
    <pre>
<span class="keyword">import</span> java.security.SecureRandom;
<span class="keyword">import</span> java.security.MessageDigest;
<span class="keyword">import</span> java.security.NoSuchAlgorithmException;

<span class="keyword">public</span> <span class="keyword">final</span> <span
			class="keyword">class</span> GenerateId {

  <span class="keyword">public</span> <span class="keyword">static</span> <span
			class="keyword">void</span> main (String... arguments) {
    <span class="keyword">try</span> {
      <span class="comment">//Inicializa SecureRandom
</span>      <span class="comment">//Esta es una operación larga, para ser hecha durante la
</span>      <span class="comment">//inicialización de la aplicación
</span>      SecureRandom prng = SecureRandom.getInstance(<span class="literal">"SHA1PRNG"</span>);

      <span class="comment">//genera un número aleatorio
</span>      String randomNum = <span class="keyword">new</span> Integer(prng.nextInt()).toString();

      <span class="comment">//obtener su resumen
</span>      MessageDigest sha = MessageDigest.getInstance(<span
			class="literal">"SHA-1"</span>);
      <span class="keyword">byte</span>[] result =  sha.digest(randomNum.getBytes());

      System.out.println(<span class="literal">"Número aleatorio: "</span> + randomNum);
      System.out.println(<span class="literal">"Resumen del mensaje: "</span> + hexEncode(result));
    }
    <span class="keyword">catch</span> (NoSuchAlgorithmException ex) {
      System.err.println(ex);
    }
  }

  <span class="comment">/**
  * La matriz de byte[] devuelta por MessageDigest no tiene una representación textual 
  * agradable, por lo que generalmente se realiza alguna forma de codificación
  *
  * Esta implementación sigue el ejemplo del libro de David Flanagan
  * "Java En Pocas Palabras", y covierte una matriz de bytes en una String
  * de caracteres hexadecimales.
  *
  * Otra alternativa popular es usar la codificación "Base64".
  */</span>
  <span class="keyword">static</span> <span class="keyword">private</span> String hexEncode(<span
			class="keyword">byte</span>[] aInput){
    StringBuilder result = <span class="keyword">new</span> StringBuilder();
    <span class="keyword">char</span>[] digits = {<span class="literal">'0'</span>, <span
			class="literal">'1'</span>, <span class="literal">'2'</span>, <span
			class="literal">'3'</span>, <span class="literal">'4'</span>,<span
			class="literal">'5'</span>,<span class="literal">'6'</span>,<span
			class="literal">'7'</span>,<span class="literal">'8'</span>,<span
			class="literal">'9'</span>,<span class="literal">'a'</span>,<span
			class="literal">'b'</span>,<span class="literal">'c'</span>,<span
			class="literal">'d'</span>,<span class="literal">'e'</span>,<span
			class="literal">'f'</span>};
    <span class="keyword">for</span> (<span class="keyword">int</span> idx = <span
			class="literal">0</span>; idx &lt; aInput.length; ++idx) {
      <span class="keyword">byte</span> b = aInput[idx];
      result.append(digits[ (b&amp;<span class="literal">0xf0</span>) &gt;&gt; <span
			class="literal">4</span> ]);
      result.append(digits[ b&amp;<span class="literal">0x0f</span> ]);
    }
    <span class="keyword">return</span> result.toString();
  }
} 
    </pre>
    <br />
    Ejemplo de ejecución:
    <p></p>
    <p>
      <code>&gt;java -cp . GenerateId</code><br />
      <code>Número aleatorio: -1103747470</code><br />
      <code>Resumen del mensaje: c8fff94ba996411079d7114e698b53bac8f7b037</code>
    </p>
    <h3>
      Estilo 3 - UID
    </h3>
    Finalmente, aquí tiene otro método, usando un 
    <code><a href="https://docs.oracle.com/javase/10/docs/api/java/rmi/server/UID.html">java.rmi.server.UID</a></code>. Los 
    identificadores <code>Serializable</code> generados por esta clase son únicos en la máquina que se generan, siempre que 
    <ul>
      <li>la máquina tome más de un milisegundo en reiniciar</li>
      <li>El reloj de la máquina nunca está configurado para funcionar al revés.</li>
    </ul>
    Para construir un <code>UID</code> que sea único globalmente, simplemente empareje un <code>UID</code> con una 
    <code><a href="https://docs.oracle.com/javase/10/docs/api/java/net/InetAddress.html">InetAddress</a></code>.
    <p>
      <b>Ejemplo</b><br />
    </p>
    <pre>
<span class="keyword">import</span> java.rmi.server.UID;

<span class="keyword">public</span> <span class="keyword">class</span> UniqueId {

  <span class="comment">/**
  * Construye y visualiza algunos objetos UID.
  */</span>
  <span class="keyword">public</span> <span class="keyword">static</span> <span
			class="keyword">void</span> main (String... arguments) {
    <span class="keyword">for</span> (<span class="keyword">int</span> idx=<span
			class="literal">0</span>; idx&lt;<span class="literal">10</span>; ++idx){
      UID userId = <span class="keyword">new</span> UID();
      System.out.println(<span class="literal">"Id de usuario: "</span> + userId);
    }
  }
} 
    </pre>
    <p></p>
    <p>Ejemplo de ejecución:</p>
    <p>
      <code>Id de usuario: 3179c3:ec6e28a7ef:-8000</code><br />
      <code>Id de usuario: 3179c3:ec6e28a7ef:-7fff</code><br />
      <code>Id de usuario: 3179c3:ec6e28a7ef:-7ffe</code><br />
      <code>Id de usuario: 3179c3:ec6e28a7ef:-7ffd</code><br />
      <code>Id de usuario: 3179c3:ec6e28a7ef:-7ffc</code><br />
      <code>Id de usuario: 3179c3:ec6e28a7ef:-7ffb</code><br />
      <code>Id de usuario: 3179c3:ec6e28a7ef:-7ffa</code><br />
      <code>Id de usuario: 3179c3:ec6e28a7ef:-7ff9</code><br />
      <code>Id de usuario: 3179c3:ec6e28a7ef:-7ff8</code><br />
      <code>Id de usuario: 3179c3:ec6e28a7ef:-7ff7</code>
    </p>
    <p>
      Claramente, estos no son identificadores seguros; conociendo uno, es fácil adivinar otro.<br />
    </p>
    <p></p>
    <footer id="footer" class="legalese">
      <span id="app_name">Prácticas de Java</span> 
      <span id="app_version_number">3.001</span><br /> © 
      <span id="copyright">2018 Hirondelle Systems</span><br /> 
      <a href="http://www.javapractices.com/source/SourceAction.do">Código Fuente</a> | 
      <a href="mailto:webmaster@javapractices.com" rel="author">Contacto</a> | 
      <a href="http://creativecommons.org/licenses/by-nc-sa/1.0/" rel="license">Licencia</a> | 
      <a href="http://www.javapractices.com/apps/cjp.rss" rel="alternate" type="application/rss+xml">RSS</a>
      <!-- ukey="2AC36CD2" -->
      <!-- ckey="16DF3D87" -->
      <br /> Los trozos de código individual tienen una 
      <a href="http://www.javapractices.com/LICENSE.txt" rel="license">licencia BSD</a><br /> 
      Sobre 1,000,000 de IPs únicas el último año<br /> 
      Última actualización <time id="last_updated_on" datetime="2018-06-03">2018-06-03</time><br />
      - In Memoriam : Bill Dirani -
    </footer>
  </body>
</html>