<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <title>E/S No Bloqueante</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
    <table id="doc-title" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top">
          <b>Plataforma Java, Edición Empresarial (Java EE) 8</b><br />
          <b>El Tutorial de Java EE</b>
        </td>
      </tr>
    </table>
    <hr />
    <table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>
        <td align="left">
          <a href="servlets012.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="servlets014.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <div class="sect1" id="BEIHICDH">
      <h2 id="nonblocking-io">E/S No Bloqueante</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>
            Los contenedores web en los servidores de aplicaciones normalmente usan un subproceso de servidor 
            por solicitud del cliente. Para desarrollar aplicaciones web escalables, debe asegurarse de que 
            los subprocesos asociados con las solicitudes de los clientes nunca estén inactivos esperando que 
            se complete una operación de bloqueo. 
            <a href="servlets012.html#BEIGCFDF">Procesamiento Asincrónico</a> proporciona un mecanismo para 
            ejecutar operaciones de bloqueo específicas de la aplicación en un nuevo hilo, devolviendo el hilo 
            asociado con la solicitud inmediatamente al contenedor. Incluso si utiliza el procesamiento 
            asincrónico para todas las operaciones de bloqueo específicas de la aplicación dentro de sus 
            métodos de servicio, los subprocesos asociados con las solicitudes de los clientes pueden 
            permanecer momentáneamente inactivos debido a consideraciones de entrada/salida.
          </p>
        </div>
        <div class="paragraph">
          <p>
            Por ejemplo, si un cliente envía una solicitud HTTP POST grande a través de una conexión de red 
            lenta, el servidor puede leer la solicitud más rápido de lo que el cliente puede proporcionarla. 
            Al usar la E/S tradicional, el subproceso del contenedor asociado con esta solicitud a veces 
            estaría inactivo esperando el resto de la solicitud.
          </p>
        </div>
        <div class="paragraph">
          <p>
            Java EE proporciona soporte de E/S sin bloqueo para servlets y filtros al procesar solicitudes en 
            modo asíncrono. Los siguientes pasos resumen cómo usar E/S sin bloqueo para procesar solicitudes y 
            escribir respuestas dentro de los métodos de servicio.
          </p>
        </div>
        <div class="olist arabic">
          <ol class="arabic">
            <li>
              <p>
                Ponga la solicitud en modo asíncrono como se describe en 
                <a href="servlets012.html#BEIGCFDF">Procesamiento Asincrónico</a>.
              </p>
            </li>
            <li>
              <p>
                Obtenga un flujo de entrada y/o un flujo de salida de los objetos de solicitud y respuesta en 
                el método de servicio.
              </p>
            </li>
            <li>
              <p>
                Asigne un oyente de lectura al flujo de entrada y/o un oyente de escritura al flujo de salida.
              </p>
            </li>
            <li>
              <p>
                Procese la solicitud y la respuesta dentro de los métodos de devolución de llamada del oyente.
              </p>
            </li>
          </ol>
        </div>
        <div class="paragraph">
          <p>
            Las tablas <a href="#BEIFDICJ">Tabla 18-4</a> y <a href="#BEIFIIIH">Tabla 18-5</a> describen los 
            métodos disponibles en los flujos de entrada y salida del servlet para el soportpe de E/S sin 
            bloqueo. La <a href="#BEIFGJCG">Tabla 18-6</a> describe las interfaces para escuchas de lectura y 
            escritura.
          </p>
        </div>
        <div class="paragraph">
          <p><a id="sthref106"></a><a id="BEIFDICJ"></a></p>
        </div>
        <div class="paragraph">
          <p><strong>Tabla 18-4 Soporte de E/S sin bloqueo en javax.servlet.ServletInputStream</strong></p>
        </div>
        <table class="tableblock frame-all grid-all" style="width: 80%;">
          <colgroup>
            <col style="width: 25%;">
            <col style="width: 75%;">
          </colgroup>
          <tbody>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><strong>Método</strong></p></td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><strong>Descripción</strong></p></td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>void setReadListener(ReadListener rl)</code></p></td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">
                  Asocia este flujo de entrada con un objeto de escucha que contiene métodos de devolución de 
                  llamada para leer datos de forma asíncrona. Proporcione el objeto de escucha como una clase 
                  anónima o utilice otro mecanismo para pasar el flujo de entrada al objeto de escucha de 
                  lectura.
                </p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>boolean isReady()</code></p></td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Devuelve verdadero si los datos se pueden leer sin bloquear.</p></td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>boolean isFinished()</code></p></td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Devuelve verdadero cuando todos los datos han sido leídos.</p></td>
            </tr>
          </tbody>
        </table>
        <div class="paragraph">
          <p><a id="sthref107"></a><a id="BEIFIIIH"></a></p>
        </div>
        <div class="paragraph">
          <p><strong>Tabla 18-5 Soporte de E/S sin bloqueo en javax.servlet.ServletOutputStream</strong></p>
        </div>
        <table class="tableblock frame-all grid-all" style="width: 80%;">
          <colgroup>
            <col style="width: 25%;">
            <col style="width: 75%;">
          </colgroup>
          <tbody>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><strong>Método</strong></p></td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><strong>Descripción</strong></p></td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>void setWriteListener(WriteListener wl)</code></p></td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">
                  Asocia este flujo de salida con un objeto de escucha que contiene métodos de devolución de 
                  llamada para escribir datos de forma asíncrona. Proporcione el objeto de escucha de 
                  escritura como una clase anónima o utilice otro mecanismo para pasar el flujo de salida al 
                  objeto de escucha de escritura.
                </p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>boolean isReady()</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Devuelve verdadero si los datos se pueden escribir sin bloqueo.</p>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="paragraph">
          <p><a id="sthref108"></a><a id="BEIFGJCG"></a></p>
        </div>
        <div class="paragraph">
          <p><strong>Tabla 18-6 Interfaces de escucha para soporte de E/S sin bloqueo</strong></p>
        </div>
        <table class="tableblock frame-all grid-all" style="width: 99%;">
          <colgroup>
            <col style="width: 20%;">
            <col style="width: 20%;">
            <col style="width: 60%;">
          </colgroup>
          <tbody>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><strong>Interfaz</strong></p></td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><strong>Métodos</strong></p></td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><strong>Descripción</strong></p></td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>ReadListener</code></p></td>
              <td class="tableblock halign-left valign-top">
                <div>
                  <div class="paragraph">
                    <p><code>void onDataAvailable()</code></p>
                  </div>
                  <div class="paragraph">
                    <p><code>void onAllDataRead()</code></p>
                  </div>
                  <div class="paragraph">
                    <p><code>void onError(Throwable t)</code></p>
                  </div>
                </div>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">
                  Una instancia de <code>ServletInputStream</code> llama a estos métodos en su escucha cuando 
                  hay datos disponibles para leer, cuando se han leído todos los datos o cuando hay un error.
                </p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>WriteListener</code></p></td>
              <td class="tableblock halign-left valign-top">
                <div>
                  <div class="paragraph">
                    <p><code>void onWritePossible()</code></p>
                  </div>
                  <div class="paragraph">
                    <p><code>void onError(Throwable t)</code></p>
                  </div>
                </div>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">
                  Una instancia de <code>ServletOutputStream</code> llama a estos métodos en su escucha cuando 
                  es posible escribir datos sin bloqueo o cuando hay un error.
                </p>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="sect2" id="sthref109">
          <h3 id="reading-a-large-http-post-request-using-nonblocking-io">
            Lectura de una Solicitud HTTP POST Grande Utilizando E/S sin bloqueo
          </h3>
          <div class="paragraph">
            <p>
              El código de esta sección muestra cómo leer una solicitud HTTP POST grande dentro de un servlet 
              poniendo la solicitud en modo asíncrono (como se describe en 
              <a href="servlets012.html#BEIGCFDF">Procesamiento Asincrónico</a>) y usando la funcionalidad de 
              E/S sin bloqueo de las tablas <a href="#BEIFDICJ">Tabla 18-4</a> y 
              <a href="#BEIFGJCG">Tabla 18-6</a>.
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
@WebServlet(urlPatterns={"/asyncioservlet"}, asyncSupported=true)
public class AsyncIOServlet extends HttpServlet {
   @Override
   public void doPost(HttpServletRequest request,
                      HttpServletResponse response)
                      throws IOException {
      final AsyncContext acontext = request.startAsync();
      final ServletInputStream input = request.getInputStream();
      input.setReadListener(new ReadListener() {
         byte buffer[] = new byte[4*1024];
         StringBuilder sbuilder = new StringBuilder();
         @Override
         public void onDataAvailable() {
            try {
               do {
                  int length = input.read(buffer);
                  sbuilder.append(new String(buffer, 0, length));
               } while(input.isReady());
            } catch (IOException ex) { ... }
         }
         @Override
         public void onAllDataRead() {
            try {
               acontext.getResponse().getWriter()
                                     .write("...la respuesta...");
            } catch (IOException ex) { ... }
            acontext.complete();
         }
         @Override
         public void onError(Throwable t) { ... }
      });
   }
}
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Este ejemplo declara el servlet web con soporte asíncrono usando el parámetro de anotación 
              <code>@WebServlet</code> <code>asyncSupported=true</code>. El método de servicio primero pone la 
              solicitud en modo asíncrono llamando al método <code>startAsync()</code> del objeto de 
              solicitud, que es necesario para usar E/S sin bloqueo. Luego, el método de servicio obtiene un 
              flujo de entrada asociado con la solicitud y asigna un oyente de lectura definido como una clase 
              interna. El oyente lee partes de la solicitud a medida que están disponibles y luego escribe 
              alguna respuesta al cliente cuando termina de leer la solicitud.
            </p>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>		
        <td align="left">
          <a href="servlets012.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="servlets014.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <span id="copyright">
      <a href="img/cpyr.adoc">
        <img src="img/oracle.gif" height="10" alt="Logo de Oracle" />&nbsp;			
        <span>
          Copyright&nbsp;&copy;&nbsp;2017,&nbsp;Oracle&nbsp;y/o&nbsp;sus&nbsp;afiliados.&nbsp;Todos&nbsp;los&nbsp;
          derechos&nbsp;reservados.
        </span>
      </a>
    </span>
  </body>
</html>
