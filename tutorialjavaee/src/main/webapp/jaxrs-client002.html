<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <title>Usando la IPA de Cliente en las Aplicaciones de Ejemplo JAX-RS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
    <table id="doc-title" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top">
          <b>Plataforma Java, Edición Empresarial (Java EE) 8</b><br />
          <b>El Tutorial de Java EE</b>
        </td>
      </tr>
    </table>
    <hr />
    <table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>
        <td align="left">
          <a href="jaxrs-client001.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="jaxrs-client003.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <div class="sect1" id="BABJCIJC">
      <h2 id="using-the-client-api-in-the-jax-rs-example-applications">
        Usando la IPA de Cliente en las Aplicaciones de Ejemplo JAX-RS
      </h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>
            Los ejemplos de <code>rsvp</code> y <code>customer</code> utilizan la IPA de cliente para llamar a 
            los servicios JAX-RS. Esta sección describe cómo cada aplicación de ejemplo utiliza la IPA de 
            cliente.
          </p>
        </div>
        <div class="paragraph">
          <p>Aquí se tratan los siguientes temas:</p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p><a href="#BABEDFIG">La IPA de Cliente en la Aplicación de Ejemplo rsvp</a></p>
            </li>
            <li>
              <p><a href="#CHDGBGID">La IPA de Cliente en la Aplicación de Ejemplo customer</a></p>
            </li>
          </ul>
        </div>
        <div class="sect2" id="BABEDFIG">
          <h3 id="the-client-api-in-the-rsvp-example-application">
            La IPA de Cliente en la Aplicación de Ejemplo rsvp
          </h3>
          <div class="paragraph">
            <p>
              La aplicación <code>rsvp</code> permite a los usuarios responder a invitaciones a eventos 
              utilizando recursos JAX-RS, como se explica en 
              <a href="jaxrs003.html#the-rsvp-example-application">La Aplicación de Ejemplo rsvp</a>. La 
              aplicación web utiliza la IPA del cliente en beans de respaldo de CDI para interactuar con los 
              recursos del servicio, y la interfaz web de Facelets muestra los resultados.
            </p>
          </div>
          <div class="paragraph">
            <p>
              El bean de respaldo CDI <code>StatusManager</code> recupera todos los eventos actuales en el 
              sistema. La instancia de cliente utilizada en el backing bean se obtiene en el constructor:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
public StatusManager() {
    this.client = ClientBuilder.newClient();
}
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              El método <code>StatusManager.getEvents</code> devuelve una colección de todos los eventos 
              actuales en el sistema llamando al recurso en 
              <code>http://localhost:8080/rsvp/webapi/status/all</code> , que devuelve un documento XML con 
              entradas para cada evento. La IPA del cliente desarma automáticamente el XML y crea una 
              instancia de <code>List&lt;Event&gt;</code>.
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
    public List&lt;Event&gt; getEvents() {
        List&lt;Event&gt; returnedEvents = null;
        try {
            returnedEvents = client.target(baseUri)
                    .path("all")
                    .request(MediaType.APPLICATION_XML)
                    .get(new GenericType&lt;List&lt;Event&gt;&gt;() {
            });
            if (returnedEvents == null) {
                logger.log(Level.SEVERE, "Eventos devueltos nulos.");
            } else {
                logger.log(Level.INFO, "Los eventos han sido devueltos.");
            }
        } catch (WebApplicationException ex) {
            throw new WebApplicationException(Response.Status.NOT_FOUND);
        }
        ...
        return returnedEvents;
    }
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              El método <code>StatusManager.changeStatus</code> se utiliza para actualizar la respuesta del 
              asistente. Crea una solicitud HTTP <code>POST</code> al servicio con la nueva respuesta. El 
              cuerpo de la solicitud es un documento XML.
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
    public String changeStatus(ResponseEnum userResponse,
            Person person, Event event) {
        String navigation;
        try {
            logger.log(Level.INFO,
                    "cambio de estado a {0} para {1} {2} para el ID de evento {3}.",
                    new Object[]{userResponse,
                        person.getFirstName(),
                        person.getLastName(),
                        event.getId().toString()});
             client.target(baseUri)
                     .path(event.getId().toString())
                     .path(person.getId().toString())
                     .request(MediaType.APPLICATION_XML)
                     .post(Entity.xml(userResponse.getLabel()));
            navigation = "changedStatus";
        } catch (ResponseProcessingException ex) {
            logger.log(Level.WARNING, "no se pudo cambiar el estado de {0} {1}",
                    new Object[]{person.getFirstName(),
                        person.getLastName()});
            logger.log(Level.WARNING, ex.getMessage());
            navigation = "error";
        }
        return navigation;
    }
                </code>
              </pre>
            </div>
          </div>
        </div>
        <div class="sect2" id="CHDGBGID">
          <h3 id="the-client-api-in-the-customer-example-application">
            La IPA de Cliente en la Aplicación de Ejemplo customer
          </h3>
          <div class="paragraph">
            <p>
              La aplicación de ejemplo <code>customer</code> almacena los datos del cliente en una base de 
              datos y expone el recurso como XML, como se explica en 
              <a href="jaxrs-advanced008.html#GKOIB">La Aplicación de Ejemplo customer</a> . El recurso de 
              servicio expone métodos que crean clientes y recuperan todos los clientes. Una aplicación web de 
              Facelets actúa como un cliente para el recurso de servicio, con un formulario para crear 
              clientes y mostrar la lista de clientes en una tabla.
            </p>
          </div>
          <div class="paragraph">
            <p>
              El bean de sesión sin estado <code>CustomerBean</code> utiliza la IPA de cliente JAX-RS para 
              interactuar con el recurso de servicio. El método <code>CustomerBean.createCustomer</code> toma 
              la instancia de entidad <code>Customer</code> creada por el formulario Facelets y realiza una 
              llamada POST al URI del servicio.
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
public String createCustomer(Customer customer) {
    if (customer == null) {
        logger.log(Level.WARNING, "El cliente es nulo.");
        return "customerError";
    }
    String navigation;
    Response response =
            client.target("http://localhost:8080/customer/webapi/Customer")
            .request(MediaType.APPLICATION_XML)
            .post(Entity.entity(customer, MediaType.APPLICATION_XML),
                    Response.class);
    if (response.getStatus() == Status.CREATED.getStatusCode()) {
        navigation = "customerCreated";
    } else {
        logger.log(Level.WARNING,
                "no se pudo crear cliente con id {0}. El estado devuelto fue {1}",
                new Object[]{customer.getId(), response.getStatus()});
        FacesContext context = FacesContext.getCurrentInstance();
        context.addMessage(null,
                new FacesMessage("No se pudo crear el cliente."));
        navigation = "customerError";
    }
    return navigation;
}
              </code></pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              La entidad de solicitud XML se crea llamando al método <code>Invocation.Builder.post</code>, 
              pasando una nueva instancia de <code>Entity</code> desde la instancia de <code>Customer</code> y 
              especificando el tipo de medio como <code>MediaType.APPLICATION_XML</code>.
            </p>
          </div>
          <div class="paragraph">
            <p>
              El método <code>CustomerBean.retrieveCustomer</code> recupera una instancia de entidad 
              <code>Customer</code> del servicio agregando la ID del cliente al URI del servicio.
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
public String retrieveCustomer(String id) {
    String navigation;
    Customer customer =
            client.target("http://localhost:8080/customer/webapi/Customer")
            .path(id)
            .request(MediaType.APPLICATION_XML)
            .get(Customer.class);
    if (customer == null) {
        navigation = "customerError";
    } else {
        navigation = "customerRetrieved";
    }
    return navigation;
}
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              El método <code>CustomerBean.retrieveAllCustomers</code> recupera una colección de clientes como 
              una instancia de <code>List&lt;Customer&gt;</code>. Esta lista luego se muestra como una tabla 
              en la aplicación web Facelets.
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
public List&lt;Customer&gt; retrieveAllCustomers() {
    List&lt;Customer&gt; customers =
            client.target("http://localhost:8080/customer/webapi/Customer")
            .path("all")
            .request(MediaType.APPLICATION_XML)
            .get(new GenericType&lt;List&lt;Customer&gt;&gt;() {
            });
    return customers;
}
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Dado que el tipo de respuesta es una colección, se llama al método 
              <code>Invocation.Builder.get</code> pasando una nueva instancia 
              de <code>GenericType&lt;List&lt;Customer&gt;&gt;</code>.
            </p>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>		
        <td align="left">
          <a href="jaxrs-client001.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="jaxrs-client003.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <span id="copyright">
      <a href="img/cpyr.adoc">
        <img src="img/oracle.gif" height="10" alt="Logo de Oracle" />&nbsp;			
        <span>
          Copyright&nbsp;&copy;&nbsp;2017,&nbsp;Oracle&nbsp;y/o&nbsp;sus&nbsp;afiliados.&nbsp;Todos&nbsp;los&nbsp;
          derechos&nbsp;reservados.
        </span>
      </a>
    </span>
  </body>
</html>
