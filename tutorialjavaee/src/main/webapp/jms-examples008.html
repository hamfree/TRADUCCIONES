<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <title>Envío de Mensajes Desde un Bean de Sesión a un MDB</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
    <table id="doc-title" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top">
          <b>Plataforma Java, Edición Empresarial (Java EE) 8</b><br />
          <b>El Tutorial de Java EE</b>
        </td>
      </tr>
    </table>
    <hr />
    <table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>
        <td align="left">
          <a href="jms-examples007.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="jms-examples009.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <div class="sect1" id="BNCGW">
      <h2 id="sending-messages-from-a-session-bean-to-an-mdb">
        Envío de Mensajes Desde un Bean de Sesión a un MDB
      </h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>
            Esta sección explica cómo escribir, compilar, empaquetar, implementar y ejecutar una aplicación 
            que utiliza la IPA de JMS junto con un bean de sesión. La aplicación contiene los siguientes 
            componentes:            
          </p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p>Un cliente de aplicación que invoca un bean de sesión</p>
            </li>
            <li>
              <p>Un bean de sesión que publica varios mensajes en un tema.</p>
            </li>
            <li>
              <p>
                Un bean controlado por mensajes que recibe y procesa los mensajes utilizando una suscripción 
                de tema duradera y un selector de mensajes
              </p>
            </li>
          </ul>
        </div>
        <div class="paragraph">
          <p>
            Encontrará los archivos fuente para esta sección en el directorio 
            tut-install`/examples/jms/clientsessionmdb/`. Los nombres de ruta en esta sección son relativos a 
            este directorio.
          </p>
        </div>
        <div class="paragraph">
          <p>Aquí se tratan los siguientes temas:</p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p>
                <a href="#BNCGX">
                  Escribir los Componentes de la Aplicación para el Ejemplo clientsessionmdb
                </a>
              </p>
            </li>
            <li>
              <p><a href="#CHDDFAHA">Ejecutar el Ejemplo clientsessionmdb</a></p>
            </li>
          </ul>
        </div>
        <div class="sect2" id="BNCGX">
          <h3 id="writing-the-application-components-for-the-clientsessionmdb-example">
            Escribir los Componentes de la Aplicación para el Ejemplo clientsessionmdb
          </h3>
          <div class="paragraph">
            <p>
              Esta aplicación demuestra cómo enviar mensajes desde un enterprise bean (en este caso, un 
              session bean) en lugar de desde una aplicación cliente, como en el ejemplo de 
              <a href="jms-examples007.html#BNBPK">
                Recepción de Mensajes de Forma Asíncrona Mediante un Bean Controlado por Mensajes
              </a>. La <a href="#BNCGY">Figura 49-4</a> ilustra la estructura de esta aplicación. El envío de 
              mensajes desde un enterprise bean es muy similar al envío de mensajes desde un bean 
              administrado, lo cual se mostró en 
              <a href="jms-examples006.html#BABBABFC">
                Enviar y Recibir Mensajes usando una Aplicación Web Simple
              </a>.
            </p>
          </div>
          <div id="BNCGY" class="paragraph">
            <div class="title">
              <strong>
                Figura 49-4 Una aplicación de Enterprise Bean: de cliente a Bean de sesión a Bean controlado 
                por mensajes
              </strong>
            </div>
            <p>
              <span class="image">
                <img src="img/javaeett_dt_037.png" 
                     alt="Diagrama de aplicación que muestra una aplicación cliente que llama a un bean de 
                     sesión, que envía mensajes que son procesados por un bean controlado por mensajes">
              </span>
            </p>
          </div>
          <div class="paragraph">
            <p>
              El enterprise bean Publisher en este ejemplo es el equivalente de aplicación empresarial de una 
              fuente de noticias de servicio por cable que categoriza eventos de noticias en seis categorías 
              de noticias. El bean controlado por mensajes podría representar una sala de redacción, donde la 
              sección de deportes, por ejemplo, configuraría una suscripción para todos los eventos de 
              noticias relacionados con los deportes.
            </p>
          </div>
          <div class="paragraph">
            <p>
              La aplicación cliente en el ejemplo inyecta la interfaz de inicio remota del enterprise bean 
              Publisher y luego llama al método de negocio del bean. El enterprise bean crea 18 mensajes de 
              texto. Para cada mensaje, establece una propiedad <code>String</code> aleatoriamente en uno de 
              los seis valores que representan las categorías de noticias y luego publica el mensaje en un 
              tema. El bean controlado por mensajes utiliza un selector de mensajes para que la propiedad 
              limite cuáles de los mensajes publicados se le entregarán.
            </p>
          </div>
          <div class="sect3" id="BNCGZ">
            <h4 id="coding-the-application-client-myappclient.java">
              Codificación del Cliente de la Aplicación: MyAppClient.java
            </h4>
            <div class="paragraph">
              <p>
                La aplicación cliente, <code>MyAppClient.java</code>, que se encuentra en 
                <code>clientsessionmdb-app-client</code>, no realiza operaciones de la IPA de JMS y, por lo 
                tanto, es más simple que el cliente en 
                <a href="jms- ejemplos007.html#BNBPK">
                  Recepción de Mensajes de Forma Asíncrona Mediante un Bean Controlado por Mensajes
                </a>. El cliente utiliza la inserción de dependencias para obtener la interfaz de negocio del 
                enterprise bean Publisher:
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="prettyprint highlight">
                  <code class="language-oac_no_warn" data-lang="oac_no_warn">
@EJB(name="PublisherRemote")
private static PublisherRemote publisher;
                  </code>
                </pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Luego, el cliente llama dos veces al método de negocio del bean.</p>
            </div>
          </div>
          <div class="sect3" id="BNCGZ">
            <h4 id="coding-the-publisher-session-bean">Codificación del Bean de Sesión Publisher</h4>
            <div class="paragraph">
              <p>
                El bean Publisher es un bean de sesión sin estado que tiene un método de negocio. El bean 
                Publisher utiliza una interfaz remota en lugar de una interfaz local porque se accede a él 
                desde la aplicación cliente.
              </p>
            </div>
            <div class="paragraph">
              <p>
                La interfaz remota, <code>PublisherRemote.java</code>, que se encuentra en 
                <code>clientsessionmdb-ejb</code>, declara un único método de negocio, 
                <code>publishNews</code>.
              </p>
            </div>
            <div class="paragraph">
              <p>
                La clase de bean, <code>PublisherBean.java</code>, que también se encuentra en 
                <code>clientsessionmdb-ejb</code>, implementa el método <code>publishNews</code> y su método 
                auxiliar <code>chooseType</code>. La clase de bean inyecta recursos 
                <code>SessionContext</code> y <code>Topic</code> (el tema se define en el bean controlado por 
                mensajes). Luego inyecta un <code>JMSContext</code>, que utiliza la fábrica de conexiones 
                predeterminada preconfigurada a menos que especifique lo contrario. La clase de bean comienza 
                de la siguiente manera:
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="prettyprint highlight">
                  <code class="language-oac_no_warn" data-lang="oac_no_warn">
@Stateless
@Remote({
    PublisherRemote.class
})
public class PublisherBean implements PublisherRemote {
    @Resource
    private SessionContext sc;
    @Resource(lookup = "java:module/jms/newsTopic")
    private Topic topic;
    @Inject
    private JMSContext context;
    ...
                  </code>
                </pre>
              </div>
            </div>
            <div class="paragraph">
              <p>
                El método de negocio <code>publishNews</code> crea un <code>JMSProducer</code> y publica los 
                mensajes.
              </p>
            </div>
          </div>
          <div class="sect3" id="BNCHB">
            <h4 id="coding-the-message-driven-bean-messagebean.java">
              Codificación del Bean Controlado por Mensajes: MessageBean.java
            </h4>
            <div class="paragraph">
              <p>
                La clase de bean controlada por mensajes, <code>MessageBean.java</code>, que se encuentra en 
                <code>clientsessionmdb-ejb</code>, es casi idéntica a la de 
                <a href="jms-examples007.html#BNBPK ">
                  Recepción de Mensajes de Forma Asíncrona Mediante un Bean Controlado por Mensajes
                </a>. Sin embargo, la anotación <code>@MessageDriven</code> es diferente, porque en lugar de 
                una cola, el bean usa un tema, una suscripción duradera y un selector de mensajes. El bean 
                define un tema para el uso de la aplicación; la definición utiliza el ámbito 
                <code>java:module</code> porque tanto el bean de sesión como el bean controlado por mensajes 
                están en el mismo módulo. Dado que el destino se define en el bean controlado por mensajes, la 
                anotación <code>@MessageDriven</code> utiliza la propiedad de configuración de activación 
                <code>destinationLookup</code>. (Consulte 
                <a href="jms-concepts005.html#BABHFBDH">Creación de recursos para aplicaciones de Java EE</a> 
                para obtener más información). La anotación también establece las propiedades de configuración 
                de activación <code>messageSelector</code>, <code>subscriptionDurability</code>, 
                <code>clientId</code> y <code>subscriptionName</code>, de la siguiente manera:
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="prettyprint highlight">
                  <code class="language-oac_no_warn" data-lang="oac_no_warn">
@JMSDestinationDefinition(
        name = "java:module/jms/newsTopic",
        interfaceName = "javax.jms.Topic",
        destinationName = "PhysicalNewsTopic")
@MessageDriven(activationConfig = {
    @ActivationConfigProperty(propertyName = "destinationLookup",
            propertyValue = "java:module/jms/newsTopic"),
    @ActivationConfigProperty(propertyName = "destinationType",
            propertyValue = "javax.jms.Topic"),
    @ActivationConfigProperty(propertyName = "messageSelector",
            propertyValue = "NewsType = 'Sports' OR NewsType = 'Opinion'"),
    @ActivationConfigProperty(propertyName = "subscriptionDurability",
            propertyValue = "Durable"),
    @ActivationConfigProperty(propertyName = "clientId",
            propertyValue = "MyID"),
    @ActivationConfigProperty(propertyName = "subscriptionName",
            propertyValue = "MySub")
})
                  </code>
                </pre>
              </div>
            </div>
            <div class="paragraph">
              <p>
                El tema es el definido en el <code>PublisherBean</code>. El selector de mensajes en este caso 
                representa tanto los escritorios deportivos como los de opinión, solo para demostrar la 
                sintaxis de los selectores de mensajes.
              </p>
            </div>
            <div class="paragraph">
              <p>
                El adaptador de recursos JMS utiliza estas propiedades para crear una fábrica de conexiones 
                para el bean controlado por mensajes que permite que el bean utilice una suscripción duradera.
              </p>
            </div>
          </div>
        </div>
        <div class="sect2" id="CHDDFAHA">
          <h3 id="running-the-clientsessionmdb-example">Ejecutar el Ejemplo clientsessionmdb</h3>
          <div class="paragraph">
            <p>
              Puede usar el EID de NetBeans o Maven para compilar, implementar y ejecutar el ejemplo de 
              <code>simplemessage</code>.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Este ejemplo utiliza un tema definido por anotaciones y la fábrica de conexiones predeterminada 
              preconfigurada <code>java:comp/DefaultJMSConnectionFactory</code>, por lo que no tiene que crear 
              recursos para ello.
            </p>
          </div>
          <div class="paragraph">
            <p>Aquí se tratan los siguientes temas:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p><a href="#CHDGGAIB">Para Ejecutar clientsessionmdb Usando el EID NetBeans</a></p>
              </li>
              <li>
                <p><a href="#CHDDDHBE">Para Ejecutar clientsessionmdb Usando Maven</a></p>
              </li>
            </ul>
          </div>
          <div class="sect3" id="CHDGGAIB">
            <h4 id="to-run-clientsessionmdb-using-netbeans-ide">
              Para Ejecutar clientsessionmdb Usando el EID NetBeans
            </h4>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>
                    Asegúrese de que se haya iniciado GlassFish Server (consulte 
                    <a href="usingexamples002.html#BNADI">Arrancando y Parando el Servidor GlassFish</a>).
                  </p>
                </li>
                <li>
                  <p>En el menú Archivo, elija Abrir Proyecto.</p>
                </li>
                <li>
                  <p>En el cuadro de diálogo Abrir Proyecto, vaya a:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
tut-install/examples/jms/clientsessionmdb
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Seleccione la carpeta <code>clientsessionmdb</code>.</p>
                </li>
                <li>
                  <p>
                    Asegúrese de que la casilla de verificación Abrir Proyectos Requeridos esté seleccionada y 
                    luego haga clic en Abrir Proyecto.
                  </p>
                </li>
                <li>
                  <p>
                    En la pestaña Proyectos, haga clic con el botón derecho en el proyecto 
                    <code>clientsessionmdb</code> y seleccione Construir. (Si el EID de NetBeans le sugiere 
                    que ejecute una compilación de preparación, haga clic en el cuadro para hacerlo).
                  </p>
                  <div class="paragraph">
                    <p>Este comando crea lo siguiente:</p>
                  </div>
                  <div class="ulist">
                    <ul>
                      <li>
                        <p>
                          Un archivo JAR de aplicación cliente que contiene el archivo de clase de cliente y 
                          la interfaz remota del bean de sesión, junto con un archivo de manifiesto que 
                          especifica la clase principal y coloca el archivo JAR de EJB en su classpath
                        </p>
                      </li>
                      <li>
                        <p>
                          Un archivo JAR EJB que contiene tanto el bean de sesión como el bean controlado por 
                          mensajes
                        </p>
                      </li>
                      <li>
                        <p>Un archivo EAR de aplicación que contiene los dos archivos JAR</p>
                        <div class="paragraph">
                          <p>
                            El archivo <code>clientsessionmdb.ear</code> se crea en el directorio 
                            <code>clientsessionmdb-ear/target/</code>.
                          </p>
                        </div>
                        <div class="paragraph">
                          <p>
                            Luego, el comando implementa el archivo EAR, recupera los esbozos del cliente y 
                            ejecuta el cliente.
                          </p>
                        </div>
                        <div class="paragraph">
                          <p>El cliente muestra estas líneas:</p>
                        </div>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="prettyprint highlight">
                              <code class="language-oac_no_warn" data-lang="oac_no_warn">
To view the bean output,
 check &lt;install_dir&gt;/domains/domain1/logs/server.log.
                              </code>
                            </pre>
                          </div>
                        </div>
                        <div class="paragraph">
                          <p>
                            La salida de los enterprise beans aparece en el archivo de registro del servidor. 
                            El bean de sesión Publisher envía dos conjuntos de 18 mensajes numerados del 0 al
                          </p>
                        </div>
                      </li>
                    </ul>
                  </div>
                </li>
                <li>
                  <p>
                    Debido al selector de mensajes, el bean controlado por mensajes recibe solo los mensajes 
                    cuya propiedad <code>NewsType</code> es <code>Sports</code> u <code>Opinion</code>.
                  </p>
                </li>
                <li>
                  <p>
                    Utilice la pestaña Servicios para anular la implementación de la aplicación una vez que 
                    haya terminado de ejecutarla.
                  </p>
                </li>
              </ol>
            </div>
          </div>
          <div class="sect3" id="CHDDDHBE">
            <h4 id="to-run-clientsessionmdb-using-maven">Para Ejecutar clientsessionmdb Usando Maven</h4>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>
                    Asegúrese de que se haya iniciado el servidor GlassFish (consulte 
                    <a href="usingexamples002.html#BNADI">Arrancando y Parando el Servidor GlassFish</a>).
                  </p>
                </li>
                <li>
                  <p>Vaya al siguiente directorio:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
tut-install/examples/jms/clientsessionmdb/
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Para compilar los archivos de origen y empaquetar, implementar y ejecutar la aplicación, 
                    ingrese el siguiente comando:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
mvn install
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>Este comando crea lo siguiente:</p>
                  </div>
                  <div class="ulist">
                    <ul>
                      <li>
                        <p>
                          Un archivo JAR de aplicación cliente que contiene el archivo de clase de cliente y 
                          la interfaz remota del bean de sesión, junto con un archivo de manifiesto que 
                          especifica la clase principal y coloca el archivo JAR de EJB en su classpath
                        </p>
                      </li>
                      <li>
                        <p>
                          Un archivo JAR EJB que contiene tanto el bean de sesión como el bean controlado por 
                          mensajes
                        </p>
                      </li>
                      <li>
                        <p>Un archivo EAR de aplicación que contiene los dos archivos JAR</p>
                        <div class="paragraph">
                          <p>
                            El archivo <code>clientsessionmdb.ear</code> se crea en el directorio 
                            <code>clientsessionmdb-ear/target/</code>.
                          </p>
                        </div>
                        <div class="paragraph">
                          <p>
                            Luego, el comando implementa el archivo EAR, recupera los esbozos del cliente y 
                            ejecuta el cliente.
                          </p>
                        </div>
                        <div class="paragraph">
                          <p>El cliente muestra estas líneas:</p>
                        </div>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="prettyprint highlight">
                              <code class="language-oac_no_warn" data-lang="oac_no_warn">
To view the bean output,
 check &lt;install_dir&gt;/domains/domain1/logs/server.log.
                              </code>
                            </pre>
                          </div>
                        </div>
                        <div class="paragraph">
                          <p>
                            La salida de los enterprise beans aparece en el archivo de registro del servidor. 
                            El bean de sesión Publisher envía dos conjuntos de 18 mensajes numerados del 0 al
                          </p>
                        </div>
                      </li>
                    </ul>
                  </div>
                </li>
                <li>
                  <p>
                    Debido al selector de mensajes, el bean controlado por mensajes recibe solo los mensajes 
                    cuya propiedad <code>NewsType</code> es <code>Sports</code> u <code>Opinion</code>.
                  </p>
                </li>
                <li>
                  <p>Anule la implementación de la aplicación una vez que haya terminado de ejecutarla:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
mvn cargo:undeploy
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>		
        <td align="left">
          <a href="jms-examples007.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="jms-examples009.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <span id="copyright">
      <a href="img/cpyr.adoc">
        <img src="img/oracle.gif" height="10" alt="Logo de Oracle" />&nbsp;			
        <span>
          Copyright&nbsp;&copy;&nbsp;2017,&nbsp;Oracle&nbsp;y/o&nbsp;sus&nbsp;afiliados.&nbsp;Todos&nbsp;los&nbsp;
          derechos&nbsp;reservados.
        </span>
      </a>
    </span>
  </body>
</html>
