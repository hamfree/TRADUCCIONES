<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <title>El Ejemplo de Aplicación async</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
    <table id="doc-title" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top">
          <b>Plataforma Java, Edición Empresarial (Java EE) 8</b><br />
          <b>El Tutorial de Java EE</b>
        </td>
      </tr>
    </table>
    <hr />
    <table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>
        <td align="left">
          <a href="ejb-async001.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="partpersist.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <div class="sect1" id="GKIEZ">
      <h2 id="the-async-example-application">El Ejemplo de Aplicación async</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>
            El ejemplo <code>async</code> demuestra cómo definir un método de negocio asíncrono en 
            un bean de sesión y llamarlo desde un cliente web. Este ejemplo contiene dos módulos.
          </p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p>
                Una aplicación web (<code>async-war</code>) que contiene un bean de sesión sin 
                estado y una interfaz JavaServer Faces. El bean de sesión sin estado 
                <code>MailerBean</code> define un método asíncrono, 
                <code>sendMessage</code>, que utiliza el IPA de JavaMail para enviar un correo 
                electrónico a una dirección de correo electrónico especificada.
              </p>
            </li>
            <li>
              <p>
                Un programa auxiliar de Java SE (<code>async-smtpd</code>) que simula un servidor 
                SMTP. Este programa escucha en el puerto TCP 3025 las solicitudes SMTP e imprime los 
                mensajes de correo electrónico en la salida estándar (en lugar de entregarlos).
              </p>
            </li>
          </ul>
        </div>
        <div class="paragraph">
          <p>
            La siguiente sección describe la arquitectura del módulo <code>async-war</code>.
          </p>
        </div>
        <div class="sect2" id="GKIQJ">
          <h3 id="architecture-of-the-async-war-module">Arquitectura del Módulo async-war</h3>
          <div class="paragraph">
            <p>
              El módulo <code>async-war</code> consta de un solo bean de sesión sin estado, 
              <code>MailerBean</code>, y una interfaz de aplicación web JavaServer Faces que utiliza 
              etiquetas Facelets en archivos XHTML para mostrar un formulario a los usuarios. para 
              introducir la dirección de correo electrónico del destinatario de un correo 
              electrónico. El estado del correo electrónico se actualiza cuando finalmente se envía 
              el correo electrónico.
            </p>
          </div>
          <div class="paragraph">
            <p>
              El bean de sesión <code>MailerBean</code> inyecta un recurso JavaMail utilizado para 
              enviar un mensaje de correo electrónico a una dirección especificada por el usuario. 
              El mensaje se crea, modifica y envía utilizando el IPA de JavaMail. El bean de sesión 
              se ve así:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
@Named
@Stateless
public class MailerBean {
    @Resource(name="mail/myExampleSession")
    private Session session;
    private static final Logger logger =
            Logger.getLogger(MailerBean.class.getName());
    @Asynchronous
    public Future&lt;String&gt; sendMessage(String email) {
        String status;
        try {
            Properties properties = new Properties();            
            properties.put("mail.smtp.port", "3025");
            session = Session.getInstance(properties);
            Message message = new MimeMessage(session);
            message.setFrom();
            message.setRecipients(Message.RecipientType.TO,
                    InternetAddress.parse(email, false));
            message.setSubject("Mensaje de prueba del ejemplo asíncrono");
            message.setHeader("X-Mailer", "JavaMail");
            DateFormat dateFormatter = DateFormat
                    .getDateTimeInstance(DateFormat.LONG, DateFormat.SHORT);
            Date timeStamp = new Date();
            String messageBody = "Este es un mensaje de prueba del ejemplo"
                    + " asíncrono de El Tutorial de Java EE. fue enviado el "
                    + dateFormatter.format(timeStamp)
                    + ".";
            message.setText(messageBody);
            message.setSentDate(timeStamp);
            Transport.send(message);
            status = "Enviado";
            logger.log(Level.INFO, "Correo enviado a {0}", email);
        } catch (MessagingException ex) {
            logger.severe("Error al enviar mensaje.");
            status = "Encontrado un error: " + ex.getMessage();
            logger.severe(ex.getMessage());
        }
        return new AsyncResult&lt;&gt;(status);
    }
}
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              El recurso JavaMail inyectado se puede configurar a través de la consola de 
              administración del servidor GlassFish, a través de un comando administrativo del 
              servidor GlassFish o a través de un archivo de configuración de recursos empaquetado 
              con la aplicación. El administrador de el Servidor GlassFish puede modificar la 
              configuración de recursos en tiempo de ejecución para usar un servidor de correo o 
              protocolo de transporte diferente.
            </p>
          </div>
          <div class="paragraph">
            <p>
              El cliente web consta de una plantilla Facelets, <code>template.xhtml</code>; dos 
              clientes Facelets, <code>index.xhtml</code> y <code>response.xhtml</code>; y un bean 
              gestionado JavaServer Faces, <code>MailerManagedBean</code>. El archivo 
              <code>index.xhtml</code> contiene un formulario para la dirección de correo 
              electrónico de destino. Cuando el usuario envía el formulario, se llama al método 
              <code>MailerManagedBean.send</code>. Este método utiliza una instancia inyectada del 
              bean de sesión <code>MailerBean</code> para llamar a 
              <code>MailerBean.sendMessage</code>. El resultado se envía a la vista Facelets 
              <code>response.xhtml</code>.
            </p>
          </div>
        </div>
        <div class="sect2" id="sthref158">
          <h3 id="running-the-async-example">Ejecutando el Ejemplo async</h3>
          <div class="paragraph">
            <p>
              Puede usar el EID de NetBeans o Maven para compilar, empaquetar, implementar y ejecutar 
              el ejemplo <code>async</code>.
            </p>
          </div>
          <div class="paragraph">
            <p>Aquí se tratan los siguientes temas:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>
                  <a href="#GKINW">
                    Para Ejecutar el Ejemplo de Aplicación async Usando el EID de NetBeans
                  </a>
                </p>
              </li>
              <li>
                <p>
                  <a href="#GKRFB">Para Ejecutar el Ejemplo de Aplicación async Usando Maven</a>
                </p>
              </li>
            </ul>
          </div>
          <div class="sect3" id="GKINW">
            <h4 id="to-run-the-async-example-application-using-netbeans-ide">
              Para Ejecutar el Ejemplo de Aplicación async Usando el EID de NetBeans
            </h4>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>
                    Asegúrese de que el Servidor GlassFish se haya iniciado (consulte 
                    <a href="usingexamples002.html#BNADI">
                      Arrancando y Parando el Servidor GlassFish</a>).
                  </p>
                </li>
                <li>
                  <p>En el menú Archivo, elija Abrir proyecto.</p>
                </li>
                <li>
                  <p>En el cuadro de diálogo Abrir proyecto, vaya a:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
tut-install/examples/ejb
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Seleccione la carpeta <code>async</code>, seleccione Abrir proyectos requeridos 
                    y haga clic en Abrir proyecto.
                  </p>
                </li>
                <li>
                  <p>
                    En la pestaña Proyectos, haga clic con el botón derecho en el proyecto 
                    <code>async-smtpd</code> y seleccione Ejecutar.
                  </p>
                  <div class="paragraph">
                    <p>
                      El simulador de servidor SMTP comienza a aceptar conexiones. La pestaña de 
                      salida async-smptd muestra el siguiente mensaje:
                    </p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
[Probar el servidor SMTP escuchando en el puerto 3025]
                      </code></pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    En la pestaña Proyectos, haga clic con el botón derecho en el proyecto 
                    <code>async-war</code> y seleccione Build.
                  </p>
                  <div class="paragraph">
                    <p>
                      Este comando configura el recurso JavaMail utilizando un comando 
                      administrativo de el Servidor GlassFish y crea, empaqueta e implementa el módulo 
                      <code>async-war</code>.
                    </p>
                  </div>
                </li>
                <li>
                  <p>Abra la siguiente URL en una ventana del navegador web:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
http://localhost:8080/async-war
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    En la ventana del navegador web, ingrese una dirección de correo electrónico y 
                    haga clic en Enviar correo electrónico.
                  </p>
                  <div class="paragraph">
                    <p>
                      El bean sin estado <code>MailerBean</code> utiliza LA IPA de JavaMail para 
                      enviar un correo electrónico al simulador del servidor SMTP. La ventana de 
                      salida async-smptd en el EID de NetBeans muestra el mensaje de correo electrónico 
                      resultante, incluidos sus encabezados.
                    </p>
                  </div>
                </li>
                <li>
                  <p>
                    Para detener el simulador de servidor SMTP, haga clic en el botón X en el lado 
                    derecho de la barra de estado en el EID de NetBeans.
                  </p>
                </li>
                <li>
                  <p>Elimine el recurso de sesión de JavaMail.</p>
                </li>
                <li>
                  <p>
                    En la pestaña Servicios, expanda el nodo Servidores, luego expanda el nodo del 
                    servidor Servidor GlassFish.
                  </p>
                </li>
                <li>
                  <p>Expanda el nodo Recursos, luego expanda el nodo Sesiones JavaMail.</p>
                </li>
                <li>
                  <p>
                    Haga clic con el botón derecho en mail/myExampleSession y seleccione Anular 
                    registro
                    .</p>
                </li>
              </ol>
            </div>
          </div>
          <div class="sect3" id="GKRFB">
            <h4 id="to-run-the-async-example-application-using-maven">
              Para Ejecutar el Ejemplo de Aplicación async Usando Maven
            </h4>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>
                    Asegúrese de que el Servidor GlassFish se haya iniciado (consulte 
                    <a href="usingexamples002.html#BNADI">
                      Arrancando y Parando el Servidor GlassFish</a>).
                  </p>
                </li>
                <li>
                  <p>En una ventana de terminal, vaya a:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
tut-install/examples/ejb/async/async-smtpd/
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Ingrese el siguiente comando para compilar y empaquetar el simulador de servidor 
                    SMTP:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
mvn install
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Ingrese el siguiente comando para iniciar el simulador de servidor SMTP:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
mvn exec:java
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>Aparece el siguiente mensaje:</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
[Probar el servidor SMTP escuchando en el puerto 3025]
                      </code></pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>Mantenga esta ventana de terminal abierta.</p>
                  </div>
                </li>
                <li>
                  <p>En una nueva ventana de terminal, vaya a:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
tut-install/examples/ejb/async/async-war
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Ingrese el siguiente comando para configurar el recurso JavaMail y para 
                    compilar, empaquetar e implementar el módulo <code>async-war</code>:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
mvn install
                      </code></pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Abra la siguiente URL en una ventana del navegador web:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
http://localhost:8080/async-war
                      </code></pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    En la ventana del navegador web, ingrese una dirección de correo electrónico y 
                    haga clic en Enviar correo electrónico.
                  </p>
                  <div class="paragraph">
                    <p>
                      El bean sin estado <code>MailerBean</code> utiliza el IPA de JavaMail para 
                      enviar un correo electrónico al simulador del servidor SMTP. El mensaje de 
                      correo electrónico resultante aparece en la primera ventana del terminal, 
                      incluidos sus encabezados.
                    </p>
                  </div>
                </li>
                <li>
                  <p>
                    Para detener el simulador de servidor SMTP, cierre la ventana de terminal en la 
                    que emitió el comando para iniciar el simulador de servidor STMP.
                  </p>
                </li>
                <li>
                  <p>
                    Para eliminar el recurso de sesión de JavaMail, escriba el siguiente comando:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
asadmin delete-javamail-resource mail/myExampleSession
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>		
        <td align="left">
          <a href="ejb-async001.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="partpersist.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <span id="copyright">
      <a href="img/cpyr.adoc">
        <img src="img/oracle.gif" height="10" alt="Logo de Oracle" />&nbsp;			
        <span>
          Copyright&nbsp;&copy;&nbsp;2017,&nbsp;Oracle&nbsp;y/o&nbsp;sus&nbsp;afiliados.&nbsp;Todos&nbsp;los&nbsp;
          derechos&nbsp;reservados.
        </span>
      </a>
    </span>
  </body>
</html>
