<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <title>Filtrando Peticiones y Respuestas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
    <table id="doc-title" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top">
          <b>Plataforma Java, Edición Empresarial (Java EE) 8</b><br />
          <b>El Tutorial de Java EE</b>
        </td>
      </tr>
    </table>
    <hr />
    <table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>
        <td align="left">
          <a href="servlets005.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="servlets007.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <div class="sect1" id="BNAGB">
      <h2 id="filtering-requests-and-responses">Filtrando Peticiones y Respuestas</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>
            Un filtro es un objeto que puede transformar el encabezado y el contenido (o ambos) de una 
            solicitud o respuesta. Los filtros se diferencian de los componentes web en que, por lo general, 
            los filtros no crean una respuesta por sí mismos. En cambio, un filtro proporciona una 
            funcionalidad que se puede "adjuntar" a cualquier tipo de recurso web. En consecuencia, un filtro 
            no debe tener ninguna dependencia de un recurso web para el que actúa como filtro; de esta forma, 
            se puede componer con más de un tipo de recurso web.
          </p>
        </div>
        <div class="paragraph">
          <p>Las principales tareas que puede realizar un filtro son las siguientes.</p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p>Consultar la solicitud y actuar en consecuencia.</p>
            </li>
            <li>
              <p>Bloquear el par de solicitud y respuesta para que no pase más.</p>
            </li>
            <li>
              <p>
                Modificar los encabezados y datos de la solicitud. Para ello, proporciona una versión 
                personalizada de la solicitud.
              </p>
            </li>
            <li>
              <p>
                Modificar los encabezados y los datos de la respuesta. Para ello, proporciona una versión 
                personalizada de la respuesta.
              </p>
            </li>
            <li>
              <p>Interactuar con recursos externos.</p>
            </li>
          </ul>
        </div>
        <div class="paragraph">
          <p>
            Las aplicaciones de los filtros incluyen la autenticación, el registro, la conversión de imágenes, 
            la compresión de datos, el cifrado, la tokenización de flujos, las transformaciones XML, etc.
          </p>
        </div>
        <div class="paragraph">
          <p>
            Puede configurar un recurso web para que se filtre por una cadena de cero, uno o más filtros en un 
            orden específico. Esta cadena se especifica cuando se implementa la aplicación web que contiene el 
            componente y se crea una instancia cuando un contenedor web carga el componente.
          </p>
        </div>
        <div class="sect2" id="BNAGC">
          <h3 id="programming-filters">Programando Filtros</h3>
          <div class="paragraph">
            <p>
              La IPA de filtrado está definida por las interfaces <code>Filter</code>, 
              <code>FilterChain</code> y <code>FilterConfig</code> en el paquete <code>javax.servlet</code>. 
              Un filtro se define implementando la interfaz <code>Filter</code>.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Utilice la anotación <code>@WebFilter</code> para definir un filtro en una aplicación web. Esta 
              anotación se especifica en una clase y contiene metadatos sobre el filtro que se declara. El 
              filtro anotado debe especificar al menos un patrón de URL. Esto se hace usando el atributo 
              <code>urlPatterns</code> o <code>value</code> en la anotación. Todos los demás atributos son 
              opcionales, con configuraciones predeterminadas. Use el atributo <code>value</code> cuando el 
              único atributo en la anotación es el patrón de URL; utilice el atributo <code>urlPatterns</code> 
              cuando también se utilicen otros atributos.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Las clases anotadas con la anotación <code>@WebFilter</code> deben implementar la interfaz 
              <code>javax.servlet.Filter</code>.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Para agregar datos de configuración al filtro, especifique el atributo <code>initParams</code> 
              de la anotación <code>@WebFilter</code>. El atributo <code>initParams</code> contiene una 
              anotación <code>@WebInitParam</code>. El siguiente fragmento de código define un filtro, 
              especificando un parámetro de inicialización:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
import javax.servlet.Filter;
import javax.servlet.annotation.WebFilter;
import javax.servlet.annotation.WebInitParam;
@WebFilter(filterName = "TimeOfDayFilter",
urlPatterns = {"/*"},
initParams = {
    @WebInitParam(name = "mood", value = "awake")})
public class TimeOfDayFilter implements Filter {
    ...
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              El método más importante en la interfaz <code>Filter</code> es <code>doFilter</code>, al que se 
              pasan objetos de cadena de solicitud, respuesta y filtro. Este método puede realizar las 
              siguientes acciones.
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>Examinar los encabezados de solicitud.</p>
              </li>
              <li>
                <p>
                  Personalizar el objeto de solicitud si el filtro desea modificar los encabezados o datos de 
                  la solicitud.
                </p>
              </li>
              <li>
                <p>
                  Personalizar el objeto de respuesta si el filtro desea modificar los encabezados o datos de 
                  respuesta.
                </p>
              </li>
              <li>
                <p>
                  Invocar la siguiente entidad en la cadena de filtros. Si el filtro actual es el último 
                  filtro de la cadena que termina con el componente web de destino o el recurso estático, la 
                  siguiente entidad es el recurso al final de la cadena; de lo contrario, es el siguiente 
                  filtro que se configuró en el WAR. El filtro invoca la siguiente entidad llamando al método 
                  <code>doFilter</code> en el objeto de la cadena, pasando la solicitud y la respuesta con la 
                  que se llamó o las versiones envueltas que puede haber creado. Alternativamente, el filtro 
                  puede optar por bloquear la solicitud al no realizar la llamada para invocar a la siguiente 
                  entidad. En este último caso, el filtro se encarga de rellenar la respuesta.
                </p>
              </li>
              <li>
                <p>
                  Examinar los encabezados de respuesta después de invocar el siguiente filtro de la cadena.
                </p>
              </li>
              <li>
                <p>Lanzar una excepción para indicar un error en el procesamiento.</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>
              Además de <code>doFilter</code>, debe implementar los métodos <code>init</code> y 
              <code>destroy</code>. El contenedor llama al método <code>init</code> cuando se crea una 
              instancia del filtro. Si desea pasar parámetros de inicialización al filtro, los recupera del 
              objeto <code>FilterConfig</code> pasado a <code>init</code>.
            </p>
          </div>
        </div>
        <div class="sect2" id="BNAGD">
          <h3 id="programming-customized-requests-and-responses">
            Programando Peticiones y Respuestas Personalizadas
          </h3>
          <div class="paragraph">
            <p>
              Hay muchas formas de que un filtro modifique una solicitud o una respuesta. Por ejemplo, un 
              filtro puede agregar un atributo a la solicitud o puede insertar datos en la respuesta.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Un filtro que modifica una respuesta generalmente debe capturar la respuesta antes de devolverla 
              al cliente. Para hacer esto, pasa una secuencia suplente al servlet que genera la respuesta. El 
              flujo suplente evita que el servlet cierre el flujo de respuesta original cuando se completa y 
              permite que el filtro modifique la respuesta del servlet.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Para pasar este flujo suplente al servlet, el filtro crea un contenedor de respuesta que anula 
              el método <code>getWriter</code> o <code>getOutputStream</code> para devolver este flujo 
              suplente. El contenedor se pasa al método <code>doFilter</code> de la cadena de filtros. Los 
              métodos de contenedor por defecto llaman al objeto de solicitud o respuesta envuelto.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Para anular los métodos de solicitud, envuelve la solicitud en un objeto que se extiende a 
              <code>ServletRequestWrapper</code> o <code>HttpServletRequestWrapper</code>. Para anular los 
              métodos de respuesta, envuelve la respuesta en un objeto que se extiende a 
              <code>ServletResponseWrapper</code> o <code>HttpServletResponseWrapper</code>.
            </p>
          </div>
        </div>
        <div class="sect2" id="BNAGF">
          <h3 id="specifying-filter-mappings">Especificando Mapeados de Filtros</h3>
          <div class="paragraph">
            <p>
              Un contenedor web utiliza asignaciones de filtros para decidir cómo aplicar filtros a los 
              recursos web. Una asignación de filtro hace coincidir un filtro con un componente web por nombre 
              o con recursos web por patrón de URL. Los filtros se invocan en el orden en que aparecen las 
              asignaciones de filtros en la lista de asignaciones de filtros de un WAR. Especifique una lista 
              de asignación de filtros para un WAR en su descriptor de implementación utilizando EID de NetBeans 
              o codificando la lista a mano con XML.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Si desea registrar cada solicitud en una aplicación web, asigne el filtro del contador de 
              visitas al patrón de URL <code>/*</code>.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Puede asignar un filtro a uno o más recursos web y puede asignar más de un filtro a un recurso 
              web. Esto se ilustra en la <a href="#BNAGH">Figura 18-1</a>, en la que el filtro F1 se asigna a 
              los servlets S1, S2 y S3; el filtro F2 se asigna al servlet S2; y el filtro F3 se asigna a los 
              servlets S1 y S2.
            </p>
          </div>
          <div id="BNAGH" class="paragraph">
            <div class="title"><strong>Figura 18-1 Asignación de filtro a servlet</strong></div>
            <p>
              <span class="image">
                <img src="img/javaeett_dt_018.png" 
                     alt="Diagrama de mapeo de filtro a servlet con filtros F1-F3 y servlets S1-S3. F1 filtra 
                     S1-S3, luego F2 filtra S2, luego F3 filtra S1 y S2.">
              </span>
            </p>
          </div>
          <div class="paragraph">
            <p>
              Recuerde que una cadena de filtros es uno de los objetos pasados al método <code>doFilter</code> 
              de un filtro. Esta cadena se forma indirectamente mediante mapeos de filtros. El orden de los 
              filtros en la cadena es el mismo que el orden en que aparecen las asignaciones de filtros en el 
              descriptor de implementación de la aplicación web.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Cuando se asigna un filtro al servlet S1, el contenedor web invoca el método 
              <code>doFilter</code> de F1. El método <code>doFilter</code> de cada filtro en la cadena de 
              filtros de S1 es invocado por el filtro anterior en la cadena por medio del método 
              <code>chain.doFilter</code>. Debido a que la cadena de filtros de S1 contiene los filtros F1 y 
              F3, la llamada de F1 a <code>chain.doFilter</code> invoca el método <code>doFilter</code> del 
              filtro F3. Cuando se completa el método <code>doFilter</code> de F3, el control vuelve al método 
              <code>doFilter</code> de F1.
            </p>
          </div>
          <div class="sect3" id="GJSLC">
            <h4 id="to-specify-filter-mappings-using-netbeans-ide">
              Para Especificar Mapeados de Filtro Usando el EID NetBeans
            </h4>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>Expanda el nodo del proyecto de la aplicación en la pestaña Proyecto.</p>
                </li>
                <li>
                  <p>Expanda los nodos Páginas Web y WEB-INF debajo del nodo del proyecto.</p>
                </li>
                <li>
                  <p>Haga doble clic en <code>web.xml</code>.</p>
                </li>
                <li>
                  <p>Haga clic en Filtros en la parte superior de la ventana del editor.</p>
                </li>
                <li>
                  <p>Expanda el nodo Filtros de Servlet en la ventana del editor.</p>
                </li>
                <li>
                  <p>
                    Haga clic en Agregar Elemento de Filtro para asignar el filtro a un recurso web por nombre 
                    o por patrón de URL.
                  </p>
                </li>
                <li>
                  <p>
                    En el cuadro de diálogo Agregar Filtro de Servlet, ingrese el nombre del filtro en el 
                    campo Nombre del filtro.
                  </p>
                </li>
                <li>
                  <p>
                    Haga clic en Examinar para localizar la clase de servlet a la que se aplica el filtro.
                  </p>
                  <div class="paragraph">
                    <p>
                      Puede incluir caracteres comodín para poder aplicar el filtro a más de un servlet.
                    </p>
                  </div>
                </li>
                <li>
                  <p>Pulse OK.</p>
                </li>
                <li>
                  <p>Para restringir cómo se aplica el filtro a las solicitudes, siga estos pasos.</p>
                </li>
                <li>
                  <p>Expanda el nodo Asignaciones de Filtros.</p>
                </li>
                <li>
                  <p>Seleccione el filtro de la lista de filtros.</p>
                </li>
                <li>
                  <p>Haga clic en Agregar.</p>
                </li>
                <li>
                  <p>
                    En el cuadro de diálogo Agregar asignación de filtros, seleccione uno de los siguientes 
                    tipos de despachadores:
                  </p>
                  <div class="ulist">
                    <ul>
                      <li>
                        <p>REQUEST: Solo cuando la solicitud viene directamente del cliente</p>
                      </li>
                      <li>
                        <p>ASYNC: Solo cuando la solicitud asíncrona proviene del cliente</p>
                      </li>
                      <li>
                        <p>
                          FORWARD: Solo cuando la solicitud se ha enviado a un componente (ver 
                          <a href="servlets007.html#BNAGK">
                            Transfiriendo el Control a Otros Componentes Web</a>)
                        </p>
                      </li>
                      <li>
                        <p>
                          INCLUDE: Solo cuando la solicitud está siendo procesada por un componente que ha 
                          sido incluido (ver 
                          <a href="servlets007.html#BNAGJ">Incluyendo Otros Recursos en la Respuesta</a>)
                        </p>
                      </li>
                      <li>
                        <p>
                          ERROR: Solo cuando la solicitud se está procesando con el mecanismo de página de 
                          error (ver <a href="servlets002.html#BNAFN">Manejando Errores del Servlet</a>)
                        </p>
                        <div class="paragraph">
                          <p>
                            Puede indicar que el filtro se aplique a cualquier combinación de las situaciones 
                            anteriores seleccionando varios tipos de despachadores. Si no se especifica ningún 
                            tipo, la opción predeterminada es REQUEST.
                          </p>
                        </div>
                      </li>
                    </ul>
                  </div>
                </li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>		
        <td align="left">
          <a href="servlets005.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="servlets007.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <span id="copyright">
      <a href="img/cpyr.adoc">
        <img src="img/oracle.gif" height="10" alt="Logo de Oracle" />&nbsp;			
        <span>
          Copyright&nbsp;&copy;&nbsp;2017,&nbsp;Oracle&nbsp;y/o&nbsp;sus&nbsp;afiliados.&nbsp;Todos&nbsp;los&nbsp;
          derechos&nbsp;reservados.
        </span>
      </a>
    </span>
  </body>
</html>
