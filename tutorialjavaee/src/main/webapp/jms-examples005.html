<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <title>Escritura de Aplicaciones JMS Escalables y de Alto Rendimiento</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
    <table id="doc-title" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top">
          <b>Plataforma Java, Edición Empresarial (Java EE) 8</b><br />
          <b>El Tutorial de Java EE</b>
        </td>
      </tr>
    </table>
    <hr />
    <table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>
        <td align="left">
          <a href="jms-examples004.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="jms-examples006.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <div class="sect1" id="BABGEFHC">
      <h2 id="writing-high-performance-and-scalable-jms-applications">
        Escritura de Aplicaciones JMS Escalables y de Alto Rendimiento
      </h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>
            Esta sección describe cómo usar la IPA de JMS para escribir aplicaciones que puedan manejar 
            grandes volúmenes de mensajes de manera sólida. Estos ejemplos utilizan consumidores compartidos 
            duraderos y no duraderos.
          </p>
        </div>
        <div class="paragraph">
          <p>Aquí se tratan los siguientes temas:</p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p><a href="#BABIBEAC">Uso de Suscripciones no Duraderas Compartidas</a></p>
            </li>
            <li>
              <p><a href="#BABEJBHA">Uso de Suscripciones Duraderas Compartidas</a></p>
            </li>
          </ul>
        </div>
        <div class="sect2" id="BABIBEAC">
          <h3 id="using-shared-nondurable-subscriptions">Uso de Suscripciones no Duraderas Compartidas</h3>
          <div class="paragraph">
            <p>
              Esta sección describe los clientes receptores en un ejemplo que muestra cómo usar un consumidor 
              compartido para distribuir mensajes enviados a un tema entre diferentes consumidores. Esta 
              sección luego explica cómo compilar y ejecutar los clientes utilizando el servidor GlassFish.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Es posible que desee comparar este ejemplo con los resultados de 
              <a href="jms-examples003.html#BABDDHHC">
                Ejecución de Múltiples Consumidores en el Mismo Destino</a> utilizando un consumidor no 
              compartido. En ese ejemplo, los mensajes se distribuyen entre los consumidores en una cola, 
              pero cada consumidor del tema recibe todos los mensajes porque cada consumidor del tema 
              utiliza una suscripción de tema independiente.
            </p>
          </div>
          <div class="paragraph">
            <p>
              En este ejemplo, sin embargo, los mensajes se distribuyen entre varios consumidores sobre un 
              tema, porque todos los consumidores comparten la misma suscripción. Cada mensaje agregado a la 
              suscripción del tema lo recibe un solo consumidor, de manera similar a como cada mensaje 
              agregado a una cola lo recibe un solo consumidor.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Un tema puede tener varias suscripciones. Cada mensaje enviado al tema se agregará a cada 
              suscripción de tema. Sin embargo, si hay varios consumidores en una suscripción en particular, 
              cada mensaje agregado a esa suscripción se entregará solo a uno de esos consumidores.
            </p>
          </div>
          <div class="sect3" id="sthref210">
            <h4 id="writing-the-clients-for-the-shared-consumer-example">
              Escribiendo los Clientes para el Ejemplo Shared Consumer
            </h4>
            <div class="paragraph">
              <p>
                El cliente de envío es <code>Producer.java</code>, el mismo cliente utilizado en los ejemplos 
                anteriores.
              </p>
            </div>
            <div class="paragraph">
              <p>
                El cliente receptor es <code>SharedConsumer.java</code>. Es muy similar a 
                <code>AsynchConsumer.java</code>, excepto que siempre usa un tema. Realiza los siguientes 
                pasos.
              </p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>Inyecta recursos para una fábrica de conexiones y un tema.</p>
                </li>
                <li>
                  <p>En un bloque <code>try</code>-with-resources, crea un <code>JMSContext</code>.</p>
                </li>
                <li>
                  <p>
                    Crea un consumidor en una suscripción no duradera compartida, especificando un nombre de 
                    suscripción:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
consumer = context.createSharedConsumer(topic, "SubName");
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Crea una instancia de la clase <code>TextListener</code> y la registra como detector de 
                    mensajes para el consumidor compartido.
                  </p>
                </li>
                <li>
                  <p>
                    Escucha los mensajes publicados en el destino, deteniéndose cuando el usuario escribe el 
                    carácter <code>q</code> o <code>Q</code>.
                  </p>
                </li>
                <li>
                  <p>
                    Atrapa y maneja cualquier excepción. El final del bloque <code>try</code>-with-resources 
                    hace que <code>JMSContext</code> se cierre automáticamente.
                  </p>
                </li>
              </ol>
            </div>
            <div class="paragraph">
              <p>
                La clase <code>TextListener.java</code> es idéntica a la del ejemplo 
                <code>asynchconsumer</code>.
              </p>
            </div>
            <div class="paragraph">
              <p>
                Para este ejemplo, utilizará la fábrica de conexiones predeterminada y el tema que creó en 
                <a href="jms-examples003.html#BABHEFCB">Para Crear Recursos para los Ejemplos Simples</a>.
              </p>
            </div>
          </div>
          <div class="sect3" id="sthref211">
            <h4 id="to-run-the-sharedconsumer-and-producer-clients">
              Para Ejecutar los Clientes SharedConsumer y Producer
            </h4>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>
                    Asegúrese de que se haya iniciado el servidor GlassFish (consulte 
                    <a href="usingexamples002.html#BNADI">Arrancando y Parando el Servidor GlassFish</a>).
                  </p>
                </li>
                <li>
                  <p>
                    Abra tres ventanas de comando. En el primero, ve al directorio 
                    <code>simple/producer/</code>:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
cd tut-install/examples/jms/simple/producer/
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    En la segunda y tercera ventana de comandos, vaya al directorio 
                    <code>shared/sharedconsumer/</code>:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
cd tut-install/examples/jms/shared/sharedconsumer/
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>En una de las ventanas <code>sharedconsumer</code>, construye el ejemplo:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
mvn install
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    En cada una de las dos ventanas <code>sharedconsumer</code>, comience a ejecutar el 
                    cliente. No necesita especificar un argumento <code>topic</code>:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/sharedconsumer.jar
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>Espere hasta que vea el siguiente resultado en ambas ventanas:</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Waiting for messages on topic
To end program, enter Q or q, then &lt;return&gt;
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    En la ventana <code>producer</code>, ejecute el cliente, especificando el tema y una serie 
                    de mensajes:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/producer.jar topic 20
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      Cada cliente consumidor recibe algunos de los mensajes. Solo uno de los clientes recibe 
                      el mensaje que no es de texto que indica el final del flujo de mensajes.
                    </p>
                  </div>
                </li>
                <li>
                  <p>
                    Ingrese <code>Q</code> o <code>q</code> y presione Intro para detener a cada cliente y 
                    ver un informe de la cantidad de mensajes de texto recibidos.
                  </p>
                </li>
              </ol>
            </div>
          </div>
        </div>
        <div class="sect2" id="BABEJBHA">
          <h3 id="using-shared-durable-subscriptions">Uso de Suscripciones Duraderas Compartidas</h3>
          <div class="paragraph">
            <p>
              El cliente <code>shareddurableconsumer</code> muestra cómo usar suscripciones duraderas 
              compartidas. Muestra cómo las suscripciones duraderas compartidas combinan las ventajas de las 
              suscripciones duraderas (la suscripción permanece activa cuando el cliente no lo está) con las 
              de los consumidores compartidos (la carga de mensajes se puede dividir entre varios clientes).
            </p>
          </div>
          <div class="paragraph">
            <p>
              El ejemplo es mucho más similar al ejemplo de <code>sharedconsumer</code> que al cliente 
              <code>DurableConsumer.java</code>. Utiliza dos clases, <code>SharedDurableConsumer.java</code> y 
              <code>TextListener.java</code>, que se pueden encontrar en el directorio 
              tut-install`/examples/jms/shared/shareddurableconsumer/`.
            </p>
          </div>
          <div class="paragraph">
            <p>
              El cliente usa <code>java:comp/DefaultJMSConnectionFactory</code>, la fábrica de conexiones que 
              no tiene un identificador de cliente, como se recomienda para las suscripciones duraderas 
              compartidas. Utiliza el método <code>createSharedDurableConsumer</code> con un nombre de 
              suscripción para establecer la suscripción:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
consumer = context.createSharedDurableConsumer(topic, "MakeItLast");
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>El ejemplo se ejecuta en combinación con el cliente <code>Producer.java</code>.</p>
          </div>
          <div class="sect3" id="sthref212">
            <h4 id="to-run-the-shareddurableconsumer-and-producer-clients">
              Para Ejecutar los Clientes SharedDurableConsumer y Producer
            </h4>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>En una ventana de terminal, vaya al siguiente directorio:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
tut-install/examples/jms/shared/shareddurableconsumer
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Para compilar y empaquetar el cliente, ingrese el siguiente comando:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
mvn install
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Primero ejecute el cliente para establecer la suscripción duradera:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/shareddurableconsumer.jar
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>El cliente muestra lo siguiente y hace una pausa:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Waiting for messages on topic
To end program, enter Q or q, then &lt;return&gt;
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    En la ventana <code>shareddurableconsumer</code>, ingresa <code>q</code> o <code>Q</code> 
                    para salir del programa. La suscripción permanece activa, aunque el cliente no se está 
                    ejecutando.
                  </p>
                </li>
                <li>
                  <p>Abra otra ventana de terminal y vaya al directorio de ejemplo <code>producer</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
cd tut-install/examples/jms/simple/producer
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Ejecute el ejemplo de <code>producer</code>, enviando una serie de mensajes al tema:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/producer.jar topic 6
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Después de que el productor haya enviado los mensajes, abra una tercera ventana de 
                    terminal y vaya al directorio <code>shareddurableconsumer</code>.
                  </p>
                </li>
                <li>
                  <p>
                    Ejecute el cliente en la primera y tercera ventana de terminal. El cliente que inicie 
                    primero recibirá todos los mensajes que se enviaron cuando no había un suscriptor activo:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/shareddurableconsumer.jar
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Con ambos clientes <code>shareddurableconsumer</code> aún ejecutándose, vaya a la ventana 
                    <code>producer</code> y envíe una mayor cantidad de mensajes al tema:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/producer.jar topic 25
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      Ahora los mensajes serán compartidos por los dos clientes consumidores. Si continúa 
                      enviando grupos de mensajes al tema, cada cliente recibe algunos de los mensajes. Si 
                      sale de uno de los clientes y envía más mensajes, el otro cliente recibirá todos los 
                      mensajes.
                    </p>
                  </div>
                </li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>		
        <td align="left">
          <a href="jms-examples004.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="jms-examples006.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <span id="copyright">
      <a href="img/cpyr.adoc">
        <img src="img/oracle.gif" height="10" alt="Logo de Oracle" />&nbsp;			
        <span>
          Copyright&nbsp;&copy;&nbsp;2017,&nbsp;Oracle&nbsp;y/o&nbsp;sus&nbsp;afiliados.&nbsp;Todos&nbsp;los&nbsp;
          derechos&nbsp;reservados.
        </span>
      </a>
    </span>
  </body>
</html>
