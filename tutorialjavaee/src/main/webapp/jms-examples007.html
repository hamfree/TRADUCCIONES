<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <title>Recepción de Mensajes de Forma Asíncrona Mediante un Bean Controlado por Mensajes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
    <table id="doc-title" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top">
          <b>Plataforma Java, Edición Empresarial (Java EE) 8</b><br />
          <b>El Tutorial de Java EE</b>
        </td>
      </tr>
    </table>
    <hr />
    <table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>
        <td align="left">
          <a href="jms-examples006.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="jms-examples008.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <div class="sect1" id="BNBPK">
      <h2 id="receiving-messages-asynchronously-using-a-message-driven-bean">
        Recepción de Mensajes de Forma Asíncrona Mediante un Bean Controlado por Mensajes
      </h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>
            Si está escribiendo una aplicación para ejecutarla en el contenedor del cliente de aplicaciones 
            Java EE o en la plataforma Java SE y desea recibir mensajes de forma asíncrona, debe definir una 
            clase que implemente la interfaz <code>MessageListener</code>, cree un <code>JMSConsumer</code>, y 
            llame al método <code>setMessageListener</code>.
          </p>
        </div>
        <div class="paragraph">
          <p>
            Si está escribiendo una aplicación para que se ejecute en el contenedor web Java EE o EJB y desea 
            que reciba mensajes de forma asincrónica, también debe definir una clase que implemente la 
            interfaz <code>MessageListener</code>. Sin embargo, en lugar de crear un <code>JMSConsumer</code> 
            y llamar al método <code>setMessageListener</code>, debe configurar su clase de escucha de 
            mensajes para que sea un bean controlado por mensajes. El servidor de aplicaciones se encargará 
            del resto.
          </p>
        </div>
        <div class="paragraph">
          <p>
            Los beans controlados por mensajes pueden implementar cualquier tipo de mensajería. Sin embargo, 
            lo más común es que implementen la tecnología Java Message Service (JMS).
          </p>
        </div>
        <div class="paragraph">
          <p>
            Esta sección describe un ejemplo simple de bean controlado por mensajes. Antes de continuar, debe 
            leer la información conceptual básica en la sección 
            <a href="ejb-intro003.html#GIPKO">¿Qué es un Bean Controlado por Mensajes?</a> así como en 
            <a href="jms- conceptos005.html#BNCGQ">Uso de Beans Controlados por Mensajes para Recibir Mensajes 
              de Forma Asíncrona</a>.
          </p>
        </div>
        <div class="sect2" id="BNBPL">
          <h3 id="overview-of-the-simplemessage-example">Descripción General del Ejemplo simplemessage</h3>
          <div class="paragraph">
            <p>
              La aplicación <code>simplemessage</code> tiene los siguientes componentes:
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>
                  <code>SimpleMessageClient</code>: una aplicación cliente que envía varios mensajes a una 
                  cola
                </p>
              </li>
              <li>
                <p>
                  <code>SimpleMessageBean</code>: un bean controlado por mensajes que procesa de forma 
                  asíncrona los mensajes que se envían a la cola
                </p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>
              La <a href="#BNBPM">Figura 49-3</a> ilustra la estructura de esta aplicación. El cliente de la 
              aplicación envía mensajes a la cola, que se creó administrativamente mediante la Consola de 
              administración. El proveedor JMS (en este caso, el servidor GlassFish) entrega los mensajes a 
              las instancias del bean controlado por mensajes, que luego procesa los mensajes.
            </p>
          </div>
          <div id="BNBPM" class="paragraph">
            <div class="title"><strong>Figura 49-3 La Aplicación simplemessage</strong></div>
            <p>
              <span class="image">
                <img src="img/javaeett_dt_036.png" 
                     alt="Diagrama de aplicación que muestra un cliente de aplicación que envía un mensaje a 
                     una cola y el mensaje se entrega a un bean controlado por mensajes">
              </span>
            </p>
          </div>
          <div class="paragraph">
            <p>
              El código fuente de esta aplicación se encuentra en el directorio 
              tut-install`/examples/jms/simplemessage/`.
            </p>
          </div>
        </div>
        <div class="sect2" id="BNBPN">
          <h3 id="the-simplemessage-application-client">La Aplicación Cliente simplemessage</h3>
          <div class="paragraph">
            <p>
              <code>SimpleMessageClient</code> envía mensajes a la cola que escucha 
              <code>SimpleMessageBean</code>. El cliente comienza inyectando la fábrica de conexiones y los 
              recursos de la cola:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
@Resource(lookup = "java:comp/DefaultJMSConnectionFactory")
private static ConnectionFactory connectionFactory;
@Resource(lookup = "jms/MyQueue")
private static Queue queue;
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              A continuación, el cliente crea el <code>JMSContext</code> en un bloque 
              <code>try</code>-with-resources:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
String text;
final int NUM_MSGS = 3;
try (JMSContext context = connectionFactory.createContext();) {
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Finalmente, el cliente envía varios mensajes de texto a la cola:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
for (int i = 0; i &lt; NUM_MSGS; i++) {
    text = "This is message " + (i + 1);
    System.out.println("Sending message: " + text);
    context.createProducer().send(queue, text);
}
                </code>
              </pre>
            </div>
          </div>
        </div>
        <div class="sect2" id="BNBPO">
          <h3 id="the-simplemessage-message-driven-bean-class">
            La Clase de Bean Controlado por Mensajes simplemessage
          </h3>
          <div class="paragraph">
            <p>
              El código para la clase <code>SimpleMessageBean</code> ilustra los requisitos de una clase de 
              bean controlada por mensajes descrita en 
              <a href="jms-concepts005.html#BNCGQ">
                Uso de Beans Controlados por Mensajes para Recibir Mensajes de Forma Asícrona
              </a>.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Las primeras líneas de la clase <code>SimpleMessageBean</code> utilizan el atributo 
              <code>activationConfig</code> de la anotación <code>@MessageDriven</code> para especificar las 
              propiedades de configuración:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
@MessageDriven(activationConfig = {
    @ActivationConfigProperty(propertyName = "destinationLookup",
            propertyValue = "jms/MyQueue"),
    @ActivationConfigProperty(propertyName = "destinationType",
            propertyValue = "javax.jms.Queue")
})
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Consulte la <a href="jms-concepts005.html#GJKOH">Tabla 48-3</a> para obtener una lista de las 
              propiedades disponibles.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Consulte 
              <a href="jms-examples008.html#BNCGW">Envío de Mensajes Desde un Bean de Sesión a un MDB</a> para 
              ver ejemplos de <code>subscriptionDurability</code>, <code>clientId</code >, 
              <code>subscriptionName</code> y <code>messageSelector</code>.
            </p>
          </div>
          <div class="sect3" id="BNBPP">
            <h4 id="the-onmessage-method">El Método onMessage</h4>
            <div class="paragraph">
              <p>
                Cuando la cola recibe un mensaje, el contenedor EJB invoca el método o los métodos de escucha 
                de mensajes. Para un bean que usa JMS, este es el método <code>onMessage</code> de la interfaz 
                <code>MessageListener</code>.
              </p>
            </div>
            <div class="paragraph">
              <p>
                En la clase <code>SimpleMessageBean</code>, el método <code>onMessage</code> envía el mensaje 
                entrante a un <code>TextMessage</code> y muestra el texto:
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="prettyprint highlight">
                  <code class="language-oac_no_warn" data-lang="oac_no_warn">
public void onMessage(Message inMessage) {
    try {
        if (inMessage instanceof TextMessage) {
            logger.log(Level.INFO,
                    "MESSAGE BEAN: Message received: {0}",
                    inMessage.getBody(String.class));
        } else {
            logger.log(Level.WARNING,
                    "Message of wrong type: {0}",
                    inMessage.getClass().getName());
        }
    } catch (JMSException e) {
        logger.log(Level.SEVERE,
                "SimpleMessageBean.onMessage: JMSException: {0}",
                e.toString());
        mdc.setRollbackOnly();
    }
}
                  </code>
                </pre>
              </div>
            </div>
          </div>
        </div>
        <div class="sect2" id="BNBPQ">
          <h3 id="running-the-simplemessage-example">Ejecutando el Ejemplo simplemessage</h3>
          <div class="paragraph">
            <p>
              Puede usar el EID NetBeans o Maven para compilar, implementar y ejecutar el ejemplo de 
              <code>simplemessage</code>.
            </p>
          </div>
          <div class="paragraph">
            <p>Aquí se tratan los siguientes temas:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p><a href="#BNBPR">Creación de Recursos para el Ejemplo simplemessage</a></p>
              </li>
              <li>
                <p><a href="#CHDFBDDA">Para Ejecutar el Ejemplo simplemessage Usando el EID NetBeans</a></p>
              </li>
              <li>
                <p><a href="#BNBPT">Para Ejecutar el Ejemplo simplemessage Usando Maven</a></p>
              </li>
            </ul>
          </div>
          <div class="sect3" id="BNBPR">
            <h4 id="creating-resources-for-the-simplemessage-example">
              Creación de Recursos para el Ejemplo simplemessage
            </h4>
            <div class="paragraph">
              <p>
                Este ejemplo utiliza la cola denominada <code>jms/MyQueue</code> y la fábrica de conexiones 
                predeterminada preconfigurada <code>java:comp/DefaultJMSConnectionFactory</code>.
              </p>
            </div>
            <div class="paragraph">
              <p>
                Si ha ejecutado los ejemplos JMS simples en 
                <a href="jms-examples003.html#BNCFA">Escritura de Aplicaciones JMS Simples</a> y no ha borrado 
                los recursos, ya tiene la cola. De lo contrario, siga las instrucciones en 
                <a href="jms-examples003.html#BABHEFCB">Para Crear Recursos para los Ejemplos Simples</a> para 
                crearlo.
              </p>
            </div>
            <div class="paragraph">
              <p>
                Para obtener más información sobre la creación de recursos JMS, consulte 
                <a href="jms-examples003.html#GKTJS">Creación de Objetos Administrados JMS</a>.
              </p>
            </div>
          </div>
          <div class="sect3" id="CHDFBDDA">
            <h4 id="to-run-the-simplemessage-example-using-netbeans-ide">
              Para Ejecutar el Ejemplo simplemessage Usando el EID NetBeans
            </h4>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>
                    Asegúrese de que se haya iniciado el servidor GlassFish (consulte 
                    <a href="usingexamples002.html#BNADI">Arrancando y Parando el Servidor GlassFish</a>).
                  </p>
                </li>
                <li>
                  <p>En el menú Archivo, elija Abrir Proyecto.</p>
                </li>
                <li>
                  <p>En el cuadro de diálogo Abrir Proyecto, vaya a:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
tut-install/examples/jms/simplemessage
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Selecciona la carpeta <code>simplemessage</code>.</p>
                </li>
                <li>
                  <p>
                    Asegúrese de que la casilla de verificación Abrir Proyectos Requeridos esté seleccionada y 
                    luego haga clic en Abrir Proyecto.
                  </p>
                </li>
                <li>
                  <p>
                    En la pestaña Proyectos, haga clic con el botón derecho en el proyecto 
                    <code>simplemessage</code> y seleccione Construir. (Si el EID de NetBeans sugiere que 
                    ejecute una compilación de preparación, haga clic en el cuadro para hacerlo).
                  </p>
                  <div class="paragraph">
                    <p>
                      Este comando empaqueta el cliente de la aplicación y el bean controlado por mensajes, 
                      luego crea un archivo llamado <code>simplemessage.ear</code> en el directorio 
                      <code>simplemessage-ear/target/</code>. Luego implementa el módulo 
                      <code>simplemessage-ear</code>, recupera los esbozos del cliente y ejecuta el cliente 
                      de la aplicación.
                    </p>
                  </div>
                  <div class="paragraph">
                    <p>
                      El resultado en la ventana de resultados tiene este aspecto (precedido por el resultado 
                      del contenedor del cliente de la aplicación):
                    </p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Sending message: This is message 1
Sending message: This is message 2
Sending message: This is message 3
To see if the bean received the messages,
 check &lt;install_dir&gt;/domains/domain1/logs/server.log.
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>En el archivo de registro del servidor, aparecen líneas similares a las siguientes:</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
MESSAGE BEAN: Message received: This is message 1
MESSAGE BEAN: Message received: This is message 2
MESSAGE BEAN: Message received: This is message 3
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      Los mensajes recibidos pueden aparecer en un orden diferente al orden en que fueron 
                      enviados.
                    </p>
                  </div>
                </li>
                <li>
                  <p>
                    Una vez que haya terminado de ejecutar la aplicación, anule su implementación mediante la 
                    pestaña Servicios.
                  </p>
                </li>
              </ol>
            </div>
          </div>
          <div class="sect3" id="BNBPT">
            <h4 id="to-run-the-simplemessage-example-using-maven">
              Para Ejecutar el Ejemplo simplemessage Usando Maven
            </h4>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>
                    Asegúrese de que se haya iniciado el servidor GlassFish (consulte 
                    <a href="usingexamples002.html#BNADI">Arrancando y Parando el Servidor GlassFish</a>).
                  </p>
                </li>
                <li>
                  <p>En una ventana de terminal, vaya a:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
tut-install/examples/jms/simplemessage/
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Para compilar los archivos fuente y empaquetar la aplicación, use el siguiente comando:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
mvn install
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      Este objetivo empaqueta el cliente de la aplicación y el bean controlado por mensajes, 
                      luego crea un archivo llamado <code>simplemessage.ear</code> en el directorio 
                      <code>simplemessage-ear/target/</code>. Luego implementa el módulo 
                      <code>simplemessage-ear</code>, recupera los esbozos del cliente y ejecuta el cliente de 
                      la aplicación.
                    </p>
                  </div>
                  <div class="paragraph">
                    <p>
                      El resultado en la ventana del terminal tiene este aspecto (precedido por el resultado 
                      del contenedor del cliente de la aplicación):
                    </p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Sending message: This is message 1
Sending message: This is message 2
Sending message: This is message 3
To see if the bean received the messages,
 check &lt;install_dir&gt;/domains/domain1/logs/server.log.
                      </code></pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>En el archivo de registro del servidor, aparecen líneas similares a las siguientes:</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
MESSAGE BEAN: Message received: This is message 1
MESSAGE BEAN: Message received: This is message 2
MESSAGE BEAN: Message received: This is message 3
                      </code></pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      Los mensajes recibidos pueden aparecer en un orden diferente al orden en que fueron 
                      enviados.
                    </p>
                  </div>
                </li>
                <li>
                  <p>
                    Una vez que haya terminado de ejecutar la aplicación, anule la implementación con el 
                    comando <code>mvn cargo:undeploy</code>.
                  </p>
                </li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>		
        <td align="left">
          <a href="jms-examples006.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="jms-examples008.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <span id="copyright">
      <a href="img/cpyr.adoc">
        <img src="img/oracle.gif" height="10" alt="Logo de Oracle" />&nbsp;			
        <span>
          Copyright&nbsp;&copy;&nbsp;2017,&nbsp;Oracle&nbsp;y/o&nbsp;sus&nbsp;afiliados.&nbsp;Todos&nbsp;los&nbsp;
          derechos&nbsp;reservados.
        </span>
      </a>
    </span>
  </body>
</html>
