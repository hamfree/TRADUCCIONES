<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>
            Apoyo a la Interacción del Usuario (Los Tutoriales de Java&trade; &gt; Gráficos 2D &gt; Temas Avanzados en Java 2D)
        </title>
        <meta name="description" content="Este tutorial de Java 2D describe gráficos 2D, geometría, IPA de texto, imágenes, 
              impresión, temas 2D avanzados." />
        <meta name="keywords" content="java programming, learn java, java sample code, java 2d" />
        <link rel="stylesheet" href="../../indice.css" type="text/css"/>
        <script src="../../navegacion.js"></script>
    </head>
    <body onload="load()">
        <noscript>Se requiere un navegador con JavaScript habilitado para que esta página opere apropiadamente.</noscript>
        <div class="header-container">
            <div class="bookwrapper clearfix">
                <div id="brandProdName">
                    <div id="logocover"></div>
                    <div id="productName">Documentación</div>
                </div>
                <br class="clearfloat" />
            </div>
        </div>
        <div id="TopBar">
            <div id="TopBar_tr">
                <div id="TopBar_tl">
                    <div id="TopBar_br">
                        <div id="TopBar_bl">
                            <div id="TopBar_left">Los Tutoriales de Java&trade;</div>
                            <div id="TopBar_right">
                                <a target="_blank" href="http://www.oracle.com/technetwork/java/javase/downloads/java-se-7-tutorial-2012-02-28-1536013.html">
                                    Descargar Libros Electrónicos</a><br />
                                <a target="_blank" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">
                                    Descargar KDJ</a><br />
                                <a href="javascript:toggleLeft()" id="ToggleLeft">
                                    Ocultar TdC</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="LeftBar" class="LeftBar_shown">
            <div id="Contents">
                <div class="linkLESSON"><a href="index.html">Temas Avanzados en Java 2D</a></div>
                <div class="linkAHEAD"><a href="transforming.html">Transformando Formas, Texto e Imágenes</a></div>
                <div class="linkAHEAD"><a href="clipping.html">Recortando la Región de Dibujo</a></div>
                <div class="linkAHEAD"><a href="compositing.html">Componiendo Gráficos</a></div>
                <div class="linkAHEAD"><a href="quality.html">Controlando la Calidad del Renderizado</a></div>
                <div class="linkAHEAD"><a href="complexshapes.html">Construyendo Formas Complejas a partir de Primitivas Geométricas</a></div>
                <div class="nolinkAHEAD">Apoyo a la Interacción del Usuario</div>
            </div>
        </div>
        <div id="MainFlow" class="MainFlow_indented">
            <div class="PrintHeaders">
                <b>Recorrido:</b> Gráficos 2D<br />
                <b>Lección:</b> Temas Avanzados en Java 2D
            </div>
            <div id="BreadCrumbs">
                <a href="../../index.html" target="_top">Página de Inicio</a>&nbsp;&gt;&nbsp;
                <a href="../index.html" target="_top">Gráficos 2D</a>&nbsp;&gt;&nbsp;
                <a href="index.html" target="_top">Temas Avanzados en Java 2D</a>
            </div>
            <div class="NavBit">
                <a target="_top" href="complexshapes.html">&laquo;&nbsp;Anterior</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="../TOC.html">TdC</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="../end.html">Siguiente&nbsp;&raquo;</a>
            </div>
            <div id="PageTitle"><h1>Apoyo a la Interacción del Usuario</h1></div>
            <div id="PageContent">
                <p>
                    Para permitir que el usuario interactúe con los gráficos que muestra, debe poder determinar cuándo el usuario 
                    hace clic en uno de ellos. El método <code>hit</code> de la clase 
                    <a class="APILink" target="_blank" 
                       href="https://docs.oracle.com/javase/8/docs/api/java/awt/Graphics2D.html"><code>Graphics2D</code></a> 
                    proporciona una forma de determinar fácilmente si se produjo un clic del mouse sobre un objeto 
                    <a class="APILink" target="_blank" 
                       href="https://docs.oracle.com/javase/8/docs/api/java/awt/Shape.html"><code>Shape</code></a> en particular.
                    Alternativamente, puede obtener la ubicación del clic del mouse y llamar a <code>contains</code> en la 
                    <code>Shape</code> para determinar si el clic estuvo dentro de los límites de la <code>Shape</code>.
                </p>
                <p>
                    Si está utilizando texto primitivo, puede realizar pruebas de aciertos simples obteniendo el contorno 
                    <code>Shape</code> que corresponde al texto y luego llamando a <code>hit</code> o <code>contains</code> con esa 
                    <code>Shape</code>. Admitir la edición de texto requiere pruebas de posicionamiento mucho más sofisticadas. Si 
                    desea permitir que el usuario edite texto, generalmente debe usar uno de los componentes de texto editables de 
                    Swing. Si está trabajando con texto primitivo y está utilizando la clase 
                    <a class="APILink" target="_blank"
                       href="https://docs.oracle.com/javase/8/docs/api/java/awt/font/TextLayout.html"><code>TextLayout</code></a>
                    para administrar la forma y el posicionamiento del texto, también puede usar <code>TextLayout</code> para 
                    realizar pruebas de posicionamiento para la edición de texto. Para obtener más información, consulte el capítulo 
                    Texto y Fuentes en la 
                    <a class="OutsideLink" target="_blank" 
                       href="https://docs.oracle.com/javase/8/docs/technotes/guides/2d/spec/j2d-bookTOC.html">Guía del Programador 
                        de Java 2D</a> o vea el ejemplo de HitTestSample a continuación, que usa un <code>TextLayout</code> para 
                    realizar pruebas de aciertos simples.
                </p>
                <h2>Ejemplo: ShapeMover</h2>
                <p>
                    Este applet permite al usuario arrastrar una <code>Shape</code> dentro de la ventana del applet. La 
                    <code>Shape</code> se vuelve a dibujar en cada ubicación del mouse para proporcionar retroalimentación a medida 
                    que el usuario la arrastra.
                </p>
                <p style="text-align: center">
                <applet code="ShapeMover" archive="examples/lib/ShapeMoverApplet.jar" width="550" height="250">
                    <param name="permissions" value="sandbox" />
                </applet>
                </p>
                <div class="note">
                    <hr />
                    <strong>Nota:</strong> &nbsp; si no ve el applet ejecutándose, debe instalar al menos la versión 7 del 
                    <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">kit de desarrollo de Java SE 
                        (KDJ)</a>.
                    <hr />
                </div>
                <p>
                    <a class="SourceLink" target="_blank" href="examples/ShapeMover.java"
                       onclick="showCode('../../displayCode.html', 'examples/ShapeMover.java'); return false;">
                        <code>ShapeMover.java</code></a> contiene el código completo para este applet.
                </p>
                <p>
                    Se llama al método <code>contains</code> para determinar si el cursor está dentro de los límites del rectángulo 
                    cuando se presiona el mouse. Si es así, se actualiza la ubicación del rectángulo.
                </p>
                <div class="codeblock">
                    <pre>
public void mousePressed(MouseEvent e){
    last_x = rect.x - e.getX();
    last_y = rect.y - e.getY();
    if(rect.contains(e.getX(),
        e.getY())) updateLocation(e);
    ...

public void updateLocation(MouseEvent e){
    rect.setLocation(last_x + e.getX(),
        last_y + e.getY());
    ...
    repaint();
                    </pre>
                </div>
                <p>
                    Puede notar que volver a dibujar la <code>Shape</code> en cada ubicación del mouse es lento, porque el 
                    rectángulo relleno se vuelve a representar cada vez que se mueve. El uso de doble búfer puede eliminar este 
                    problema. Si utiliza Swing, el dibujo se almacenará automáticamente en doble búfer; no tiene que cambiar el 
                    código de renderizado en absoluto. El código para una versión Swing de este programa es 
                    <a class="SourceLink" target="_blank" href="examples/SwingShapeMover.java"
                       onclick="showCode('../../displayCode.html', 'examples/SwingShapeMover.java'); return false;">
                        <code>SwingShapeMover.java</code></a>.
                </p>
                <h2>Ejemplo: HitTestSample</h2>
                <p>
                    Esta aplicación ilustra las pruebas de aciertos dibujando el signo de intercalación predeterminado donde el 
                    usuario hace clic en <code>TextLayout</code>, como se muestra en la siguiente figura.
                </p>
                <p style="text-align: center">
                <applet code="HitTestSample" archive="examples/lib/HitTestSampleApplet.jar" width="400" height="250">
                    <param name="permissions" value="sandbox" />
                </applet>
                </p>
                <div class="note">
                    <hr />
                    <strong>Nota:</strong> &nbsp; si no ve el applet ejecutándose, debe instalar al menos la versión 7 del 
                    <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">kit de desarrollo de Java SE 
                        (KDJ)</a>.
                    <hr />
                </div>
                <p>
                    <a class="SourceLink" target="_blank" href="examples/HitTestSample.java"
                       onclick="showCode('../../displayCode.html', 'examples/HitTestSample.java'); return false;">
                        <code>HitTestSample.java</code></a> contiene el código completo para este applet.
                </p>
                <p>
                    El método <code>mouseClicked</code> usa <code>TextLayout.hitTestChar</code> para devolver un objeto 
                    <code>java.awt.font.TextHitInfo</code> que contiene la ubicación del clic del mouse (el índice de inserción) en 
                    el objeto <code>TextLayout</code>.
                </p>
                <p>
                    La información devuelta por los métodos de <code>TextLayout</code> <code>getAscent</code>, 
                    <code>getDescent</code> y <code>getAdvance</code> se utiliza para calcular la ubicación del origen de el objeto 
                    <code>TextLayout</code> de modo que esté centrado horizontal y verticalmente.
                </p>
                <div class="codeblock">
                    <pre>
...

private Point2D computeLayoutOrigin() {
  Dimension size = getPreferredSize();
  Point2D.Float origin = new Point2D.Float();
     
  origin.x = (float) (size.width -
             textLayout.getAdvance()) / 2;   
  origin.y = 
    (float) (size.height -
             textLayout.getDescent() +
             textLayout.getAscent())/2;
  return origin;
}

...

public void paintComponent(Graphics g) {
  super.paintComponent(g);
  setBackground(Color.white);
  Graphics2D graphics2D = (Graphics2D) g;                
  Point2D origin = computeLayoutOrigin();
  graphics2D.translate(origin.getX(),
                       origin.getY());
                
  // Dibuja textLayout.
  textLayout.draw(graphics2D, 0, 0);
     
  // Recupera el signo de intercalación de Shapes para insertionIndex.
  Shape[] carets =
      textLayout.getCaretShapes(insertionIndex);
       
  // Dibuja los signos de intercalación. carets[0] es el signo de intercalación 
  // fuerte y  carets[1] es el signo de intercalación débil.   
  graphics2D.setColor(STRONG_CARET_COLOR);
  graphics2D.draw(carets[0]);                
  if (carets[1] != null) {
    graphics2D.setColor(WEAK_CARET_COLOR);
    graphics2D.draw(carets[1]);
  }       
}

...

private class HitTestMouseListener
              extends MouseAdapter {
                
    /**
     * Calcula la posición del carácter del 
     * click del ratón.
     */     
    public void mouseClicked(MouseEvent e) {
                
      Point2D origin = computeLayoutOrigin();
                
      // Calcula la ubicación del clic del ratón 
      // relativo al origen de textLayout.
      float clickX =
          (float) (e.getX() - origin.getX());
      float clickY =
          (float) (e.getY() - origin.getY());
         
      // Obtiene la posición del carácter del 
      // clic del ratón.
      TextHitInfo currentHit =
          textLayout.hitTestChar(clickX, clickY);
      insertionIndex =
          currentHit.getInsertionIndex();
            
      // Repinta el Component de forma que los nuevos 
      // signos de intercalación serán mostrados.
      hitPane.repaint();
    }
                    </pre>
                </div>
            </div>
            <div class="NavBit">
                <a target="_top" href="complexshapes.html">&laquo;&nbsp;Anterior</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="../TOC.html">TdC</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="../end.html">Siguiente&nbsp;&raquo;</a>
            </div>
        </div>
        <hr class="clearfloat"/>
        <div id="Footer">
            <table style="width: 100%;padding: 5px">
                <tr>
                    <td>
                        <p class="footertext">
                            <a id="license_info">Su uso de ésta</a> página y todo el material en las páginas bajo el anuncio
                            &quot;Los Tutoriales de Java&quot; está sujeto a estos <a href="../../information/cpyr.html">avisos
                                legales</a>.
                        </p>
                        <p class="footertext">
                            Copyright &copy; 1995, 2015 Oracle y/o sus afiliados. Todos los derechos reservados.
                        </p>
                    </td>
                    <td style="text-align: right">
                        <p class="footertext">
                            ¿Problemas con estos ejemplos? Intente
                            <a target="_blank" href="../../information/run-examples.html">Compilando y Ejecutando los Ejemplos: PFs
                            </a>.
                        </p>
                        <p class="footertext">
                            ¿Quejas? ¿Elogios? ¿Sugerencias? <a target="_blank" href="https://docs.oracle.com/javase/feedback.html">
                                Denos su opinión</a>.
                        </p>
                    </td>
                </tr>
            </table>
        </div>
        <div class="PrintHeaders">
            <b>Página anterior:</b> Construyendo Formas Complejas a partir de Primitivas Geométricas<br />
            <b>Página siguiente:</b> Final de la Lección
        </div>
    </body>
</html> 
