<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>
            Solución de Problemas (Los Tutoriales de Java&trade; &gt; La IPA de Reflexión &gt; Miembros)
        </title>
        <meta name="description" content="Este tutorial de reflexión de Java describe el uso de la reflexión para acceder y 
              manipular clases, campos, métodos y constructores" />
        <meta name="keywords" content="java programming, learn java, java sample code, java reflection" />
        <link rel="stylesheet" href="../../indice.css" type="text/css"/>
        <script src="../../navegacion.js"></script>
    </head>
    <body onload="load()">
        <noscript>Se requiere un navegador con JavaScript habilitado para que esta página opere apropiadamente.</noscript>
        <div class="header-container">
            <div class="bookwrapper clearfix">
                <div id="brandProdName">
                    <div id="logocover"></div>
                    <div id="productName">Documentación</div>
                </div>
                <br class="clearfloat" />
            </div>
        </div>
        <div id="TopBar">
            <div id="TopBar_tr">
                <div id="TopBar_tl">
                    <div id="TopBar_br">
                        <div id="TopBar_bl">
                            <div id="TopBar_left">Los Tutoriales de Java&trade;</div>
                            <div id="TopBar_right">
                                <a target="_blank" href="http://www.oracle.com/technetwork/java/javase/downloads/java-se-7-tutorial-2012-02-28-1536013.html">
                                    Descargar Libros Electrónicos</a><br />
                                <a target="_blank" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">
                                    Descargar KDJ</a><br />
                                <a href="javascript:toggleLeft()" id="ToggleLeft">
                                    Ocultar TdC</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="LeftBar" class="LeftBar_shown">
            <div id="Contents">
                <div class="linkLESSON"><a href="index.html">Miembros</a></div>
                <div class="linkAHEAD"><a href="field.html">Campos</a></div>
                <div class="linkBHEAD"><a href="fieldTypes.html">Obteniendo los Tipos de los Campos</a></div>
                <div class="linkBHEAD"><a href="fieldModifiers.html">Recuperando y Analizando Modificadores de los Campos</a></div>
                <div class="linkBHEAD"><a href="fieldValues.html">Obteniendo y Estableciendo los Valores de los Campos</a></div>
                <div class="nolinkBHEAD">Solución de Problemas</div>
                <div class="linkAHEAD"><a href="method.html">Métodos</a></div>
                <div class="linkBHEAD"><a href="methodType.html">Obteniendo Información del Tipo del Método</a></div>
                <div class="linkBHEAD"><a href="methodparameterreflection.html">Obteniendo los Nombre de los Parámetros del Método</a></div>
                <div class="linkBHEAD"><a href="methodModifiers.html">Recuperando y Analizando Modificadores del Método</a></div>
                <div class="linkBHEAD"><a href="methodInvocation.html">Invocando Métodos</a></div>
                <div class="linkBHEAD"><a href="methodTrouble.html">Solución de Problemas</a></div>
                <div class="linkAHEAD"><a href="ctor.html">Constructores</a></div>
                <div class="linkBHEAD"><a href="ctorLocation.html">Encontrando Constructores</a></div>
                <div class="linkBHEAD"><a href="ctorModifiers.html">Recuperando y Analizando Modificadores del Constructor</a></div>
                <div class="linkBHEAD"><a href="ctorInstance.html">Creando Nuevas Instancias de Clase</a></div>
                <div class="linkBHEAD"><a href="ctorTrouble.html">Solución de Problemas</a></div>
            </div>
        </div>
        <div id="MainFlow" class="MainFlow_indented">
            <div class="PrintHeaders">
                <b>Recorrido:</b> La IPA de Reflexión<br />
                <b>Lección:</b> Miembros<br />
                <b>Sección:</b> Campos
            </div>
            <div id="BreadCrumbs">
                <a href="../../index.html" target="_top">Página de Inicio</a>&nbsp;&gt;&nbsp;
                <a href="../index.html" target="_top">La IPA de Reflexión</a>&nbsp;&gt;&nbsp;
                <a href="index.html" target="_top">Miembros</a>
            </div>
            <div class="NavBit">
                <a target="_top" href="fieldValues.html">&laquo;&nbsp;Anterior</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="../TOC.html">TdC</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="method.html">Siguiente&nbsp;&raquo;</a>
            </div>
            <div id="PageTitle">
                <h1>Solución de Problemas</h1>
            </div>
            <div id="PageContent">
                <p>
                    A continuación, se muestran algunos problemas comunes que encuentran los desarrolladores con explicaciones de 
                    por qué ocurren y cómo resolverlos.
                </p>
                <h2>
                    IllegalArgumentException Debido a Tipos Inconvertibles
                </h2>
                <p>
                    El ejemplo 
                    <a class="SourceLink" target="_blank" href="example/FieldTrouble.java" 
                       onclick="showCode('../../displayCode.html', 'example/FieldTrouble.java'); return false;">
                        <code>FieldTrouble</code></a> generará una 
                    <a class="APILink" target="_blank" 
                       href="https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalArgumentException.html">
                        <code>IllegalArgumentException</code></a>.
                    <a class="APILink" target="_blank"
                       href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Field.html#setInt-java.lang.Object-int-">
                        <code>Field.setInt()</code></a> se invocó para establecer un campo que es del tipo referencia 
                    <code>Integer</code> con un valor de tipo primitivo. En el equivalente sin reflexión 
                    <code>Integer val = 42</code> el compilador convertirá (o <em>encajará</em>) el tipo primitivo 
                    <code>42</code> a un tipo referencia como <code>new Integer(42)</code> de forma que su comprobación de 
                    tipos aceptará la sentencia. Cuando usa reflexión, la comprobación de tipos sólo ocurre en tiempo de 
                    ejecución así que no hay oportunidad de encajar el valor.
                </p>
                <div class="codeblock">
                    <pre>

import java.lang.reflect.Field;

public class FieldTrouble {
    public Integer val;

    public static void main(String... args) {
	FieldTrouble ft = new FieldTrouble();
	try {
	    Class&lt;?&gt; c = ft.getClass();
	    Field f = c.getDeclaredField(&quot;val&quot;);
  	    f.setInt(ft, 42);               // IllegalArgumentException

        // production code should handle these exceptions more gracefully
	} catch (NoSuchFieldException x) {
	    x.printStackTrace();
 	} catch (IllegalAccessException x) {
 	    x.printStackTrace();
	}
    }
}
                    </pre>
                </div>
                <div class="codeblock">
                    <pre>
&#36; <em>java FieldTrouble</em>
Exception in thread "main" java.lang.IllegalArgumentException: Can not set
  java.lang.Object field FieldTrouble.val to (long)42
        at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException
          (UnsafeFieldAccessorImpl.java:146)
        at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException
          (UnsafeFieldAccessorImpl.java:174)
        at sun.reflect.UnsafeObjectFieldAccessorImpl.setLong
          (UnsafeObjectFieldAccessorImpl.java:102)
        at java.lang.reflect.Field.setLong(Field.java:831)
        at FieldTrouble.main(FieldTrouble.java:11)
                    </pre>
                </div>
                <p>
                    Para eliminar esta excepción, la línea problemática deber ser reemplazada por la siguiente invocación de 
                    <a class="APILink" target="_blank" 
                       href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Field.html#set-java.lang.Object-java.lang.Object-">
                        <code>Field.set(Object obj, Object value)</code></a>:
                </p>
                <div class="codeblock">
                    <pre>
f.set(ft, new Integer(43));
                    </pre>
                </div>
                <div class="note">
                    <hr />
                    <strong>Consejo:</strong>&nbsp;Cuando usa reflexión para establecer u obtener un campo, el compilador no tiene 
                    ninguna oportunidad de realizar el encajado. Sólo puede convertir tipos que están relacionados como se describe 
                    en la especificación para 
                    <a class="APILink" target="_blank" 
                       href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#isAssignableFrom-java.lang.Class-">
                        <code>Class.isAssignableFrom()</code></a>. Se espera que el ejemplo falle porque 
                    <code>isAssignableFrom()</code> devolverá <code>falso</code> en esta prueba que puede utilizarse de forma 
                    programada para verificar si una conversión en particular es posible:
                    <div class="codeblock">
                        <pre>
Integer.class.isAssignableFrom(int.class) == false
                        </pre>
                    </div>
                    <p>
                        De manera similar, la conversión automática de tipo primitivo a tipo de referencia también es imposible en 
                        la reflexión.
                    </p>
                    <div class="codeblock">
                        <pre>
int.class.isAssignableFrom(Integer.class) == false
                        </pre>
                    </div>
                    <hr />
                </div>
                <h2>
                    NoSuchFieldException para Campos No Públicos
                </h2>
                <p>
                    El lector astuto puede notar que si el ejemplo 
                    <a class="SourceLink" target="_blank" href="example/FieldSpy.java" 
                       onclick="showCode('../../displayCode.html', 'example/FieldSpy.java'); return false;">
                        <code>FieldSpy</code></a> que se mostró más temprano se usa para obtener información de un campo no público, 
                        fallará:
                </p>
                <div class="codeblock">
                    <pre>
&#36; <em>java FieldSpy java.lang.String count</em>
java.lang.NoSuchFieldException: count
        at java.lang.Class.getField(Class.java:1519)
        at FieldSpy.main(FieldSpy.java:12)
                    </pre>
                </div>
                <div class="note"><hr /><strong>Tip:</strong>&nbsp;Los métodos 
                    <a class="APILink" target="_blank" 
                       href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getField-java.lang.String-">
                        <code>Class.getField()</code></a> y
                    <a class="APILink" target="_blank" 
                       href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getFields--">
                        <code>Class.getFields()</code></a> devuelven el miembro (campo,-os) <em>public</em> de la clase, 
                        enumeración, o interfaz representado por el objeto <code>Class</code>. Para recuperar todos los campos  
                        declarados (pero no los heredados) en la <code>Class</code>, use el método 
                    <a class="APILink" target="_blank" 
                       href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredFields--">
                        <code>Class.getDeclaredFields()</code></a>.
                    <hr />
                </div>
                <h2>
                    IllegalAccessException al Modificar Campos Finales
                </h2>
                <p>
                    Una 
                    <a class="APILink" target="_blank" 
                       href="https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalAccessException.html">
                        <code>IllegalAccessException</code></a> puede ser lanzada si se hace un intento de obtener o establecer el 
                        valor de un campo <code>private</code> o de otra forma innacesible o para establecer el valor de un campo 
                    <code>final</code> (independientemente de sus modificadores de acceso).
                </p>
                <p>
                    El ejemplo 
                    <a class="SourceLink" target="_blank" href="example/FieldTroubleToo.java" 
                       onclick="showCode('../../displayCode.html', 'example/FieldTroubleToo.java'); return false;">
                        <code>FieldTroubleToo</code></a> ilustra el tipo de seguimiento de pila que resulta de intentar establecer 
                        un campo final.
                </p>
                <div class="codeblock">
                    <pre>

import java.lang.reflect.Field;

public class FieldTroubleToo {
    public final boolean b = true;

    public static void main(String... args) {
	FieldTroubleToo ft = new FieldTroubleToo();
	try {
	    Class&lt;?&gt; c = ft.getClass();
	    Field f = c.getDeclaredField(&quot;b&quot;);
// 	    f.setAccessible(true);  // solution
	    f.setBoolean(ft, Boolean.FALSE);   // IllegalAccessException

        // production code should handle these exceptions more gracefully
	} catch (NoSuchFieldException x) {
	    x.printStackTrace();
	} catch (IllegalArgumentException x) {
	    x.printStackTrace();
	} catch (IllegalAccessException x) {
	    x.printStackTrace();
	}
    }
}
                    </pre>
                </div>
                <div class="codeblock">
                    <pre>
&#36; <em>java FieldTroubleToo</em>
java.lang.IllegalAccessException: Can not set final boolean field
  FieldTroubleToo.b to (boolean)false
        at sun.reflect.UnsafeFieldAccessorImpl.
          throwFinalFieldIllegalAccessException(UnsafeFieldAccessorImpl.java:55)
        at sun.reflect.UnsafeFieldAccessorImpl.
          throwFinalFieldIllegalAccessException(UnsafeFieldAccessorImpl.java:63)
        at sun.reflect.UnsafeQualifiedBooleanFieldAccessorImpl.setBoolean
          (UnsafeQualifiedBooleanFieldAccessorImpl.java:78)
        at java.lang.reflect.Field.setBoolean(Field.java:686)
        at FieldTroubleToo.main(FieldTroubleToo.java:12)
                    </pre>
                </div>
                <div class="note">
                    <hr />
                    <strong>Consejo:</strong>&nbsp;Existe una restricción de acceso que previene que los campos <code>final</code> 
                    sean establecidos después de la incicialización de la clase. Sin embargo, <code>Field</code> se declara para 
                    extender 
                    <a class="APILink" target="_blank"
                       href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/AccessibleObject.html">
                        <code>AccessibleObject</code></a> que proporciona la habilidad de suprimir esta comprobación.
                    <br /><br />
                    Si 
                    <a class="APILink" target="_blank" 
                       href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/AccessibleObject.html#setAccessible-boolean-">
                        <code>AccessibleObject.setAccessible()</code></a> tiene éxito, entonces las operaciones posteriores en este
                        valor del campo no fallarán para resolver este problema. Esto puede tener efectos secuandarios inesperados; 
                        por ejemplo, a veces algunas secciones de la aplicación seguirán usando el valor original aunque se haya 
                        modificado el valor.
                    <a class="APILink" target="_blank"
                       href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/AccessibleObject.html#setAccessible-boolean-">
                        <code>AccessibleObject.setAccessible()</code></a> sólo tendrá éxito si la operación está permitida por el 
                        contexto de seguridad.
                    <hr />
                </div>
            </div>
            <div class="NavBit">
                <a target="_top" href="fieldValues.html">&laquo;&nbsp;Anterior</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="../TOC.html">TdC</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="method.html">Siguiente&nbsp;&raquo;</a>
            </div>
        </div>
        <hr class="clearfloat"/>
        <div id="Footer">
            <table style="width: 100%;padding: 5px">
                <tr>
                    <td>
                        <p class="footertext">
                            <a id="license_info">Su uso de ésta</a> página y todo el material en las páginas bajo el anuncio
                            &quot;Los Tutoriales de Java&quot; está sujeto a estos <a href="../../information/cpyr.html">avisos
                                legales</a>.
                        </p>
                        <p class="footertext">
                            Copyright &copy; 1995, 2015 Oracle y/o sus afiliados. Todos los derechos reservados.
                        </p>
                    </td>
                    <td style="text-align: right">
                        <p class="footertext">
                            ¿Problemas con estos ejemplos? Intente
                            <a target="_blank" href="../../information/run-examples.html">Compilando y Ejecutando los Ejemplos: PFs
                            </a>.
                        </p>
                        <p class="footertext">
                            ¿Quejas? ¿Elogios? ¿Sugerencias? <a target="_blank" href="https://docs.oracle.com/javase/feedback.html">
                                Denos su opinión</a>.
                        </p>
                    </td>
                </tr>
            </table>
        </div>
        <div class="PrintHeaders">
            <b>Página anterior:</b> Obteniendo y Estableciendo los Valores de los Campos<br />
            <b>Página siguiente:</b> Métodos
        </div>
    </body>
</html> 
