<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>
            Objetos de Bloqueo (Los Tutoriales de Java&trade; &gt; Clases Esenciales &gt; Concurrencia)
        </title>
        <meta name="description" content="Este tutorial de Java describe las excepciones, la entrada/salida básica, concurrencia,
              expresiones regulares, y el entorno de la plataforma" />
        <meta name="keywords" content="java programming, learn java, java sample code, java exception, java input output, java
              threads, java regex, regular expressions, path, classpath, environment variable" />
        <link rel="stylesheet" href="../../indice.css" type="text/css"/>
        <script src="../../navegacion.js"></script>
    </head>
    <body onload="load()">
        <noscript>Se requiere un navegador con JavaScript habilitado para que esta página opere apropiadamente.</noscript>
        <div class="header-container">
            <div class="bookwrapper  clearfix">       
                <div id="brandProdName">
                    <div id="logocover"></div>
                    <div id="productName">Documentación</div>
                </div> 
                <br class="clearfloat" />
            </div>
        </div>
        <div id="TopBar">
            <div id="TopBar_tr">
                <div id="TopBar_tl">
                    <div id="TopBar_br">
                        <div id="TopBar_bl">
                            <div id="TopBar_left">Los Tutoriales de Java&trade;</div>
                            <div id="TopBar_right">
                                <a target="_blank" href="http://www.oracle.com/technetwork/java/javase/downloads/java-se-7-tutorial-2012-02-28-1536013.html">
                                    Descargar Libros Electrónicos</a><br />
                                <a target="_blank" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">
                                    Descargar KDJ</a><br />
                                <a href="javascript:toggleLeft()" id="ToggleLeft">
                                    Ocultar TdC</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="LeftBar" class="LeftBar_shown">
            <div id="Contents">
                <div class="linkLESSON"><a href="index.html">Concurrencia</a></div>
                <div class="linkAHEAD"><a href="procthread.html">Procesos e Hilos</a></div>
                <div class="linkAHEAD"><a href="threads.html">Objetos Hilo</a></div>
                <div class="linkBHEAD"><a href="runthread.html">Definiendo e Iniciando un Hilo</a></div>
                <div class="linkBHEAD"><a href="sleep.html">Pausando la Ejecución con Sleep</a></div>
                <div class="linkBHEAD"><a href="interrupt.html">Interrupciones</a></div>
                <div class="linkBHEAD"><a href="join.html">Uniones</a></div>
                <div class="linkBHEAD"><a href="simple.html">El Ejemplo SimpleThreads</a></div>
                <div class="linkAHEAD"><a href="sync.html">Sincronización</a></div>
                <div class="linkBHEAD"><a href="interfere.html">Interferencias entre Hilos</a></div>
                <div class="linkBHEAD"><a href="memconsist.html">Errores de Consistencia en Memoria</a></div>
                <div class="linkBHEAD"><a href="syncmeth.html">Métodos Sincronizados</a></div>
                <div class="linkBHEAD"><a href="locksync.html">Bloqueos Intrínsecos y Sincronización</a></div>
                <div class="linkBHEAD"><a href="atomic.html">Acceso Atómico</a></div>
                <div class="linkAHEAD"><a href="liveness.html">Tiempo de vida</a></div>
                <div class="linkBHEAD"><a href="deadlock.html">Bloqueo Mutuo</a></div>
                <div class="linkBHEAD"><a href="starvelive.html">Inanición y Livelock</a></div>
                <div class="linkAHEAD"><a href="guardmeth.html">Bloques Vigilados</a></div>
                <div class="linkAHEAD"><a href="immutable.html">Objetos Inmutables</a></div>
                <div class="linkBHEAD"><a href="syncrgb.html">Un Ejemplo de Clase Sincronizada</a></div>
                <div class="linkBHEAD"><a href="imstrat.html">Una Estrategia para Definir Objetos Inmutables</a></div>
                <div class="linkAHEAD"><a href="highlevel.html">Objetos con Alto Nivel de Concurrencia</a></div>
                <div class="nolinkBHEAD">Objetos de Bloqueo</div>
                <div class="linkBHEAD"><a href="executors.html">Ejecutores</a></div>
                <div class="linkCHEAD"><a href="exinter.html">Interfaces del Ejecutor</a></div>
                <div class="linkCHEAD"><a href="pools.html">Agrupaciones de Hilos</a></div>
                <div class="linkCHEAD"><a href="forkjoin.html">Fork/Join</a></div>
                <div class="linkBHEAD"><a href="collections.html">Colecciones Concurrentes</a></div>
                <div class="linkBHEAD"><a href="atomicvars.html">Variables Atómicas</a></div>
                <div class="linkBHEAD"><a href="threadlocalrandom.html">Números Aleatorios Concurrentes</a></div>
                <div class="linkAHEAD"><a href="further.html">Lecturas Adicionales</a></div>
                <div class="linkQUESTIONS"><a href="QandE/questions.html">Preguntas y Ejercicios</a></div>
            </div>
        </div>
        <div id="MainFlow" class="MainFlow_indented">
            <div class="PrintHeaders">
                <b>Recorrido:</b> Clases Esenciales<br />
                <b>Lección:</b> Concurrencia<br />
                <b>Sección:</b> Objetos con Alto Nivel de Concurrencia
            </div>
            <div id="BreadCrumbs">
                <a href="../../index.html" target="_top">Página de Inicio</a>&nbsp;&gt;&nbsp;
                <a href="../index.html" target="_top">Clases Esenciales</a>&nbsp;&gt;&nbsp;
                <a href="index.html" target="_top">Concurrencia</a>
            </div>
            <div class="NavBit">
                <a target="_top" href="highlevel.html">&laquo;&nbsp;Anterior</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="../TOC.html">TdC</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="executors.html">Siguiente&nbsp;&raquo;</a>
            </div>
            <div id="PageTitle">
                <h1>Objetos de Bloqueo</h1>
            </div>
            <div id="PageContent">
                <p>
                    El código sincronizado se basa en un tipo simple de bloqueo reentrante. Esta clase de bloqueo es fácil de usar,
                    pero tiene muchas limitaciones. Idiomas de bloqueo más sofisticados están soportados por el paquete
                    <a class="APILink" target="_blank"
                       href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/package-summary.html">
                        <code>java.util.concurrent.locks</code></a> . No examinaremos este paquete en detalle, pero en su lugar nos
                    enfocaremos en su interfaz más básico,
                    <a class="APILink" target="_blank"
                       href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Lock.html">
                        <code>Lock</code></a>.
                </p>
                <p>
                    Los objetos <code>Lock</code> funcionan muy parecido a los bloqueos implícitos usados por el código
                    sincronizado. Como con los bloqueos mplícitos, sólo un hilo puede poseer un objeto <code>Lock</code> a la vez.
                    Los objetos <code>Lock</code> también soportan un mecanismo <code>esperar/notificar</code>, a través de sus
                    objetos asociados
                    <a class="APILink" target="_blank"
                       href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Condition.html">
                        <code>Condition</code></a> .
                </p>
                <p>
                    La ventaja más grande de los objetos <code>Lock</code> sobre los bloqueos implícitos es su capacidad de
                    retroceder de un intento de adquirir un bloqueo. El método <code>tryLock</code> retrocede si el bloqueo no está
                    disponible inmediatamente o antes de que expire un tiempo de espera (si se especifica). El método
                    <code>lockInterruptibly</code> retrocede si otro hilo manda una interrupción antes de que el bloqueo sea
                    adquirido.
                </p>
                <p>
                    Usemos los objetos <code>Lock</code> para resolver el problema del bloqueo mutuo que vimos en
                    <a href="liveness.html">Tiempo de vida</a>. Alfonso y Gastón se han entrenado a sí mismos para notar cuándo un
                    amigo se va a inclinar. Nosotros modelamos esta mejora requiriendo que nuestros objetos <code>Amigo</code>
                    deban adquirir bloquos para <i>ambos</i> participantes antes de proceder con la inclinación. Aquí está el código
                    fuente para el modelo mejorado,
                    <a class="SourceLink" target="_blank" href="examples/BloqueoSeguro.java"
                       onclick="showCode('../../displayCode.html', 'examples/BloqueoSeguro.java'); return false;">
                        <code>BloqueoSeguro</code></a>. Para demostrar la versatilidad de este idioma, suponemos que Alphonse y Gaston
                    están tan fascinados con su recién descubierta capacidad de inclinarse con seguridad que no pueden dejar de
                    inclinarse el uno al otro:
                </p>
                <div class="codeblock">
                    <pre>

import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;
import java.util.Random;

public class BloqueoSeguro {
    static class Amigo {
        private final String nombre;
        private final Lock bloqueo = new ReentrantLock();

        public Amigo(String nombre) {
            this.nombre = nombre;
        }

        public String getNombre() {
            return this.nombre;
        }

        public boolean esInminenteLaInclinacion(Amigo inclinador) {
            Boolean esMiBloqueo = false;
            Boolean esTuBloqueo = false;
            try {
                esMiBloqueo = bloqueo.tryLock();
                esTuBloqueo = inclinador.bloqueo.tryLock();
            } finally {
                if (! (esMiBloqueo &amp;&amp; esTuBloqueo)) {
                    if (esMiBloqueo) {
                        bloqueo.unlock();
                    }
                    if (esTuBloqueo) {
                        inclinador.bloqueo.unlock();
                    }
                }
            }
            return esMiBloqueo &amp;&amp; esTuBloqueo;
        }

        public void inclinar(Amigo inclinador) {
            if (esInminenteLaInclinacion(inclinador)) {
                try {
                    System.out.format(&quot;%s: ¡%s se ha&quot;
                        + &quot; inclinado ante mí!%n&quot;,
                        this.nombre, inclinador.getNombre());
                    inclinador.responderALaInclinacion(this);
                } finally {
                    bloqueo.unlock();
                    inclinador.bloqueo.unlock();
                }
            } else {
                System.out.format(&quot;%s: %s empezó&quot;
                    + &quot; a inclinarse ante mí, pero vio que&quot;
                    + &quot; yo estaba ya inclinándome ante&quot;
                    + &quot; él.%n&quot;,
                    this.nombre, inclinador.getNombre());
            }
        }

        public void responderALaInclinacion(Amigo bower) {
            System.out.format(&quot;%s: ¡%s me ha&quot; +
                &quot; respondido inclinándose a mi!%n&quot;,
                this.nombre, bower.getNombre());
        }
    }

    static class BucleInclinaciones implements Runnable {
        private Amigo inclinador1;
        private Amigo inclinador2;

        public BucleInclinaciones(Amigo inclinador1, Amigo inclinador2) {
            this.inclinador1 = inclinador1;
            this.inclinador2 = inclinador2;
        }

        public void run() {
            Random aleatorio = new Random();
            for (;;) {
                try {
                    Thread.sleep(aleatorio.nextInt(10));
                } catch (InterruptedException e) {}
                inclinador2.inclinar(inclinador1);
            }
        }
    }


    public static void main(String[] args) {
        final Amigo alfonso =
            new Amigo(&quot;Alfonso&quot;);
        final Amigo gaston =
            new Amigo(&quot;Gastón&quot;);
        new Thread(new BucleInclinaciones(alfonso, gaston)).start();
        new Thread(new BucleInclinaciones(gaston, alfonso)).start();
    }
}
                    </pre>
                </div>
            </div>
            <div class="NavBit">
                <a target="_top" href="highlevel.html">&laquo;&nbsp;Anterior</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="../TOC.html">TdC</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="executors.html">Siguiente&nbsp;&raquo;</a>
            </div>
        </div>
        <hr class="clearfloat"/>
        <div id="Footer">
            <table style="width: 100%;padding: 5px">
                <tr>
                    <td>
                        <p class="footertext">
                            <a id="license_info">
                                Su uso de ésta
                            </a>
                            página y todo el material en las páginas bajo el anuncio &quot;Los Tutoriales de Java&quot; está sujeto
                            a estos
                            <a href="../../information/cpyr.html">
                                avisos legales
                            </a>
                            .
                        </p>
                        <p class="footertext">
                            Copyright &copy; 1995, 2015 Oracle y/o sus afiliados. Todos los derechos reservados.
                        </p>
                    </td>
                    <td style="text-align: right">
                        <p class="footertext">
                            ¿Problemas con estos ejemplos? Intente
                            <a target="_blank" href="../../information/run-examples.html">
                                Compilando y Ejecutando los Ejemplos: PFs
                            </a>
                            .
                        </p>
                        <p class="footertext">
                            ¿Quejas? ¿Elogios? ¿Sugerencias?
                            <a target="_blank" href="https://docs.oracle.com/javase/feedback.html">
                                Denos su opinión
                            </a>
                            .
                        </p>
                    </td>
                </tr>
            </table>
        </div>
        <div class="PrintHeaders">
            <b>Página Anterior:</b> Objetos con Alto Nivel de Concurrencia<br />
            <b>Página Siguiente:</b> Ejecutores
        </div>
    </body>
</html>