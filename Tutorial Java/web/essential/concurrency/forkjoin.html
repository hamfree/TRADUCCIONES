<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>
            Fork/Join (Los Tutoriales de Java&trade; &gt; Clases Esenciales &gt; Concurrencia)
        </title>
        <meta name="description" content="Este tutorial de Java describe las excepciones, la entrada/salida básica, concurrencia,
              expresiones regulares, y el entorno de la plataforma" />
        <meta name="keywords" content="java programming, learn java, java sample code, java exception, java input output, java
              threads, java regex, regular expressions, path, classpath, environment variable" />
        <link rel="stylesheet" href="../../indice.css" type="text/css"/>
        <script src="../../navegacion.js"></script>
    </head>
    <body onload="load()">
        <noscript>Se requiere un navegador con JavaScript habilitado para que esta página opere apropiadamente.</noscript>
        <div class="header-container">
            <div class="bookwrapper clearfix">       
                <div id="brandProdName">
                    <div id="logocover"></div>
                    <div id="productName">Documentación</div>
                </div> 
                <br class="clearfloat" />
            </div>
        </div>
        <div id="TopBar">
            <div id="TopBar_tr">
                <div id="TopBar_tl">
                    <div id="TopBar_br">
                        <div id="TopBar_bl">
                            <div id="TopBar_left">Los Tutoriales de Java&trade;</div>
                            <div id="TopBar_right">
                                <a target="_blank" href="http://www.oracle.com/technetwork/java/javase/downloads/java-se-7-tutorial-2012-02-28-1536013.html">
                                    Descargar Libros Electrónicos</a><br />
                                <a target="_blank" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">
                                    Descargar KDJ</a><br />
                                <a href="javascript:toggleLeft()" id="ToggleLeft">
                                    Ocultar TdC</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="LeftBar" class="LeftBar_shown">
            <div id="Contents">
                <div class="linkLESSON"><a href="index.html">Concurrencia</a></div>
                <div class="linkAHEAD"><a href="procthread.html">Procesos e Hilos</a></div>
                <div class="linkAHEAD"><a href="threads.html">Objetos Hilo</a></div>
                <div class="linkBHEAD"><a href="runthread.html">Definiendo e Iniciando un Hilo</a></div>
                <div class="linkBHEAD"><a href="sleep.html">Pausando la Ejecución con Sleep</a></div>
                <div class="linkBHEAD"><a href="interrupt.html">Interrupciones</a></div>
                <div class="linkBHEAD"><a href="join.html">Uniones</a></div>
                <div class="linkBHEAD"><a href="simple.html">El Ejemplo SimpleThreads</a></div>
                <div class="linkAHEAD"><a href="sync.html">Sincronización</a></div>
                <div class="linkBHEAD"><a href="interfere.html">Interferencias entre Hilos</a></div>
                <div class="linkBHEAD"><a href="memconsist.html">Errores de Consistencia en Memoria</a></div>
                <div class="linkBHEAD"><a href="syncmeth.html">Métodos Sincronizados</a></div>
                <div class="linkBHEAD"><a href="locksync.html">Bloqueos Intrínsecos y Sincronización</a></div>
                <div class="linkBHEAD"><a href="atomic.html">Acceso Atómico</a></div>
                <div class="linkAHEAD"><a href="liveness.html">Tiempo de vida</a></div>
                <div class="linkBHEAD"><a href="deadlock.html">Bloqueo Mutuo</a></div>
                <div class="linkBHEAD"><a href="starvelive.html">Inanición y Livelock</a></div>
                <div class="linkAHEAD"><a href="guardmeth.html">Bloques Vigilados</a></div>
                <div class="linkAHEAD"><a href="immutable.html">Objetos Inmutables</a></div>
                <div class="linkBHEAD"><a href="syncrgb.html">Un Ejemplo de Clase Sincronizada</a></div>
                <div class="linkBHEAD"><a href="imstrat.html">Una Estrategia para Definir Objetos Inmutables</a></div>
                <div class="linkAHEAD"><a href="highlevel.html">Objetos con Alto Nivel de Concurrencia</a></div>
                <div class="linkBHEAD"><a href="newlocks.html">Objetos de Bloqueo</a></div>
                <div class="linkBHEAD"><a href="executors.html">Ejecutores</a></div>
                <div class="linkCHEAD"><a href="exinter.html">Interfaces del Ejecutor</a></div>
                <div class="linkCHEAD"><a href="pools.html">Agrupaciones de Hilos</a></div>
                <div class="nolinkCHEAD">Fork/Join</div>
                <div class="linkBHEAD"><a href="collections.html">Colecciones Concurrentes</a></div>
                <div class="linkBHEAD"><a href="atomicvars.html">Variables Atómicas</a></div>
                <div class="linkBHEAD"><a href="threadlocalrandom.html">Números Aleatorios Concurrentes</a></div>
                <div class="linkAHEAD"><a href="further.html">Lecturas Adicionales</a></div>
                <div class="linkQUESTIONS"><a href="QandE/questions.html">Preguntas y Ejercicios</a></div>
            </div>
        </div>
        <div id="MainFlow" class="MainFlow_indented">
            <div class="PrintHeaders">
                <b>Recorrido:</b> Clases Esenciales<br />
                <b>Lección:</b> Concurrencia<br />
                <b>Sección:</b> Objetos con Alto Nivel de Concurrencia<br />
                <b>Subsección:</b> Ejecutores
            </div>
            <div id="BreadCrumbs">
                <a href="../../index.html" target="_top">Página de Inicio</a>&nbsp;&gt;&nbsp;
                <a href="../index.html" target="_top">Clases Esenciales</a>&nbsp;&gt;&nbsp;
                <a href="index.html" target="_top">Concurrencia</a>
            </div>
            <div class="NavBit">
                <a target="_top" href="pools.html">&laquo;&nbsp;Anterior</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="../TOC.html">TdC</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="collections.html">Siguiente&nbsp;&raquo;</a>
            </div>
            <div id="PageTitle">
                <h1>Fork/Join</h1>
            </div>
            <div id="PageContent">
                <p>
                    El marco de trabajo fork/join es una implementación del interfaz <code>ExecutorService</code> que le ayuda a
                    aprovecharse de los procesadores múltiples. Está diseñado para trabajos que pueden ser divididos en piezas más
                    pequeñas recursivamente. El objetivo es usar todo el poder de proceso disponible para mejorar el rendimiento de
                    su aplicación.
                </p>
                <p>
                    Como con cualquier implementación de <code>ExecutorService</code> , el marco de trabajo fork/join distribuye las
                    tareas en hilos de trabajo en una agrupación dehilos. El marco de trabajo fork/join es distinto porque usa un 
                    algoritmo <i>robo-de-trabajo</i>. Los hilos de trabajo que se quedan sin cosas que hacer pueden robar tareas de
                    otros hilos que todavía están ocupados.
                </p>
                <p>
                    El centro del marco de trabajo fork/join framework es la clase
                    <a class="APILink" target="_blank"
                       href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinPool.html">
                        <code>ForkJoinPool</code></a> , una extensión de la clase <code>AbstractExecutorService</code> .
                    <code>ForkJoinPool</code> implementa el núcleo del algoritmo robo-de-trabajo y puede ejecutar procesos
                    <a class="APILink" target="_blank"
                       href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinTask.html">
                        <code>ForkJoinTask</code></a> .
                </p>
                <h2>Uso Básico</h2>
                <p>
                    El primer paso para usar el marco de trabajo fork/join es escribir código que ejecute un segmento del trabajo.
                    Su código debe ser similar al siguiente pseudocódigo:
                </p>
                <div class="codeblock">
                    <pre>
si (mi porcion del trabajo es bastante pequeña)
  haz el trabajo directamente
si no
  divide mi trabajo en dos piezas
  invoca las dos piezas y espera los resultados
                    </pre>
                </div>
                <p>
                    Envuelva este código en una subclase de <code>ForkJoinTask</code> , típicamente usando uno de sus más
                    especializados tipos,
                    either
                    <a class="APILink" target="_blank" 
                       href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/RecursiveTask.html">
                        <code>RecursiveTask</code></a> (la cual puede devolver un resultado) o
                    <a class="APILink" target="_blank"
                       href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/RecursiveAction.html">
                        <code>RecursiveAction</code></a>.
                </p>
                <p>
                    Después de que su subclase <code>ForkJoinTask</code> esté lista, cree el objeto que representa todo  el trabajo
                    a ser hecho y páselo al método <code>invoke()</code> de una instancia <code>ForkJoinPool</code>.
                </p>
                <h2>Falta de definición para la claridad</h2>
                <p>
                    Para ayudarle a entender cómo funciona el marco de trabajo fork/join, considere el siguiente ejemplo. Supongamos 
                    que desea desenfocar una imagen. La imagen original <i>origen</i> está representada por una matriz de enteros,
                    donde cada entero contiene los valores de color para un único pixel. La imagen desenfocada <i>destino</i> está
                    también representada por una matriz de enteros con el mismo tamaño que la del origen.
                </p>
                <p>
                    Realizar el desenfoque se logra trabajando a través de la matriz de origen con un píxel a la vez. Cada píxel es
                    promediado con sus píxeles circundantes (los componentes rojo, verde y azul son promediados), y el resultado es
                    colocado en la matriz de destino. Ya que una imagen es una matriz grande, este proceso puede tomar mucho
                    tiempo. Puede aprovechar el procesamiento simultáneo en sistemas multiprocesador implementando el algoritmo
                    utilizando el marco fork / join. Aquí hay una posible implementación:
                </p>
                <div class="codeblock">
                    <pre>
public class DifuminadoConFork extends RecursiveAction {

    private int[] mOrigen;
    private int mInicio;
    private int mLongitud;
    private int[] mDestino;
    private int mAnchoDifuminado = 15; // Tamaño de la ventana de procesado, debe ser impar.

    public DifuminadoConFork(int[] orig, int inicio, int longitud, int[] dest) {
        mOrigen = orig;
        mInicio = inicio;
        mLongitud = longitud;
        mDestino = dest;
    }

    // Promedia los píxeles de la fuente, escribe los resultados en el destino.
    protected void calculaDirectamente() {
        int sidePixels = (mAnchoDifuminado - 1) / 2;
        for (int indice = mInicio; indice &lt; mInicio + mLongitud; indice++) {
            // Calcula el promedio.
            float rt = 0, gt = 0, bt = 0;
            for (int mi = -sidePixels; mi &lt;= sidePixels; mi++) {
                int mindex = Math.min(Math.max(mi + indice, 0), mOrigen.length - 1);
                int pixel = mOrigen[mindex];
                rt += (float) ((pixel & 0x00ff0000) >> 16) / mAnchoDifuminado;
                gt += (float) ((pixel & 0x0000ff00) >> 8) / mAnchoDifuminado;
                bt += (float) ((pixel & 0x000000ff) >> 0) / mAnchoDifuminado;
            }

            // Vuelve a montar el píxel en destino.
            int dpixel = (0xff000000)
                    | (((int) rt) &lt;&lt; 16)
                    | (((int) gt) &lt;&lt; 8)
                    | (((int) bt) &lt;&lt; 0);
            mDestino[indice] = dpixel;
        }
    }
    protected static int sUmbral = 10000;

    @Override
    protected void compute() {
        if (mLongitud &lt; sUmbral) {
            calculaDirectamente();
            return;
        }

        int division = mLongitud / 2;

        invokeAll(new DifuminadoConFork(mOrigen, mInicio, division, mDestino),
                new DifuminadoConFork(mOrigen, mInicio + division, mLongitud - division,
                mDestino));
    }

    // La fontanería a continuación...
    public static void main(String[] args) throws Exception {
        String origenNombre = "red-tulips.jpg";
        File origenFichero = new File(origenNombre);
        BufferedImage imagen = ImageIO.read(origenFichero);

        System.out.println("Imagen origen: " + origenNombre);

        BufferedImage imagenDifuminada = difumina(imagen);

        String destinoNombre = "blurred-tulips.jpg";
        File destinoFichero = new File(destinoNombre);
        ImageIO.write(imagenDifuminada, "jpg", destinoFichero);
        
        System.out.println("Imagen de salida: " + destinoNombre);

    }
  
  ...
                    </pre>
                </div>
                <p>
                    Ahora implementa el método abstracto <code>compute()</code> , el cual o realiza el difuminado directamente
                    o lo divide en dos tareas más pequeñas. Un umbral de longitud de matriz simple ayuda a determinar si el trabajo
                    se realiza o se divide.
                </p>
                <div class="codeblock">
                    <pre>
    protected static int sUmbral = 10000;

    @Override
    protected void compute() {
        if (mLongitud &lt; sUmbral) {
            calculaDirectamente();
            return;
        }

        int division = mLongitud / 2;

        invokeAll(new DifuminadoConFork(mOrigen, mInicio, division, mDestino),
                new DifuminadoConFork(mOrigen, mInicio + division, mLongitud - division,
                mDestino));
    }
                    </pre>
                </div>
                <p>
                    Si los métodos anteriores están en una subclase de la clase <code>RecursiveAction</code> , entonces configurar
                    la tarea para ejecutarse en un <code>ForkJoinPool</code> es sencillo, e incluye los siguientes pasos:
                </p>
                <ol>
                    <li>
                        <p>
                            Crear una tarea que represente todo el trabajo a ser realizado.
                        </p>
                        <div class="codeblock">
                            <pre>
// los píxeles de la imagen origen están en src
// los píxeles de la imagen destino están en dst
ForkBlur fb = new ForkBlur(src, 0, src.length, dst);
                            </pre>
                        </div>
                    </li>
                    <li>
                        <p>
                            Crear el <code>ForkJoinPool</code> que ejecutará la tarea.
                        </p>
                        <div class="codeblock">
                            <pre>
ForkJoinPool agrupacionHilos = new ForkJoinPool();
                            </pre>
                        </div>
                    </li>
                    <li>
                        <p>
                            Ejecutar la tarea.
                        </p>
                        <div class="codeblock">
                            <pre>
agrupacionHilos.invoke(fb);
                            </pre>
                        </div>
                    </li>
                </ol>
                <p>
                    Para ver el código fuente completo, incluyendo algún código extra que crea el fichero de imagen destino, vea el
                    ejemplo
                    <a class="SourceLink" target="_blank" href="examples/DifuminadoConFork.java"
                       onclick="showCode('../../displayCode.html', 'examples/DifuminadoConFork.java'); return false;">
                        <code>DifuminadoConFork</code></a> .
                </p>
                <h2>Implementaciones Estándar</h2>
                <p>
                    Además de utilizar el marco de trabajo fork/join para implementar algoritmos personalizados para tareas que son
                    realizadas concurrentemente en un sistema multiprocesador (como el ejemplo <code>DifuminadoConFork.java</code>
                    en la sección previa), hay algunas características generalmente útiles en Java SE las cuales están ya
                    implementadas usando el marco de trabajo fork/join. Una de tales implementaciones, introducida en Java SE 8,
                    es usada por la clase 
                    <a class="APILink" target="_blank"
                       href="https://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html">
                        <code>java.util.Arrays</code></a> para sus métodos <code>parallelSort()</code>.
                    Estos métodos son similares a <code>sort()</code>, pero aprovechan la concurrencia vía el marco de trabajo
                    fork/join. El ordenamiento paralelo de grandes matrices es más rápido que el ordenamiento secuencial cuando se
                    ejecuta en sistemas multiprocesador. Sin embargo, cómo exactamente el marco de trabajo fork/join es aprovechado
                    por estos métodos está fuera del alcance de los Tutoriales de Java. Para obtener esta información, vea la
                    documentación del IPA de Java.
                </p>
                <p>
                    Otra implementación del marco de trabajo fork/join es usada por los métodos en el paquete
                    <code>java.util.streams</code>, el cual es parte del
                    <a class="OutsideLink" target="_blank" 
                       href="http://openjdk.java.net/projects/lambda/">Projecto Lambda</a> programado para la versión de Java SE 8.
                    Para obtener más información, vea la sección
                    <a class="TutorialLink" target="_top" 
                       href="../../java/javaOO/lambdaexpressions.html">Expresiones Lambda </a> .
                </p>
            </div>
            <div class="NavBit">
                <a target="_top" href="pools.html">&laquo;&nbsp;Anterior</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="../TOC.html">TdC</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="collections.html">Siguiente&nbsp;&raquo;</a>
            </div>
        </div>
        <hr class="clearfloat"/>
        <div id="Footer">
            <table style="width: 100%;padding: 5px">
                <tr>
                    <td>
                        <p class="footertext">
                            <a id="license_info">
                                Su uso de ésta
                            </a>
                            página y todo el material en las páginas bajo el anuncio "Los Tutoriales de Java" está sujeto
                            a estos
                            <a href="../../information/cpyr.html">
                                avisos legales
                            </a>
                            .
                        </p>
                        <p class="footertext">
                            Copyright &copy; 1995, 2015 Oracle y/o sus afiliados. Todos los derechos reservados.
                        </p>
                    </td>
                    <td style="text-align: right">
                        <p class="footertext">
                            ¿Problemas con estos ejemplos? Intente
                            <a target="_blank" href="../../information/run-examples.html">
                                Compilando y Ejecutando los Ejemplos: PFs
                            </a>
                            .
                        </p>
                        <p class="footertext">
                            ¿Quejas? ¿Elogios? ¿Sugerencias?
                            <a target="_blank" href="https://docs.oracle.com/javase/feedback.html">
                                Denos su opinión
                            </a>
                            .
                        </p>
                    </td>
                </tr>
            </table>
        </div>
        <div class="PrintHeaders">
            <b>Página Anterior:</b> Agrupaciones de Hilos<br />
            <b>Página Siguiente:</b> Colecciones Concurrentes
        </div>
    </body>
</html>