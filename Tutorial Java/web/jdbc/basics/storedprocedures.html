<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>
            Usando Procedimientos Almacenados (Los Tutoriales de Java&trade; &gt; Acceso a Bases de Datos JDBC(TM) &gt; 
            Lo Básico de JDBC)
        </title>
        <meta name="description" content="Este tutorial de Java JDBC describe cómo usar la IPA JDBC para crear, insertar, 
              actualizar y consultar tablas. También aprenderá cómo usar declaraciones simples y preparadas, procedimientos 
              almacenados y realizar transacciones" />
        <meta name="keywords" content="java programming, learn java, java sample code, jdbc, prepared statement, result set" />
        <link rel="stylesheet" href="../../indice.css" type="text/css"/>
        <script src="../../navegacion.js"></script>
    </head>
    <body onload="load()">
        <noscript>Se requiere un navegador con JavaScript habilitado para que esta página opere apropiadamente.</noscript>
        <div class="header-container">
            <div class="bookwrapper clearfix">
                <div id="brandProdName">
                    <div id="logocover"></div>
                    <div id="productName">Documentación</div>
                </div>
                <br class="clearfloat" />
            </div>
        </div>
        <div id="TopBar">
            <div id="TopBar_tr">
                <div id="TopBar_tl">
                    <div id="TopBar_br">
                        <div id="TopBar_bl">
                            <div id="TopBar_left">Los Tutoriales de Java&trade;</div>
                            <div id="TopBar_right">
                                <a target="_blank" href="http://www.oracle.com/technetwork/java/javase/downloads/java-se-7-tutorial-2012-02-28-1536013.html">
                                    Descargar Libros Electrónicos</a><br />
                                <a target="_blank" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">
                                    Descargar KDJ</a><br />
                                <a href="javascript:toggleLeft()" id="ToggleLeft">
                                    Ocultar TdC</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="LeftBar" class="LeftBar_shown">
            <div id="Contents">
                <div class="linkLESSON"><a href="index.html">Lo Básico de JDBC</a></div>
                <div class="linkAHEAD"><a href="gettingstarted.html">Empezando</a></div>
                <div class="linkAHEAD"><a href="processingsqlstatements.html">Procesando Sentencias SQL con JDBC</a></div>
                <div class="linkAHEAD"><a href="connecting.html">Estableciendo una Conexión</a></div>
                <div class="linkAHEAD"><a href="sqldatasources.html">Conectando con Objetos DataSource</a></div>
                <div class="linkAHEAD"><a href="sqlexception.html">Manejando SQLExceptions</a></div>
                <div class="linkAHEAD"><a href="tables.html">Configurando Tablas</a></div>
                <div class="linkAHEAD"><a href="retrieving.html">Recuperando y Modificando Valores de los Result Sets</a></div>
                <div class="linkAHEAD"><a href="prepared.html">Usando Prepared Statements</a></div>
                <div class="linkAHEAD"><a href="transactions.html">Usando Transacciones</a></div>
                <div class="linkAHEAD"><a href="rowset.html">Usando Objetos RowSet</a></div>
                <div class="linkAHEAD"><a href="jdbcrowset.html">Utilizando Objetos JdbcRowSet</a></div>
                <div class="linkAHEAD"><a href="cachedrowset.html">Utilizando CachedRowSetObjects</a></div>
                <div class="linkAHEAD"><a href="joinrowset.html">Utilizando Objetos JoinRowSet</a></div>
                <div class="linkAHEAD"><a href="filteredrowset.html">Utilizando Objetos FilteredRowSet</a></div>
                <div class="linkAHEAD"><a href="webrowset.html">Utilizando Objetos WebRowSet</a></div>
                <div class="linkAHEAD"><a href="sqltypes.html">Usando Tipos de Datos Avanzados</a></div>
                <div class="linkAHEAD"><a href="blob.html">Utilizando Objetos Grandes</a></div>
                <div class="linkAHEAD"><a href="sqlxml.html">Utilizando Objetos SQLXML</a></div>
                <div class="linkAHEAD"><a href="array.html">Utilizando Objetos Array</a></div>
                <div class="linkAHEAD"><a href="distinct.html">Usando el Tipo de Datos DISTINCT</a></div>
                <div class="linkAHEAD"><a href="sqlstructured.html">Utilizando Objetos Estructurados</a></div>
                <div class="linkAHEAD"><a href="sqlcustommapping.html">Usando Mapeados de Tipos Personalizados</a></div>
                <div class="linkAHEAD"><a href="sqldatalink.html">Utilizando Objetos Datalink</a></div>
                <div class="linkAHEAD"><a href="sqlrowid.html">Utilizando Objetos RowId</a></div>
                <div class="nolinkAHEAD">Usando Procedimientos Almacenados</div>
                <div class="linkAHEAD"><a href="jdbcswing.html">Usando JDBC con una IPA de IGU</a></div>
            </div>
        </div>
        <div id="MainFlow" class="MainFlow_indented">
            <div class="PrintHeaders">
                <b>Recorrido:</b> Acceso a Bases de Datos JDBC(TM)<br />
                <b>Lección:</b> Lo Básico de JDBC
            </div>
            <div id="BreadCrumbs">
                <a href="../../index.html" target="_top">Página de Inicio</a>&nbsp;&gt;&nbsp;
                <a href="../index.html" target="_top">Acceso a Bases de Datos JDBC(TM)</a>&nbsp;&gt;&nbsp;
                <a href="index.html" target="_top">Lo Básico de JDBC</a>
            </div>
            <div class="NavBit">
                <a target="_top" href="sqlrowid.html">&laquo;&nbsp;Anterior</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="../TOC.html">TdC</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="jdbcswing.html">Siguiente&nbsp;&raquo;</a>
            </div>
            <div id="PageTitle">
                <h1>Usando Procedimientos Almacenados</h1>
            </div>
            <div id="PageContent">
                <p>
                    Un procedimiento almacenado es un grupo de sentencias SQL que forman una unidad lógica y realiza una tarea en 
                    particular, y son usados par encapsular un conjunto de operaciones o consultas a ejecutar en un servidor de 
                    bases de datos. Por ejemplo, las operaciones de un empleado en la base de datos (contratar, despedir, 
                    promocionar, buscar) podrían ser codificadas como procedimientos almacenados ejecutados por código de la 
                    aplicación. Los procedimientos almacenados pueden ser compilados y ejecutados con diferentes parámetros y 
                    resultados, y pueden tener cualquier combinación de parámetros de entrada, salida, y entrada/salida.
                </p>
                <p>
                    Dese cuenta de que los procedimientos almacenados son admitidos por la mayoría de los DBMSs, pero existe una 
                    gran cantidad de variación en su sintaxis y capacidades. Como consecuencia, el tutorial contiene dos clases, 
                    <code><a href="gettingstarted.html">StoredProcedureJavaDBSample</a></code> y 
                    <code><a href="gettingstarted.html">StoredProcedureMySQLSample</a></code> para demostrar cómo crear 
                    procedimientos almacenados en Java DB y MySQL, respectivamente.
                </p>
                <p>
                    Esta página cubre los temas siguientes:
                </p>
                <ul>
                    <li>
                        <a href="#overview_stored_procedures_examples">
                            Descripción General de los Ejemplos de Procedimientos Almacenados</a>
                    </li>
                    <li>
                        <a href="#parameter_modes">Modos de Parámetros</a>
                    </li>
                    <li>
                        <a href="#creating_stored_procedures_java_db">Crear Procedimientos Almacenados en Java DB</a>
                        <ul>
                            <li>
                                <a href="#creating_javadb_sql_jdbc">
                                    Crear Procedimientos Almacenados en Java DB con Scripts de SQL o la IPA de JDBC</a>
                            </li>
                            <li>
                                <a href="#creating_stored_procedures_java_db">Crear Procedimientos Almacenados en Java DB</a>
                            </li>
                            <li>
                                <a href="#package_java_class_in_jar_file">Empaquetar la Clase de Java en un Fichero JAR</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#creating_stored_procedure_mysql">Crear Procedimiento Almacenado en MySQL</a>
                        <ul>
                            <li>
                                <a href="#create_jdbc_mysql">
                                    Crear Procedimientos Almacenados en MySQL con Scripts SQL o la IPA de JDBC</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#calling_javadb_mysql">Llamar a Procedimientos Almacenados en Java DB y MySQL</a>
                    </li>
                </ul>
                <h2>
                    <a id="overview_stored_procedures_examples">
                        Descripción General de los Ejemplos de Procedimientos Almacenados</a>
                </h2>
                <p>
                    Los ejemplos <code><a href="gettingstarted.html">StoredProcedureJavaDBSample.java</a></code> y
                    <code><a href="gettingstarted.html">StoredProcedureMySQLSample.java</a></code> crean y llaman a los siguientes 
                    procedimientos almacenados:
                </p>
                <ul>
                    <li>
                        <p>
                            <code>SHOW_SUPPLIERS</code>: Imprime un conjunto de resultado que contiene los nombres de los 
                            proveedores de café y los cafés que siministran a The Coffe Break. Este procedimiento almacenado no 
                            requiere ningún parámetro. Cuando el ejemplo llama a este procedimiento almacenado, el ejemplo produce 
                            una salida similar a la siguiente:
                        </p>
                        <div class="codeblock">
                            <pre>
Acme, Inc.: Colombian_Decaf
Acme, Inc.: Colombian
Superior Coffee: French_Roast_Decaf
Superior Coffee: French_Roast
The High Ground: Espresso
                            </pre>
                        </div>
                    </li>
                    <li>
                        <p>
                            <code>GET_SUPPLIER_OF_COFFEE</code>: Imprime el nombre del proveedor <code>supplierName</code> para el 
                            café <code>coffeeName</code>. Requiere los parámetros siguientes:
                        </p>
                        <ul>
                            <li>
                                <code>IN coffeeName varchar(32)</code>: El nombre del café
                            </li>
                            <li>
                                <code>OUT supplierName varchar(40)</code>: El nombre del proveedor de café
                            </li>
                        </ul>
                        <p>
                            Cuando el ejemplo llama a este procedimiento almacenado con <code>Colombian</code> como valor para 
                            <code>coffeeName</code>, el ejemplo produce una salida similar a la siguiente:
                        </p>
                        <div class="codeblock">
                            <pre>
Supplier of the coffee Colombian: Acme, Inc.
                            </pre>
                        </div>
                    </li>
                    <li>
                        <p>
                            <code>RAISE_PRICE</code>: Eleva el precio del café <code>coffeeName</code> al precio 
                            <code>newPrice</code>. Si el incremento de precio es mayor que el porcentaje 
                            <code>maximumPercentage</code>, entonces el precio es elevado por ese porcentaje. Este procedimiento 
                            no cambia el precio si el precio <code>newPrice</code> es menor que el precio original del café. 
                            Requiere los siguientes parámetros:
                        </p>
                        <ul>
                            <li>
                                <code>IN coffeeName varchar(32)</code>: El nombre del café
                            </li>
                            <li>
                                <code>IN maximumPercentage float</code>: El porcentaje máximo a elevar el precio del café
                            </li>
                            <li>
                                <code>INOUT newPrice numeric(10,2)</code>: El nuevo precio del café. Después de que se haya llamado 
                                al procedimiento almacenado <code>RAISE_PRICE</code>, este parámetro contendrá el precio actual del 
                                café <code>coffeeName</code>.
                            </li>
                        </ul>
                        <p>
                            Cuando el ejemplo llama a este procedimiento almacenado con <code>Colombian</code> como el valor para 
                            <code>coffeeName</code>, <code>0.10</code> como el valor para <code>maximumPercentage</code>, y 
                            <code>19.99</code> como el valor para <code>newPrice</code>, el ejemplo produce una salida similar a la 
                            siguiente:
                        </p>
                        <div class="codeblock">
                            <pre>
Contents of COFFEES table before calling RAISE_PRICE:
Colombian, 101, <strong>7.99</strong>, 0, 0
Colombian_Decaf, 101, 8.99, 0, 0
Espresso, 150, 9.99, 0, 0
French_Roast, 49, 8.99, 0, 0
French_Roast_Decaf, 49, 9.99, 0, 0

Calling the procedure RAISE_PRICE

Value of newPrice after calling RAISE_PRICE: <strong>8.79</strong>

Contents of COFFEES table after calling RAISE_PRICE:
Colombian, 101, <strong>8.79</strong>, 0, 0
Colombian_Decaf, 101, 8.99, 0, 0
Espresso, 150, 9.99, 0, 0
French_Roast, 49, 8.99, 0, 0
French_Roast_Decaf, 49, 9.99, 0, 0
                            </pre>
                        </div>
                    </li>
                </ul>
                <h2>
                    <a id="parameter_modes">Modos de Parámetros</a>
                </h2>
                <p>
                    Los atributos de parámetro <code>IN</code> (predeterminados), <code>OUT</code>, y <code>INOUT</code> son modos 
                    de parámetros. Definen la acción de los parámetros formales. La tabla siguente resume la información sobre los 
                    modos de parámetros.
                </p>
                <table class="celda">
                    <caption>Esta tabla resume los modos de parámetros</caption>
                    <thead>
                        <tr>
                            <th id="h1" class="celda">Característica o Modo de Parámetro</th>
                            <th id="h2" class="celda">IN</th>
                            <th id="h3" class="celda">OUT</th>
                            <th id="h4" class="celda">INOUT</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td headers="h1" class="celda">
                                <p>
                                    ¿Debe ser especificado en la definición del procedmiento almacenado?
                                </p>
                            </td>
                            <td headers="h2" class="celda">
                                <p>
                                    No; si se omite, entonces el modo de parámetro del parámetro formal es <code>IN</code>.
                                </p>
                            </td>
                            <td headers="h3" class="celda">
                                <p>
                                    Debe ser especificado.
                                </p>
                            </td>
                            <td headers="h4" class="celda">
                                <p>
                                    Debe ser especificado.
                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td headers="h1" class="celda">
                                <p>
                                    ¿El parámetro pasa un valor al procedimiento almacenado o devuelve un valor?
                                </p>
                            </td>
                            <td headers="h2" class="celda">
                                <p>
                                    Pasa valores a un procedimiento almacenado.
                                </p>
                            </td>
                            <td headers="h3" class="celda">
                                <p>
                                    Devuelve valores al código que llama.
                                </p>
                            </td>
                            <td headers="h4" class="celda">
                                <p>
                                    Ambos;pasa los valors iniciales a un procedimiento almacenado; devuelve valores actualizados al 
                                    código que llama.
                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td headers="h1" class="celda">
                                <p>
                                    ¿El parámetro formal actúa como una constante o una variable en el procedimiento almacenado?
                                </p>
                            </td>
                            <td headers="h2" class="celda">
                                <p>
                                    El parámetro formal actúa como una constante.
                                </p>
                            </td>
                            <td headers="h3" class="celda">
                                <p>
                                    El parámetro formal actúa como una variable no inicializada.
                                </p>
                            </td>
                            <td headers="h4" class="celda">
                                <p>
                                    El parámetro formal actúa como una variable inicializada.
                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td headers="h1" class="celda">
                                <p>
                                    ¿Se puede asignar un valor al parámetro formal en el procedimiento almacenado?
                                </p>
                            </td>
                            <td headers="h2" class="celda">
                                <p>
                                    No se puede asignar un valor al parámetro formal.
                                </p>
                            </td>
                            <td headers="h3" class="celda">
                                <p>
                                    El parámetro formal no puede ser usado en una expresión; debe asignársele un valor.
                                </p>
                            </td>
                            <td headers="h4" class="celda">
                                <p>
                                    Se debe asignar un valor al parámetro formal.
                                </p>
                            </td>
                        </tr>
                        <tr>
                            <td headers="h1" class="celda">
                                <p>
                                    ¿Qué tipos de parámetros (argumentos) reales se pueden pasar al procedimiento almacenado?
                                </p>
                            </td>
                            <td headers="h2" class="celda">
                                <p>
                                    Los parámetros reales pueden ser una constante, una variable inicializada, un literal, o una 
                                    expresión.
                                </p>
                            </td>
                            <td headers="h3" class="celda">
                                <p>
                                    El parámetro real debe ser una variable.
                                </p>
                            </td>
                            <td headers="h4" class="celda">
                                <p>
                                    El parámetro real debe ser una variable.
                                </p>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <h2>
                    <a id="creating_stored_procedures_java_db">Crear Procedimientos Almacenados en Java DB</a>
                </h2>
                <p>
                    <strong>Nota</strong>: Vea la sección &quot;CREATE PROCEDURE statement&quot; en el 
                    <a href="http://docs.oracle.com/javadb/index_jdk8.html"><em>Manual de Referencia de Java DB</em></a> para más 
                    información sobre la creación de procedimientos almacenados en Java DB.
                </p>
                <p>
                    Crear y usar un procedmiento almacenado en Java DB involucra los pasos siguientes:
                </p>
                <ol>
                    <li>
                        <a href="#creating_public_static_java_method">
                            Crear un método público estático en una clase Java</a>: Este método realiza la tarea requerida del 
                            procedimiento almacenado.
                    </li>
                    <li>
                        <a href="#creating_javadb_sql_jdbc">Crear el procedimiento almacenado</a>: Este procedimiento almacenado 
                        llama al método Java que creó.
                    </li>
                    <li>
                        <a href="#package_java_class_in_jar_file">Empaquetar la Clase Java (que contiene el método público estático 
                            que creo anteriormente) en un fichero JAR.</a>
                    </li>
                    <li>
                        Llamar al procedimiento almacenado con la sentencia SQL <code>CALL</code>. Vea la sección 
                        <a href="#calling_javadb_mysql">Llamar a Procedimientos Almacenados en Java DB y MySQL</a>.
                    </li>
                </ol>
                <h3>
                    <a id="creating_public_static_java_method">Crear Método Publico Estático de Java</a>
                </h3>
                <p>
                    El método siguiente, <code><a href="gettingstarted.html">StoredProcedureJavaDBSample.showSuppliers</a></code>, 
                    contiene las sentencias SQL que el procedimiento almacenado <code>SHOW_SUPPLIERS</code> llama:
                </p>
                <div class="codeblock">
                    <pre>
public static void showSuppliers(ResultSet[] rs)
    throws SQLException {

    Connection con = DriverManager.getConnection("jdbc:default:connection");
    Statement stmt = null;

    String query =
        "select SUPPLIERS.SUP_NAME, " +
        "COFFEES.COF_NAME " +
        "from SUPPLIERS, COFFEES " +
        "where SUPPLIERS.SUP_ID = " +
        "COFFEES.SUP_ID " +
        "order by SUP_NAME";

    stmt = con.createStatement();
    rs[0] = stmt.executeQuery(query);
}
                    </pre>
                </div>
                <p>
                    El procedimiento almacenado <code>SHOW_SUPPLIERS</code> no toma argumentos. Puede especificar argumentos en un 
                    procedimiento almacenado definiéndolos en la firma del método de su método estático y público de Java. Dese 
                    cuenta de que el método <code>showSuppliers</code> contiene un parámetro de tipo <code>ResultSet[]</code>. Si 
                    su procedimiento almacenado devuelve cualquier número de objetos <code>ResultSet</code>, especifique un 
                    parámetro de tipo <code>ResultSet[]</code> en su método Java. Además, asegúrese de que este método Java es 
                    público y estático.
                </p>
                <p>
                    Recupere el objeto <code>Connection</code> desde la URL <code>jdbc:default:connection</code>. Esta es una 
                    convención en Java DB para indicar que el procedimiento almacenado usará el objeto <code>Connection</code> 
                    actualmente existente.
                </p>
                <p>
                    Tenga en cuenta que el objeto <code>Statement</code> no está cerrado en este método. No cierre ningún objeto 
                    <code>Statement</code> en el método Java de su procedimiento almacenado; si lo hace, el objeto 
                    <code>ResultSet</code> no existirá cuando emita la sentencia <code>CALL</code> cuando llama al procedimiento 
                    almacenado.
                </p>
                <p>
                    Para que el procedimiento almacenado devuelve un conjunto de resultados generado, debe asignar el conjunto de 
                    resultado a un componente matriz del parámetro <code>ResultSet[]</code>. En este ejemplo, el conjunto de 
                    resultados generados es asignado al componente matriz <code>rs[0]</code>.
                </p>
                <p>
                    El método siguiente es 
                    <code><a href="gettingstarted.html">StoredProcedureJavaDBSample.showSuppliers</a></code>:
                </p>
                <div class="codeblock">
                    <pre>
public static void getSupplierOfCoffee(String coffeeName, String[] supplierName)
    throws SQLException {

    Connection con = DriverManager.getConnection("jdbc:default:connection");
    PreparedStatement pstmt = null;
    ResultSet rs = null;

    String query =
        "select SUPPLIERS.SUP_NAME " +
        "from SUPPLIERS, COFFEES " +
        "where " +
        "SUPPLIERS.SUP_ID = COFFEES.SUP_ID " +
        "and ? = COFFEES.COF_NAME";

    pstmt = con.prepareStatement(query);
    pstmt.setString(1, coffeeName);
    rs = pstmt.executeQuery();

    if (rs.next()) {
        supplierName[0] = rs.getString(1);
    } else {
        supplierName[0] = null;
    }
}
                    </pre>
                </div>
                <p>
                    El parámetro formal <code>coffeeName</code> tiene el modo de parámetro <code>IN</code>. Este parámetro forma 
                    se usa como cualquier otro parámetro en un método Java. Debido a que el parámetro formal 
                    <code>supplierName</code> tiene el modo de parámetro <code>OUT</code>, este debe usar un tipo de datos de 
                    matriz unidimensional. Ya que este método no produce un conjunto de resultados, la definición del método no 
                    contiene un parámetro de tipo <code>ResultSet[]</code>. Para recuperar un valor de un parámetro formal 
                    <code>OUT</code>, debe asignar el valor que va ser recuperado a un componente matriz del parámetro formal 
                    <code>OUT</code>. En este ejemplo, el nombre recuperado del proveedor de café es asignado al componente matriz 
                    <code>supplierName[0]</code>.
                </p>
                <p>
                    Lo siguiente es la firma del método 
                    <code><a href="gettingstarted.html">StoredProcedureJavaDBSample.raisePrice</a></code>
                </p>
                <div class="codeblock">
                    <pre>
public static void raisePrice(
   String coffeeName, double maximumPercentage,
   BigDecimal[] newPrice) throws SQLException
                    </pre>
                </div>
                <p>
                    Ya que el parámetro formal <code>newPrice</code> tiene el modo de parámetro <code>INOUT</code>, debe usar un 
                    tipo de dato de matriz unidimensional. Java DB asigna los tipos de datos SQL <code>FLOAT</code> y 
                    <code>NUMERIC</code> a los tipos de datos Java <code>double</code> y <code>java.math.BigDecimal</code>, 
                    respectivamente.
                </p>
                <h3>
                    <a id="creating_javadb_sql_jdbc">
                        Crear Procedimientos Almacenados en Java DB con Scripts de SQL o la IPA de JDBC</a>
                </h3>
                <p>
                    Java DB usa el lenguaje de programación Java para sus procedimientos almacenados. Como consecuencia, cuando 
                    define un procedimiento almacenado, especifica a qué clase Java llamar y dónde puede encontrarla Java DB.
                </p>
                <p>
                    El siguiente extracto de 
                    <code><a href="gettingstarted.html">StoredProcedureJavaDBSample.createProcedures</a></code> crea un 
                    procedimiento almacenado llamado <code>SHOW_SUPPLIERS</code>:
                </p>
                <div class="codeblock">
                    <pre>
public void createProcedures(Connection con)
    throws SQLException {

    Statement stmtCreateShowSuppliers = null;

    // ...

    String queryShowSuppliers =
        "CREATE PROCEDURE SHOW_SUPPLIERS() " +
        "PARAMETER STYLE JAVA " +
        "LANGUAGE JAVA " +
        "DYNAMIC RESULT SETS 1 " +
        "EXTERNAL NAME " +
        "'com.oracle.tutorial.jdbc." +
        "StoredProcedureJavaDBSample." +
        "showSuppliers'";

    // ...

    try {
        System.out.println("Calling CREATE PROCEDURE");
        stmtCreateShowSuppliers = con.createStatement();

        // ...

    } catch (SQLException e) {
        JDBCTutorialUtilities.printSQLException(e);
    } finally {
        if (stmtCreateShowSuppliers != null) {
            stmtCreateShowSuppliers.close();
        }
        // ...
    }
}
                    </pre>
                </div>
                <p>
                    La lista siguiente describe los elementos del procedimiento que puede especificar en la sentencia 
                    <code>CREATE PROCEDURE</code>:
                </p>
                <ul>
                    <li>
                        <code>PARAMETER STYLE</code>: Identifica la convención usada para pasar parámetros al procedimiento 
                        almacenado. Las siguientes opciones son válidas:
                        <ul>
                            <li>
                                <code>JAVA</code>: Especifica que el procedimiento almacenado usa una convención de paso de 
                                parámetros que es conforme con el lenguaje Java y la especificación de rutinas de SQL.
                            </li>
                            <li>
                                <code>DERBY</code>: Especifica que el procedimiento almacenado admite un vararg como argumento 
                                final en la lista de parámetros.
                            </li>
                        </ul>
                    </li>
                    <li>
                        <code>LANGUAGE JAVA</code>: Especifica el lenguaje de programación del procedimiento almacenado 
                        (actualmente, <code>JAVA</code> es la única opción).
                    </li>
                    <li>
                        <code>DYNAMIC RESULT SETS 1</code>: Especifica el número máximo de conjuntos de resultados recuperados; en 
                        este caso, este es <code>1</code>.
                    </li>
                    <li>
                        <code>EXTERNAL NAME &#39;com.oracle.tutorial.jdbc.StoredProcedureJavaDBSample.showSuppliers&#39;</code>
                        especifica el método de Java plenamente cualificado al que este procedimiento almacenado llama. 
                        <strong>Nota</strong>: Java DB debe ser capaz de encontrar el método especificado aquí en su ruta de clases 
                        o en un fichero JAR directamente agregado a la base de datos. Vea el siguiente paso, 
                        <a href="#package_java_class_in_jar_file">Empaquetar la Clase de Java en un Fichero JAR</a>.
                    </li>
                </ul>
                <p>
                    La sentencia siguiente (que se encuentra en 
                    <code><a href="gettingstarted.html">StoredProcedureJavaDBSample.createProcedures</a></code>) crea un 
                    procedimiento almacenado llamado <code>GET_SUPPLIERS_OF_COFFEE</code> (los saltos de línea se han agregado por 
                    claridad):
                </p>
                <div class="codeblock">
                    <pre>
CREATE PROCEDURE GET_SUPPLIER_OF_COFFEE(
    IN coffeeName varchar(32),
    OUT supplierName
    varchar(40))
    PARAMETER STYLE JAVA
    LANGUAGE JAVA
    DYNAMIC RESULT SETS 0
    EXTERNAL NAME 'com.oracle.tutorial.jdbc.
        StoredProcedureJavaDBSample.
        getSupplierOfCoffee'
                    </pre>
                </div>
                <p>
                    Este procedimiento almacenado tiene dos parámetros formales, <code>coffeeName</code> y 
                    <code>supplierName</code>. Los especificadores de parámetro <code>IN</code> y <code>OUT</code> se llaman 
                    modos de parámetro. Definen la acción de los parámetros formales. Vea 
                    <a href="#parameter_modes">Modos de Parámetro</a> para más información. Este procedimiento almacenado no 
                    recupera un conjunto de resultados, así que el elemento de procedimiento <code>DYNAMIC RESULT SETS</code> es 
                    <code>0</code>.
                </p>
                <p>
                    La siguiente sentencia crea un procedimiento almacenado llamado <code>RAISE_PRICE</code> (los saltos de línea
                    han sido agregados por claridad):
                </p>
                <div class="codeblock">
                    <pre>
CREATE PROCEDURE RAISE_PRICE(
    IN coffeeName varchar(32),
    IN maximumPercentage float,
    INOUT newPrice float)
    PARAMETER STYLE JAVA
    LANGUAGE JAVA
    DYNAMIC RESULT SETS 0
    EXTERNAL NAME 'com.oracle.tutorial.jdbc.
        StoredProcedureJavaDBSample.raisePrice'
                    </pre>
                </div>
                <p>
                    Puede usar scripts SQL para crear procedimientos almacenados en Java DB. Vea el script 
                    <code><a href="gettingstarted.html">javadb/create-procedures.sql</a></code> y el objetivo Ant
                    <code>javadb-create-procedure</code> en el script de construcción de Ant 
                    <code><a href="gettingstarted.html">build.xml</a></code>.
                </p>
                <h3>
                    <a id="package_java_class_in_jar_file">Empaquetar la Clase de Java en un Fichero JAR</a>
                </h3>
                <p>
                    El script de contrucción Ant <code><a href="gettingstarted.html">build.xml</a></code> contiene objetivos para 
                    compilar y empaquetar el tutorial en un fichero JAR. En la línea de comandos, cambie el directorio actual a 
                    <code><em>&lt;directorio tutorial de JDBC&gt;</em></code>. Desde este directorio, ejecute el siguiente comando 
                    para compilar y empaquetar el tutorial en un fichero JAR:
                </p>
                <p>
                    <code>ant jar</code>
                </p>
                <p>
                    El nombre del fichero JAR es <code><em>&lt;directorio tutorial JDBC&gt;</em>/lib/JDBCTutorial.jar</code>.
                </p>
                <p>
                    El script de construcción de Ant agrega el fichero <code>JDBCTutorial.jar</code> a la ruta de clases. Puede 
                    también especificar la ubicación del fichero JAR en su variable de entorno <code>CLASSPATH</code>. Esto 
                    habilita a Java DB a encontrar el método Java que el procedimiento almacenado llama.
                </p>
                <h4>
                    Agregar un Fichero JAR Directamente a la Base de Datos
                </h4>
                <p>
                    Java DB busca primero en su ruta de clases para cualquier claser requerida, y después en la base de datos. 
                    Esta sección muestra como agregar ficheros JAR directamente a la base de datos.
                </p>
                <p>
                    Use los siguientes procedimientos de sistema para agregar el fichero JAR <code>JDBCTutorial.jar</code> a la 
                    base de datos (los saltos de línea han sido agregados por claridad):
                </p>
                <div class="codeblock">
                    <pre>
CALL sqlj.install_jar(
  '<em>&lt;JDBC tutorial directory&gt;</em>/
  lib/JDBCTutorial.jar',
  'APP.JDBCTutorial', 0)
CALL sqlj.replace_jar(
  '<em>&lt;JDBC tutorial directory&gt;</em>/
  lib/JDBCTutorial.jar',
  'APP.JDBCTutorial')";
CALL syscs_util.syscs_set_database_property(
  'derby.database.classpath',
  'APP.JDBCTutorial')";
                    </pre>
                </div>
                <p>
                    <strong>Nota</strong>: El método <a href="gettingstarted.html">
                        <code>StoredProcedureJavaDBSample.registerJarFile</code></a> demuestra cómo llamar estos procedimientos de
                        sistema. Si usted llama a este método, asegúrese que ha modificado 
                        <code><a href="gettingstarted.html">javadb-sample-properties.xml</a></code> de forma que el valor de la 
                        propiedad <code>jar_file</code> es establecido al nombre de ruta completa de <code>JDBCTutorial.jar</code>.
                </p>
                <p>
                    El procedimiento <code>install_jar</code> en el esquema <code>SQL</code> agrega un fichero JAR a la base de 
                    datos. El primer argumento de este procedimiento es el nombre de ruta copleta del fichero JAR en la computadora 
                    desde la cual este procedimiento se ejecuta. El segundo argumento es un identficador que Java DB usa para 
                    referise al fichero JAR. (El identificador <code>APP</code> es el esquema por defecto de Java DB). El 
                    procedimiento <code>replace_jar</code> reemplaza un fichero JAR ya en la base de datos.
                </p>
                <p>
                    El procedimiento de sistema <code>SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY</code> establece o elimina el valor de 
                    una propiedad de la base de datos en la conexión actual. Este método establece la propiedad 
                    <code>derby.database.classpath</code> al identificador especificado en el fichero <code>install_jar</code>. 
                    Java DB primero busca en su ruta de clases de Java por una clase, después lo busca en 
                    <code>derby.database.classpath</code>.
                </p>
                <h2>
                    <a id="creating_stored_procedure_mysql">Crear Procedimiento Almacenado en MySQL</a>
                </h2>
                <p>
                    Crear y usar un procedimiento almacenado en MySQL involucra los pasos siguientes:
                </p>
                <ol>
                    <li>
                        <a href="#create_jdbc_mysql">Crear Procedimientos Almacenados en MySQL con Scripts SQL o la IPA de JDBC</a>
                    </li>
                    <li>
                        Llamar al procedimiento almacenado con la sentencia de SQL <code>CALL</code>. Vea la sección 
                        <a href="#calling_javadb_mysql">Llamar a Procedimientos Almacenados en Java DB y MySQL</a>
                    </li>
                </ol>
                <h3>
                    <a id="create_jdbc_mysql">Crear Procedimientos Almacenados en MySQL con Scripts SQL o la IPA de JDBC</a>
                </h3>
                <p>
                    MySQL usa una sintaxis basada en SQL para sus procedimientos almacenados. El siguiente extracto del script SQL 
                    <code><a href="gettingstarted.html">mysql/create-procedures.sql</a></code> crea un procedimiento almacenado 
                    llamado <code>SHOW_SUPPLIERS</code>:
                </p>
                <div class="codeblock">
                    <pre>
SELECT 'Dropping procedure SHOW_SUPPLIERS' AS ' '|
drop procedure if exists SHOW_SUPPLIERS|

# ...

SELECT 'Creating procedure SHOW_SUPPLIERS' AS ' '|
create procedure SHOW_SUPPLIERS()
    begin
        select SUPPLIERS.SUP_NAME,
        COFFEES.COF_NAME
        from SUPPLIERS, COFFEES
        where SUPPLIERS.SUP_ID = COFFEES.SUP_ID
        order by SUP_NAME;
    end|
                    </pre>
                </div>
                <p>
                    La sentencia <code>DROP PROCEDURE</code> borra el procedimiento <code>SHOW_SUPPLIERS</code> si existe. En 
                    MySQL, las sentencias en un procedimiento almacenado están separados por puntos y comas. Sin embargo, se 
                    requiere un delimitador diferente para finalizar la sentencia <code>create procedure</code>. Este ejemplo usa 
                    el carácter tubería (<code>|</code>); puede usar otro carácter (o más de un carácter). Este carácter que separa 
                    sentencias se define en el atributo <code>delimiter</code> en el objetivo Ant que llama este script. Este 
                    extracto es del fichero de construcción ANT <code><a href="gettingstarted.html">build.xml</a></code> (los 
                    saltos de línea han sido insertadas por claridad):
                </p>
                <div class="codeblock">
                    <pre>
&lt;target name="mysql-create-procedure"&gt;

  &lt;sql driver="${DB.DRIVER}"
       url="${DB.URL}" userid="${DB.USER}"
       password="${DB.PASSWORD}"
       classpathref="CLASSPATH"
       print="true"
       <strong>delimiter="|"</strong>
       autocommit="false"
       onerror="abort"&gt;
       &lt;transaction
         src="./sql/${DB.VENDOR}/
           create-procedures.sql"&gt;
       &lt;/transaction&gt;
  &lt;/sql&gt;

&lt;/target&gt;
                    </pre>
                </div>
                <p>
                    Alternativamente, puede usar la sentencia SQL <code>DELIMITER</code> para especificar un carácter delimitador 
                    diferente.
                </p>
                <p>
                    La sentencia <code>CREATE PROCEDURE</code> consiste del nombre del procedimiento, una lista separada por comas 
                    de parámetros en paréntesis, y sentencias SQL dentro de las palabras clave <code>BEGIN</code> y 
                    <code>END</code>.
                </p>
                <p>
                    Puede usar la IPA JDBC para crear un procedimiento almacenado. El método siguiente, 
                    <code><a href="gettingstarted.html">StoredProcedureMySQLSample.createProcedureShowSuppliers</a></code>, realiza 
                    las mismas tareas que el script anterior:
                </p>
                <div class="codeblock">
                    <pre>
public void
    createProcedureShowSuppliers()
    throws SQLException {
    String createProcedure = null;

    String queryDrop =
        "DROP PROCEDURE IF EXISTS SHOW_SUPPLIERS";

    createProcedure =
        "create procedure SHOW_SUPPLIERS() " +
        "begin " +
            "select SUPPLIERS.SUP_NAME, " +
            "COFFEES.COF_NAME " +
            "from SUPPLIERS, COFFEES " +
            "where SUPPLIERS.SUP_ID = " +
            "COFFEES.SUP_ID " +
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "order by SUP_NAME; " +
        "end";
    Statement stmt = null;
    Statement stmtDrop = null;

    try {
        System.out.println("Calling DROP PROCEDURE");
        stmtDrop = con.createStatement();
        stmtDrop.execute(queryDrop);
    } catch (SQLException e) {
        JDBCTutorialUtilities.printSQLException(e);
    } finally {
        if (stmtDrop != null)
        {
            stmtDrop.close();
        }
    }

    try {
        stmt = con.createStatement();
        stmt.executeUpdate(createProcedure);
    } catch (SQLException e) {
        JDBCTutorialUtilities.printSQLException(e);
    } finally {
        if (stmt != null) { stmt.close(); }
    }
}
                    </pre>
                </div>
                <p>
                    Dese cuenta que el delimitador no ha sido cambiado en este método.
                </p>
                <p>
                    El procedimiento almacenado <code>SHOW_SUPPLIERS</code> genera un conjunto de resultados, aunque el tipo de 
                    retorno del método <code>createProcedureShowSuppliers</code> es <code>void</code> y el método no contiene 
                    ningún parámetro. Un conjunto de resultados se devuelve cuando el procedimiento almacenado 
                    <code>SHOW_SUPPLIERS</code> se llama con el método <code>CallableStatement.executeQuery</code>:
                </p>
                <div class="codeblock">
                    <pre>
CallableStatement cs = null;
cs = this.con.prepareCall("{call SHOW_SUPPLIERS}");
ResultSet rs = cs.executeQuery();
                    </pre>
                </div>
                <p>
                    El siguiente extracto del método 
                    <code>
                        <a href="gettingstarted.html">StoredProcedureMySQLSample.createProcedureGetSupplierOfCoffee</a>
                    </code> contiene la consulta SQL que crea un procedimiento almacenado llamado 
                    <code>GET_SUPPLIER_OF_COFFEE</code>:
                </p>
                <div class="codeblock">
                    <pre>
public void createProcedureGetSupplierOfCoffee()
    throws SQLException {

    String createProcedure = null;

    // ...

    createProcedure =
        "create procedure GET_SUPPLIER_OF_COFFEE(" +
        "IN coffeeName varchar(32), " +
        "OUT supplierName varchar(40)) " +
        "begin " +
            "select SUPPLIERS.SUP_NAME into " +
            "supplierName " +
            "from SUPPLIERS, COFFEES " +
            "where SUPPLIERS.SUP_ID = " +
            "COFFEES.SUP_ID " +
            "and coffeeName = COFFEES.COF_NAME; " +
            "select supplierName; " +
        "end";
    // ...
}
                    </pre>
                </div>
                <p>
                    Este procedimiento almacenado tiene dos parámetros formales, <code>coffeeName</code> y 
                    <code>supplierName</code>. Los especificadores de parámetros <code>IN</code> and <code>OUT</code> se llaman 
                    modos de parámetro. Definen la acción de los parámetros formales. Vea 
                    <a href="#parameter_modes">Modos de Parámetro</a> para más información. Los parámetros formales se definen el 
                    la consulta SQL, no en el método <code>createProcedureGetSupplierOfCoffee</code>. Para asignar un valor a el 
                    parámetro <code>OUT</code> <code>supplierName</code>, este procedimiento almacenado usa una sentencia 
                    <code>SELECT</code>.
                </p>
                <p>
                    El siguiente extracto del método
                    <code><a href="gettingstarted.html">StoredProcedureMySQLSample.createProcedureRaisePrice</a></code> contiene la 
                    consulta SQL que crea un procedimiento almacenado llamado <code>RAISE_PRICE</code>:
                </p>
                <div class="codeblock">
                    <pre>
public void createProcedureRaisePrice()
    throws SQLException {

    String createProcedure = null;

    // ...

    createProcedure =
        "create procedure RAISE_PRICE(" +
        "IN coffeeName varchar(32), " +
        "IN maximumPercentage float, " +
        "INOUT newPrice numeric(10,2)) " +
        "begin " +
        "main: BEGIN " +
            "declare maximumNewPrice " +
                "numeric(10,2); " +
            "declare oldPrice numeric(10,2); " +
            "select COFFEES.PRICE into oldPrice " +
                "from COFFEES " +
                "where COFFEES.COF_NAME " +
                "= coffeeName; " +
            "set maximumNewPrice = " +
                "oldPrice * (1 + " +
                "maximumPercentage); " +
            "if (newPrice &gt; maximumNewPrice) " +
                "then set newPrice = " +
                "maximumNewPrice; " +
            "end if; " +
            "if (newPrice &lt;= oldPrice) " +
                "then set newPrice = oldPrice; " +
                "leave main; " +
            "end if; " +
            "update COFFEES " +
                "set COFFEES.PRICE = newPrice " +
                "where COFFEES.COF_NAME " +
                "= coffeeName; " +
            "select newPrice; " +
        "END main; " +
        "end";

    // ...
}
                    </pre>
                </div>
                <p>
                    El procedimiento almacenado asigna un valor al parámetro <code>INOUT</code> <code>newPrice</code> con las 
                    sentencias <code>SET</code> y <code>SELECT</code>. Para salir del procedimiento almacenado, el procedimiento 
                    almacenado primero encierra las sentencias en un bloque <code>BEGIN ... END</code> etiquetado  
                    <code>main</code>. Para salir del procedimiento, el método usa la sentencia <code>leave main</code>.
                    The stored procedure assigns a value to the <code>INOUT</code> parameter <code>newPrice</code> with the
                    <code>SET</code> and <code>SELECT</code> statements. To exit the stored procedure, the stored procedure first
                    encloses the statements in a <code>BEGIN ... END</code> block labeled <code>main</code>. To exit the procedure,
                    the method uses the statement <code>leave main</code>.
                </p>
                <h2>
                    <a id="calling_javadb_mysql">Llamar a Procedimientos Almacenados en Java DB y MySQL</a>
                </h2>
                <p>
                    El siguiente extracto del método <code><a href="gettingstarted.html">runStoredProcedures</a></code>, llama al 
                    procedimiento almacenado <code>SHOW_SUPPLIERS</code> e imprime el conjunto de resultados generado:
                </p>
                <div class="codeblock">
                    <pre>
cs = this.con.prepareCall("{call SHOW_SUPPLIERS()}");
ResultSet rs = cs.executeQuery();

while (rs.next()) {
    String supplier = rs.getString("SUP_NAME");
    String coffee = rs.getString("COF_NAME");
    System.out.println(supplier + ": " + coffee);
}
                    </pre>
                </div>
                <p>
                    <strong>Nota</strong>: Como con los objetos <code>Statement</code>, para llamar al procedimiento almacenado, 
                    puede llamar a <code>execute</code>, <code>executeQuery</code>, o <code>executeUpdate</code> dependiendo de 
                    cuantos objetos <code>ResultSet</code> devuelve el procedimiento. Sin embargo, si no está seguro de cuantos 
                    objetos <code>ResultSet</code> devuelve el procedimiento, llame a <code>execute</code>.
                </p>
                <p>
                    Llamar al procedimiento almacenado <code>SHOW_SUPPLIERS</code> se demuestra en la sección 
                    <a href="#create_jdbc_mysql">Crear Procedimientos Almacenados en MySQL con Scripts SQL o la IPA de JDBC</a>.
                </p>
                <p>
                    El siguiente extracto del método <code><a href="gettingstarted.html">runStoredProcedures</a></code>, llama al 
                    procedimiento almacenado <code>GET_SUPPLIER_OF_COFFEE</code>:
                </p>
                <div class="codeblock">
                    <pre>
cs = this.con.prepareCall("{call GET_SUPPLIER_OF_COFFEE(?, ?)}");
cs.setString(1, coffeeNameArg);
cs.registerOutParameter(2, Types.VARCHAR);
cs.executeQuery();

String supplierName = cs.getString(2);
                    </pre>
                </div>
                <p>
                    La interfaz <code>CallableStatement</code> extiende <code>PreparedStatement</code>. Es usado para llamar a 
                    procedimientos almacenados. Especifique valores para los parámetros <code>IN</code> (tales como 
                    <code>coffeeName</code> en este ejemplo) tal como lo haría con un objeto <code>PreparedStatement</code> 
                    llamando al método establecedor apropiado. Sin embargo, si un procedimiento almacenado contiene un parámetro 
                    <code>OUT</code>, debe registrarlo con el método <code>registerOutParameter</code>.
                </p>
                <p>
                    El siguiente extracto del método <code><a href="gettingstarted.html">runStoredProcedures</a></code>, llama al 
                    procedimiento almacenado <code>RAISE_PRICE</code>:
                </p>
                <div class="codeblock">
                    <pre>
cs = this.con.prepareCall("{call RAISE_PRICE(?,?,?)}");
cs.setString(1, coffeeNameArg);
cs.setFloat(2, maximumPercentageArg);
cs.registerOutParameter(3, Types.NUMERIC);
cs.setFloat(3, newPriceArg);

cs.execute();
                    </pre>
                </div>
                <p>
                    Debido a que el parámetro <code>newPrice</code> (el tercer parámetro en el procedimento <code>newPrice</code>) 
                    tiene el modo de parámetro <code>INOUT</code>, debe especificar su valor llamando al método establecedor y 
                    registrarlo con el método <code>registerOutParameter</code>.
                </p>
            </div>
            <div class="NavBit">
                <a target="_top" href="sqlrowid.html">&laquo;&nbsp;Anterior</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="../TOC.html">TdC</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="jdbcswing.html">Siguiente&nbsp;&raquo;</a>
            </div>
        </div>
        <hr class="clearfloat"/>
        <div id="Footer">
            <table style="width: 100%;padding: 5px">
                <tr>
                    <td>
                        <p class="footertext">
                            <a id="license_info">Su uso de ésta</a> página y todo el material en las páginas bajo el anuncio
                            &quot;Los Tutoriales de Java&quot; está sujeto a estos <a href="../../information/cpyr.html">avisos
                                legales</a>.
                        </p>
                        <p class="footertext">
                            Copyright &copy; 1995, 2015 Oracle y/o sus afiliados. Todos los derechos reservados.
                        </p>
                    </td>
                    <td style="text-align: right">
                        <p class="footertext">
                            ¿Problemas con estos ejemplos? Intente
                            <a target="_blank" href="../../information/run-examples.html">Compilando y Ejecutando los Ejemplos: PFs
                            </a>.
                        </p>
                        <p class="footertext">
                            ¿Quejas? ¿Elogios? ¿Sugerencias? <a target="_blank" href="https://docs.oracle.com/javase/feedback.html">
                                Denos su opinión</a>.
                        </p>
                    </td>
                </tr>
            </table>
        </div>
        <div class="PrintHeaders">
            <b>Página anterior:</b> Utilizando Objetos RowId<br />
            <b>Página siguiente:</b> Usando JDBC con una IPA de IGU
        </div>
    </body>
</html> 
