<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>
            Usando Mapeados de Tipos Personalizados (Los Tutoriales de Java&trade; &gt; Acceso a Bases de Datos JDBC(TM) &gt; 
            Lo Básico de JDBC)
        </title>
        <meta name="description" content="Este tutorial de Java JDBC describe cómo usar la IPA JDBC para crear, insertar, 
              actualizar y consultar tablas. También aprenderá cómo usar declaraciones simples y preparadas, procedimientos 
              almacenados y realizar transacciones" />
        <meta name="keywords" content="java programming, learn java, java sample code, jdbc, prepared statement, result set" />
        <link rel="stylesheet" href="../../indice.css" type="text/css"/>
        <script src="../../navegacion.js"></script>
    </head>
    <body onload="load()">
        <noscript>Se requiere un navegador con JavaScript habilitado para que esta página opere apropiadamente.</noscript>
        <div class="header-container">
            <div class="bookwrapper clearfix">
                <div id="brandProdName">
                    <div id="logocover"></div>
                    <div id="productName">Documentación</div>
                </div>
                <br class="clearfloat" />
            </div>
        </div>
        <div id="TopBar">
            <div id="TopBar_tr">
                <div id="TopBar_tl">
                    <div id="TopBar_br">
                        <div id="TopBar_bl">
                            <div id="TopBar_left">Los Tutoriales de Java&trade;</div>
                            <div id="TopBar_right">
                                <a target="_blank" href="http://www.oracle.com/technetwork/java/javase/downloads/java-se-7-tutorial-2012-02-28-1536013.html">
                                    Descargar Libros Electrónicos</a><br />
                                <a target="_blank" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">
                                    Descargar KDJ</a><br />
                                <a href="javascript:toggleLeft()" id="ToggleLeft">
                                    Ocultar TdC</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="LeftBar" class="LeftBar_shown">
            <div id="Contents">
                <div class="linkLESSON"><a href="index.html">Lo Básico de JDBC</a></div>
                <div class="linkAHEAD"><a href="gettingstarted.html">Empezando</a></div>
                <div class="linkAHEAD"><a href="processingsqlstatements.html">Procesando Sentencias SQL con JDBC</a></div>
                <div class="linkAHEAD"><a href="connecting.html">Estableciendo una Conexión</a></div>
                <div class="linkAHEAD"><a href="sqldatasources.html">Conectando con Objetos DataSource</a></div>
                <div class="linkAHEAD"><a href="sqlexception.html">Manejando SQLExceptions</a></div>
                <div class="linkAHEAD"><a href="tables.html">Configurando Tablas</a></div>
                <div class="linkAHEAD"><a href="retrieving.html">Recuperando y Modificando Valores de los Result Sets</a></div>
                <div class="linkAHEAD"><a href="prepared.html">Usando Prepared Statements</a></div>
                <div class="linkAHEAD"><a href="transactions.html">Usando Transacciones</a></div>
                <div class="linkAHEAD"><a href="rowset.html">Usando Objetos RowSet</a></div>
                <div class="linkAHEAD"><a href="jdbcrowset.html">Utilizando Objetos JdbcRowSet</a></div>
                <div class="linkAHEAD"><a href="cachedrowset.html">Utilizando CachedRowSetObjects</a></div>
                <div class="linkAHEAD"><a href="joinrowset.html">Utilizando Objetos JoinRowSet</a></div>
                <div class="linkAHEAD"><a href="filteredrowset.html">Utilizando Objetos FilteredRowSet</a></div>
                <div class="linkAHEAD"><a href="webrowset.html">Utilizando Objetos WebRowSet</a></div>
                <div class="linkAHEAD"><a href="sqltypes.html">Usando Tipos de Datos Avanzados</a></div>
                <div class="linkAHEAD"><a href="blob.html">Utilizando Objetos Grandes</a></div>
                <div class="linkAHEAD"><a href="sqlxml.html">Utilizando Objetos SQLXML</a></div>
                <div class="linkAHEAD"><a href="array.html">Utilizando Objetos Array</a></div>
                <div class="linkAHEAD"><a href="distinct.html">Usando el Tipo de Datos DISTINCT</a></div>
                <div class="linkAHEAD"><a href="sqlstructured.html">Utilizando Objetos Estructurados</a></div>
                <div class="nolinkAHEAD">Usando Mapeados de Tipos Personalizados</div>
                <div class="linkAHEAD"><a href="sqldatalink.html">Utilizando Objetos Datalink</a></div>
                <div class="linkAHEAD"><a href="sqlrowid.html">Utilizando Objetos RowId</a></div>
                <div class="linkAHEAD"><a href="storedprocedures.html">Usando Procedimientos Almacenados</a></div>
                <div class="linkAHEAD"><a href="jdbcswing.html">Usando JDBC con una IPA de IGU</a></div>
            </div>
        </div>
        <div id="MainFlow" class="MainFlow_indented">
            <div class="PrintHeaders">
                <b>Recorrido:</b> Acceso a Bases de Datos JDBC(TM)<br />
                <b>Lección:</b> Lo Básico de JDBC
            </div>
            <div id="BreadCrumbs">
                <a href="../../index.html" target="_top">Página de Inicio</a>&nbsp;&gt;&nbsp;
                <a href="../index.html" target="_top">Acceso a Bases de Datos JDBC(TM)</a>&nbsp;&gt;&nbsp;
                <a href="index.html" target="_top">Lo Básico de JDBC</a>
            </div>
            <div class="NavBit">
                <a target="_top" href="sqlstructured.html">&laquo;&nbsp;Anterior</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="../TOC.html">TdC</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="sqldatalink.html">Siguiente&nbsp;&raquo;</a>
            </div>
            <div id="PageTitle">
                <h1>Usando Mapeados de Tipos Personalizados</h1>
            </div>
            <div id="PageContent">
                <p>
                    <strong>Nota</strong>: MySQL actualmente no soporta los tipos definidos por el usuario. MySQL y Java DB 
                    actualmente no admiten los tipos estructurados, o el tipo de datos <code>DISTINCT</code> de SQL. No hay ejemplo 
                    de tutorial de JDBC disponible para demostrar las características descritas en esta sección.
                </p>
                <p>
                    Con el negocio en auge, el propietario de The Coffee Break está regularmente agregando nuevas tieneas y 
                    haciendo cambios a la base de datos. El propietario ha decidio usar un mapa personalizado para el tipo 
                    estructurado <code>ADDRESS</code>. Esto habilita al propietario a hacer cambios a la clase Java que asigna el 
                    tipo <code>ADDRESS</code>. La clase Java tendrá un campo por cada atributo de <code>ADDRESS</code>. El nombre 
                    de la clase y los nombres de sus campos pueden ser cualquier identificador válido de Java.
                </p>
                <p>
                    Se cubren los siguientes temas:
                </p>
                <ul>
                    <li>
                        <a href="#implementing_sqldata">Implementar SQLData</a>
                    </li>
                    <li>
                        <a href="#using_connection_type_map">Usar el Mapa de Tipos de una Conexión</a>
                    </li>
                    <li>
                        <a href="#using_your_own_type_map">Uso de su Propio Mapa de Tipos</a>
                    </li>
                </ul>
                <h2>
                    <a id="implementing_sqldata">Implementar SQLData</a>
                </h2>
                <p>
                    La primera cosa requerida para un mapeo personalizado es crear una clase que implemente la interfaz 
                    <code>SQLData</code>.
                </p>
                <p>
                    La definición SQL del tipo estructurado <code>ADDRESS</code> se parece a esto:
                </p>
                <div class="codeblock">
                    <pre>

  CREATE TYPE ADDRESS
  (
    NUM INTEGER,
    STREET VARCHAR(40),
    CITY VARCHAR(40),
    STATE CHAR(2),
    ZIP CHAR(5)
  );

                    </pre>
                </div>
                <p>
                    Una clase que implementa la interfaz <code>SQLData</code> para la asignación personalizada del tipo 
                    <code>ADDRESS</code> podría parecerse a esto:
                </p>
                <div class="codeblock">
                    <pre>
public class Address implements SQLData {
    public int num;
    public String street;
    public String city;
    public String state;
    public String zip;
    private String sql_type;
    
    public String getSQLTypeName() {
        return sql_type;
    }

    public void readSQL(SQLInput stream, String type)
        throws SQLException {
        sql_type = type;
        num = stream.readInt();
        street = stream.readString();
        city = stream.readString();
        state = stream.readString();
        zip = stream.readString();
    }

    public void writeSQL(SQLOutput stream)
        throws SQLException {
        stream.writeInt(num);
        stream.writeString(street);
        stream.writeString(city);
        stream.writeString(state);
        stream.writeString(zip);
    }
}
                    </pre>
                </div>
                <h2>
                    <a id="using_connection_type_map">Usar el Mapa de Tipos de una Conexión</a>
                </h2>
                <p>
                    Después de escribir una clase que implementa la interfaz <code>SQLData</code>, la única otra cosa que tiene que 
                    hacer es configurar un mapeo personalizado es hacer una entrada en un mapa de tipos. Para el ejemplo, esto 
                    significa introducir el nombre SQL completamente cualificado para el tipo <code>ADDRESS</code> y el objeto 
                    <code>Class</code> para la clase <code>Address</code>. Un mapa de tipos, una instancia de la interfaz 
                    <code>java.util.Map</code>, se asocia con cada nueva conexión cuando se crea, por lo que usa esa. Asumiendo que 
                    <code>con</code> es la conexión activa, el siguiente fragmento de código agrega una entrada para el UDT 
                    <code>ADDRESS</code> al mapa de tipos asociado con <code>con</code>.
                </p>
                <div class="codeblock">
                    <pre>
java.util.Map map = con.getTypeMap();
map.put("SchemaName.ADDRESS", Class.forName("Address"));
con.setTypeMap(map);
                    </pre>
                </div>
                <p>
                    Cada vez que llama al método <code>getObject</code> para recuperar una instancia del tipo <code>ADDRESS</code>, 
                    el controlador comprobará el mapa de tipos asociado con la conexión y ver que tiene una entrada para 
                    <code>ADDRESS</code>. El controlador anotará el objeto <code>Class</code> para la clase <code>Address</code>, 
                    crea una instancia de ella, y hace muchas otras cosas en segundo plano para asignar <code>ADDRESS</code> a 
                    <code>Address</code>. No tiene que hacer nada más que generar la clase para la asignación y entonces hacer una 
                    entrada en un mapa de tipos para permitir que el controlador conozca que hay un mapeo personalizado. El 
                    controlador hará todo el resto.
                </p>
                <p>
                    La situación es similar para almacenar un tipo estructurado que tiene un mapeo personalizado. Cuando llama al 
                    método <code>setObject</code>, el controlador comprobará para ver si el valor que se establece es una instancia 
                    de un clase que implementa la interfaz <code>SQLData</code>. Si esto es así (significando que hay un mapeo 
                    personalizado), el controlador usará la asignación personalizada para convertir el valor a su contrapartida SQL 
                    antes de devolvero a la base de datos. De nuevo, el controlador hace la asignación personalizada detrás de escena; 
                    todo lo que necesita hacer es suplir el método <code>setObject</code> con un parámetro que tiene un mapeo 
                    personalizado. Verá un ejemplo de esto más tarde en esta sección.
                </p>
                <p>
                    Mire la diferencia entre trabajar con la asignación estándar, un objeto <code>Struct</code>, y la asignación 
                    personalizado, una clase en el lenguaje de programación Java. El siguiente fragmento de código muestra la asignación 
                    estandar a un objeto <code>Struct</code>, el cual es la asignación que el controlador usa cuando no hay entrada en 
                    el mapa de tipos de la conexión.
                </p>
                <div class="codeblock">
                    <pre>
ResultSet rs = stmt.executeQuery(
    "SELECT LOCATION " +
    "WHERE STORE_NO = 100003");
rs.next();
Struct address = (Struct)rs.getObject("LOCATION");
                    </pre>
                </div>
                <p>
                    La variable <code>address</code> contiene los valores de atributo siguientes: <code>4344</code>, 
                    <code>&quot;First_Street&quot;</code>, <code>&quot;Verona&quot;</code>, <code>&quot;CA&quot;</code>, 
                    <code>&quot;94545&quot;</code>.
                </p>
                <p>
                    El siguiente fragmento de código muestra qué ocurre cuando hay una entrada para el tipo estructurado 
                    <code>ADDRESS</code> en el mapa de tipos de la conexión. Recuerde que la columna <code>LOCATION</code> almacena 
                    valores del tipo <code>ADDRESS</code>.
                </p>
                <div class="codeblock">
                    <pre>
ResultSet rs = stmt.executeQuery(
    "SELECT LOCATION " +
    "WHERE STORE_NO = 100003");
rs.next();
Address store_3 = (Address)rs.getObject("LOCATION");
                    </pre>
                </div>
                <p>
                    La variable <code>store_3</code> es ahora una instancia de la clase <code>Address</code>, con cada valor de 
                    atributo siendo el valor actual de uno de los campos de <code>Address</code>. Dese cuenta de que debe recordar 
                    convertir el objeto recuperado por el método <code>getObject</code> a un objeto <code>Address</code> antes de 
                    asignarlo a <code>store_3</code>. Dese cuenta de que <code>store_3</code> debe ser un objeto 
                    <code>Address</code>.
                </p>
                <p>
                    Compare trabajar con el objeto <code>Struct</code> a trabajar con la instancia de la clase 
                    <code>Address</code>. Suponga que la tienda se trasladó a una ubicación mejor en la ciudad vecina y, por lo 
                    tanto, debe actualizar la base de datos. Con la asignación personalizada, restaure los campos de 
                    <code>store_3</code>, como en el siguiente fragmento de código:
                </p>
                <div class="codeblock">
                    <pre>
ResultSet rs = stmt.executeQuery(
    "SELECT LOCATION " +
    "WHERE STORE_NO = 100003");
rs.next();
Address store_3 = (Address)rs.getObject("LOCATION");
store_3.num = 1800;
store_3.street = &quot;Artsy_Alley&quot;;
store_3.city = &quot;Arden&quot;;
store_3.state = &quot;CA&quot;;
store_3.zip = &quot;94546&quot;;
PreparedStatement pstmt = con.prepareStatement(
    "UPDATE STORES " +
    "SET LOCATION = ? " +
    "WHERE STORE_NO = 100003");
pstmt.setObject(1, store_3);
pstmt.executeUpdate();
                    </pre>
                </div>
                <p>
                    Los valores en la columna <code>LOCATION</code> son instancias del tipo <code>ADDRESS</code>. El controlador 
                    comprueba el mapa de tipos de la conexión y ve que hay una entrada enlazando <code>ADDRESS</code> con la clase 
                    <code>Address</code> y consecuentemente usa la asignación personalizada indicado en <code>Address</code>. Cuando el 
                    código llama al método <code>setObject</code> con la variable <code><em>store_3</em></code> como el segundo 
                    parámetro, el controlador comprueba y ve que <code><em>store_3</em></code> representa una instancia de la clase 
                    <code>Address</code>, la cual implementa la interfaz <code>SQLData</code> para el tipo estructurado 
                    <code>ADDRESS</code>, y de nuevo automáticamente usa la asignación personalizada.
                </p>
                <p>
                    Sin un mapeo personalizado para <code>ADDRESS</code>, la actualización se parecería más a esto:
                </p>
                <div class="codeblock">
                    <pre>
PreparedStatement pstmt = con.prepareStatement(
    "UPDATE STORES " +
    "SET LOCATION.NUM = 1800, " +
    "LOCATION.STREET = 'Artsy_Alley', " + 
    "LOCATION.CITY = 'Arden', &quot; +
    &quot;LOCATION.STATE = 'CA', &quot; +
    &quot;LOCATION.ZIP = '94546' &quot; +
    &quot;WHERE STORE_NO = 100003&quot;);
pstmt.executeUpdate;
                    </pre>
                </div>
                <h2>
                    <a id="using_your_own_type_map">Uso de su Propio Mapa de Tipos</a>
                </h2>
                <p>
                    Hasta este punto, ha usado sólo el mapa de tipos asociado con una conexión para la asignación personalizada. 
                    Ordinariamente, ese el único mapa de tipos que la mayoría de los programadores usarán. Sin embargo, es también 
                    posible crear un mapa de tipos y pasarlo a ciertos métodos de forma que el controlador usará ese mapa de tipos 
                    en vez del que está asociado con la conexión. Esto permite dos mapeos diferentes para el mismo tipo definido 
                    por el usuario (UDT, en inglés). En realidad, es posible tener múltiples mapeos personalizados para el mismo UDT, 
                    siempre que cada mapeo esté configurado con una clase que implemente la interfaz <code>SQLData</code> y una 
                    entrada en un mapa de tipos. Si no pasa un mapa de tipos a un método que pueda ceptar uno, el controlador 
                    usará de forma predeterminada el mapa de tipos asociado con la conexión.
                </p>
                <p>
                    Hay muy pocas situaciones que requieran el uso de un mapa de tipos que no sea el asociado con una conexión.
                    Podría ser necesario suplir un método con mapa de tipos si, por ejemplo, varios programadores trabajan en una 
                    aplicación JDBC unieron sus componentes y estaban usando la misma conexión. Si dos o más programadores han 
                    creado sus propios mapeos personalizados para el mismo UDT de DQL, cada uno necesitaría suplir su propio mapa 
                    de tipos, para sobreescribir el mapa de tipos de la conexión.
                </p>
            </div>
            <div class="NavBit">
                <a target="_top" href="sqlstructured.html">&laquo;&nbsp;Anterior</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="../TOC.html">TdC</a>&nbsp;&bull;&nbsp;
                <a target="_top" href="sqldatalink.html">Siguiente&nbsp;&raquo;</a>
            </div>
        </div>
        <hr class="clearfloat"/>
        <div id="Footer">
            <table style="width: 100%;padding: 5px">
                <tr>
                    <td>
                        <p class="footertext">
                            <a id="license_info">Su uso de ésta</a> página y todo el material en las páginas bajo el anuncio
                            &quot;Los Tutoriales de Java&quot; está sujeto a estos <a href="../../information/cpyr.html">avisos
                                legales</a>.
                        </p>
                        <p class="footertext">
                            Copyright &copy; 1995, 2015 Oracle y/o sus afiliados. Todos los derechos reservados.
                        </p>
                    </td>
                    <td style="text-align: right">
                        <p class="footertext">
                            ¿Problemas con estos ejemplos? Intente
                            <a target="_blank" href="../../information/run-examples.html">Compilando y Ejecutando los Ejemplos: PFs
                            </a>.
                        </p>
                        <p class="footertext">
                            ¿Quejas? ¿Elogios? ¿Sugerencias? <a target="_blank" href="https://docs.oracle.com/javase/feedback.html">
                                Denos su opinión</a>.
                        </p>
                    </td>
                </tr>
            </table>
        </div>
        <div class="PrintHeaders">
            <b>Página anterior:</b> Utilizando Objetos Estructurados<br />
            <b>Página siguiente:</b> Utilizando Objetos Datalink
        </div>
    </body>
</html> 
