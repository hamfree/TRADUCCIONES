<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <title>Escritura de Aplicaciones JMS Simples</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
    <table id="doc-title" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top">
          <b>Plataforma Java, Edición Empresarial (Java EE) 8</b><br />
          <b>El Tutorial de Java EE</b>
        </td>
      </tr>
    </table>
    <hr />
    <table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>
        <td align="left">
          <a href="jms-examples002.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="jms-examples004.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <div class="sect1" id="BNCFA">
      <h2 id="writing-simple-jms-applications">Escritura de Aplicaciones JMS Simples</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>
            Esta sección muestra cómo crear, empaquetar y ejecutar clientes JMS simples que se empaquetan como 
            clientes de aplicaciones.
          </p>
        </div>
        <div class="paragraph">
          <p>Aquí se tratan los siguientes temas:</p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p><a href="#CHDCEFGA">Descripción General de la Escritura de una Aplicación JMS Simple</a></p>
            </li>
            <li>
              <p><a href="#BNCFD">Inicio del Proveedor JMS</a></p>
            </li>
            <li>
              <p><a href="#GKTJS">Creación de Objetos Administrados JMS</a></p>
            </li>
            <li>
              <p><a href="#BABEEABE">Construyendo Todos los Ejemplos Simples</a></p>
            </li>
            <li>
              <p><a href="#BABIHCAE">Enviando mensajes</a></p>
            </li>
            <li>
              <p><a href="#BNCFB">Recepción de Mensajes Sincrónicamente</a></p>
            </li>
            <li>
              <p>
                <a href="#BNCFH">Uso de un Detector de Mensajes para la Entrega Asincrónica de Mensajes</a>
              </p>
            </li>
            <li>
              <p><a href="#BNCFL">Exploración de Mensajes en una Cola</a></p>
            </li>
            <li>
              <p><a href="#BABDDHHC">Ejecución de Múltiples Consumidores en el Mismo Destino</a></p>
            </li>
            <li>
              <p><a href="#BNCFX">Confirmación de Mensajes</a></p>
            </li>
          </ul>
        </div>
        <div class="sect2" id="CHDCEFGA">
          <h3 id="overview-of-writing-simple-jms-application">
            Descripción General de la Escritura de una Aplicación JMS Simple
          </h3>
          <div class="paragraph">
            <p>
              Los clientes demuestran las tareas básicas que debe realizar una aplicación JMS:
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>Crear un <code>JMSContext</code></p>
              </li>
              <li>
                <p>Creación de productores y consumidores de mensajes.</p>
              </li>
              <li>
                <p>Enviar y recibir mensajes</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>
              Cada ejemplo utiliza dos clientes: uno que envía mensajes y otro que los recibe. Puede ejecutar 
              los clientes en dos ventanas de terminal.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Cuando escribe un cliente JMS para ejecutarlo en una aplicación de enterprise bean, utiliza 
              muchos de los mismos métodos en la misma secuencia que para una aplicación cliente. Sin embargo, 
              hay algunas diferencias significativas. 
              <a href="jms-concepts005.html#BNCGL">Uso de la IPA de JMS en Aplicaciones de Java EE</a> 
              describe estas diferencias, y este capítulo proporciona ejemplos que las ilustran.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Los ejemplos de esta sección se encuentran en el directorio 
              <code><em>tut-install</em>/examples/jms/simple/</code>, en los siguientes subdirectorios:
            </p>
          </div>
          <div class="paragraph">
            <p>
              <code>producer/</code><br>
              <code>synchconsumer/</code><br>
              <code>asynchconsumer/</code><br>
              <code>messagebrowser/</code><br>
              <code>clientackconsumer/</code><br>
            </p>
          </div>
          <div class="paragraph">
            <p>
              Antes de ejecutar los ejemplos, debe iniciar el servidor GlassFish y crear objetos 
              administrados.
            </p>
          </div>
        </div>
        <div class="sect2" id="BNCFD">
          <h3 id="starting-the-jms-provider">Inicio del Proveedor JMS</h3>
          <div class="paragraph">
            <p>
              Cuando usa el servidor GlassFish, su proveedor JMS es el servidor GlassFish. Inicie el servidor 
              como se describe en 
              <a href="usingexamples002.html#BNADI">Arrancando y Parando el Servidor GlassFish</a>.
            </p>
          </div>
        </div>
        <div class="sect2" id="GKTJS">
          <h3 id="creating-jms-administered-objects">Creación de Objetos Administrados JMS</h3>
          <div class="paragraph">
            <p>
              Este ejemplo utiliza los siguientes objetos administrados por JMS:
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>Una fábrica de conexiones</p>
              </li>
              <li>
                <p>Dos recursos de destino: un tema y una cola</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>
              Antes de ejecutar las aplicaciones, puede usar el comando <code>asadmin add-resources</code> 
              para crear los recursos JMS necesarios, especificando como argumento un archivo llamado 
              <code>glassfish-resources.xml</code>. Este archivo se puede crear en cualquier proyecto usando 
              el EID de NetBeans, aunque también se puede crear a mano. Un archivo para los recursos 
              necesarios está presente en el directorio <code>jms/simple/producer/src/main/setup/</code>.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Los ejemplos de JMS utilizan una fábrica de conexiones con el nombre de búsqueda JNDI lógico 
              <code>java:comp/DefaultJMSConnectionFactory</code>, que está preconfigurado en el servidor 
              GlassFish.
            </p>
          </div>
          <div class="paragraph">
            <p>
              También puede usar el comando <code>asadmin create-jms-resource</code> para crear recursos, el 
              comando <code>asadmin list-jms-resources</code> para mostrar sus nombres y el comando 
              <code>asadmin delete -jms-resource</code> para eliminarlos.
            </p>
          </div>
          <div class="sect3" id="BABHEFCB">
            <h4 id="to-create-resources-for-the-simple-examples">
              Para Crear Recursos para los Ejemplos Simples
            </h4>
            <div class="paragraph">
              <p>
                Un archivo <code>glassfish-resources.xml</code> en uno de los proyectos de Maven puede crear 
                todos los recursos necesarios para los ejemplos simples.
              </p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>
                    Asegúrese de que el servidor GlassFish se haya iniciado (consulte 
                    <a href="usingexamples002.html#BNADI">Arrancando y Parando el Servidor GlassFish</a>).
                  </p>
                </li>
                <li>
                  <p>En una ventana de comandos, vaya al ejemplo de <code>Producer</code>.</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
cd tut-install/jms/simple/producer
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Cree los recursos usando el comando <code>asadmin add-resources</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
asadmin add-resources src/main/setup/glassfish-resources.xml
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Verifique la creación de los recursos:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
asadmin list-jms-resources
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      El comando enumera los dos destinos y la fábrica de conexiones especificados en el 
                      archivo <code>glassfish-resources.xml</code> además de la fábrica de conexiones 
                      predeterminada de la plataforma:
                    </p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
jms/MyQueue
jms/MyTopic
jms/__defaultConnectionFactory
Command list-jms-resources executed successfully.
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      En el servidor GlassFish, el recurso Java EE 
                      <code>java:comp/DefaultJMSConnectionFactory</code> se asigna a una fábrica de conexiones 
                      denominada <code>jms/__defaultConnectionFactory</code>.
                    </p>
                  </div>
                </li>
              </ol>
            </div>
          </div>
        </div>
        <div class="sect2" id="BABEEABE">
          <h3 id="building-all-the-simple-examples">Construyendo Todos los Ejemplos Simples</h3>
          <div class="paragraph">
            <p>
              Para ejecutar los ejemplos simples con el servidor GlassFish, empaquete cada ejemplo en un 
              archivo JAR de aplicación cliente. El archivo JAR de la aplicación cliente requiere un archivo 
              de manifiesto, ubicado en el directorio <code>src/main/java/META-INF/</code> para cada ejemplo, 
              junto con el archivo <code>.class</code>.
            </p>
          </div>
          <div class="paragraph">
            <p>
              El archivo <code>pom.xml</code> para cada ejemplo especifica un complemento que crea un archivo 
              JAR de cliente de aplicación. Puede compilar los ejemplos utilizando el EID de NetBeans o Maven.
            </p>
          </div>
          <div class="paragraph">
            <p>Aquí se tratan los siguientes temas:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>
                  <a href="#CHDJEJCD">Para Construir Todos los Ejemplos Simples Usando el EID NetBeans</a>
                </p>
              </li>
              <li>
                <p><a href="#CHDGHJAA">Para Construir Todos los Ejemplos Simples Usando Maven</a></p>
              </li>
            </ul>
          </div>
          <div class="sect3" id="CHDJEJCD">
            <h4 id="to-build-all-the-simple-examples-using-netbeans-ide">
              Para Construir Todos los Ejemplos Simples Usando el EID NetBeans
            </h4>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>En el menú Archivo, elija Abrir proyecto.</p>
                </li>
                <li>
                  <p>En el cuadro de diálogo Abrir proyecto, vaya a:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
tut-install/examples/jms
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Expanda el nodo <code>jms</code> y seleccione la carpeta <code>simple</code>.</p>
                </li>
                <li>
                  <p>Haga clic en Abrir proyecto para abrir todos los ejemplos simples.</p>
                </li>
                <li>
                  <p>
                    En la pestaña Proyectos, haga clic con el botón derecho en el proyecto <code>simple</code> 
                    y seleccione Generar para compilar todos los ejemplos.
                  </p>
                  <div class="paragraph">
                    <p>
                      Este comando coloca los archivos JAR del cliente de la aplicación en los directorios 
                      <code>target</code> para los ejemplos.
                    </p>
                  </div>
                </li>
              </ol>
            </div>
          </div>
          <div class="sect3" id="CHDGHJAA">
            <h4 id="to-build-all-the-simple-examples-using-maven">
              Para Construir Todos los Ejemplos Simples Usando Maven
            </h4>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>En una ventana de terminal, vaya al directorio <code>simple</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
cd tut-install/jms/simple/
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Ingrese el siguiente comando para compilar todos los proyectos:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
mvn install
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      Este comando coloca los archivos JAR del cliente de la aplicación en los directorios 
                      <code>target</code> para los ejemplos.
                    </p>
                  </div>
                </li>
              </ol>
            </div>
          </div>
        </div>
        <div class="sect2" id="BABIHCAE">
          <h3 id="sending-messages">Enviando mensajes</h3>
          <div class="paragraph">
            <p>
              Esta sección describe cómo usar un cliente para enviar mensajes. El cliente 
              <code>Producer.java</code> enviará mensajes en todos estos ejemplos.
            </p>
          </div>
          <div class="paragraph">
            <p>Aquí se tratan los siguientes temas:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p><a href="#CHDGHJHH">Pasos Generales Realizados en el Ejemplo</a></p>
              </li>
              <li>
                <p><a href="#CHDFBABB">El Cliente Producer.java</a></p>
              </li>
              <li>
                <p><a href="#CHDHIIHE">Para Ejecutar el Cliente Producer</a></p>
              </li>
            </ul>
          </div>
          <div class="sect3" id="CHDGHJHH">
            <h4 id="general-steps-performed-in-the-example">Pasos Generales Realizados en el Ejemplo</h4>
            <div class="paragraph">
              <p>Los pasos generales que realiza este ejemplo son los siguientes.</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>Inyecte recursos para los objetos administrados utilizados por el ejemplo.</p>
                </li>
                <li>
                  <p>
                    Acepte y verifique los argumentos de la línea de comandos. Puede usar este ejemplo para 
                    enviar cualquier cantidad de mensajes a una cola o a un tema, de modo que especifique el 
                    tipo de destino y la cantidad de mensajes en la línea de comandos cuando ejecute el 
                    programa.
                  </p>
                </li>
                <li>
                  <p>
                    Cree un <code>JMSContext</code>, luego envíe la cantidad especificada de mensajes de texto 
                    en forma de cadenas, como se describe en 
                    <a href="jms-concepts003.html#BNCEW">Cuerpos del Mensaje</a>.
                  </p>
                </li>
                <li>
                  <p>
                    Envíe un mensaje final de tipo <code>Message</code> para indicar que el consumidor no debe 
                    esperar más mensajes.
                  </p>
                </li>
                <li>
                  <p>Capture cualquier excepción.</p>
                </li>
              </ol>
            </div>
          </div>
          <div class="sect3" id="CHDFBABB">
            <h4 id="the-producer.java-client">El Cliente Producer.java</h4>
            <div class="paragraph">
              <p>
                El cliente de envío, <code>Producer.java</code>, realiza los siguientes pasos.
              </p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>Inyecta recursos para una fábrica de conexiones, una cola y un tema:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
@Resource(lookup = "java:comp/DefaultJMSConnectionFactory")
private static ConnectionFactory connectionFactory;
@Resource(lookup = "jms/MyQueue")
private static Queue queue;
@Resource(lookup = "jms/MyTopic")
private static Topic topic;
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Recupera y verifica los argumentos de la línea de comandos que especifican el tipo de 
                    destino y la cantidad de argumentos:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
final int NUM_MSGS;
String destType = args[0];
System.out.println("Destination type is " + destType);
if ( ! ( destType.equals("queue") || destType.equals("topic") ) ) {
    System.err.println("Argument must be \"queue\" or " + "\"topic\"");
    System.exit(1);
}
if (args.length == 2){
    NUM_MSGS = (new Integer(args[1])).intValue();
} else {
    NUM_MSGS = 1;
}
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Asigna la cola o el tema a un objeto de destino, según el tipo de destino especificado:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Destination dest = null;
try {
    if (destType.equals("queue")) {
        dest = (Destination) queue;
    } else {
        dest = (Destination) topic;
    }
} catch (Exception e) {
    System.err.println("Error setting destination: " + e.toString());
    System.exit(1);
}
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Dentro de un bloque <code>try</code>-with-resources, crea un <code>JMSContext</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
try (JMSContext context = connectionFactory.createContext();) {
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Establece el recuento de mensajes en cero, luego crea un <code>JMSProducer</code> y envía 
                    uno o más mensajes al destino e incrementa el recuento. Los mensajes en forma de cadenas 
                    son del tipo de mensaje <code>TextMessage</code>:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
    int count = 0;
    for (int i = 0; i &lt; NUM_MSGS; i++) {
        String message = "Este es el mensaje " + (i + 1)
                + "del productor";
        // Comenta la siguiente línea para enviar muchos mensajes.
        System.out.println("Enviando mensaje: " + message);
        context.createProducer().send(dest, message);
        count += 1;
    }
    System.out.println("Mensajes de texto enviados: " + count);
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Envía un mensaje de control vacío para indicar el final del flujo de mensajes:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
    context.createProducer().send(dest, context.createMessage());
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      Enviar un mensaje vacío sin un tipo específico es una forma conveniente para que una 
                      aplicación indique al consumidor que ha llegado el mensaje final.
                    </p>
                  </div>
                </li>
                <li>
                  <p>
                    Atrapa y maneja cualquier excepción. El final del bloque <code>try</code>-with-resources 
                    hace que <code>JMSContext</code> se cierre automáticamente:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
} catch (Exception e) {
    System.err.println("Ocurrió una excepción: " + e.toString());
    System.exit(1);
}
System.exit(0);
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
              </ol>
            </div>
          </div>
          <div class="sect3" id="CHDHIIHE">
            <h4 id="to-run-the-producer-client">Para Ejecutar el Cliente Producer</h4>
            <div class="paragraph">
              <p>
                Puede ejecutar el cliente usando el comando <code>appclient</code>. El cliente 
                <code>Producer</code> toma uno o dos argumentos de la línea de comandos: un tipo de destino y, 
                opcionalmente, una cantidad de mensajes. Si no especifica una cantidad de mensajes, el cliente 
                envía un mensaje.
              </p>
            </div>
            <div class="paragraph">
              <p>Utilizará el cliente para enviar tres mensajes a una cola.</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>
                    Asegúrese de que se haya iniciado el servidor GlassFish 
                    (consulte <a href="usingexamples002.html#BNADI">
                      Arrancando y Parando el Servidor GlassFish</a>) y que haya creado recursos y compilado 
                    los ejemplos JMS simples (consulte 
                    <a href ="#GKTJS">Creación de Objetos Administrados JMS</a> y 
                    <a href="#BABEEABE">Construyendo Todos los Ejemplos Simples</a>).
                  </p>
                </li>
                <li>
                  <p>En una ventana de terminal, vaya al directorio <code>producer</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
cd producer
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Ejecute el programa <code>Producer</code>, enviando tres mensajes a la cola:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/producer.jar queue 3
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>La salida del programa se ve así (junto con alguna salida adicional):</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Destination type is queue
Sending message: This is message 1 from producer
Sending message: This is message 2 from producer
Sending message: This is message 3 from producer
Text messages sent: 3
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>Los mensajes están ahora en la cola, esperando ser recibidos.</p>
                  </div>
                  <table class="tableblock frame-all grid-all spread">
                    <colgroup>
                      <col style="width: 100%;">
                    </colgroup>
                    <tbody>
                      <tr>
                        <td class="tableblock halign-left valign-top">
                          <div>
                            <div class="paragraph">
                              <p><strong>Nota</strong>:</p>
                            </div>
                            <div class="paragraph">
                              <p>
                                Cuando ejecuta un cliente de aplicación, el comando puede tardar mucho tiempo 
                                en completarse.
                              </p>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </li>
              </ol>
            </div>
          </div>
        </div>
        <div class="sect2" id="BNCFB">
          <h3 id="receiving-messages-synchronously">Recepción de Mensajes Sincrónicamente</h3>
          <div class="paragraph">
            <p>
              Esta sección describe el cliente receptor, que utiliza el método <code>receive</code> para 
              consumir mensajes sincrónicamente. Esta sección luego explica cómo ejecutar los clientes 
              utilizando el servidor GlassFish.
            </p>
          </div>
          <div class="paragraph">
            <p>Aquí se tratan los siguientes temas:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p><a href="#BNCFC">El Cliente SynchConsumer.java</a></p>
              </li>
              <li>
                <p><a href="#BNCFG">Para Ejecutar los Clientes SynchConsumer y Producer</a></p>
              </li>
            </ul>
          </div>
          <div class="sect3" id="BNCFC">
            <h4 id="the-synchconsumer.java-client">El Cliente SynchConsumer.java</h4>
            <div class="paragraph">
              <p>El cliente receptor, <code>SynchConsumer.java</code>, realiza los siguientes pasos.</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>Inyecta recursos para una fábrica de conexiones, una cola y un tema.</p>
                </li>
                <li>
                  <p>
                    Asigna la cola o el tema a un objeto de destino, según el tipo de destino especificado.
                  </p>
                </li>
                <li>
                  <p>Dentro de un bloque <code>try</code>-with-resources, crea un <code>JMSContext</code>.</p>
                </li>
                <li>
                  <p>Crea un <code>JMSConsumer</code>, iniciando la entrega del mensaje:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
consumer = context.createConsumer(dest);
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Recibe los mensajes enviados al destino hasta que se recibe el mensaje de control de fin 
                    de flujo de mensajes:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
int count = 0;
while (true) {
    Message m = consumer.receive(1000);
    if (m != null) {
        if (m instanceof TextMessage) {
            System.out.println(
                    "Reading message: " + m.getBody(String.class));
            count += 1;
        } else {
            break;
        }
    }
}
System.out.println("Messages received: " + count);
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      Debido a que el mensaje de control no es un <code>TextMessage</code>, el cliente 
                      receptor finaliza el ciclo <code>while</code> y deja de recibir mensajes después de que 
                      llega el mensaje de control.
                    </p>
                  </div>
                </li>
                <li>
                  <p>
                    Atrapa y maneja cualquier excepción. El final del bloque <code>try</code>-with-resources 
                    hace que <code>JMSContext</code> se cierre automáticamente.
                  </p>
                </li>
              </ol>
            </div>
            <div class="paragraph">
              <p>
                El cliente <code>SynchConsumer</code> usa un bucle indefinido <code>while</code> para recibir 
                mensajes, llamando a <code>receive</code> con un argumento de tiempo de espera.
              </p>
            </div>
          </div>
          <div class="sect3" id="BNCFG">
            <h4 id="to-run-the-synchconsumer-and-producer-clients">
              Para Ejecutar los Clientes SynchConsumer y Producer
            </h4>
            <div class="paragraph">
              <p>
                Puede ejecutar el cliente usando el comando <code>appclient</code>. El cliente 
                <code>SynchConsumer</code> toma un argumento de la línea de comandos, el tipo de destino. type.
              </p>
            </div>
            <div class="paragraph">
              <p>
                Estos pasos muestran cómo recibir y enviar mensajes sincrónicamente usando una cola y un tema. 
                Los pasos asumen que ya ejecutó el cliente <code>Producer</code> y tiene tres mensajes 
                esperando en la cola.
              </p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>
                    En la misma ventana de terminal donde ejecutó <code>Producer</code>, vaya al 
                    directorio <code>synchconsumer</code>:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
cd ../synchconsumer
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Ejecute el cliente <code>SynchConsumer</code>, especificando la cola:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/synchconsumer.jar queue
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>La salida del cliente se ve así (junto con alguna salida adicional):</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Destination type is queue
Reading message: This is message 1 from producer
Reading message: This is message 2 from producer
Reading message: This is message 3 from producer
Messages received: 3
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Ahora intente ejecutar los clientes en el orden opuesto. Ejecute el cliente 
                    <code>SynchConsumer</code>:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/synchconsumer.jar queue
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>El cliente muestra el tipo de destino y luego espera los mensajes.</p>
                  </div>
                </li>
                <li>
                  <p>Abra una nueva ventana de terminal y ejecute el cliente <code>Producer</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
cd tut-install/jms/simple/producer
appclient -client target/producer.jar queue 3
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      Cuando se han enviado los mensajes, el cliente <code>SynchConsumer</code> los recibe y 
                      sale.
                    </p>
                  </div>
                </li>
                <li>
                  <p>
                    Ahora ejecute el cliente <code>Producer</code> utilizando un tema en lugar de una cola:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/producer.jar topic 3
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>La salida del cliente se ve así (junto con alguna salida adicional):</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Destination type is topic
Sending message: This is message 1 from producer
Sending message: This is message 2 from producer
Sending message: This is message 3 from producer
Text messages sent: 3
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Ahora, en la otra ventana de terminal, ejecute el cliente <code>SynchConsumer</code> 
                    utilizando el tema:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/synchconsumer.jar topic
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      El resultado, sin embargo, es diferente. Debido a que está utilizando una suscripción 
                      sobre un tema, los mensajes que se enviaron antes de crear la suscripción sobre el tema 
                      no se agregarán a la suscripción ni se entregarán al consumidor. (Ver 
                      <a href="jms-concepts002.html#BNCED">Estilo de Mensajería de Publicación/Suscripción</a> 
                      y <a href="jms-concepts003.html#BABEEJJJ">Consumir Mensajes desde los Temas</a> para 
                      más detalles). En lugar de recibir los mensajes, el cliente espera a que lleguen los 
                      mensajes.
                    </p>
                  </div>
                </li>
                <li>
                  <p>
                    Deje el cliente <code>SynchConsumer</code> ejecutándose y vuelva a ejecutar el cliente 
                    <code>Producer</code>:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/producer.jar topic 3
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>Ahora el cliente <code>SynchConsumer</code> recibe los mensajes:</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Destination type is topic
Reading message: This is message 1 from producer
Reading message: This is message 2 from producer
Reading message: This is message 3 from producer
Messages received: 3
                      </code></pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      Debido a que estos mensajes se enviaron después de que se inició el consumidor, el 
                      cliente los recibe.
                    </p>
                  </div>
                </li>
              </ol>
            </div>
          </div>
        </div>
        <div class="sect2" id="BNCFH">
          <h3 id="using-a-message-listener-for-asynchronous-message-delivery">
            Uso de un Detector de Mensajes para la Entrega Asincrónica de Mensajes
          </h3>
          <div class="paragraph">
            <p>
              Esta sección describe los clientes receptores en un ejemplo que utiliza un detector de mensajes 
              para la entrega de mensajes asincrónicos. Esta sección luego explica cómo compilar y ejecutar 
              los clientes utilizando el servidor GlassFish.
            </p>
          </div>
          <table class="tableblock frame-all grid-all spread">
            <colgroup>
              <col style="width: 100%;">
            </colgroup>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p><strong>Nota</strong>:</p>
                    </div>
                    <div class="paragraph">
                      <p>
                        En la plataforma Java EE, los detectores de mensajes solo se pueden usar en clientes 
                        de aplicaciones, como en este ejemplo. Para permitir la entrega de mensajes 
                        asincrónicos en una aplicación web o de enterprise beans, utilice un bean controlado 
                        por mensajes, que se muestra en ejemplos posteriores de este capítulo.
                      </p>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>Aquí se tratan los siguientes temas:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p><a href="#BNCFI">Escritura de los Clientes AsynchConsumer.java y TextListener.java</a></p>
              </li>
              <li>
                <p><a href="#BNCFK">Para Ejecutar los Clientes AsynchConsumer y Producer</a></p>
              </li>
            </ul>
          </div>
          <div class="sect3" id="BNCFI">
            <h4 id="writing-the-asynchconsumer.java-and-textlistener.java-clients">
              Escritura de los Clientes AsynchConsumer.java y TextListener.java
            </h4>
            <div class="paragraph">
              <p>
                El cliente de envío es <code>Producer.java</code>, el mismo cliente utilizado en 
                <a href="#BABIHCAE">Enviando mensajes</a> y 
                <a href="#BNCFB">Recepción de Mensajes Sincrónicamente</a>.
              </p>
            </div>
            <div class="paragraph">
              <p>
                Un consumidor asíncrono normalmente se ejecuta indefinidamente. Este se ejecuta hasta que el 
                usuario escribe el carácter <code>q</code> o <code>Q</code> para detener el cliente.
              </p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>El cliente, <code>AsynchConsumer.java</code>, realiza los siguientes pasos.</p>
                </li>
                <li>
                  <p>Inyecta recursos para una fábrica de conexiones, una cola y un tema.</p>
                </li>
                <li>
                  <p>
                    Asigna la cola o el tema a un objeto de destino, según el tipo de destino especificado.
                  </p>
                </li>
                <li>
                  <p>En un bloque <code>try</code>-with-resources, crea un <code>JMSContext</code>.</p>
                </li>
                <li>
                  <p>Crea un <code>JMSConsumer</code>.</p>
                </li>
                <li>
                  <p>
                    Crea una instancia de la clase <code>TextListener</code> y la registra como detector de 
                    mensajes para <code>JMSConsumer</code>:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
listener = new TextListener();
consumer.setMessageListener(listener);
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Escucha los mensajes enviados al destino, deteniéndose cuando el usuario escribe el 
                    carácter <code>q</code> o <code>Q</code> (utiliza un 
                    <code>java.io.InputStreamReader</code> para hacer esto).
                  </p>
                </li>
                <li>
                  <p>
                    Atrapa y maneja cualquier excepción. El final del bloque <code>try</code>-with-resources 
                    hace que el <code>JMSContext</code> se cierre automáticamente, lo que detiene la entrega 
                    de mensajes al oyente de mensajes.
                  </p>
                </li>
                <li>
                  <p>El detector de mensajes, <code>TextListener.java</code>, sigue estos pasos:</p>
                </li>
                <li>
                  <p>Cuando llega un mensaje, el método <code>onMessage</code> se llama automáticamente.</p>
                </li>
                <li>
                  <p>
                    Si el mensaje es un <code>TextMessage</code>, el método <code>onMessage</code> muestra su 
                    contenido como un valor de cadena. Si el mensaje no es un mensaje de texto, informa de 
                    este hecho:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
public void onMessage(Message m) {
    try {
        if (m instanceof TextMessage) {
            System.out.println(
                    "Reading message: " + m.getBody(String.class));
        } else {
             System.out.println("Message is not a TextMessage");
        }
    } catch (JMSException | JMSRuntimeException e) {
        System.err.println("JMSException in onMessage(): " + e.toString());
    }
}
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
              </ol>
            </div>
            <div class="paragraph">
              <p>
                Para este ejemplo, utilizará la misma fábrica de conexiones y destinos que creó en 
                <a href="#BABHEFCB">Para Crear Recursos para los Ejemplos Simples</a>.
              </p>
            </div>
            <div class="paragraph">
              <p>
                Los pasos asumen que ya ha creado y empaquetado todos los ejemplos utilizando el EID de 
                NetBeans o Maven.
              </p>
            </div>
          </div>
          <div class="sect3" id="BNCFK">
            <h4 id="to-run-the-asynchconsumer-and-producer-clients">
              Para Ejecutar los Clientes AsynchConsumer y Producer
            </h4>
            <div class="paragraph">
              <p>
                Necesitarás dos ventanas de terminal, como hizo en 
                <a href="#BNCFB">Recepción de Mensajes Sincrónicamente</a>.
              </p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>
                    En la ventana de terminal donde ejecutó el cliente <code>SynchConsumer</code>, vaya al 
                    directorio de ejemplo <code>asynchconsumer</code>:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
cd tut-install/jms/simple/asynchconsumer
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Ejecute el cliente <code>AsynchConsumer</code>, especificando el tipo de destino 
                    <code>topic</code>:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/asynchconsumer.jar topic
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      El cliente muestra las siguientes líneas (junto con algunos resultados adicionales) y 
                      luego espera los mensajes:
                    </p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Destination type is topic
To end program, enter Q or q, then &lt;return&gt;
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    En la ventana de terminal donde ejecutó el cliente <code>Producer</code> anteriormente, 
                    vuelva a ejecutar el cliente y envíe tres mensajes:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/producer.jar topic 3
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>La salida del cliente se ve así (junto con alguna salida adicional):</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Destination type is topic
Sending message: This is message 1 from producer
Sending message: This is message 2 from producer
Sending message: This is message 3 from producer
Text messages sent: 3
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      En la otra ventana, el cliente <code>AsynchConsumer</code> muestra lo siguiente (junto 
                      con algunos resultados adicionales):
                    </p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Destination type is topic
To end program, enter Q or q, then &lt;return&gt;
Reading message: This is message 1 from producer
Reading message: This is message 2 from producer
Reading message: This is message 3 from producer
Message is not a TextMessage
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      La última línea aparece porque el cliente ha recibido el mensaje de control que no es de 
                      texto enviado por el cliente <code>Producer</code>.
                    </p>
                  </div>
                </li>
                <li>
                  <p>
                    Ingrese <code>Q</code> o <code>q</code> y presione Return para detener el cliente 
                    <code>AsynchConsumer</code>.
                  </p>
                </li>
                <li>
                  <p>Ahora ejecuta los clientes usando una cola.</p>
                  <div class="paragraph">
                    <p>
                      En este caso, como en el ejemplo síncrono, puede ejecutar primero el cliente 
                      <code>Producer</code>, porque no hay dependencia de tiempo entre el remitente y el 
                      receptor:
                    </p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/producer.jar queue 3
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>La salida del cliente se ve así:</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Destination type is queue
Sending message: This is message 1 from producer
Sending message: This is message 2 from producer
Sending message: This is message 3 from producer
Text messages sent: 3
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>En la otra ventana, ejecute el cliente <code>AsynchConsumer</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/asynchconsumer.jar queue
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>La salida del cliente se ve así (junto con alguna salida adicional):</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Destination type is queue
To end program, enter Q or q, then &lt;return&gt;
Reading message: This is message 1 from producer
Reading message: This is message 2 from producer
Reading message: This is message 3 from producer
Message is not a TextMessage
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Ingrese <code>Q</code> o <code>q</code> y presione Return para detener el cliente.</p>
                </li>
              </ol>
            </div>
          </div>
        </div>
        <div class="sect2" id="BNCFL">
          <h3 id="browsing-messages-on-a-queue">Exploración de Mensajes en una Cola</h3>
          <div class="paragraph">
            <p>
              Esta sección describe un ejemplo que crea un objeto <code>QueueBrowser</code> para examinar 
              mensajes en una cola, como se describe en 
              <a href="jms-concepts003.html#BNCEY">Navegadores de la Cola de JMS</a >. Luego, esta sección 
              explica cómo compilar, empaquetar y ejecutar el ejemplo usando el servidor GlassFish.
            </p>
          </div>
          <div class="paragraph">
            <p>Aquí se tratan los siguientes temas:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p><a href="#BNCFM">El Cliente MessageBrowser.java</a></p>
              </li>
              <li>
                <p><a href="#BNCFN">Para Ejecutar el Cliente QueueBrowser</a></p>
              </li>
            </ul>
          </div>
          <div class="sect3" id="BNCFM">
            <h4 id="the-messagebrowser.java-client">El Cliente MessageBrowser.java</h4>
            <div class="paragraph">
              <p>
                Para crear un <code>QueueBrowser</code> para una cola, llame al método 
                <code>JMSContext.createBrowser</code> con la cola como argumento. Obtiene los mensajes en la 
                cola como un objeto <code>Enumeration</code>. Luego puede iterar a través del objeto 
                <code>Enumeration</code> y mostrar el contenido de cada mensaje.
              </p>
            </div>
            <div class="paragraph">
              <p>El cliente <code>MessageBrowser.java</code> realiza los siguientes pasos.</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>Inyecta recursos para una fábrica de conexiones y una cola.</p>
                </li>
                <li>
                  <p>En un bloque <code>try</code>-with-resources, crea un <code>JMSContext</code>.</p>
                </li>
                <li>
                  <p>Crea un <code>QueueBrowser</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
QueueBrowser browser = context.createBrowser(queue);
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Recupera la <code>Enumeration</code> que contiene los mensajes:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Enumeration msgs = browser.getEnumeration();
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Verifica que <code>Enumeration</code> contiene mensajes, luego muestra el contenido de los 
                    mensajes:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
if ( !msgs.hasMoreElements() ) {
    System.out.println("No messages in queue");
} else {
    while (msgs.hasMoreElements()) {
        Message tempMsg = (Message)msgs.nextElement();
        System.out.println("Message: " + tempMsg);
    }
}
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Atrapa y maneja cualquier excepción. El final del bloque <code>try</code>-with-resources 
                    hace que <code>JMSContext</code> se cierre automáticamente.
                  </p>
                </li>
              </ol>
            </div>
            <div class="paragraph">
              <p>
                Volcar el contenido del mensaje a la salida estándar recupera el cuerpo y las propiedades del 
                mensaje en un formato que depende de la implementación del método <code>toString</code>. En el 
                servidor GlassFish, el formato del mensaje se ve así:
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="prettyprint highlight">
                  <code class="language-oac_no_warn" data-lang="oac_no_warn">
Text:   This is message 3 from producer
Class:                  com.sun.messaging.jmq.jmsclient.TextMessageImpl
getJMSMessageID():      ID:8-10.152.23.26(bf:27:4:e:e7:ec)-55645-1363100335526
getJMSTimestamp():      1129061034355
getJMSCorrelationID():  null
JMSReplyTo:             null
JMSDestination:         PhysicalQueue
getJMSDeliveryMode():   PERSISTENT
getJMSRedelivered():    false
getJMSType():           null
getJMSExpiration():     0
getJMSPriority():       4
Properties:             {JMSXDeliveryCount=0}
                  </code>
                </pre>
              </div>
            </div>
            <div class="paragraph">
              <p>
                En lugar de mostrar el contenido del mensaje de esta manera, puede llamar a algunos de los 
                métodos captadores de la interfaz <code>Message</code> para recuperar las partes del mensaje 
                que desea ver.
              </p>
            </div>
            <div class="paragraph">
              <p>
                Para este ejemplo, utilizará la fábrica de conexiones y la cola que creó para 
                <a href="#BNCFB">Recepción de Mensajes Sincrónicamente</a>. Se supone que ya ha creado y 
                empaquetado todos los ejemplos.
              </p>
            </div>
          </div>
          <div class="sect3" id="BNCFN">
            <h4 id="to-run-the-queuebrowser-client">Para Ejecutar el Cliente QueueBrowser</h4>
            <div class="paragraph">
              <p>
                Para ejecutar el ejemplo de <code>MessageBrowser</code> usando el comando 
                <code>appclient</code>, sigue estos pasos.
              </p>
            </div>
            <div class="paragraph">
              <p>
                También necesita el ejemplo de <code>Producer</code> para enviar el mensaje a la cola y uno de 
                los clientes consumidores para consumir los mensajes después de inspeccionarlos.
              </p>
            </div>
            <div class="paragraph">
              <p>Para ejecutar los clientes, necesita dos ventanas de terminal.</p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>En una ventana de terminal, vaya al directorio <code>producer</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
cd tut-install/examples/jms/simple/producer/
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Ejecute el cliente <code>Producer</code>, enviando un mensaje a la cola, junto con el 
                    mensaje de control que no es de texto:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/producer.jar queue
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>La salida del cliente se ve así (junto con alguna salida adicional):</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Destination type is queue
Sending message: This is message 1 from producer
Text messages sent: 1
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>En otra ventana de terminal, ve al directorio <code>messagebrowser</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
cd tut-install/jms/simple/messagebrowser
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Ejecute el cliente <code>MessageBrowser</code> usando el siguiente comando:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/messagebrowser.jar
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>La salida del cliente se parece a esto (junto con alguna salida adicional):</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Message:
Text:   This is message 1 from producer
Class:                  com.sun.messaging.jmq.jmsclient.TextMessageImpl
getJMSMessageID():      ID:9-10.152.23.26(bf:27:4:e:e7:ec)-55645-1363100335526
getJMSTimestamp():      1363100335526
getJMSCorrelationID():  null
JMSReplyTo:             null
JMSDestination:         PhysicalQueue
getJMSDeliveryMode():   PERSISTENT
getJMSRedelivered():    false
getJMSType():           null
getJMSExpiration():     0
getJMSPriority():       4
Properties:             {JMSXDeliveryCount=0}
Message:
Class:                  com.sun.messaging.jmq.jmsclient.MessageImpl
getJMSMessageID():      ID:10-10.152.23.26(bf:27:4:e:e7:ec)-55645-1363100335526
getJMSTimestamp():      1363100335526
getJMSCorrelationID():  null
JMSReplyTo:             null
JMSDestination:         PhysicalQueue
getJMSDeliveryMode():   PERSISTENT
getJMSRedelivered():    false
getJMSType():           null
getJMSExpiration():     0
getJMSPriority():       4
Properties:             {JMSXDeliveryCount=0}
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      El primer mensaje es el <code>TextMessage</code>, y el segundo es el mensaje de control 
                      que no es de texto.
                    </p>
                  </div>
                </li>
                <li>
                  <p>Vaya al directorio <code>synchconsumer</code>.</p>
                </li>
                <li>
                  <p>Ejecute el cliente <code>SynchConsumer</code> para consumir los mensajes:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/synchconsumer.jar queue
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>La salida del cliente se ve así (junto con alguna salida adicional):</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Destination type is queue
Reading message: This is message 1 from producer
Messages received: 1
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
              </ol>
            </div>
          </div>
        </div>
        <div class="sect2" id="BABDDHHC">
          <h3 id="running-multiple-consumers-on-the-same-destination">
            Ejecución de Múltiples Consumidores en el Mismo Destino
          </h3>
          <div class="paragraph">
            <p>
              Para ilustrar mejor cómo funciona la mensajería de punto a punto y de publicación/suscripción, 
              puede usar los ejemplos de <code>Producer</code> y <code>SynchConsumer</code> para enviar 
              mensajes que luego son consumidos por dos clientes que ejecutan simultaneamente.
            </p>
          </div>
          <div class="olist arabic">
            <ol class="arabic">
              <li>
                <p>
                  Abra tres ventanas de comando. En uno, vaya al directorio <code>producer</code>. En los 
                  otros dos, vaya al directorio <code>synchconsumer</code>.
                </p>
              </li>
              <li>
                <p>
                  En cada una de las ventanas de <code>synchconsumer</code>, comienza a ejecutar el cliente, 
                  recibiendo mensajes de una cola:
                </p>
                <div class="listingblock">
                  <div class="content">
                    <pre class="prettyprint highlight">
                      <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/synchconsumer.jar queue
                      </code>
                    </pre>
                  </div>
                </div>
                <div class="paragraph">
                  <p>Espere hasta que vea el mensaje "Destination type is queue" en ambas ventanas.</p>
                </div>
              </li>
              <li>
                <p>
                  En la ventana <code>producer</code>, ejecute el cliente y envíe unos 20 mensajes a la cola:
                </p>
                <div class="listingblock">
                  <div class="content">
                    <pre class="prettyprint highlight">
                      <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/producer.jar queue 20
                      </code>
                    </pre>
                  </div>
                </div>
              </li>
              <li>
                <p>
                  Mire la salida en las ventanas <code>synchconsumer</code>. En la mensajería punto a punto, 
                  cada mensaje solo puede tener un consumidor. Por lo tanto, cada uno de los clientes recibe 
                  algunos de los mensajes. Uno de los clientes recibe el mensaje de control que no es de 
                  texto, informa de la cantidad de mensajes recibidos y sale.
                </p>
              </li>
              <li>
                <p>
                  En la ventana del cliente que no recibió el mensaje de control que no es de texto, ingrese 
                  Control-C para salir del programa.
                </p>
              </li>
              <li>
                <p>
                  A continuación, ejecute los clientes <code>synchconsumer</code> utilizando un tema. En cada 
                  ventana, ejecute el siguiente comando:
                </p>
                <div class="listingblock">
                  <div class="content">
                    <pre class="prettyprint highlight">
                      <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/synchconsumer.jar topic
                      </code>
                    </pre>
                  </div>
                </div>
                <div class="paragraph">
                  <p>Espere hasta que vea el mensaje "Destination type is topic" en ambas ventanas.</p>
                </div>
              </li>
              <li>
                <p>
                  En la ventana <code>producer</code>, ejecute el cliente y envíe unos 20 mensajes al tema:
                </p>
                <div class="listingblock">
                  <div class="content">
                    <pre class="prettyprint highlight">
                      <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/producer.jar topic 20
                      </code>
                    </pre>
                  </div>
                </div>
              </li>
              <li>
                <p>
                  Nuevamente, mire la salida en las ventanas <code>synchconsumer</code>. En la mensajería de 
                  publicación/suscripción, se envía una copia de cada mensaje a cada suscripción sobre el 
                  tema. Por lo tanto, cada uno de los clientes recibe los 20 mensajes de texto, así como el 
                  mensaje de control que no es de texto.
                </p>
              </li>
            </ol>
          </div>
        </div>
        <div class="sect2" id="BNCFX">
          <h3 id="acknowledging-messages">Confirmación de Mensajes</h3>
          <div class="paragraph">
            <p>
              JMS proporciona dos formas alternativas para que un cliente consumidor se asegure de que un 
              mensaje no se reconozca hasta que la aplicación haya terminado de procesar el mensaje:
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>
                  Usar un consumidor síncrono en un <code>JMSContext</code> que se ha configurado para usar la 
                  configuración <code>CLIENT_ACKNOWLEDGE</code>
                </p>
              </li>
              <li>
                <p>
                  Uso de un detector de mensajes para la entrega asincrónica de mensajes en un 
                  <code>JMSContext</code> que se ha configurado para usar la configuración predeterminada 
                  <code>AUTO_ACKNOWLEDGE</code>
                </p>
              </li>
            </ul>
          </div>
          <table class="tableblock frame-all grid-all spread">
            <colgroup>
              <col style="width: 100%;">
            </colgroup>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p><strong>Nota</strong>:</p>
                    </div>
                    <div class="paragraph">
                      <p>
                        En la plataforma Java EE, las sesiones de <code>CLIENT_ACKNOWLEDGE</code> solo se 
                        pueden usar en clientes de aplicaciones, como en este ejemplo.
                      </p>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>
              El ejemplo de <code>clientackconsumer</code> demuestra la primera alternativa, en la que un 
              consumidor síncrono utiliza la confirmación del cliente. El ejemplo de 
              <code>asynchconsumer</code> descrito en 
              <a href="#BNCFH">Uso de un Detector de Mensajes para la Entrega Asincrónica de Mensajes</a> 
              demuestra la segunda alternativa.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Para obtener información sobre el reconocimiento de mensajes, consulte 
              <a href="jms-concepts004.html#BNCFW">Control de la Confirmación del Mensaje</a>.
            </p>
          </div>
          <div class="paragraph">
            <p>
              La siguiente tabla describe cuatro posibles interacciones entre tipos de consumidores y tipos de 
              acuse de recibo.
            </p>
          </div>
          <div class="paragraph">
            <p><a id="sthref204"></a><a id="sthref205"></a></p>
          </div>
          <div class="paragraph">
            <p>
              <strong>Tabla 49-3 Confirmación de Mensajes con Consumidores Síncronos y Asíncronos</strong>
            </p>
          </div>
          <table class="tableblock frame-all grid-all" style="width: 99%;">
            <colgroup>
              <col style="width: 20%;">
              <col style="width: 20%;">
              <col style="width: 60%;">
            </colgroup>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><strong>Tipo de Consumidor</strong></p></td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><strong>Tipo de Reconocimiento</strong></p></td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><strong>Comportamiento</strong></p></td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top"><p class="tableblock">Síncrono</p></td>
                <td class="tableblock halign-left valign-top"><p class="tableblock">Cliente</p></td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">
                    El cliente reconoce el mensaje después de completar el procesamiento
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top"><p class="tableblock">Asíncrono</p></td>
                <td class="tableblock halign-left valign-top"><p class="tableblock">Cliente</p></td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">
                    El cliente reconoce el mensaje después de completar el procesamiento
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top"><p class="tableblock">Síncrono</p></td>
                <td class="tableblock halign-left valign-top"><p class="tableblock">Auto</p></td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">
                    El reconocimiento ocurre inmediatamente después de la llamada <code>receive</code>; el 
                    mensaje no se puede volver a enviar si falla cualquier paso de procesamiento posterior
                  </p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top"><p class="tableblock">Asíncrono</p></td>
                <td class="tableblock halign-left valign-top"><p class="tableblock">Auto</p></td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">
                    El mensaje se reconoce automáticamente cuando el método <code>onMessage</code> regresa
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>
              El ejemplo está en el directorio tut-install`/examples/jms/simple/clientackconsumer/`.
            </p>
          </div>
          <div class="paragraph">
            <p>
              El cliente de ejemplo, <code>ClientAckConsumer.java</code>, crea un <code>JMSContext</code> que 
              especifica la confirmación del cliente:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
try (JMSContext context =
      connectionFactory.createContext(JMSContext.CLIENT_ACKNOWLEDGE);) {
    ...
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              El cliente usa un bucle <code>while</code> casi idéntico al usado por 
              <code>SynchConsumer.java</code>, con la excepción de que después de procesar cada mensaje, llama 
              al método <code>acknowledge</code> en el <code>JMSContext</code>:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
context.acknowledge();
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>El ejemplo utiliza los siguientes objetos:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>
                  El recurso <code>jms/MyQueue</code> que creó para 
                  <a href="#BNCFB">Recepción de Mensajes Sincrónicamente</a>.
                </p>
              </li>
              <li>
                <p>
                  <code>java:comp/DefaultJMSConnectionFactory</code>, la fábrica de conexiones predeterminada 
                  de la plataforma preconfigurada con el servidor GlassFish
                </p>
              </li>
            </ul>
          </div>
          <div class="sect3" id="GJSCG">
            <h4 id="to-run-the-clientackconsumer-client">Para Ejecutar el Cliente ClientAckConsumer</h4>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>En una ventana de terminal, vaya al siguiente directorio:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
tut-install/examples/jms/simple/producer/
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Ejecute el cliente <code>Producer</code> y envíe algunos mensajes a la cola:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/producer.jar queue 3
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>En otra ventana de terminal, vaya al siguiente directorio:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
tut-install/examples/jms/simple/clientackconsumer/
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Para ejecutar el cliente, use el siguiente comando:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
appclient -client target/clientackconsumer.jar
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>La salida del cliente se ve así (junto con alguna salida adicional):</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Created client-acknowledge JMSContext
Reading message: This is message 1 from producer
Acknowledging TextMessage
Reading message: This is message 2 from producer
Acknowledging TextMessage
Reading message: This is message 3 from producer
Acknowledging TextMessage
Acknowledging non-text control message
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>
                      El cliente reconoce cada mensaje explícitamente después de procesarlo, al igual que un 
                      <code>JMSContext</code> configurado para usar <code>AUTO_ACKNOWLEDGE</code> lo hace 
                      automáticamente después de que un <code>MessageListener</code> regresa con éxito del 
                      procesamiento de un mensaje recibido de forma asíncrona.
                    </p>
                  </div>
                </li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>		
        <td align="left">
          <a href="jms-examples002.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="jms-examples004.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <span id="copyright">
      <a href="img/cpyr.adoc">
        <img src="img/oracle.gif" height="10" alt="Logo de Oracle" />&nbsp;			
        <span>
          Copyright&nbsp;&copy;&nbsp;2017,&nbsp;Oracle&nbsp;y/o&nbsp;sus&nbsp;afiliados.&nbsp;Todos&nbsp;los&nbsp;
          derechos&nbsp;reservados.
        </span>
      </a>
    </span>
  </body>
</html>
