<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <title>Creando y Usando un Validador Personalizado</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
    <table id="doc-title" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top">
          <b>Plataforma Java, Edición Empresarial (Java EE) 8</b><br />
          <b>El Tutorial de Java EE</b>
        </td>
      </tr>
    </table>
    <hr />
    <table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>
        <td align="left">
          <a href="jsf-custom011.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="jsf-custom013.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <div class="sect1" id="BNAUW">
      <h2 id="creating-and-using-a-custom-validator">Creando y Usando un Validador Personalizado</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>
            Si los validadores estándar o Validación de Beans no realizan la verificación de validación que 
            necesita, puede crear un validador personalizado para validar la entrada del usuario. Como se 
            explica en <a href="jsf-intro005.html#BNAQK">Modelo de Validación</a>, hay dos formas de 
            implementar el código de validación.
          </p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p>Implemente un método de bean gestionado que realice la validación.</p>
            </li>
            <li>
              <p>
                Proporcione una implementación de la interfaz <code>javax.faces.validator.Validator</code> 
                para realizar la validación.
              </p>
            </li>
          </ul>
        </div>
        <div class="paragraph">
          <p>
            <a href="jsf-develop003.html#BNAVE">Escribiendo un Método para Realizar una Validación</a> 
            explica cómo implementar un método de bean administrado para realizar la validación. El resto de 
            esta sección explica cómo implementar la interfaz <code>Validator</code>.
          </p>
        </div>
        <div class="paragraph">
          <p>
            Si elige implementar la interfaz <code>Validator</code> y desea permitir que el autor de la página 
            configure los atributos del validador desde la página, también debe especificar una etiqueta 
            personalizada para registrar el validador en un componente.
          </p>
        </div>
        <div class="paragraph">
          <p>
            Si prefiere configurar los atributos en la implementación del <code>Validator</code>, puede 
            renunciar a especificar una etiqueta personalizada y dejar que el autor de la página registre el 
            validador en un componente utilizando la etiqueta <code>f:validator</code>, como se describe en 
            <a href="#BNATV">Usando un Validador Personalizado</a>.
          </p>
        </div>
        <div class="paragraph">
          <p>
            También puede crear una propiedad de bean gestionada que acepte y devuelva la implementación de 
            <code>Validator</code> que cree, como se describe en 
            <a href="jsf-develop002.html#BNAUL">Escribiendo Propiedades Ligadas a Convertidores, Oyentes, o 
              Validadores</a>. Puede usar el atributo de enlace de la etiqueta <code>f:validator</code> para 
              vincular la implementación del <code>Validator</code> a la propiedad del bean gestionado.
          </p>
        </div>
        <div class="paragraph">
          <p>
            Por lo general, querrá mostrar un mensaje de error cuando los datos fallan en la validación. Debe 
            almacenar estos mensajes de error en un paquete de recursos.
          </p>
        </div>
        <div class="paragraph">
          <p>
            Después de crear el paquete de recursos, tiene dos formas de hacer que los mensajes estén 
            disponibles para la aplicación. Puede poner en cola los mensajes de error en 
            <code>FacesContext</code> mediante programación, o puede registrar los mensajes de error en el 
            archivo de recursos de configuración de la aplicación, como se explica en 
            <a href="jsf-configure006.html#BNAXB">Registrando Mensajes de Aplicación</a>.
          </p>
        </div>
        <div class="paragraph">
          <p>
            Por ejemplo, una aplicación de comercio electrónico puede usar un validador personalizado de uso 
            general llamado <code>FormatValidator.java</code> para validar los datos de entrada con un patrón 
            de formato que se especifica en la etiqueta del validador personalizado. Este validador se usaría 
            con un campo de Número de tarjeta de crédito en una página de Facelets. Aquí está la etiqueta de 
            validación personalizada:
          </p>
        </div>
        <div class="listingblock">
          <div class="content">
            <pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">
&lt;mystore:formatValidator
 formatPatterns="9999999999999999|9999 9999 9999 9999|9999-9999-9999-9999"/&gt;
            </code></pre>
          </div>
        </div>
        <div class="paragraph">
          <p>Según este validador, los datos ingresados en el campo deben ser uno de los siguientes:</p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p>Un número de 16 dígitos sin espacios.</p>
            </li>
            <li>
              <p>Un número de 16 dígitos con un espacio entre cada cuatro dígitos.</p>
            </li>
            <li>
              <p>Un número de 16 dígitos con guiones entre cada cuatro dígitos.</p>
            </li>
          </ul>
        </div>
        <div class="paragraph">
          <p>
            La etiqueta <code>f:validateRegex</code> hace que un validador personalizado sea innecesario en 
            esta situación. Sin embargo, el resto de esta sección describe cómo se implementaría este 
            validador y cómo especificar una etiqueta personalizada para que el autor de la página pueda 
            registrar el validador en un componente.
          </p>
        </div>
        <div class="sect2" id="BNAUX">
          <h3 id="implementing-the-validator-interface">Implementando la Interfaz Validator</h3>
          <div class="paragraph">
            <p>
              Una implementación de <code>Validator</code> debe contener un constructor, un conjunto de 
              métodos de acceso para cualquier atributo en la etiqueta y un método <code>validate</code>, que 
              anula el método <code>validate</code> de la interfaz <code>Validator</code>.
            </p>
          </div>
          <div class="paragraph">
            <p>
              La clase hipotética <code>FormatValidator</code> también define métodos de acceso para 
              configurar el atributo <code>formatPatterns</code>, que especifica los patrones de formato 
              aceptables para la entrada en los campos. El método setter llama al método 
              <code>parseFormatPatterns</code>, que separa los componentes de la cadena del patrón en una 
              matriz de cadenas, <code>formatPatternsList</code>.
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">
public String getFormatPatterns() {
    return (this.formatPatterns);
}
public void setFormatPatterns(String formatPatterns) {
    this.formatPatterns = formatPatterns;
    parseFormatPatterns();
}
              </code></pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Además de definir métodos de acceso para los atributos, la clase anula el método 
              <code>validate</code> de la interfaz <code>Validator</code>. Este método valida la entrada y 
              también accede a los mensajes de error personalizados que se mostrarán cuando el 
              <code>String</code> no sea válido.
            </p>
          </div>
          <div class="paragraph">
            <p>
              El método <code>validate</code> realiza la validación real de los datos. Toma la instancia 
              <code>FacesContext</code>, el componente cuyos datos necesitan ser validados y el valor que 
              necesita ser validado. Un validador puede validar solo los datos de un componente que implementa 
              <code>javax.faces.component.EditableValueHolder</code>.
            </p>
          </div>
          <div class="paragraph">
            <p>Aquí hay una implementación del método <code>validate</code>:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">
@FacesValidator
public class FormatValidator implements Validator, StateHolder {
    ...
    public void validate(FacesContext context, UIComponent component,
                         Object toValidate) {
        boolean valid = false;
        String value = null;
        if ((context == null) || (component == null)) {
            throw new NullPointerException();
        }
        if (!(component instanceof UIInput)) {
            return;
        }
        if ( null == formatPatternsList || null == toValidate) {
            return;
        }
        value = toValidate.toString();
        // validate the value against the list of valid patterns.
        Iterator patternIt = formatPatternsList.iterator();
        while (patternIt.hasSiguiente()) {
            valid = isFormatValid(
                ((String)patternIt.next()), value);
            if (valid) {
                break;
            }
        }
        if ( !valid ) {
            FacesMessage errMsg =
                new FacesMessage(FORMAT_INVALID_MESSAGE_ID);
            FacesContext.getCurrentInstance().addMessage(null, errMsg);
            throw new ValidatorException(errMsg);
        }
    }
}
              </code></pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              La anotación <code>@FacesValidator</code> registra la clase <code>FormatValidator</code> como un 
              validador con la implementación de JavaServer Faces. El método <code>validate</code> obtiene el 
              valor local del componente y lo convierte en una <code>String</code>. Luego itera sobre la lista 
              <code>formatPatternsList</code>, que es la lista de patrones aceptables que se analizó a partir 
              del atributo <code>formatPatterns</code> de la etiqueta de validación personalizada.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Al iterar sobre la lista, este método compara el patrón del valor local del componente con los 
              patrones de la lista. Si el patrón del valor local no coincide con ningún patrón de la lista, 
              este método genera un mensaje de error. Luego crea un 
              <code>javax.faces.application.FacesMessage</code> y lo pone en cola en el 
              <code>FacesContext</code> para su visualización, utilizando una <code>String</code> que 
              representa la clave en el Archivo <code>Properties</code>:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">
public static final String FORMAT_INVALID_MESSAGE_ID =
     "FormatInvalid";
}
              </code></pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Finalmente, el método pasa el mensaje al constructor de 
              <code>javax.faces.validator.ValidatorException</code>.
            </p>
          </div>
          <div class="paragraph">
            <p>
              When the error message is displayed, the format pattern will be substituted for the <code>{0}</code> in the error message, which, in English, is as follows:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">
La entrada debe coincidir con uno de los siguientes patrones: {0}
              </code></pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Es posible que desee guardar y restaurar el estado de su validador, aunque generalmente no es 
              necesario guardar el estado. Para hacerlo, deberá implementar la interfaz 
              <code>StateHolder</code> así como la interfaz <code>Validator</code>. Para implementar 
              <code>StateHolder</code>, necesitaría implementar sus cuatro métodos: 
              <code>saveState(FacesContext)</code>, <code>restoreState(FacesContext, Object)</code>, 
              <code>isTransient</code> y <code>setTransient(boolean)</code>. Consulta 
              <a href="jsf-custom005.html#BNAVZ">Guardar y Restaurar el Estado</a> para obtener más 
              información.
            </p>
          </div>
        </div>
        <div class="sect2" id="BNAUY">
          <h3 id="specifying-a-custom-tag">Especificando una Etiqueta Personalizada</h3>
          <div class="paragraph">
            <p>
              Si implementó una interfaz <code>Validator</code> en lugar de implementar un método de bean 
              administrado que realiza la validación, debe realizar una de las siguientes acciones.
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>
                  Permita que el autor de la página especifique la implementación de <code>Validator</code> 
                  para usar con la etiqueta <code>f:validator</code>. En este caso, la implementación de 
                  <code>Validator</code> debe definir sus propias propiedades. 
                  <a href="#BNATV">Usando un Validador Personalizado</a> explica cómo usar la etiqueta 
                  <code>f:validator</code>.
                </p>
              </li>
              <li>
                <p>
                  Especifique una etiqueta personalizada que proporcione atributos para configurar las 
                  propiedades del validador desde la página.
                </p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>
              Para crear una etiqueta personalizada, debe agregar la etiqueta al descriptor de la biblioteca 
              de etiquetas para la aplicación, <code>bookstore.taglib.xml</code>:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">
&lt;tag&gt;
    &lt;tag-name&gt;validator&lt;/tag-name&gt;
    &lt;validator&gt;
        &lt;validator-id&gt;formatValidator&lt;/validator-id&gt;
        &lt;validator-class&gt;
            dukesbookstore.validators.FormatValidator
        &lt;/validator-class&gt;
    &lt;/validator&gt;
&lt;/tag&gt;
              </code></pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              El elemento <code>tag-name</code> define el nombre de la etiqueta, ya que debe usarse en una 
              página de Facelets. El elemento <code>validator-id</code> identifica el validador personalizado. 
              El elemento <code>validator-class</code> conecta la etiqueta personalizada a su clase de 
              implementación.
            </p>
          </div>
          <div class="paragraph">
            <p>
              <a href="#BNATV">
                Usando un Validador Personalizado</a> explica cómo utilizar la etiqueta de validación 
                personalizada en la página.
            </p>
          </div>
        </div>
        <div class="sect2" id="BNATV">
          <h3 id="using-a-custom-validator">Usando un Validador Personalizado</h3>
          <div class="paragraph">
            <p>
              Para registrar un validador personalizado en un componente, debe realizar una de las siguientes 
              acciones.
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>
                  Anida la etiqueta personalizada del validador dentro de la etiqueta del componente cuyo 
                  valor desea validar.
                </p>
              </li>
              <li>
                <p>
                  Anida la etiqueta <code>f:validator</code> estándar dentro de la etiqueta del componente y 
                  haga referencia a la implementación personalizada de <code>Validator</code> desde la 
                  etiqueta <code>f:validator</code>.
                </p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>
              A continuación, se muestra una etiqueta <code>formatValidator</code> personalizada hipotética 
              para el campo Credit Card Number, anidada dentro de la etiqueta <code>h:inputText</code>:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">
&lt;h:inputText id="ccno" size="19"
  ...
  required="true"&gt;
  &lt;mystore:formatValidator
  formatPatterns="9999999999999999|9999 9999 9999 9999|9999-9999-9999-9999"/&gt;
&lt;/h:inputText&gt;
&lt;h:message styleClass="validationMessage" for="ccno"/&gt;
              </code></pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Esta etiqueta valida la entrada del campo <code>ccno</code> con los patrones definidos por el 
              autor de la página en el atributo <code>formatPatterns</code>.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Puede utilizar el mismo validador personalizado para cualquier componente similar simplemente 
              anidando la etiqueta del validador personalizado dentro de la etiqueta del componente.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Si el desarrollador de la aplicación que creó el validador personalizado prefiere configurar los 
              atributos en la implementación del <code>Validator</code> en lugar de permitir que el autor de 
              la página configure los atributos de la página, el desarrollador no creará una etiqueta 
              personalizada para usar con el validador.
            </p>
          </div>
          <div class="paragraph">
            <p>
              En este caso, el autor de la página debe anidar la etiqueta <code>f:validator</code> dentro de 
              la etiqueta del componente cuyos datos necesitan ser validados. Luego, el autor de la página 
              debe realizar una de las siguientes acciones.
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>
                  Establezca el atributo <code>validatorId</code> de la etiqueta <code>f:validator</code> en 
                  el ID del validador que se define en el archivo de recursos de configuración de la 
                  aplicación.
                </p>
              </li>
              <li>
                <p>
                  Vincule la implementación personalizada de <code>Validator</code> a una propiedad de bean 
                  administrada utilizando el atributo <code>binding</code> de la etiqueta 
                  <code>f:validator</code>, como se describe en 
                  <a href="jsf-custom014.html#BNATM">
                    Enlazando Convertidores, Oyentes, y Validadores a Propiedades de un Bean Gestionado
                  </a>.
                </p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>
              La siguiente etiqueta registra un validador hipotético en un componente usando una etiqueta 
              <code>f:validator</code> y hace referencia al ID del validador:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">
&lt;h:inputText id="name" value="#{CustomerBean.name}"
            size="10" ...&gt;
    &lt;f:validator validatorId="customValidator" /&gt;
    ...
&lt;/h:inputText&gt;
              </code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>		
        <td align="left">
          <a href="jsf-custom011.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="jsf-custom013.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <span id="copyright">
      <a href="img/cpyr.adoc">
        <img src="img/oracle.gif" height="10" alt="Logo de Oracle" />&nbsp;			
        <span>
          Copyright&nbsp;&copy;&nbsp;2017,&nbsp;Oracle&nbsp;y/o&nbsp;sus&nbsp;afiliados.&nbsp;Todos&nbsp;los&nbsp;
          derechos&nbsp;reservados.
        </span>
      </a>
    </span>
  </body>
</html>
