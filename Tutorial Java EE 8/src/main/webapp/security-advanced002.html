<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <title>Mecanismos de Autenticación</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
    <table id="doc-title" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top">
          <b>Plataforma Java, Edición Empresarial (Java EE) 8</b><br />
          <b>El Tutorial de Java EE</b>
        </td>
      </tr>
    </table>
    <hr />
    <table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>
        <td align="left">
          <a href="security-advanced001.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="security-advanced003.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <div class="sect1" id="GLIEN">
      <h2 id="authentication-mechanisms">Mecanismos de Autenticación</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>
            En esta sección se analizan los mecanismos de autenticación de clientes y de autenticación mutua.
          </p>
        </div>
        <div class="paragraph">
          <p>Aquí se tratan los siguientes temas:</p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p><a href="#GLIEQ">Autenticación del Cliente</a></p>
            </li>
            <li>
              <p><a href="#GLIEL">Autenticación Mutua</a></p>
            </li>
          </ul>
        </div>
        <div class="sect2" id="GLIEQ">
          <h3 id="client-authentication">Autenticación del Cliente</h3>
          <div class="paragraph">
            <p>
              Con la autenticación del cliente, el servidor web autentica al cliente mediante el certificado 
              de clave pública del cliente. La autenticación del cliente es un método de autenticación más 
              seguro que la autenticación básica o basada en formularios. Utiliza HTTP sobre SSL (HTTPS), en 
              el que el servidor autentica al cliente utilizando el certificado de clave pública del cliente. 
              La tecnología SSL proporciona cifrado de datos, autenticación de servidor, integridad de 
              mensajes y autenticación de cliente opcional para una conexión TCP/IP. Puede pensar en un 
              certificado de clave pública como el equivalente digital de un pasaporte. El certificado es 
              emitido por una organización de confianza, una autoridad de certificación (CA), y proporciona 
              identificación para el portador.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Antes de utilizar la autenticación de cliente, asegúrese de que el cliente tenga un certificado 
              de clave pública válido. Para obtener más información sobre la creación y el uso de certificados 
              de clave pública, lea <a href="security-advanced001.html#BNBYB">
                Trabajar con Certificados Digitales</a>.
            </p>
          </div>
          <div class="paragraph">
            <p>
              El siguiente ejemplo muestra cómo declarar la autenticación del cliente en su descriptor de 
              implementación:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
&lt;login-config&gt;
    &lt;auth-method&gt;CLIENT-CERT&lt;/auth-method&gt;
&lt;/login-config&gt;
                </code>
              </pre>
            </div>
          </div>
        </div>
        <div class="sect2" id="GLIEL">
          <h3 id="mutual-authentication">Autenticación Mutua</h3>
          <div class="paragraph">
            <p>
              Con la autenticación mutua, el servidor y el cliente se autentican entre sí. La autenticación 
              mutua es de dos tipos:
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>Basado en certificados (ver <a href="#GLIFJ">Figura 53-1</a>)</p>
              </li>
              <li>
                <p>Basado en nombre de usuario/contraseña (ver <a href="#GLIGQ">Figura 53-2</a>)</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>
              Cuando se utiliza la autenticación mutua basada en certificados, se producen las siguientes 
              acciones.
            </p>
          </div>
          <div class="olist arabic">
            <ol class="arabic">
              <li>
                <p>Un cliente solicita acceso a un recurso protegido.</p>
              </li>
              <li>
                <p>El servidor web presenta su certificado al cliente.</p>
              </li>
              <li>
                <p>El cliente verifica el certificado del servidor.</p>
              </li>
              <li>
                <p>Si tiene éxito, el cliente envía su certificado al servidor.</p>
              </li>
              <li>
                <p>El servidor verifica las credenciales del cliente.</p>
              </li>
              <li>
                <p>
                  Si tiene éxito, el servidor otorga acceso al recurso protegido solicitado por el cliente.
                </p>
              </li>
            </ol>
          </div>
          <div class="paragraph">
            <p>
              La <a href="#GLIFJ">Figura 53-1</a> muestra lo que ocurre durante la autenticación mutua basada 
              en certificados.
            </p>
          </div>
          <div id="GLIFJ" class="paragraph">
            <div class="title">
              <strong>Figura 53-1 Autenticación Mutua Basada en Certificados</strong>
            </div>
            <p>
              <span class="image">
                <img src="img/javaeett_dt_048.png" 
                     alt="Diagrama de seis pasos en autenticación mutua con certificados">
              </span>
            </p>
          </div>
          <div class="paragraph">
            <p>
              En la autenticación mutua basada en nombre de usuario/contraseña, ocurren las siguientes 
              acciones.
            </p>
          </div>
          <div class="olist arabic">
            <ol class="arabic">
              <li>
                <p>Un cliente solicita acceso a un recurso protegido.</p>
              </li>
              <li>
                <p>El servidor web presenta su certificado al cliente.</p>
              </li>
              <li>
                <p>El cliente verifica el certificado del servidor.</p>
              </li>
              <li>
                <p>Si tiene éxito, el cliente envía su nombre de usuario y contraseña al servidor.</p>
              </li>
              <li>
                <p>El servidor verifica las credenciales del cliente.</p>
              </li>
              <li>
                <p>
                  Si la verificación es exitosa, el servidor otorga acceso al recurso protegido solicitado por 
                  el cliente.
                </p>
              </li>
            </ol>
          </div>
          <div class="paragraph">
            <p>
              La <a href="#GLIGQ">Figura 53-2</a> muestra lo que ocurre durante la autenticación mutua basada 
              en nombre de usuario/contraseña.
            </p>
          </div>
          <div id="GLIGQ" class="paragraph">
            <div class="title">
              <strong>Figura 53-2 Autenticación Mutua Basada en Nombre de Usuario/contraseña</strong>
            </div>
            <p>
              <span class="image">
                <img src="img/javaeett_dt_049.png" 
                     alt="Diagrama de cinco pasos en autenticación mutua con nombre de usuario y contraseña">
              </span>
            </p>
          </div>
          <div class="sect3" id="BNBYH">
            <h4 id="enabling-mutual-authentication-over-ssl">
              Habilitación de la Autenticación Mutua sobre SSL
            </h4>
            <div class="paragraph">
              <p>
                Esta sección trata sobre la configuración de la autenticación del lado del cliente. Habilitar 
                la autenticación del lado del servidor y del lado del cliente se denomina autenticación mutua 
                o bidireccional. En la autenticación de clientes, los clientes deben enviar certificados 
                emitidos por una autoridad de certificación que elija aceptar.
              </p>
            </div>
            <div class="paragraph">
              <p>Hay al menos dos formas de habilitar la autenticación mutua a través de SSL.</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>
                    El método preferido es establecer el método de autenticación en el descriptor de 
                    implementación de la aplicación <code>web.xml</code> en <code>CLIENT-CERT</code>. Esto 
                    impone la autenticación mutua modificando el descriptor de implementación de la aplicación 
                    dada. De esta forma, la autenticación del cliente se habilita solo para un recurso 
                    específico controlado por la restricción de seguridad y la verificación se realiza solo 
                    cuando la aplicación requiere la autenticación del cliente.
                  </p>
                </li>
                <li>
                  <p>
                    Un método menos utilizado es establecer la propiedad <code>clientAuth</code> en el 
                    dominio <code>certificate</code> en <code>true</code> si desea que la pila SSL requiera 
                    una cadena de certificados válida del cliente antes de aceptar una conexión. Un valor 
                    <code>false</code> (que es el valor predeterminado) no requerirá una cadena de 
                    certificados a menos que el cliente solicite un recurso protegido por una restricción de 
                    seguridad que utilice la autenticación <code>CLIENT-CERT</code>. Cuando habilita la 
                    autenticación del cliente configurando la propiedad <code>clientAuth</code> en 
                    <code>true</code>, se requerirá la autenticación del cliente para todas las solicitudes 
                    que pasen por el puerto SSL especificado. Si activa <code>clientAuth</code>, estará 
                    activado todo el tiempo, lo que puede degradar gravemente el rendimiento.
                  </p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>
                Cuando la autenticación de cliente está habilitada de estas dos formas, la autenticación de 
                cliente se realizará dos veces.
              </p>
            </div>
          </div>
          <div class="sect3" id="BNBYI">
            <h4 id="creating-a-client-certificate-for-mutual-authentication">
              Creación de un Certificado de Cliente para Autenticación Mutua
            </h4>
            <div class="paragraph">
              <p>
                Si tiene un certificado firmado por una autoridad de certificación (CA) de confianza, como 
                Verisign, y el archivo <code>cacerts.jks</code> del servidor GlassFish ya contiene un 
                certificado verificado por esa CA, no necesita completar este paso. Debe instalar su 
                certificado en el archivo de certificado del servidor GlassFish solo cuando su certificado 
                esté autofirmado.
              </p>
            </div>
            <div class="paragraph">
              <p>
                Desde el directorio donde desea crear el certificado de cliente, ejecute <code>keytool</code> 
                como se describe aquí. Cuando presiona Intro, <code>keytool</code> le solicita que ingrese el 
                nombre del servidor, la unidad organizativa, la organización, la localidad, el estado y el 
                código del país.
              </p>
            </div>
            <div class="paragraph">
              <p>
                Debe ingresar el nombre del servidor en respuesta al primer aviso de <code>keytool</code>, en 
                el que solicita el nombre y el apellido. Para fines de prueba, puede ser 
                <code>localhost</code>. Si este ejemplo es para verificar la autenticación mutua y recibe un error 
                de tiempo de ejecución que indica que el nombre de host HTTPS es incorrecto, vuelva a crear el 
                certificado de cliente, asegurándose de usar el mismo nombre de host que usará cuando ejecute el 
                ejemplo. Por ejemplo, si el nombre de su máquina es <code>duke</code>, ingrese 
                <code>duke</code> como el CN del certificado o cuando se le solicite el nombre y el apellido. 
                Al acceder a la aplicación, ingrese una URL que apunte a la misma ubicación (por ejemplo, 
                <code>https://duke:8181/mutualauth/hello</code>). Esto es necesario porque durante el 
                protocolo de enlace SSL, el servidor verifica el certificado del cliente comparando el nombre 
                del certificado con el nombre de host desde el que se origina.
              </p>
            </div>
            <div class="paragraph">
              <p>
                Para crear un almacén de claves denominado <code>client_keystore.jks</code> que contenga un 
                certificado de cliente denominado <code>client.cer</code>, siga estos pasos.
              </p>
            </div>
            <div class="olist arabic">
              <ol class="arabic">
                <li>
                  <p>
                    Cree una copia de seguridad del archivo de almacén de confianza del servidor. Para hacer 
                    esto,
                  </p>
                </li>
                <li>
                  <p>
                    Cambie al directorio que contiene los archivos del almacén de claves y del almacén de 
                    confianza del servidor, domain-dir`\config`.
                  </p>
                </li>
                <li>
                  <p>Copie <code>cacerts.jks</code> a <code>cacerts.backup.jks</code>.</p>
                </li>
                <li>
                  <p>Copie <code>keystore.jks</code> en <code>keystore.backup.jks</code>.</p>
                  <div class="paragraph">
                    <p>
                      No coloque certificados de cliente en el archivo <code>cacerts.jks</code>. Cualquier 
                      certificado que agregue al archivo <code>cacerts</code> puede ser una raíz confiable 
                      para todas y cada una de las cadenas de certificados. Una vez que haya completado el 
                      desarrollo, elimine la versión de desarrollo del archivo <code>cacerts</code> y 
                      reemplácelo con la copia original.
                    </p>
                  </div>
                </li>
                <li>
                  <p>
                    Genere el certificado de cliente. Ingrese el siguiente comando desde el directorio donde 
                    desea generar el certificado de cliente:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
java-home\bin\keytool -genkey -alias client-alias -keyalg RSA
-keypass changeit -storepass changeit -keystore client_keystore.jks
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Exporte el certificado de cliente generado al archivo <code>client.cer</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
java-home\bin\keytool -export -alias client-alias -storepass changeit
-file client.cer -keystore client_keystore.jks
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>
                    Agregue el certificado al archivo del almacén de confianza 
                    domain-dir`/config/cacerts.jks`. Ejecute <code>keytool</code> desde el directorio donde 
                    creó el almacén de claves y el certificado de cliente. Utilice los siguientes parámetros:
                  </p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
java-home\bin\keytool -import -v -trustcacerts -alias client-alias
-file client.cer -keystore domain-dir/config/cacerts.jks
-keypass changeit -storepass changeit
                        </code>
                      </pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>La utilidad <code>keytool</code> devuelve un mensaje como este:</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="prettyprint highlight">
                        <code class="language-oac_no_warn" data-lang="oac_no_warn">
Owner: CN=localhost, OU=My Company, O=Software, L=Santa Clara, ST=CA, C=US
Issuer: CN=localhost, OU=My Company, O=Software, L=Santa Clara, ST=CA, C=US
Serial number: 3e39e66a
Valid from: Tue Nov 27 12:22:47 EST 2012 until: Mon Feb 25 12:22:47 EST 2013
Certificate fingerprints:
    MD5: 5A:B0:4C:88:4E:F8:EF:E9:E5:8B:53:BD:D0:AA:8E:5A
    SHA1:90:00:36:5B:E0:A7:A2:BD:67:DB:EA:37:B9:61:3E:26:B3:89:46:32
    Signature algorithm name: SHA1withRSA
    Version: 3
Trust this certificate? [no]: yes
Certificate was added to keystore
[Storing cacerts.jks]
                        </code>
                      </pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Reinicie el servidor GlassFish.</p>
                </li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>		
        <td align="left">
          <a href="security-advanced001.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="security-advanced003.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <span id="copyright">
      <a href="img/cpyr.adoc">
        <img src="img/oracle.gif" height="10" alt="Logo de Oracle" />&nbsp;			
        <span>
          Copyright&nbsp;&copy;&nbsp;2017,&nbsp;Oracle&nbsp;y/o&nbsp;sus&nbsp;afiliados.&nbsp;Todos&nbsp;los&nbsp;
          derechos&nbsp;reservados.
        </span>
      </a>
    </span>
  </body>
</html>
