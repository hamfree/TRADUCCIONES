<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <title>Diseño y Arquitectura del Bosque de Duke</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
    <table id="doc-title" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top">
          <b>Plataforma Java, Edición Empresarial (Java EE) 8</b><br />
          <b>El Tutorial de Java EE</b>
        </td>
      </tr>
    </table>
    <hr />
    <table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>
        <td align="left">
          <a href="dukes-forest001.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="dukes-forest003.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <div class="sect1" id="GLNRJ">
      <h2 id="design-and-architecture-of-dukes-forest">Diseño y Arquitectura del Bosque de Duke</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>
            El Bosque de Duke es una aplicación compleja que consta de tres proyectos principales y tres 
            subproyectos. La <a href="#GLNVM">Figura 62-1</a> muestra la arquitectura de los tres proyectos 
            principales que implementará: La Tienda de Duke, Los Envíos de Duke y Los Pagos de Duke. También 
            muestra cómo La Tienda de Duke hace uso de los proyectos de Eventos y Entidades.
          </p>
        </div>
        <div id="GLNVM" class="paragraph">
          <div class="title">
            <strong>Figura 62-1 Arquitectura de Ejemplo de Aplicación El Bosque de Duke </strong>
          </div>
          <p>
            <span class="image">
              <img src="img/javaeett_dt_062.png" 
                   alt="Esta figura muestra la arquitectura de los principales proyectos de El Bosque de Duke 
                   y cómo utilizan los proyectos de Eventos y Entidades.">
            </span>
          </p>
        </div>
        <div class="paragraph">
          <p>El Bosque de Duke utiliza las siguientes características de la plataforma Java EE:</p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p>Entidades de persistencia IPA de Java</p>
              <div class="ulist">
                <ul>
                  <li>
                    <p>
                      Anotaciones de Validación de Beans sobre las entidades para la verificación de datos
                    </p>
                  </li>
                  <li>
                    <p>Anotaciones XML para API de Java para serialización de enlace XML (JAXB)</p>
                  </li>
                </ul>
              </div>
            </li>
            <li>
              <p>Servicios web</p>
              <div class="ulist">
                <ul>
                  <li>
                    <p>Un servicio web JAX-RS para pago, con restricciones de seguridad</p>
                  </li>
                  <li>
                    <p>Un servicio web JAX-RS basado en EJB</p>
                  </li>
                </ul>
              </div>
            </li>
            <li>
              <p>Enterprise beans</p>
              <div class="ulist">
                <ul>
                  <li>
                    <p>Beans de sesión locales</p>
                  </li>
                  <li>
                    <p>Todos los enterprise beans empaquetados dentro de WAR</p>
                  </li>
                </ul>
              </div>
            </li>
            <li>
              <p>Inyección de Contextos y Dependencias (CDI)</p>
              <div class="ulist">
                <ul>
                  <li>
                    <p>Anotaciones CDI para componentes JavaServer Faces</p>
                  </li>
                  <li>
                    <p>
                      Un bean administrado por CDI que se usa como carrito de compras, con alcance de 
                      conversación
                    </p>
                  </li>
                  <li>
                    <p>Clasificatorios</p>
                  </li>
                  <li>
                    <p>Eventos y controladores de eventos</p>
                  </li>
                </ul>
              </div>
            </li>
            <li>
              <p>Servlets</p>
              <div class="ulist">
                <ul>
                  <li>
                    <p>Un servlet para la presentación dinámica de imágenes.</p>
                  </li>
                </ul>
              </div>
            </li>
            <li>
              <p>Tecnología JavaServer Faces, usando Facelets para el front-end web</p>
              <div class="ulist">
                <ul>
                  <li>
                    <p>Plantillas</p>
                  </li>
                  <li>
                    <p>Componentes compuestos</p>
                  </li>
                  <li>
                    <p>Carga de archivos</p>
                  </li>
                  <li>
                    <p>
                      Recursos empaquetados en un archivo JAR para que se puedan encontrar en el classpath
                    </p>
                  </li>
                </ul>
              </div>
            </li>
            <li>
              <p>Seguridad</p>
              <div class="ulist">
                <ul>
                  <li>
                    <p>
                      Restricciones de seguridad de Java EE en los métodos comerciales de la interfaz 
                      administrativa (enterprise beans)
                    </p>
                  </li>
                  <li>
                    <p>Restricciones de seguridad para clientes y administradores (componentes web)</p>
                  </li>
                  <li>
                    <p>
                      Inicio de Sesión Unico (SSO, en inglés) para propagar una identidad de usuario 
                      autenticada desde La Tienda de Duke a Envíos de Duke
                    </p>
                  </li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
        <div class="paragraph">
          <p>
           La aplicación El Bosque de Duke tiene dos interfaces de usuario principales, ambas empaquetadas 
           dentro del archivo WAR de La Tienda de Duke:
          </p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p>La interfaz principal, para clientes e invitados</p>
            </li>
            <li>
              <p>
                La interfaz administrativa utilizada para realizar operaciones administrativas, como agregar 
                nuevos artículos al catálogo.
              </p>
            </li>
          </ul>
        </div>
        <div class="paragraph">
          <p>
            La aplicación Envíos de Duke también tiene una interfaz de usuario a la que pueden acceder los 
            administradores.
          </p>
        </div>
        <div class="paragraph">
          <p>
            La <a href="#CIHCHCAA">Figura 62-2</a> muestra cómo interactúan las aplicaciones web y el servicio 
            web.
          </p>
        </div>
        <div id="CIHCHCAA" class="paragraph">
          <div class="title">
            <strong>Figura 62-2 Interacciones Entre los Componentes de El Bosque de Duke</strong>
          </div>
          <p>
            <span class="image">
              <img src="img/javaeett_dt_063.png" 
                   alt="Esta figura muestra las interacciones entre los proyectos La Tienda de Duke y Envíos 
                   de Duke (usando REST y HTTP), y entre los proyectos La Tienda de Duke y Los Pagos de Duke 
                   (usando REST y HTTP).">
            </span>
          </p>
        </div>
        <div class="paragraph">
          <p>
            Como se ilustra en la <a href="#CIHCHCAA">Figura 62-2</a>, el cliente interactúa con la interfaz 
            principal de La Tienda de Duke, mientras que el administrador interactúa con la interfaz de 
            administración. Ambas interfaces acceden a una fachada que consta de beans administrados y beans 
            de sesión sin estado, que a su vez interactúan con las entidades que representan las tablas de la 
            base de datos. La fachada también interactúa con las IPA de servicios web que acceden al servicio 
            web Pagos de Duke. Cuando se aprueba el pago de un pedido, La Tienda de Duke envía el pedido a una 
            cola JMS. El administrador también interactúa con la interfaz de Envíos de Duke, a la que se puede 
            acceder directamente a través de Envíos de Duke o desde la interfaz de administración de La Tienda 
            de Duke mediante un servicio web. Cuando el administrador aprueba el envío de un pedido, Envíos de 
            Duke consume el pedido de la cola JMS.
          </p>
        </div>
        <div class="paragraph">
          <p>
            Los bloques de construcción más fundamentales de la aplicación son los proyectos de eventos y 
            entidades, que se incluyen en La Tienda de Duke y Envíos de Duke junto con el proyecto Recursos de 
            Duke.
          </p>
        </div>
        <div class="sect2" id="CIHHJEGA">
          <h3 id="the-events-project">El Proyecto eventos</h3>
          <div class="paragraph">
            <p>
              Los eventos son uno de los componentes centrales de El Bosque de Duke. El proyecto 
              <code>events</code>, incluido en los tres proyectos principales, es el proyecto más simple de la 
              aplicación. Tiene solo una clase, <code>OrderEvent</code>, pero esta clase es responsable de la 
              mayoría de los mensajes entre objetos en la aplicación.
            </p>
          </div>
          <div class="paragraph">
            <p>
              La aplicación puede enviar mensajes basados en eventos a diferentes componentes y reaccionar a 
              ellos en función de la calificación del evento. La aplicación admite los siguientes 
              calificadores:
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p><code>@LoggedIn</code>: para usuarios autenticados</p>
              </li>
              <li>
                <p><code>@New</code>: cuando el carrito de compras crea un nuevo pedido</p>
              </li>
              <li>
                <p><code>@Paid</code>: cuando un pedido está pagado y listo para su envío</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>
              El siguiente fragmento de código de la clase <code>PaymentHandler</code> de La Tienda de Duke 
              muestra cómo se maneja el evento <code>@Paid</code>:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
@Inject @Paid Event&lt;OrderEvent&gt; eventManager;
...
public void onNewOrder(@Observes @New OrderEvent event) {
    if (processPayment(event)) {
        orderBean.setOrderStatus(event.getOrderID(),
                String.valueOf(OrderBean.Status.PENDING_PAYMENT.getStatus()));
        logger.info("Payment Approved");
        eventManager.fire(event);
    } else {
        orderBean.setOrderStatus(event.getOrderID(),
                String.valueOf(OrderBean.Status.CANCELLED_PAYMENT.getStatus()));
        logger.info("Payment Denied");
    }
}
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              Para permitir a los usuarios agregar fácilmente más eventos al proyecto o actualizar una clase 
              de evento con más campos para un nuevo cliente, este componente es un proyecto separado dentro 
              de la aplicación.
            </p>
          </div>
        </div>
        <div class="sect2" id="CIHFCIAC">
          <h3 id="the-entities-project">El Proyecto entidades</h3>
          <div class="paragraph">
            <p>
              El proyecto <code>entities</code> es un proyecto de la IPA de Persistencia de Java (JPA) 
              utilizado tanto por La Tienda de Duke como por Envíos de Duke. Se genera a partir del esquema de 
              la base de datos que se muestra en la <a href="#GLNXD">Figura 62-3</a> y también se utiliza como 
              base para las entidades consumidas y producidas por los servicios web a través de JAXB. Cada 
              entidad tiene reglas de validación basadas en requerimientos de negocio, especificadas mediante 
              Validación de Beans.
            </p>
          </div>
          <div id="GLNXD" class="paragraph">
            <div class="title">
              <strong>Figura 62-3 Tablas de la Base de Datos de El Bosque de Duke y sus Relaciones</strong>
            </div>
            <p>
              <span class="image">
                <img src="img/javaeett_dt_064.png" 
                     alt="Esta figura muestra las tablas de la base de datos de El Bosque de Duke y sus 
                     relaciones.">
              </span>
            </p>
          </div>
          <div class="paragraph">
            <p>El esquema de la base de datos contiene ocho tablas:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>
                  <code>PERSON</code>, que tiene una relación de uno a muchos con <code>PERSON_GROUPS</code> y 
                  <code>CUSTOMER_ORDER</code>
                </p>
              </li>
              <li>
                <p>
                  <code>GROUPS</code>, que tiene una relación de uno a muchos con <code>PERSON_GROUPS</code>
                </p>
              </li>
              <li>
                <p>
                  <code>PERSON_GROUPS</code>, que tiene una relación de muchos a uno con <code>PERSON</code> y 
                  <code>GROUPS</code> (es la tabla de unión entre esas dos tablas)
                </p>
              </li>
              <li>
                <p>
                  <code>PRODUCT</code>, que tiene una relación de muchos a uno con <code>CATEGORY</code> y una 
                  relación de uno a muchos con <code>ORDER_DETAIL</code>
                </p>
              </li>
              <li>
                <p><code>CATEGORY</code>, que tiene una relación de uno a muchos con <code>PRODUCT</code></p>
              </li>
              <li>
                <p>
                  <code>CUSTOMER_ORDER</code>, que tiene una relación de uno a muchos con 
                  <code>ORDER_DETAIL</code> y una relación de muchos a uno con <code>PERSON</code> y 
                  <code>ORDER_STATUS</code>
                </p>
              </li>
              <li>
                <p>
                  <code>ORDER_DETAIL</code>, que tiene una relación de muchos a uno con <code>PRODUCT</code> y 
                  <code>CUSTOMER_ORDER</code> (es la tabla de unión entre esas dos tablas)
                </p>
              </li>
              <li>
                <p>
                  <code>ORDER_STATUS</code>, que tiene una relación de uno a muchos con 
                  <code>CUSTOMER_ORDER</code>
                </p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>Las clases de entidad que corresponden a estas tablas son las siguientes.</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>
                  <code>Person</code>, que define atributos comunes a clientes y administradores. Estos 
                  atributos son el nombre de la persona y la información de contacto, incluidas la calle y las 
                  direcciones de correo electrónico. La dirección de correo electrónico tiene una anotación de 
                  Validación de Beans para garantizar que los datos enviados estén bien formados. La tabla 
                  generada para la entidad <code>Person</code> también tiene un campo <code>DTYPE</code> que 
                  representa la columna discriminadora. Su valor identifica la subclase 
                  (<code>Customer</code> o <code>Administrator</code>) a la que pertenece la persona.
                </p>
              </li>
              <li>
                <p>
                  <code>Customer</code>, una especialización de <code>Person</code> con un campo específico 
                  para objetos <code>CustomerOrder</code>.
                </p>
              </li>
              <li>
                <p>
                  <code>Administrator</code>, una especialización de <code>Person</code> con campos para 
                  privilegios de administración.
                </p>
              </li>
              <li>
                <p>
                  <code>Groups</code>, que representa el grupo (<code>USERS</code> o <code>ADMINS</code>) al 
                  que pertenece el usuario.
                </p>
              </li>
              <li>
                <p>
                  <code>Product</code>, que define los atributos de los productos. Estos atributos incluyen 
                  nombre, precio, descripción, imagen asociada y categoría.
                </p>
              </li>
              <li>
                <p>
                  <code>Category</code>, que define atributos para categorías de productos. Estos atributos 
                  incluyen un nombre y un conjunto de etiquetas.
                </p>
              </li>
              <li>
                <p>
                  <code>CustomerOrder</code>, que define los atributos de los pedidos realizados por los 
                  clientes. Estos atributos incluyen una cantidad y una fecha, junto con los valores de 
                  identificación del cliente y el detalle del pedido.
                </p>
              </li>
              <li>
                <p>
                  <code>OrderDetail</code>, que define atributos para el detalle del pedido. Estos atributos 
                  incluyen una cantidad y valores de identificación para el producto y el cliente.
                </p>
              </li>
              <li>
                <p><code>OrderStatus</code>, que define un atributo de estado para cada pedido.</p>
              </li>
            </ul>
          </div>
        </div>
        <div class="sect2" id="sthref301">
          <h3 id="the-dukes-payment-project">El Proyecto pagos-de-duke</h3>
          <div class="paragraph">
            <p>
              El proyecto <code>dukes-payment</code> es un proyecto web que contiene un servicio web de pago 
              simple. Dado que esta es una aplicación de ejemplo, no obtiene ninguna información de crédito 
              real ni siquiera el estado del cliente para validar el pago. Por ahora, la única regla que 
              impone el sistema de pago es denegar todos los pedidos superiores a $1,000. Esta aplicación 
              ilustra un escenario común en el que se utiliza un servicio de pago de terceros para validar 
              tarjetas de crédito o pagos bancarios.
            </p>
          </div>
          <div class="paragraph">
            <p>
              El proyecto utiliza autenticación básica HTTP y JAAS (Servicio de Autenticación y Autorización 
              de Java) para autenticar a un cliente en un servicio web JAX-RS. La implementación en sí expone 
              un método simple, <code>processPayment</code>, que recibe un <code>OrderEvent</code> para 
              evaluar y aprobar o denegar el pago del pedido. El método se llama desde el proceso de pago de 
              La Tienda de Duke.
            </p>
          </div>
        </div>
        <div class="sect2" id="sthref302">
          <h3 id="the-dukes-resources-project">El Proyecto recursos-de-duke</h3>
          <div class="paragraph">
            <p>
              El proyecto <code>dukes-resources</code> contiene una serie de archivos utilizados tanto por La 
              Tienda de Duke como por Envíos de Duke, agrupados en un archivo JAR ubicado en el classpath. Los 
              recursos están en el directorio <code>src/main/resources</code>:
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>
                  <code>META-INF/resources/css</code>: dos hojas de estilo, <code>default.css</code> y 
                  <code>jsfcrud.css</code>
                </p>
              </li>
              <li><p><code>META-INF/resources/img</code>: Imágenes utilizadas por los proyectos</p></li>
              <li><p><code>META-INF/resources/js</code>: un archivo JavaScript, <code>util.js</code></p></li>
              <li>
                <p>
                  <code>META-INF/resources/util</code>: Componentes compuestos utilizados por los proyectos
                </p>
              </li>
              <li><p><code>bundles/Bundle.properties</code>: Mensajes de la aplicación en inglés</p></li>
              <li><p><code>bundles/Bundle_es.properties</code>: Mensajes de la aplicación en español</p></li>
              <li>
                <p><code>ValidationMessages.properties</code>: Mensajes de Validación de Beans en Inglés</p>
              </li>
              <li>
                <p>
                  <code>ValidationMessages_es.properties</code>: Mensajes de Validación de Beans en Español
                </p>
              </li>
            </ul>
          </div>
        </div>
        <div class="sect2" id="sthref303">
          <h3 id="the-dukes-store-project">El Proyecto de la Tienda de Duke</h3>
          <div class="paragraph">
            <p>
              La Tienda de Duke, una aplicación web, es la aplicación principal de El Bosque de Duke. Es 
              responsable de la interfaz de la tienda principal para los clientes, así como de la interfaz de 
              administración.
            </p>
          </div>
          <div class="paragraph">
            <p>
              La interfaz principal de La Tienda de Duke permite al usuario realizar las siguientes tareas:
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li><p>Navegar por el catálogo de productos</p></li>
              <li><p>Registrarse como nuevo cliente</p></li>
              <li><p>Añadir productos al carrito de la compra</p></li>
              <li><p>Pagar la cuenta e irse</p></li>
              <li><p>Ver el estado del pedido</p></li>
            </ul>
          </div>
          <div class="paragraph">
            <p>
              La interfaz de administración de La Tienda de Duke permite a los administradores realizar las 
              siguientes tareas:
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li><p>Mantenimiento del producto (crear, editar, actualizar, eliminar)</p></li>
              <li><p>Mantenimiento de categorías (crear, editar, actualizar, eliminar)</p></li>
              <li><p>Mantenimiento de clientes (crear, editar, actualizar, eliminar)</p></li>
              <li><p>Mantenimiento de grupos (crear, editar, actualizar, eliminar)</p></li>
            </ul>
          </div>
          <div class="paragraph">
            <p>
              El proyecto también utiliza beans de sesión sin estado como fachadas para las interacciones con 
              las entidades JPA descritas en <a href="#CIHFCIAC">El Proyecto entidades</a>, y beans 
              administrados por CDI como controladores para las interacciones con las páginas de Facelets. El 
              proyecto sigue así el patrón MVC (Modelo-Vista-Controlador) y aplica el mismo patrón a todas las 
              entidades y páginas, como en el siguiente ejemplo.
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>
                  <code>AbstractFacade</code> es una clase abstracta que recibe un <code>Type&lt;T&gt;</code> 
                  e implementa las operaciones comunes (CRUD) para este tipo, donde 
                  <code>&lt;T&gt;</code> es una entidad JPA.
                </p>
              </li>
              <li>
                <p>
                  <code>ProductBean</code> es un bean de sesión sin estado que extiende 
                  <code>AbstractFacade</code>, aplicando <code>Product</code> como <code>Type&lt;T&gt;</code>, 
                  e inyecta el <code>PersistenceContext</code> para el <code>EntityManager</code>. Este bean 
                  implementa cualquier método personalizado necesario para interactuar con la entidad 
                  <code>Product</code> o para llamar a una consulta personalizada.
                </p>
              </li>
              <li>
                <p>
                  <code>ProductController</code> es un bean administrado por CDI que interactúa con los 
                  enterprise beans y las páginas Facelets necesarios para controlar la forma en que se 
                  mostrarán los datos.
                </p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p><code>ProductBean</code> comienza de la siguiente manera:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
@Stateless
public class ProductBean extends AbstractFacade&lt;Product&gt; {
    private static final Logger logger =
        Logger.getLogger(ProductBean.class.getCanonicalName());
    @PersistenceContext(unitName="forestPU")
    private EntityManager em;
    @Override
    protected EntityManager getEntityManager() {
        return em;
    }
    ...
                </code>
              </pre>
            </div>
          </div>
          <div class="sect3" id="sthref304">
            <h4 id="enterprise-beans-used-in-dukes-store">Enterprise Beans Usados en la Tienda de Duke</h4>
            <div class="paragraph">
              <p>
                Los enterprise beans utilizados en La Tienda de Duke proporcionan la lógica de negocio para la 
                aplicación y se encuentran en el paquete <code>com.forest.ejb</code>. Todos son beans de 
                sesión sin estado.
              </p>
            </div>
            <div class="paragraph">
              <p>
                <code>AbstractFacade</code> no es un enterprise bean sino una clase abstracta que implementa 
                operaciones comunes para <code>Type&lt;T&gt;</code>, donde <code>&lt;T&gt;</code> es una 
                entidad JPA.
              </p>
            </div>
            <div class="paragraph">
              <p>
                La mayoría de los otros beans extienden <code>AbstractFacade</code>, inyectan 
                <code>PersistenceContext</code> e implementan los métodos personalizados necesarios:
              </p>
            </div>
            <div class="ulist">
              <ul>
                <li><p><code>AdministratorBean</code></p></li>
                <li><p><code>CategoryBean</code></p></li>
                <li><p><code>EventDispatcherBean</code></p></li>
                <li><p><code>GroupsBean</code></p></li>
                <li><p><code>OrderBean</code></p></li>
                <li><p><code>OrderDetailBean</code></p></li>
                <li><p><code>OrderJMSManager</code></p></li>
                <li><p><code>OrderStatusBean</code></p></li>
                <li><p><code>ProductBean</code></p></li>
                <li><p><code>ShoppingCart</code></p></li>
                <li><p><code>UserBean</code></p></li>
              </ul>
            </div>
            <div class="paragraph">
              <p>
                La clase <code>ShoppingCart</code>, aunque está en el paquete <code>ejb</code>, es un bean 
                administrado por CDI con ámbito de conversación, lo que significa que la información de la 
                solicitud persistirá en varias solicitudes. Además, <code>ShoppingCart</code> es responsable 
                de iniciar la cadena de eventos para los pedidos de los clientes, que invoca el servicio web 
                RESTful en <code>dukes-payment</code> y publica un pedido en la cola JMS para la aprobación 
                del envío si el pago es exitoso.
              </p>
            </div>
          </div>
          <div class="sect3" id="sthref305">
            <h4 id="facelets-files-used-in-the-main-interface-of-dukes-store">
              Archivos Facelets Usados en la Interfaz Principal de la Tienda de Duke
            </h4>
            <div class="paragraph">
              <p>
                Al igual que los otros ejemplos de estudios de casos, La Tienda de Duke usa Facelets para 
                mostrar la interfaz de usuario. La interfaz principal utiliza una gran cantidad de páginas 
                Facelets para mostrar diferentes áreas. Las páginas se agrupan en directorios según el módulo 
                que manejan.
              </p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>
                    <code>template.xhtml</code>: archivo de plantilla, utilizado para las interfaces principal 
                    y de administración. Primero realiza una revisión del navegador para verificar que el 
                    navegador del usuario soporte HTML 5, el cual es requerido para El Bosque de Duke. Divide 
                    la pantalla en varias áreas y especifica la página del cliente para cada área.
                  </p>
                </li>
                <li>
                  <p>
                    <code>topbar.xhtml</code>: Página para el área de inicio de sesión en la parte superior de 
                    la pantalla.
                  </p>
                </li>
                <li><p><code>top.xhtml</code>: Página para el área de título.</p></li>
                <li><p><code>left.xhtml</code>: Página de la barra lateral izquierda.</p></li>
                <li><p><code>index.xhtml</code>: Página para el contenido de la pantalla principal.</p></li>
                <li>
                  <p>
                    <code>login.xhtml</code>: página de inicio de sesión especificada en <code>web.xml</code>. 
                    La interfaz de inicio de sesión principal se proporciona en <code>topbar.xhtml</code>, 
                    pero esta página aparece si hay un error de inicio de sesión.
                  </p>
                </li>
                <li>
                  <p>
                    Directorio <code>admin</code>: Páginas relacionadas con la interfaz de administración, 
                    descritas en 
                    <a href="#CIHHDHIH">
                      Archivos Facelets Utilizados en la Interfaz de Administración de la Tienda de Duke
                    </a>.
                  </p>
                </li>
                <li>
                  <p>
                    Directorio <code>cliente</code>: Páginas relacionadas con los clientes 
                    (<code>Create.xhtml</code>, <code>Edit.xhtml</code>, <code>List.xhtml</code>, 
                    <code >Perfil.xhtml</code>, <code>View.xhtml</code>).
                  </p>
                </li>
                <li>
                  <p>
                    Directorio <code>order</code>: páginas relacionadas con pedidos 
                    (<code>Create.xhtml</code>, <code>List.xhtml</code>, <code>MyOrders.xhtml</code>, 
                    <code>Ver.xhtml</code>).
                  </p>
                </li>
                <li>
                  <p>
                    Directorio <code>orderDetail</code>: página emergente que permite a los usuarios ver los 
                    detalles de un pedido (<code>View_popup.xhtml</code>).
                  </p>
                </li>
                <li>
                  <p>
                    Directorio <code>product</code>: Páginas relacionadas con productos 
                    (<code>List.xhtml</code>, <code>ListCategory.xhtml</code>, <code>View.xhtml</code>).
                  </p>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3" id="CIHHDHIH">
            <h4 id="facelets-files-used-in-the-administration-interface-of-dukes-store">
              Archivos Facelets Utilizados en la Interfaz de Administración de la Tienda de Duke
            </h4>
            <div class="paragraph">
              <p>
                Las páginas de Facelets para la interfaz de administración de La Tienda de Duke se encuentran 
                en el directorio <code>web/admin</code>:
              </p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>
                    Directorio <code>administrator</code>: Páginas relacionadas con la gestión del 
                    administrador (<code>Create.xhtml</code>, <code>Edit.xhtml</code>, <code>List.xhtml, 
                      View.xhtml</code>)
                  </p>
                </li>
                <li>
                  <p>
                    Directorio <code>category</code>: páginas relacionadas con la gestión de categorías de 
                    productos (<code>Create.xhtml</code>, <code>Edit.xhtml</code>, <code>List.xhtml</code>, 
                    <code>View.xhtml</code>)
                  </p>
                </li>
                <li>
                  <p>
                    Directorio <code>cliente</code>: Páginas relacionadas con la gestión de clientes 
                    (<code>Create.xhtml</code>, <code>Edit.xhtml</code>, <code>List.xhtml</code>, 
                    <code>Profile.xhtml</code>, <code>View.xhtml</code>)
                  </p>
                </li>
                <li>
                  <p>
                    Directorio <code>groups</code>: páginas relacionadas con la gestión de grupos 
                    (<code>Create.xhtml</code>, <code>Edit.xhtml</code>, <code>List.xhtml</code>, 
                    <code>View.xhtml</code>)
                  </p>
                </li>
                <li>
                  <p>
                    Directorio <code>order</code>: páginas relacionadas con la gestión de pedidos 
                    (<code>Create.xhtml</code>, <code>Edit.xhtml</code>, <code>List.xhtml</code>, 
                    <code>View.xhtml</code>)
                  </p>
                </li>
                <li>
                  <p>
                    Directorio <code>orderDetail</code>: página emergente que permite al administrador ver los 
                    detalles de un pedido (<code>View_popup.xhtml</code>)
                  </p>
                </li>
                <li>
                  <p>
                    Directorio <code>producto</code>: Páginas relacionadas con la gestión de productos 
                    (<code>Confirm.xhtml, Create.xhtml</code>, <code>Edit.xhtml</code>, 
                    <code>List.xhtml</code>, <code>View.xhtml</code>)
                  </p>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3" id="sthref306">
            <h4 id="managed-beans-used-in-dukes-store">Beans Gestionados Usados en la Tienda de Duke</h4>
            <div class="paragraph">
              <p>
                La Tienda de Duke utiliza los siguientes beans gestionados por CDI, que corresponden a los 
                enterprise beans. Los beans están en el paquete <code>com.forest.web</code>:
              </p>
            </div>
            <div class="ulist">
              <ul>
                <li><p><code>AdministratorController</code></p></li>
                <li><p><code>CategoryController</code></p></li>
                <li><p><code>CustomerController</code></p></li>
                <li><p><code>CustomerOrderController</code></p></li>
                <li><p><code>GroupsController</code></p></li>
                <li><p><code>OrderDetailController</code></p></li>
                <li><p><code>OrderStatusController</code></p></li>
                <li><p><code>ProductController</code></p></li>
                <li><p><code>UserController</code></p></li>
              </ul>
            </div>
          </div>
          <div class="sect3" id="sthref307">
            <h4 id="helper-classes-used-in-dukes-store">Clases Auxiliares Usadas en la Tienda de Duke</h4>
            <div class="paragraph">
              <p>
                Los beans administrados por CDI en la interfaz principal de La Tienda de Duke utilizan las 
                siguientes clases auxiliares, que se encuentran en el paquete 
                <code>com.forest.web.util</code>:
              </p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>
                    <code>AbstractPaginationHelper</code>: una clase abstracta con métodos utilizados por los 
                    beans administrados
                  </p>
                </li>
                <li>
                  <p>
                    <code>ImageServlet</code>: una clase de servlet que recupera el contenido de la imagen de 
                    la base de datos y lo muestra
                  </p>
                </li>
                <li>
                  <p>
                    <code>JsfUtil</code>: clase utilizada para las operaciones de JavaServer Faces, como la 
                    cola de mensajes en una instancia de <code>FacesContext</code>
                  </p>
                </li>
                <li>
                  <p>
                    <code>MD5Util</code>: Clase utilizada por el bean gestionado 
                    <code>CustomerController</code> para generar una contraseña cifrada para un usuario
                  </p>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3" id="CIHEBAFD">
            <h4 id="qualifiers-used-in-dukes-store">Calificadores Utilizados en la Tienda de Duke</h4>
            <div class="paragraph">
              <p>
                La Tienda de Duke define los siguientes calificadores en el paquete 
                <code>com.forest.qualifiers</code>:
              </p>
            </div>
            <div class="ulist">
              <ul>
                <li><p><code>@LoggedIn</code>: califica a un usuario como que ha iniciado sesión</p></li>
                <li><p><code>@New</code>: califica un pedido como nuevo</p></li>
                <li><p><code>@Paid</code>: califica un pedido como pagado</p></li>
              </ul>
            </div>
          </div>
          <div class="sect3" id="sthref308">
            <h4 id="event-handlers-used-in-dukes-store">
              Controladores de Eventos Utilizados en la Tienda de Duke
            </h4>
            <div class="paragraph">
              <p>
                La Tienda de Duke define manejadores de eventos relacionados con la clase 
                <code>OrderEvent</code> empaquetada en el proyecto <code>events</code> (ver 
                <a href="#CIHHJEGA">El Proyecto eventos</a>). Los controladores de eventos se encuentran en el 
                paquete <code>com.forest.handlers</code>.
              </p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>
                    <code>IOrderHandler</code>: la interfaz <code>IOrderHandler</code> define un método, 
                    <code>onNewOrder</code>, implementado por las dos clases de controlador.
                  </p>
                </li>
                <li>
                  <p>
                    <code>PaymentHandler</code>: el bean <code>ShoppingCart</code> activa un 
                    <code>OrderEvent</code> calificado como <code>@New</code>. El método 
                    <code>onNewOrder</code> de <code>PaymentHandler</code> observa estos eventos y, cuando los 
                    intercepta, procesa el pago mediante el servicio web Pagos de Duke. Después de una 
                    respuesta exitosa del servicio web, <code>PaymentHandler</code> activa el 
                    <code>OrderEvent</code> nuevamente, esta vez calificado como <code>@Paid</code>.
                  </p>
                </li>
                <li>
                  <p>
                    <code>DeliveryHandler</code>: El método <code>onNewOrder</code> de 
                    <code>DeliveryHandler</code> observa objetos <code>OrderEvent</code> calificados como 
                    <code>@Paid</code> (pedidos pagados y listos para entrega) y modifica el estado del pedido 
                    a <code>PENDING_SHIPMENT</code>. Cuando un administrador accede a Envíos de Duke, llamará 
                    al Servicio de pedidos, un servicio web RESTful, y solicitará todos los pedidos de la base 
                    de datos que estén listos para la entrega.
                  </p>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3" id="sthref309">
            <h4 id="deployment-descriptors-used-in-dukes-store">
              Descriptores de Implementación Utilizados en la Tienda de Duke
            </h4>
            <div class="paragraph">
              <p>
                La Tienda de Duke utiliza los siguientes descriptores de implementación, ubicados en el 
                directorio <code>web/WEB-INF</code>:
              </p>
            </div>
            <div class="ulist">
              <ul>
                <li><p><code>faces-config.xml</code>: El archivo de configuración de JavaServer Faces</p></li>
                <li>
                  <p>
                    <code>glassfish-web.xml</code>: el archivo de configuración específico del servidor 
                    GlassFish 
                  </p>
                </li>
                <li><p><code>web.xml</code>: El archivo de configuración de la aplicación web</p></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="sect2" id="sthref310">
          <h3 id="the-dukes-shipment-project">El Proyecto de Envío de Duke</h3>
          <div class="paragraph">
            <p>
              Envíos de Duke es una aplicación web con una página de inicio de sesión, una página principal de 
              Facelets y algunos otros objetos. Esta aplicación, a la que solo pueden acceder los 
              administradores, consume pedidos de una cola JMS y llama al servicio web RESTful expuesto por La 
              Tienda de Duke para actualizar el estado del pedido. La página principal de Envíos de Duke 
              muestra una lista de pedidos pendientes de aprobación de envío y una lista de pedidos enviados. 
              El administrador puede aprobar o denegar pedidos para su envío. Si se aprueba, el pedido se 
              envía y aparece bajo el encabezado Enviado. Si es denegado, el pedido desaparece de la página, 
              y en la lista de Pedidos del cliente aparece como cancelado.
            </p>
          </div>
          <div class="paragraph">
            <p>
              También hay un icono de engranaje en la lista Pendiente que realiza una llamada Ajax al Servicio 
              de pedidos para actualizar la lista sin actualizar la página. El código se ve así:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
&lt;h:commandLink&gt;
    &lt;h:graphicImage library="img" title="Check for new orders"
                    style="border:0px" name="refresh.png"/&gt;
    &lt;f:ajax execute="@form" render="@form" /&gt;
&lt;/h:commandLink&gt;
                </code>
              </pre>
            </div>
          </div>
          <div class="sect3" id="sthref311">
            <h4 id="enterprise-beans-used-in-dukes-shipment">Enterprise Beans Usados en el Envío de Duke</h4>
            <div class="paragraph">
              <p>
                El bean de sesión sin estado <code>UserBean</code> utilizado en Envíos de Duke proporciona la 
                lógica de negocio para la aplicación y se encuentra en el paquete 
                <code>com.forest.shipment.session</code>.
              </p>
            </div>
            <div class="paragraph">
              <p>
                Al igual que La Tienda de Duke, Envíos de Duke usa la clase <code>AbstractFacade</code>. Esta 
                clase no es un enterprise bean sino una clase abstracta que implementa operaciones comunes 
                para <code>Type&lt;T&gt;</code>, donde <code>&lt;T&gt;</code> es una entidad JPA.
              </p>
            </div>
            <div class="paragraph">
              <p>
                El bean de sesión sin estado <code>OrderBrowser</code>, ubicado en el paquete 
                <code>com.forest.shipment.ejb</code>, tiene un método que examina la cola de pedidos JMS y 
                otro que consume un mensaje de pedido después del administrador aprueba o deniega la orden de 
                envío.
              </p>
            </div>
          </div>
          <div class="sect3" id="sthref312">
            <h4 id="facelets-files-used-in-dukes-shipment">Archivos Facelets Usados en el  Envío de Duke</h4>
            <div class="paragraph">
              <p>
                Envíos de Duke tiene solo una página, por lo que tiene muchos menos archivos Facelets que La 
                Tienda de Duke.
              </p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>
                    <code>template.xhtml</code>: El archivo de plantilla, como el de La Tienda de Duke, 
                    primero realiza una revisión del navegador para verificar que el navegador del usuario 
                    soporte HTML 5, el cual es requerido para El Bosque de Duke. Divide la pantalla en áreas y 
                    especifica la página del cliente para cada área.
                  </p>
                </li>
                <li>
                  <p>
                    <code>topbar.xhtml</code>: Página para el área de inicio de sesión en la parte superior de 
                    la pantalla.
                  </p>
                </li>
                <li><p><code>top.xhtml</code>: Página para el área de título.</p></li>
                <li>
                  <p><code>index.xhtml</code>: Página para el contenido inicial de la pantalla principal.</p>
                </li>
                <li>
                  <p>
                    <code>login.xhtml</code>: página de inicio de sesión especificada en <code>web.xml</code>. 
                    La interfaz de inicio de sesión principal se proporciona en <code>topbar.xhtml</code>, 
                    pero esta página aparece si hay un error de inicio de sesión.
                  </p>
                </li>
                <li>
                  <p>
                    <code>admin/index.xhtml</code>: Página para el contenido de la pantalla principal después 
                    de la autenticación.
                  </p>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3" id="sthref313">
            <h4 id="managed-beans-used-in-dukes-shipment">Beans Gestionados Usados en el Envío de Duke</h4>
            <div class="paragraph">
              <p>
                Envíos de Duke utiliza los siguientes beans administrados por CDI, en el paquete 
                <code>com.forest.shipment</code>:
              </p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>
                    <code>web.ShippingBean</code>: bean gestionado que actúa como cliente del servicio de 
                    pedidos
                  </p>
                </li>
                <li>
                  <p>
                    <code>web.UserController</code>: bean administrado que corresponde al bean de sesión 
                    <code>UserBean</code>
                  </p>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3" id="sthref314">
            <h4 id="helper-class-used-in-dukes-shipment">Clases Auxiliares Usadas en el Envío de Duke</h4>
            <div class="paragraph">
              <p>
                Los beans administrados de Envíos de Duke usan solo una clase auxiliar, que se encuentra en el 
                paquete <code>com.forest.shipment.web.util</code>:
              </p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>
                    <code>JsfUtil</code>: clase utilizada para las operaciones de JavaServer Faces, como la 
                    cola de mensajes en una instancia de <code>FacesContext</code>
                  </p>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3" id="sthref315">
            <h4 id="qualifier-used-in-dukes-shipment">Calificador Utilizado en el Envío de Duke</h4>
            <div class="paragraph">
              <p>
                El Envío de Duke incluye el calificador <code>@LoggedIn</code> descrito en 
                <a href="#CIHEBAFD">Calificadores Utilizados en la Tienda de Duke</a>.
              </p>
            </div>
          </div>
          <div class="sect3" id="sthref316">
            <h4 id="deployment-descriptors-used-in-dukes-shipment">
              Descriptores de Despliegue Utilizados en el Envío de Duke
            </h4>
            <div class="paragraph">
              <p>Envíos de Duke utiliza los siguientes descriptores de despliegue:</p>
            </div>
            <div class="ulist">
              <ul>
                <li><p><code>faces-config.xml</code>: El archivo de configuración de JavaServer Faces</p></li>
                <li>
                  <p>
                    <code>glassfish-web.xml</code>: el archivo de configuración específico del servidor 
                    GlassFish 
                  </p>
                </li>
                <li><p><code>web.xml</code>: El archivo de configuración de la aplicación web</p></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>		
        <td align="left">
          <a href="dukes-forest001.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="dukes-forest003.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <span id="copyright">
      <a href="img/cpyr.adoc">
        <img src="img/oracle.gif" height="10" alt="Logo de Oracle" />&nbsp;			
        <span>
          Copyright&nbsp;&copy;&nbsp;2017,&nbsp;Oracle&nbsp;y/o&nbsp;sus&nbsp;afiliados.&nbsp;Todos&nbsp;los&nbsp;
          derechos&nbsp;reservados.
        </span>
      </a>
    </span>
  </body>
</html>
