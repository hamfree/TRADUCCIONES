<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <title>Caso de Uso Sencillo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
    <table id="doc-title" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top">
          <b>Plataforma Java, Edición Empresarial (Java EE) 8</b><br />
          <b>El Tutorial de Java EE</b>
        </td>
      </tr>
    </table>
    <hr />
    <table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>
        <td align="left">
          <a href="batch-processing002.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="batch-processing004.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <div class="sect1" id="BCGHBJIG">
      <h2 id="simple-use-case">Caso de Uso Sencillo</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>
            Esta sección demuestra cómo definir un trabajo simple utilizando el Lenguaje de Especificación de 
            Trabajos (JSL, en inglés) y cómo implementar los artefactos por lotes correspondientes. Consulte 
            el resto de las secciones de este capítulo para obtener descripciones detalladas de los elementos 
            del marco de trabajo por lotes.
          </p>
        </div>
        <div class="paragraph">
          <p>
            La siguiente definición de trabajo especifica un paso de fragmento y un paso de tarea de la 
            siguiente manera:
          </p>
        </div>
        <div class="listingblock">
          <div class="content">
            <pre class="prettyprint highlight">
              <code class="language-oac_no_warn" data-lang="oac_no_warn">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;job id="simplejob" xmlns="http://xmlns.jcp.org/xml/ns/javaee"
                    version="1.0"&gt;
  &lt;properties&gt;
    &lt;property name="input_file" value="input.txt"/&gt;
    &lt;property name="output_file" value="output.txt"/&gt;
  &lt;/properties&gt;
  &lt;step id="mychunk" next="mytask"&gt;
    &lt;chunk&gt;
      &lt;reader ref="MyReader"&gt;&lt;/reader&gt;
      &lt;processor ref="MyProcessor"&gt;&lt;/processor&gt;
      &lt;writer ref="MyWriter"&gt;&lt;/writer&gt;
    &lt;/chunk&gt;
  &lt;/step&gt;
  &lt;step id="mytask"&gt;
    &lt;batchlet ref="MyBatchlet"&gt;&lt;/batchlet&gt;
    &lt;end on="COMPLETED"/&gt;
  &lt;/step&gt;
&lt;/job&gt;
              </code>
            </pre>
          </div>
        </div>
        <div class="sect2">
          <h3 id="chunk-step">Paso de Fragmento</h3>
          <div class="paragraph">
            <p>
              En la mayoría de los casos, debe implementar una clase de punto de control para pasos orientados 
              a fragmentos. La siguiente clase solo realiza un seguimiento del número de línea en un archivo 
              de texto:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
public class MyCheckpoint implements Serializable {
    private long lineNum = 0;
    public void increase() { lineNum++; }
    public long getLineNum() { return lineNum; }
}
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              La siguiente implementación del lector de elementos continúa leyendo el archivo de entrada desde 
              el punto de control proporcionado si se reinició el trabajo. Los elementos consisten en cada 
              línea del archivo de texto (en escenarios más complejos, los elementos son tipos de Java 
              personalizados y la fuente de entrada puede ser una base de datos):
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
@Dependent
@Named("MyReader")
public class MyReader implements javax.batch.api.chunk.ItemReader {
    private MyCheckpoint checkpoint;
    private BufferedReader breader;
    @Inject
    JobContext jobCtx;
    public MyReader() {}
    @Override
    public void open(Serializable ckpt) throws Exception {
        if (ckpt == null)
            checkpoint = new MyCheckpoint();
        else
            checkpoint = (MyCheckpoint) ckpt;
        String fileName = jobCtx.getProperties()
                                .getProperty("input_file");
        breader = new BufferedReader(new FileReader(fileName));
        for (long i = 0; i &lt; checkpoint.getLineNum(); i++)
            breader.readLine();
    }
    @Override
    public void close() throws Exception {
        breader.close();
    }
    @Override
    public Object readItem() throws Exception {
        String line = breader.readLine();
        return line;
    }
}
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              En el siguiente caso, el procesador de elementos solo convierte la línea a mayúsculas. Los 
              ejemplos más complejos pueden procesar elementos de diferentes maneras o transformarlos en tipos 
              Java de salida personalizados:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
@Dependent
@Named("MyProcessor")
public class MyProcessor implements javax.batch.api.chunk.ItemProcessor {
    public MyProcessor() {}
    @Override
    public Object processItem(Object obj) throws Exception {
        String line = (String) obj;
        return line.toUpperCase();
    }
}
                </code>
              </pre>
            </div>
          </div>
          <table class="tableblock frame-all grid-all spread">
            <colgroup>
              <col style="width: 100%;">
            </colgroup>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Nota:</p>
                    </div>
                    <div class="paragraph">
                      <p>
                        La IPA de procesamiento por lotes no admite genéricos. En la mayoría de los casos, 
                        debe convertir los elementos en su tipo específico antes de procesarlos.
                      </p>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="paragraph">
            <p>
              El escritor de elementos escribe los elementos procesados en el archivo de salida. Sobrescribe 
              el archivo de salida si no se proporciona ningún punto de control; de lo contrario, reanuda la 
              escritura al final del archivo. Los elementos se escriben en fragmentos:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
@Dependent
@Named("MyWriter")
public class MyWriter implements javax.batch.api.chunk.ItemWriter {
    private BufferedWriter bwriter;
    @Inject
    private JobContext jobCtx;
    @Override
    public void open(Serializable ckpt) throws Exception {
        String fileName = jobCtx.getProperties()
                                .getProperty("output_file");
        bwriter = new BufferedWriter(new FileWriter(fileName,
                                                    (ckpt != null)));
    }
    @Override
    public void writeItems(List&lt;Object&gt; items) throws Exception {
        for (int i = 0; i &lt; items.size(); i++) {
            String line = (String) items.get(i);
            bwriter.write(line);
            bwriter.newLine();
        }
    }
    @Override
    public Serializable checkpointInfo() throws Exception {
        return new MyCheckpoint();
}
                </code>
              </pre>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="task-step">Paso de Tarea</h3>
          <div class="paragraph">
            <p>
              El paso de la tarea muestra la longitud del archivo de salida. En escenarios más complejos, los 
              pasos de la tarea realizan cualquier tarea que no se ajuste al modelo de programación de 
              procesamiento de fragmentos:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
@Dependent
@Named("MyBatchlet")
public class MyBatchlet implements javax.batch.api.chunk.Batchlet {
    @Inject
    private JobContext jobCtx;
    @Override
    public String process() throws Exception {
        String fileName = jobCtx.getProperties()
                                .getProperty("output_file");
        System.out.println(""+(new File(fileName)).length());
        return "COMPLETED";
    }
}
                </code>
              </pre>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>		
        <td align="left">
          <a href="batch-processing002.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="batch-processing004.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <span id="copyright">
      <a href="img/cpyr.adoc">
        <img src="img/oracle.gif" height="10" alt="Logo de Oracle" />&nbsp;			
        <span>
          Copyright&nbsp;&copy;&nbsp;2017,&nbsp;Oracle&nbsp;y/o&nbsp;sus&nbsp;afiliados.&nbsp;Todos&nbsp;los&nbsp;
          derechos&nbsp;reservados.
        </span>
      </a>
    </span>
  </body>
</html>
