<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <title>Enviando y Recibiendo Mensajes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
    <table id="doc-title" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top">
          <b>Plataforma Java, Edición Empresarial (Java EE) 8</b><br />
          <b>El Tutorial de Java EE</b>
        </td>
      </tr>
    </table>
    <hr />
    <table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>
        <td align="left">
          <a href="websocket004.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="websocket006.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <div class="sect1" id="BABFCGBJ">
      <h2 id="sending-and-receiving-messages">Enviando y Recibiendo Mensajes</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>
            Los extremos de WebSocket pueden enviar y recibir mensajes binarios y de texto. Además, también 
            pueden enviar tramas ping y recibir tramas pong. Esta sección describe cómo usar las interfaces 
            <code>Session</code> y <code>RemoteEndpoint</code> para enviar mensajes al par conectado y cómo 
            usar la anotación <code>OnMessage</code> para recibir mensajes de eso.
          </p>
        </div>
        <div class="paragraph">
          <p>Aquí se tratan los siguientes temas:</p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p><a href="#CIHEHFCB">Enviando Mensajes</a></p>
            </li>
            <li>
              <p><a href="#CIHIDFHD">Recibiendo Mensajes</a></p>
            </li>
          </ul>
        </div>
        <div class="sect2" id="CIHEHFCB">
          <h3 id="sending-messages">Enviando Mensajes</h3>
          <div class="paragraph">
            <p>Siga estos pasos para enviar mensajes en un punto final.</p>
          </div>
          <div class="olist arabic">
            <ol class="arabic">
              <li>
                <p>Obtenga el objeto <code>Session</code> de la conexión.</p>
                <div class="paragraph">
                  <p>
                    El objeto <code>Session</code> está disponible como parámetro en los métodos de ciclo de 
                    vida anotados del punto final, como los de la 
                    <a href="websocket004.html#BABDGEJH">Tabla 19-1</a>. Cuando su mensaje es una respuesta a 
                    un mensaje del par, tiene el objeto <code>Session</code> disponible dentro del método que 
                    recibió el mensaje (el método anotado con <code>@OnMessage</code>). Si tiene que enviar 
                    mensajes que no son respuestas, almacene el objeto <code>Session</code> como una variable 
                    de instancia de la clase de punto final en el método anotado con <code>@OnOpen</code> para 
                    que pueda acceder a él de otros métodos.
                  </p>
                </div>
              </li>
              <li>
                <p>
                  Utilice el objeto <code>Session</code> para obtener un objeto <code>RemoteEndpoint</code>.
                </p>
                <div class="paragraph">
                  <p>
                    El método <code>Session.getBasicRemote</code> y el método 
                    <code>Session.getAsyncRemote</code> devuelven objetos <code>RemoteEndpoint.Basic</code> y 
                    <code>RemoteEndpoint.Async</code> respectivamente. La interfaz 
                    <code>RemoteEndpoint.Basic</code> proporciona métodos de bloqueo para enviar mensajes; la 
                    interfaz <code>RemoteEndpoint.Async</code> proporciona métodos sin bloqueo.
                  </p>
                </div>
              </li>
              <li>
                <p>Utilice el objeto <code>RemoteEndpoint</code> para enviar mensajes al par.</p>
                <div class="paragraph">
                  <p>
                    La siguiente lista muestra algunos de los métodos que puede usar para enviar mensajes al 
                    par. * <code>void RemoteEndpoint.Basic.sendText(String text)</code>
                  </p>
                </div>
                <div class="paragraph">
                  <p>
                    Enviar un mensaje de texto al compañero. Este método bloquea hasta que se haya transmitido 
                    todo el mensaje.
                  </p>
                </div>
                <div class="ulist">
                  <ul>
                    <li>
                      <p><code>void RemoteEndpoint.Basic.sendBinary(ByteBuffer data)</code></p>
                      <div class="paragraph">
                        <p>
                          Envía un mensaje binario al par. Este método bloquea hasta que se haya transmitido 
                          todo el mensaje.
                        </p>
                      </div>
                    </li>
                    <li>
                      <p><code>void RemoteEndpoint.sendPing(ByteBuffer appData)</code></p>
                      <div class="paragraph">
                        <p>Enviar un marco de ping al compañero.</p>
                      </div>
                    </li>
                    <li>
                      <p><code>void RemoteEndpoint.sendPong(ByteBuffer appData)</code></p>
                      <div class="paragraph">
                        <p>Enviar un marco pong al compañero.</p>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
            </ol>
          </div>
          <div class="paragraph">
            <p>
              El ejemplo en <a href="websocket004.html#BABFEBGA">Endpoints Anotados</a> demuestra cómo 
              utilizar este procedimiento para responder a todos los mensajes de texto entrantes.
            </p>
          </div>
          <div class="sect3" id="BABIFBCG">
            <h4 id="sending-messages-to-all-peers-connected-to-an-endpoint">
              Enviando Mensajes a Todos los Pares Conectados a un Endpoint
            </h4>
            <div class="paragraph">
              <p>
                Cada instancia de una clase de punto final está asociada con una y solo una conexión y par; 
                sin embargo, hay casos en los que una instancia de punto final necesita enviar mensajes a 
                todos los pares conectados. Los ejemplos incluyen aplicaciones de chat y subastas en línea. La 
                interfaz <code>Session</code> proporciona el método <code>getOpenSessions</code> para este 
                propósito. El siguiente ejemplo demuestra cómo usar este método para reenviar mensajes de 
                texto entrantes a todos los pares conectados:
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="prettyprint highlight">
                  <code class="language-oac_no_warn" data-lang="oac_no_warn">
@ServerEndpoint("/echoall")
public class EchoAllEndpoint {
   @OnMessage
   public void onMessage(Session session, String msg) {
      try {
         for (Session sess : session.getOpenSessions()) {
            if (sess.isOpen())
               sess.getBasicRemote().sendText(msg);
         }
      } catch (IOException e) { ... }
   }
}
                  </code>
                </pre>
              </div>
            </div>
          </div>
        </div>
        <div class="sect2" id="CIHIDFHD">
          <h3 id="receiving-messages">Recibiendo Mensajes</h3>
          <div class="paragraph">
            <p>
              La anotación <code>OnMessage</code> designa métodos que manejan los mensajes entrantes. Puede 
              tener como máximo tres métodos anotados con <code>@OnMessage</code> en un punto final, uno para 
              cada tipo de mensaje: texto, binario y pong. El siguiente ejemplo demuestra cómo designar 
              métodos para recibir los tres tipos de mensajes:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
@ServerEndpoint("/receive")
public class ReceiveEndpoint {
   @OnMessage
   public void textMessage(Session session, String msg) {
      System.out.println("Mensaje de texto: " + msg);
   }
   @OnMessage
   public void binaryMessage(Session session, ByteBuffer msg) {
      System.out.println("Mensaje binario: " + msg.toString());
   }
   @OnMessage
   public void pongMessage(Session session, PongMessage msg) {
      System.out.println("Mensaje pong: " +
                          msg.getApplicationData().toString());
   }
}
              </code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>		
        <td align="left">
          <a href="websocket004.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="websocket006.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <span id="copyright">
      <a href="img/cpyr.adoc">
        <img src="img/oracle.gif" height="10" alt="Logo de Oracle" />&nbsp;			
        <span>
          Copyright&nbsp;&copy;&nbsp;2017,&nbsp;Oracle&nbsp;y/o&nbsp;sus&nbsp;afiliados.&nbsp;Todos&nbsp;los&nbsp;
          derechos&nbsp;reservados.
        </span>
      </a>
    </span>
  </body>
</html>
