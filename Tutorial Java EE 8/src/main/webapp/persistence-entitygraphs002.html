<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8"/>
    <title>Conceptos Básicos del Grafo de Entidades</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://use.fontawesome.com/96c4d89611.js"></script>
  </head>
  <body>
    <table id="doc-title" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top">
          <b>Plataforma Java, Edición Empresarial (Java EE) 8</b><br />
          <b>El Tutorial de Java EE</b>
        </td>
      </tr>
    </table>
    <hr />
    <table width="90%" id="top-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>
        <td align="left">
          <a href="persistence-entitygraphs001.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="persistence-entitygraphs003.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class=" vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <div class="sect1" id="BABCJBCG">
      <h2 id="entity-graph-basics">Conceptos Básicos del Grafo de Entidades</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>
            Puede crear grafos de entidades de forma estática mediante el uso de anotaciones o un descriptor 
            de implementación, o de forma dinámica mediante el uso de interfaces estándar.
          </p>
        </div>
        <div class="paragraph">
          <p>
            Puede usar un grafo de entidad con el método <code>EntityManager.find</code> o como parte de una 
            consulta de las IPA de JPQL o Criteria especificando el grafo de entidad como una sugerencia para 
            la operación o consulta.
          </p>
        </div>
        <div class="paragraph">
          <p>
            Los grafos de entidad tienen atributos que corresponden a los campos que se buscarán 
            anticipadamente durante una operación <code>find</code> o de consulta. Los campos de clave 
            principal y versión de la clase de entidad siempre se recuperan y no es necesario agregarlos 
            explícitamente a un grafo de entidad.
          </p>
        </div>
        <div class="sect2" id="sthref184">
          <h3 id="the-default-entity-graph">El Grafo De Entidad Predeterminado</h3>
          <div class="paragraph">
            <p>
              De forma predeterminada, todos los campos de una entidad se obtienen de forma diferida, a menos 
              que el atributo <code>fetch</code> de los metadatos de la entidad esté configurado en 
              <code>javax.persistence.FetchType.EAGER</code>. El grafo de entidad predeterminado consta de 
              todos los campos de una entidad cuyos campos están configurados para ser buscados con 
              anticipación.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Por ejemplo, la siguiente entidad <code>EmailMessage</code> especifica que algunos campos se 
              buscarán con anticipación:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="prettyprint highlight">
                <code class="language-oac_no_warn" data-lang="oac_no_warn">
@Entity
public class EmailMessage implements Serializable {
    @Id
    String messageId;
    @Basic(fetch=EAGER)
    String subject;
    String body;
    @Basic(fetch=EAGER)
    String sender;
    @OneToMany(mappedBy="message", fetch=LAZY)
    Set&lt;EmailAttachment&gt; attachments;
    ...
}
                </code>
              </pre>
            </div>
          </div>
          <div class="paragraph">
            <p>
              El grafo de entidad predeterminado para esta entidad contendría los campos 
              <code>messageId</code>, <code>subject</code> y <code>sender</code>, pero no los campos 
              <code>body</code> o <code>attachments</code>.
            </p>
          </div>
        </div>
        <div class="sect2" id="sthref185">
          <h3 id="using-entity-graphs-in-persistence-operations">
            Usar Grafos de Entidad en Operaciones de Persistencia
          </h3>
          <div class="paragraph">
            <p>
              Los grafos de entidades se utilizan creando una instancia de la interfaz 
              <code>javax.persistence.EntityGraph</code> llamando a <code>EntityManager.getEntityGraph</code> 
              para grafos de entidades con nombre o <code>EntityManager.createEntityGraph</code> para crear 
              grafos de entidades dinámicas.
            </p>
          </div>
          <div class="paragraph">
            <p>
              Un grafo de entidad con nombre es un grafo de entidad especificado por la anotación 
              <code>@NamedEntityGraph</code> aplicada a las clases de entidad, o el elemento 
              <code>named-entity-graph</code> en los descriptores de implementación de la aplicación. Los 
              grafos de entidades con nombre definidos dentro del descriptor de implementación anulan 
              cualquier grafo de entidades basado en anotaciones con el mismo nombre.
            </p>
          </div>
          <div class="paragraph">
            <p>
              El grafo de entidad creado puede ser un grafo de búsqueda o un grafo de carga.
            </p>
          </div>
          <div class="paragraph">
            <p>Aquí se tratan los siguientes temas:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p><a href="#BABGEFCG">Obtener Grafos</a></p>
              </li>
              <li>
                <p><a href="#BABHJBHG">Cargar Grafos</a></p>
              </li>
            </ul>
          </div>
          <div class="sect3" id="BABGEFCG">
            <h4 id="fetch-graphs">Obtener Grafos</h4>
            <div class="paragraph">
              <p>
                Para especificar un grafo de búsqueda, establezca la propiedad 
                <code>javax.persistence.fetchgraph</code> cuando ejecute una operación de consulta o 
                <code>EntityManager.find</code>. Un grafo de obtención consta solo de los campos especificados 
                explícitamente en la instancia de <code>EntityGraph</code> e ignora la configuración 
                predeterminada del grafo de entidad.
              </p>
            </div>
            <div class="paragraph">
              <p>
                En el siguiente ejemplo, se ignora el grafo de entidad predeterminado y solo se incluye el 
                campo <code>body</code> en el grafo de búsqueda creado dinámicamente:
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="prettyprint highlight">
                  <code class="language-oac_no_warn" data-lang="oac_no_warn">
EntityGraph&lt;EmailMessage&gt; eg = em.createEntityGraph(EmailMessage.class);
eg.addAttributeNodes("body");
...
Properties props = new Properties();
props.put("javax.persistence.fetchgraph", eg);
EmailMessage message = em.find(EmailMessage.class, id, props);
                  </code>
                </pre>
              </div>
            </div>
          </div>
          <div class="sect3" id="BABHJBHG">
            <h4 id="load-graphs">Cargar Grafos</h4>
            <div class="paragraph">
              <p>
                Para especificar un grafo de carga, establezca la propiedad 
                <code>javax.persistence.loadgraph</code> cuando ejecute una operación de consulta o 
                <code>EntityManager.find</code>. Un grafo de carga consta de los campos especificados 
                explícitamente en la instancia de <code>EntityGraph</code> más cualquier campo en el grafo de 
                entidad predeterminado.
              </p>
            </div>
            <div class="paragraph">
              <p>
                En el siguiente ejemplo, el grafo de carga creado dinámicamente contiene todos los campos del 
                grafo de entidad predeterminado más el campo <code>body</code>:
              </p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="prettyprint highlight">
                  <code class="language-oac_no_warn" data-lang="oac_no_warn">
EntityGraph&lt;EmailMessage&gt; eg = em.createEntityGraph(EmailMessage.class);
eg.addAttributeNodes("body");
...
Properties props = new Properties();
props.put("javax.persistence.loadgraph", eg);
EmailMessage message = em.find(EmailMessage.class, id, props);
                  </code>
                </pre>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <table width="90%" id="bottom-nav" cellspacing="0" cellpadding="0">
      <colgroup>
        <col width="12%"/>
        <col width="12%"/>
        <col width="*"/>
      </colgroup>
      <tr>		
        <td align="left">
          <a href="persistence-entitygraphs001.html">
            <span class=" vector-font"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Anterior</span>
          </a>
        </td>
        <td align="left">
          <a href="persistence-entitygraphs003.html">
            <span class="vector-font"><i class="fa fa-arrow-circle-right vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Siguiente</span>
          </a>
        </td>
        <td align="right">
          <a href="toc.html">
            <span class="vector-font"><i class="fa fa-list vector-font" aria-hidden="true"></i></span>
            <span style="position:relative;top:-2px;">Contenidos</span>
          </a>
        </td>
      </tr>
    </table>
    <span id="copyright">
      <a href="img/cpyr.adoc">
        <img src="img/oracle.gif" height="10" alt="Logo de Oracle" />&nbsp;			
        <span>
          Copyright&nbsp;&copy;&nbsp;2017,&nbsp;Oracle&nbsp;y/o&nbsp;sus&nbsp;afiliados.&nbsp;Todos&nbsp;los&nbsp;
          derechos&nbsp;reservados.
        </span>
      </a>
    </span>
  </body>
</html>
